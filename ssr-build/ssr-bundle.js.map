{"version":3,"sources":["webpack:///webpack/bootstrap f9c434f48d470c715ea0","webpack:///./node_modules/window-size/index.js","webpack:///external \"tty\"","webpack:///./node_modules/preact/dist/preact.min.js","webpack:///./style.css?b85c","webpack:///./node_modules/classnames/index.js","webpack:///./node_modules/@firebase/polyfill/dist/index.esm.js","webpack:///./node_modules/firebase/app/dist/index.esm.js","webpack:///./node_modules/firebase/database/dist/index.esm.js","webpack:///./firebase.js","webpack:///./index.js","webpack:///./node_modules/@firebase/app/dist/index.esm.js","webpack:///./node_modules/tslib/tslib.es6.js","webpack:///./node_modules/@firebase/database/dist/index.esm.js","webpack:///./assets/style.css?a85e","webpack:///(webpack)/buildin/harmony-module.js","webpack:///./node_modules/@firebase/logger/dist/index.esm.js","webpack:///./node_modules/whatwg-fetch/fetch.js","webpack:///./node_modules/@firebase/util/dist/index.esm.js"],"names":["tty","require","module","exports","width","height","isatty","process","stdout","getWindowSize","columns","rows","Error","e","t","n","o","r","i","l","W","arguments","length","P","push","children","pop","a","T","nodeName","attributes","key","M","vnode","current","slice","call","__d","V","debounceRendering","D","x","splitText","_componentConstructor","__n","toLowerCase","u","defaultProps","c","document","createElementNS","createElement","p","parentNode","removeChild","s","style","cssText","E","test","innerHTML","__html","replace","substring","addEventListener","_","removeEventListener","__l","removeAttribute","removeAttributeNS","setAttributeNS","setAttribute","className","type","event","f","A","shift","afterMount","componentDidMount","d","H","R","ownerSVGElement","B","h","appendChild","_component","nodeValue","createTextNode","replaceChild","v","__preactattr_","N","firstChild","name","value","nextSibling","m","dangerouslySetInnerHTML","y","childNodes","b","g","w","C","k","__k","trim","insertBefore","ref","lastChild","previousSibling","F","prototype","render","U","constructor","__b","splice","__x","__r","getDerivedStateFromProps","base","componentWillMount","componentWillReceiveProps","context","__c","__p","props","syncComponentUpdates","state","__s","S","shouldComponentUpdate","componentWillUpdate","getChildContext","getSnapshotBeforeUpdate","L","__u","componentDidUpdate","afterUpdate","__h","beforeUnmount","componentWillUnmount","Promise","resolve","then","bind","setTimeout","setState","forceUpdate","j","cloneElement","createRef","Component","rerender","options","self","preact","hasOwn","hasOwnProperty","classNames","classes","arg","argType","Array","isArray","inner","apply","join","default","define","window","setTimeoutFunc","noop","fn","thisArg","TypeError","_state","_handled","_value","undefined","_deferreds","doResolve","handle","deferred","_immediateFn","cb","onFulfilled","onRejected","reject","promise","ret","newValue","finale","_unhandledRejectionFn","len","Handler","done","reason","ex","prom","callback","all","arr","args","remaining","res","val","race","values","setImmediate","err","console","warn","globalNS","global","createCommonjsModule","_global","Math","Function","__g","_core","core","version","__e","_core_1","_isObject","it","_anObject","_fails","exec","_descriptors","Object","defineProperty","get","is","_domCreate","_ie8DomDefine","_toPrimitive","toString","valueOf","dP","O","Attributes","_objectDp","_propertyDesc","bitmap","enumerable","configurable","writable","_hide","object","_has","id","px","random","_uid","concat","_redefine","SRC","TO_STRING","$toString","TPL","split","inspectSource","safe","isFunction","String","_aFunction","_ctx","that","PROTOTYPE","$export","source","IS_FORCED","IS_GLOBAL","G","IS_STATIC","IS_PROTO","IS_BIND","target","expProto","own","out","exp","_export","_cof","_iobject","propertyIsEnumerable","_defined","_toObject","ceil","floor","_toInteger","isNaN","min","_toLength","_isArray","SHARED","store","_shared","_wks","Symbol","USE_SYMBOL","$exports","SPECIES","_arraySpeciesConstructor","original","_arraySpeciesCreate","_arrayMethods","TYPE","$create","IS_MAP","IS_FILTER","IS_SOME","IS_EVERY","IS_FIND_INDEX","NO_HOLES","create","$this","callbackfn","index","result","UNSCOPABLES","ArrayProto","_addToUnscopables","$find","KEY","forced","find","$find$1","KEY$1","forced$1","findIndex","_toIobject","max","min$1","_toAbsoluteIndex","_arrayIncludes","IS_INCLUDES","el","fromIndex","shared","_sharedKey","arrayIndexOf","IE_PROTO","_objectKeysInternal","names","_enumBugKeys","_objectKeys","keys","f$1","getOwnPropertySymbols","_objectGops","f$2","_objectPie","$assign","assign","_objectAssign","K","forEach","aLen","getSymbols","isEnum","MATCH","_isRegexp","isRegExp","_stringContext","searchString","NAME","MATCH$1","_failsIsRegexp","re","STARTS_WITH","$startsWith","startsWith","search","_stringRepeat","repeat","count","str","Infinity","RangeError","_meta","META","setDesc","isExtensible","FREEZE","preventExtensions","setMeta","fastKey","getWeak","onFreeze","meta","NEED","_meta_1","_meta_2","_meta_3","_meta_4","_meta_5","def","TAG","_setToStringTag","tag","stat","f$3","_wksExt","_library","_wksDefine","$Symbol","charAt","_enumKeys","symbols","_objectDps","defineProperties","Properties","document$1","_html","documentElement","IE_PROTO$1","Empty","PROTOTYPE$1","createDict","iframe","lt","gt","iframeDocument","display","src","contentWindow","open","write","close","_objectCreate","hiddenKeys","f$4","getOwnPropertyNames","_objectGopn","gOPN","toString$1","windowNames","getWindowNames","f$5","_objectGopnExt","gOPD","getOwnPropertyDescriptor","f$6","_objectGopd","gOPD$1","dP$1","gOPN$1","$JSON","JSON","_stringify","stringify","PROTOTYPE$2","HIDDEN","TO_PRIMITIVE","SymbolRegistry","AllSymbols","OPSymbols","ObjectProto","USE_NATIVE","QObject","setter","findChild","setSymbolDesc","protoDesc","wrap","sym","_k","isSymbol","iterator","$defineProperty","$defineProperties","$propertyIsEnumerable","$getOwnPropertyDescriptor","$getOwnPropertyNames","$getOwnPropertySymbols","IS_OP","$set","set","es6Symbols","wellKnownSymbols","keyFor","useSetter","useSimple","replacer","$replacer","TAG$1","ARG","tryGet","_classof","callee","symbol","_stringAt","pos","charCodeAt","_iterators","IteratorPrototype","_iterCreate","Constructor","next","IE_PROTO$2","ObjectProto$1","_objectGpo","getPrototypeOf","ITERATOR","BUGGY","FF_ITERATOR","KEYS","VALUES","returnThis","_iterDefine","Base","DEFAULT","IS_SET","FORCED","getMethod","kind","proto","entries","DEF_VALUES","VALUES_BUG","$native","$default","$entries","$anyNative","methods","$at","iterated","_t","_i","point","_iterStep","es6_array_iterator","Arguments","ITERATOR$1","TO_STRING_TAG","ArrayValues","DOMIterables","CSSRuleList","CSSStyleDeclaration","CSSValueList","ClientRectList","DOMRectList","DOMStringList","DOMTokenList","DataTransferItemList","FileList","HTMLAllCollection","HTMLCollection","HTMLFormElement","HTMLSelectElement","MediaList","MimeTypeArray","NamedNodeMap","NodeList","PaintRequestList","Plugin","PluginArray","SVGLengthList","SVGNumberList","SVGPathSegList","SVGPointList","SVGStringList","SVGTransformList","SourceBufferList","StyleSheetList","TextTrackCueList","TextTrackList","TouchList","collections","explicit","Collection","firebase","config","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","initializeApp","App","word","translation","translations","addWord","addTranslation","showStartPage","showAddNewWord","showWordAdded","plusHover","showShare","isShowAddNewBlock","handleChange","checkWord","handleAddWordChange","handleAddTranslationChange","obj","translationsRef","database","item","populate","map","showAddNew","hideAddNew","toggleAddNewWord","hideStartPage","showShareBtns","on","snapshot","newState","onclick","addNewClass","location","href","contains","DEFAULT_ENTRY_NAME","tokenListeners","FirebaseAppImpl","firebase_","isDeleted_","services_","name_","_automaticDataCollectionEnabled","automaticDataCollectionEnabled","options_","deepCopy","INTERNAL","getUid","getToken","addAuthTokenListener","removeAuthTokenListener","filter","listener","checkDestroyed_","delete","_this","removeApp","services","serviceKey","instanceKey","service","_getService","instanceIdentifier","instanceSpecifier","factories","extendApp","deepExtend","error","log","createFirebaseNamespace","apps_","appHooks","namespace","__esModule","app","apps","SDK_VERSION","registerService","extendNamespace","createSubscribe","ErrorFactory","useAsService","patchProperty","getApps","callAppHooks","rawConfig","name_1","createService","serviceProperties","appHook","allowMultipleInstances","serviceNamespace","appArg","serviceFxn","eventName","serviceName","factoryName","useService","code","appErrors","errors","extendStatics","setPrototypeOf","__proto__","__extends","__","__assign","__rest","indexOf","__decorate","decorators","desc","Reflect","decorate","__param","paramIndex","decorator","__metadata","metadataKey","metadataValue","metadata","__awaiter","_arguments","generator","fulfilled","step","rejected","__generator","body","label","sent","trys","ops","verb","op","__exportStar","__values","__read","ar","__spread","__await","__asyncGenerator","asyncIterator","q","resume","settle","fulfill","__asyncDelegator","__asyncValues","__makeTemplateObject","cooked","raw","__importStar","mod","__importDefault","DOMStorageWrapper","domStorage_","prefix_","removeItem","prefixedName_","setItem","storedVal","getItem","jsonEval","remove","MemoryStorage","cache_","isInMemoryStorage","createStoragefor","domStorageName","domStorage","PersistentStorage","SessionStorage","logClient","Logger","LUIDGenerator","sha1","utf8Bytes","stringToByteArray","Sha1","update","sha1Bytes","digest","base64","encodeByteArray","buildLogMessage_","var_args","message","logger","firstLog_","enableLogging","logger_","persistent","assert","logLevel","LogLevel","VERBOSE","logWrapper","prefix","fatal","warnIfPageIsSecure","protocol","isInvalidJSONNumber","data","Number","POSITIVE_INFINITY","NEGATIVE_INFINITY","executeWhenDOMReady","isNodeSdk","readyState","called_1","wrappedFn_1","attachEvent","MIN_NAME","MAX_NAME","nameCompare","aAsInt","tryParseInt","bAsInt","stringCompare","requireKey","ObjectToUniqueKey","sort","splitStringBySize","segsize","dataSegs","each","doubleToIEEE754String","ebits","fbits","bias","ln","bits","abs","pow","LN2","round","reverse","hexByteString","hexByte","parseInt","substr","isChromeExtensionContentScript","isWindowsStoreApp","Windows","UI","errorForServerCode","query","path","toUpperCase","INTEGER_REGEXP_","RegExp","intVal","exceptionGuard","stack","beingCrawled","userAgent","setTimeoutNonBlocking","time","timeout","Path","pathOrString","pieceNum","pieces_","copyTo","pieceNum_","getFront","getLength","popFront","getBack","pathString","toUrlEncodedString","encodeURIComponent","begin","parent","pieces","child","childPathObj","childPieces","isEmpty","relativePath","outerPath","innerPath","outer","comparePaths","left","right","leftKeys","rightKeys","cmp","equals","other","ValidationPath","errorPrefix_","parts_","byteLength_","stringLength","checkValid_","last","MAX_PATH_LENGTH_BYTES","MAX_PATH_DEPTH","toErrorString","PROTOCOL_VERSION","VERSION_PARAM","TRANSPORT_SESSION_PARAM","REFERER_PARAM","FORGE_REF","FORGE_DOMAIN","LAST_SESSION_PARAM","WEBSOCKET","LONG_POLLING","RepoInfo","host","secure","webSocketOnly","persistenceKey","domain","internalHost","needsQueryParam","isCustomHost","isCacheableHost","isDemoHost","updateHost","newHost","connectionURL","params","connURL","pairs","toURLString","decodePath","pathStringDecoded","piece","decodeURIComponent","decodeQuery","queryString","results","_a","segment","kv","parseRepoInfo","dataURL","parsedUrl","parseURL","subdomain","scheme","repoInfo","port","colonInd","slashInd","questionMarkInd","queryParams","parts","INVALID_KEY_REGEX_","INVALID_PATH_REGEX_","MAX_LEAF_SIZE_","isValidKey","isValidPathString","isValidRootPathString","isValidPriority","priority","validateFirebaseDataArg","fnName","argumentNumber","optional","validateFirebaseData","errorPrefix","errorPrefix$$1","path_","hasDotValue_1","hasActualChild_1","validateFirebaseMergePaths","mergePaths","curPath","prevPath","validateFirebaseMergeDataArg","validatePriority","validateEventType","eventType","validateKey","validatePathString","validateRootPathString","validateWritablePath","validateUrl","validateBoolean","bool","OnDisconnect","repo_","cancel","onComplete","validateArgCount","validateCallback","Deferred","onDisconnectCancel","wrapCallback","onDisconnectSet","setWithPriority","onDisconnectSetWithPriority","objectToMerge","newObjectToMerge","onDisconnectUpdate","TransactionResult","committed","toJSON","nextPushId","PUSH_CHARS","lastPushTime","lastRandChars","now","duplicateTime","timeStampChars","NamedNode","node","Wrap","Index","getCompare","compare","indexedValueChanged","oldNode","newNode","oldWrapped","newWrapped","minPost","MIN","__EMPTY_NODE","KeyIndex","_super","isDefinedOn","assertionError","maxPost","makePost","indexValue","KEY_INDEX","MAX_NODE","setMaxNode","priorityHashText","validatePriorityNode","priorityNode","isLeafNode","getPriority","__childrenNodeConstructor","LeafNode","value_","priorityNode_","EMPTY_NODE","lazyHash_","updatePriority","newPriorityNode","getImmediateChild","childName","getChild","hasChild","getPredecessorChildName","childNode","updateImmediateChild","newChildNode","updateChild","front","numChildren","forEachChild","action","exportFormat","getValue","hash","toHash","compareTo","compareToLeafNode_","otherLeaf","otherLeafType","thisLeafType","otherIndex","VALUE_TYPE_ORDER","thisIndex","withIndex","isIndexed","nodeFromJSON","MAX_NODE$1","setNodeFromJSON","setMaxNode$1","PriorityIndex","aPriority","bPriority","indexCmp","PRIORITY_INDEX","SortedMapIterator","startKey","comparator","isReverse_","resultGenerator_","nodeStack_","getNext","hasNext","peek","LLRBNode","color","RED","SortedMap","copy","inorderTraversal","reverseTraversal","min_","minKey","maxKey","insert","fixUp_","removeMin_","isRed_","moveRedLeft_","smallest","rotateRight_","moveRedRight_","rotateLeft_","colorFlip_","nl","nr","checkMaxDepth_","blackDepth","check_","BLACK","LLRBEmptyNode","comparator_","root_","getPredecessorKey","rightParent","getIterator","resultGenerator","getIteratorFrom","getReverseIteratorFrom","getReverseIterator","LOG_2","Base12Num","logBase2","num","bitMask","current_","mask","bits_","nextBitIsOne","buildChildSet","childList","keyFn","mapSortFn","buildBalancedTree","low","high","namedNode","middle","buildFrom12Array","base12","root","buildPennant","chunkSize","childTree","attachPennant","pennant","isOne","_defaultIndexMap","fallbackObject","IndexMap","indexes_","indexSet_","indexKey","sortedMap","safeGet","hasIndex","indexDefinition","addIndex","existingChildren","sawIndexedValue","iter","newIndex","indexName","newIndexSet","clone","newIndexes","addToIndexes","indexedChildren","existingSnap","newChildren","removeFromIndexes","NAME_ONLY_COMPARATOR","NAME_COMPARATOR","ChildrenNode","children_","indexMap_","Default","newIndexMap","newPriority","newImmediateChild","numKeys","allIntegerKeys","array","toHash_1","childHash","idx","resolveIndex_","predecessor","getFirstChildName","getFirstChild","getLastChildName","getLastChild","wrappedNode","startPost","endPost","MAX_NODE$2","otherChildrenNode","thisIter","otherIter","thisCurrent","otherCurrent","MaxNode","MAX","USE_HINZE","nodeFromJSON$1","json","jsonLeaf","children_1","childrenHavePriority_1","hinzeJsonObj_1","childSet","sortedChildSet","node_1","jsonObj_1","childData","ValueIndex","valueNode","VALUE_INDEX","PathIndex","indexPath_","extractChild","snap","aChild","bChild","DataSnapshot","node_","ref_","index_","exportVal","exists","childPathString","childPath","childRef","childrenNode","hasChildren","getKey","getRef","DataEvent","eventRegistration","prevName","getPath","getParent","getEventType","getEventRunner","CancelEvent","ValueEventRegistration","callback_","cancelCallback_","context_","respondsTo","createEvent","change","getQueryParams","getIndex","snapshotNode","eventData","ctx","cancelCB_1","cb_1","createCancelEvent","matches","hasAnyCallback","ChildEventRegistration","callbacks_","eventToCheck","cancelCB_2","cb_2","otherCount","getCount","thisCount","otherKey","getAnyKey","thisKey","every","__referenceConstructor","Query","repo","queryParams_","orderByCalled_","validateQueryEndpoints_","startNode","endNode","hasStart","getIndexStartValue","hasEnd","getIndexEndValue","tooManyArgsError","wrongArgTypeError","startName","getIndexStartName","endName","getIndexEndName","validateLimit_","hasLimit","hasAnchoredLimit","validateNoPreviousOrderByCall_","cancelCallbackOrContext","getCancelAndContextArgs_","onValueEvent","callbacks","onChildEvent","cancelCallback","container","addEventCallbackForQuery","off","validateContextObject","valueCallback","removeEventCallbackForQuery","once","userCallback","cancelOrContext","firstCall","catch","onceCallback","limitToFirst","limit","limitToLast","orderByChild","parsedPath","newParams","orderBy","orderByKey","orderByPriority","orderByValue","startAt","endAt","equalTo","queryObject","getQueryObject","queryIdentifier","isEqual","error$$1","sameRepo","samePath","sameQueryIdentifier","CountedSet","add","clear","SparseSnapshotTree","childKey","remember","forget","self_1","tree","safeToRemove","forEachTree","prefixPath","func","generateWithValues","Date","getTime","resolveDeferredValue","serverValues","resolveDeferredValueTree","resolvedTree","resolveDeferredValueSnapshot","rawPri","leafNode","OperationType","OperationSource","fromUser","fromServer","queryId","tagged","User","Server","forServerTaggedQuery","AckUserWrite","affectedTree","revert","ACK_USER_WRITE","operationForChild","subtree","emptyChildrenSingleton","EmptyChildren","ImmutableTree","fromObject","childSnap","findRootMostMatchingPathAndValue","predicate","childExistingPathAndValue","fullPath","findRootMostValueAndPath","toSet","newChild","setTree","newTree","fold","fold_","pathSoFar","accum","findOnPath","findOnPath_","pathToFollow","nextChild","foreachOnPath","foreachOnPath_","currentRelativePath","foreach","foreach_","foreachChild","ListenComplete","LISTEN_COMPLETE","Overwrite","OVERWRITE","Merge","MERGE","CacheNode","fullyInitialized_","filtered_","isFullyInitialized","isFiltered","isCompleteForPath","isCompleteForChild","getNode","ViewCache","eventCache_","serverCache_","updateEventSnap","eventSnap","complete","filtered","updateServerSnap","serverSnap","getEventCache","getCompleteEventSnap","getServerCache","getCompleteServerSnap","Change","oldSnap","valueChange","VALUE","childAddedChange","CHILD_ADDED","childRemovedChange","CHILD_REMOVED","childChangedChange","newSnapshot","oldSnapshot","CHILD_CHANGED","childMovedChange","CHILD_MOVED","IndexedFilter","affectedPath","optChangeAccumulator","oldChild","trackChildChange","updateFullNode","newSnap","filtersNodes","getIndexedFilter","ChildChangeAccumulator","changeMap_","oldChange","oldType","getChanges","getValues","NoCompleteChildSource_","getCompleteChild","getChildAfterChild","NO_COMPLETE_CHILD_SOURCE","WriteTreeCompleteChildSource","writes_","viewCache_","optCompleteServerCache_","serverNode","calcCompleteChild","completeServerData","nodes","calcIndexedSlice","ProcessorResult","viewCache","changes","ViewProcessor","filter_","assertIndexed","applyOperation","oldViewCache","operation","writesCache","completeCache","accumulator","newViewCache","filterServerNode","overwrite","applyUserOverwrite_","applyServerOverwrite_","merge","applyUserMerge_","applyServerMerge_","ackUserWrite","ackUserWrite_","revertUserWrite_","listenComplete_","maybeAddValueEvent_","isLeafOrEmpty","oldCompleteSnap","generateEventCacheAfterServerEvent_","changePath","oldEventSnap","shadowingWrite","newEventCache","serverCache","completeChildren","completeEventChildren","calcCompleteEventChildren","completeNode","calcCompleteEventCache","oldEventNode","updatedPriority","calcEventCacheAfterServerOverwrite","childChangePath","newEventChild","eventChildUpdate","changedSnap","oldServerSnap","newServerCache","serverFilter","newServerNode","newEventSnap","cacheHasChild_","changedChildren","curViewCache","writePath","applyMerge_","viewMergeTree","serverChild","childMergeTree","isUnknownDeepMerge","ackPath","changedChildren_1","changedChildren_2","mergePath","serverCachePath","oldServerNode","completeServerCache","oldEventCache","serverChildren","EventGenerator","query_","generateEventsForChanges","eventCache","eventRegistrations","events","moves","generateEventsForType_","registrations","filteredChanges","compareChanges_","materializedChange","materializeSingleChange_","registration","aWrapped","bWrapped","View","initialViewCache","eventRegistrations_","indexFilter","getNodeFilter","processor_","initialServerCache","initialEventCache","eventGenerator_","getQuery","getCompleteServerCache","cache","loadsAllData","addEventRegistration","removeEventRegistration","cancelError","cancelEvents","path_1","maybeEvent","existing","generateEventsForChanges_","getInitialEvents","initialChanges","eventNode","__referenceConstructor$1","SyncPoint","views_","optCompleteServerCache","view","events_1","serverCacheComplete","eventCacheComplete","removed","hadCompleteView","hasCompleteView","viewQueryId","getQueryViews","viewForQuery","getCompleteView","viewExistsForQuery","completeView","findValue","CompoundWrite","writeTree_","addWrite","rootmost","rootMostPath","newWriteTree","addWrites","updates","newWrite","removeWrite","hasCompleteWrite","getCompleteNode","getCompleteChildren","childCompoundWrite","shadowingNode","applySubtreeWrite_","writeTree","priorityWrite_1","WriteTree","visibleWrites_","allWrites_","lastWriteId_","childWrites","WriteTreeRef","addOverwrite","writeId","visible","addMerge","getWrite","record","writeToRemove","removedWriteWasVisible","removedWriteOverlapsWithOtherWrites","currentWrite","recordContainsPath_","resetTree_","getCompleteWriteData","treePath","writeIdsToExclude","includeHiddenWrites","subMerge","layeredCache","mergeAtPath","layerTree_","completeServerChildren","topLevelSet","merge_1","existingEventSnap","existingServerSnap","childMerge","toIterate","writeRecord","findKey","DefaultFilter_","writes","treeRoot","compoundWrite","deepNode","treePath_","existingServerCache","SyncTree","listenProvider_","syncPointTree_","pendingWriteTree_","tagToQueryMap_","queryToTagMap_","applyUserOverwrite","newData","applyOperationToSyncPoints_","applyUserMerge","changeTree","needToReevaluate","affectedTree_1","applyServerOverwrite","applyServerMerge","applyListenComplete","applyTaggedQueryOverwrite","queryKey","queryKeyForTag_","parseQueryKey_","queryPath","applyTaggedOperation_","applyTaggedQueryMerge","applyTaggedListenComplete","foundAncestorDefaultView","pathToSyncPoint","sp","syncPoint","childSyncPoint","viewAlreadyExists","makeQueryKey_","getNextQueryTag_","setupListener_","maybeSyncPoint","removedAndEvents","removingDefault","covered","parentSyncPoint","newViews","collectDistinctViewsForSubTree_","newQuery","createListenerForView_","startListening","queryForListening_","tagForQuery_","hashFn","defaultTag","stopListening","queryToRemove","tagToRemove","removeTags_","includeHiddenSets","maybeChildSyncPoint","childMap","views_1","childViews","queries","removedQuery","removedQueryKey","removedQueryTag","isDefault","queriesToStop","queries_1","childQueries","queryToStop","status","splitIndex","nextQueryTag_","applyOperationHelper_","syncPointTree","applyOperationDescendantsHelper_","childOperation","childServerCache","childWritesCache","SnapshotHolder","rootNode_","updateSnapshot","newSnapshotNode","AuthTokenProvider","app_","forceRefresh","addTokenChangeListener","removeTokenChangeListener","notifyForInvalidToken","errorMessage","StatsCollection","counters_","incrementCounter","amount","StatsManager","getCollection","hashString","collections_","getOrCreateReporter","creatorFunction","reporters_","StatsListener","collection_","last_","newStats","delta","FIRST_STATS_MIN_TIME","FIRST_STATS_MAX_TIME","REPORT_STATS_INTERVAL","StatsReporter","collection","server_","statsToReport_","statsListener_","reportStats_","includeStat","stats","reportedStats","haveStatsToReport","reportStats","EventQueue","eventLists_","recursionDepth_","queueEvents","eventDataList","currList","eventPath","EventList","raiseEventsAtPath","raiseQueuedEventsMatchingPredicate_","raiseEventsForChangedPath","changedPath","sentAll","eventList","raise","events_","eventFn","EventEmitter","allowedEvents_","listeners_","trigger","listeners","validateEventType_","getInitialEvent","et","VisibilityMonitor","hidden","visibilityChange","visible_","getInstance","OnlineMonitor","online_","isMobileCordova","currentlyOnline","PacketReceiver","onMessage_","pendingResponses","currentResponseNum","closeAfterResponse","onClose","closeAfter","responseNum","handleResponse","requestNum","_loop_1","toProcess","this_1","_loop_2","state_1","FIREBASE_LONGPOLL_START_PARAM","FIREBASE_LONGPOLL_CLOSE_COMMAND","FIREBASE_LONGPOLL_COMMAND_CB_NAME","FIREBASE_LONGPOLL_DATA_CB_NAME","FIREBASE_LONGPOLL_ID_PARAM","FIREBASE_LONGPOLL_PW_PARAM","FIREBASE_LONGPOLL_SERIAL_PARAM","FIREBASE_LONGPOLL_CALLBACK_ID_PARAM","FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM","FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET","FIREBASE_LONGPOLL_DATA_PARAM","FIREBASE_LONGPOLL_DISCONN_FRAME_PARAM","FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM","MAX_URL_DATA_SIZE","SEG_HEADER_SIZE","MAX_PAYLOAD_SIZE","KEEPALIVE_REQUEST_INTERVAL","LP_CONNECT_TIMEOUT","BrowserPollConnection","connId","transportSessionId","lastSessionId","bytesSent","bytesReceived","everConnected_","log_","stats_","urlFn","onMessage","onDisconnect","curSegmentNum","onDisconnect_","myPacketOrderer","isClosed_","connectTimeoutTimer_","onClosed_","scriptTagHolder","FirebaseIFrameScriptHolder","command","arg1","arg2","incrementIncomingBytes_","clearTimeout","password","sendNewPolls","pN","urlParams","uniqueCallbackIdentifier","connectURL","addTag","start","startLongPoll","addDisconnectPingFrame","forceAllow","forceAllow_","forceDisallow","forceDisallow_","isAvailable","markConnectionHealthy","shutdown_","myDisconnFrame","send","dataStr","base64data","base64Encode","enqueueSegment","pw","commandCB","onMessageCB","outstandingRequests","pendingSegs","currentSerial","myIFrame","createIFrame_","script","currentDomain","iframeContents","doc","contentDocument","alive","myID","myPW","theURL","nodeRestRequest","newRequest_","curDataString","nextSeg","theSeg","seg","ts","addLongPollTag_","segnum","totalsegs","url","serial","doNewRequest","keepaliveTimeout","readyStateCB","loadCB","doNodeLongPoll","newScript_1","async","onload","onreadystatechange","rstate","onerror","WEBSOCKET_MAX_FRAME_SIZE","WEBSOCKET_KEEPALIVE_INTERVAL","WebSocketImpl","MozWebSocket","WebSocket","WebSocketConnection","keepaliveTimer","frames","totalFrames","connectionURL_","device","CONSTANTS","NODE_ADMIN","headers","platform","env","proxy","origin","mySock","onopen","onclose","onmessage","handleIncomingFrame","isOldAndroid","navigator","oldAndroidRegex","oldAndroidMatch","match","parseFloat","previouslyFailed","appendFrame_","fullMess","jsonMess","handleNewFrameCount_","frameCount","extractFrameCount_","mess","resetKeepAlive","remainingData","sendString_","clearInterval","setInterval","responsesRequiredToBeHealthy","healthyTimeout","TransportManager","initTransports_","isWebSocketsAvailable","isSkipPollConnection","transports_","transports_1","ALL_TRANSPORTS","transport","initialTransport","upgradeTransport","UPGRADE_TIMEOUT","DELAY_BEFORE_SENDING_EXTRA_REQUESTS","BYTES_SENT_HEALTHY_OVERRIDE","BYTES_RECEIVED_HEALTHY_OVERRIDE","MESSAGE_TYPE","MESSAGE_DATA","CONTROL_SHUTDOWN","CONTROL_RESET","CONTROL_ERROR","CONTROL_PONG","SWITCH_ACK","END_TRANSMISSION","PING","SERVER_HELLO","Connection","repoInfo_","onReady_","onKill_","connectionCount","pendingDataMessages","state_","transportManager_","start_","conn","conn_","nextTransportId_","primaryResponsesRequired_","onMessageReceived","connReceiver_","onConnectionLost","disconnReceiver_","tx_","rx_","secondaryConn_","isHealthy_","healthyTimeout_ms","healthyTimeout_","everConnected","onConnectionLost_","onSecondaryConnectionLost_","onPrimaryMessageReceived_","onSecondaryMessageReceived_","sendRequest","dataMsg","msg","sendData_","tryCleanupConnection","onSecondaryControl_","controlData","cmd","upgradeIfSecondaryHealthy_","secondaryResponsesRequired_","parsedData","layer","proceedWithUpgrade_","onControl_","onDataMessage_","onPrimaryResponse_","payload","onHandshake_","onConnectionShutdown_","onReset_","sendPingOnPrimaryIfNecessary_","handshake","timestamp","sessionId","onConnectionEstablished_","tryStartUpgrade_","startUpgrade_","closeConnections_","ServerActions","put","refreshAuthToken","token","onDisconnectPut","onDisconnectMerge","RECONNECT_MIN_DELAY","RECONNECT_MAX_DELAY_DEFAULT","RECONNECT_MAX_DELAY_FOR_ADMINS","RECONNECT_DELAY_MULTIPLIER","RECONNECT_DELAY_RESET_TIMEOUT","SERVER_KILL_INTERRUPT_REASON","INVALID_AUTH_TOKEN_THRESHOLD","PersistentConnection","onDataUpdate_","onConnectStatus_","onServerInfoUpdate_","authTokenProvider_","authOverride_","nextPersistentConnectionId_","interruptReasons_","listens_","outstandingPuts_","outstandingPutCount_","onDisconnectRequestQueue_","connected_","reconnectDelay_","maxReconnectDelay_","securityDebugCallback_","establishConnectionTimer_","requestCBHash_","requestNumber_","realtime_","authToken_","forceTokenRefresh_","invalidAuthTokenCount_","firstConnection_","lastConnectionAttemptTime_","lastConnectionEstablishedTime_","scheduleConnect_","onVisible_","onOnline_","onResponse","curReqNum","listen","currentHashFn","listenSpec","sendListen_","req","warnOnListenWarnings_","currentListenSpec","removeListen_","warnings","indexSpec","indexPath","tryAuth","reduceReconnectDelayIfAdminCredential_","credential","isFirebaseSecret","isAdmin","token_1","authMethod","isValidFormat","requestData","cred","onAuthRevoked_","unlisten","sendUnlisten_","queryObj","sendOnDisconnect_","request","response","putInternal","sendPut_","queued","errorReason","reqNum","onDataPush_","onListenRevoked_","onSecurityDebugPacket_","handleTimestamp_","sendConnectStats_","restoreState_","establishConnection_","online","onRealtimeDisconnect_","cancelSentTransactions_","shouldReconnect_","timeSinceLastConnectSucceeded","timeSinceLastConnectAttempt","reconnectDelay","onDataMessage_1","onReady_1","onDisconnect_1","connId_1","nextConnectionId_","lastSessionId_1","canceled_1","connection_1","closeFn_1","sendRequestFn","accessToken","interrupt","serverTimeOffset","normalizedPathString","statusCode","explanation","clientName","NODE_CLIENT","isReactNative","ReadonlyRestClient","getListenId_","listenId","thisListen","queryStringParameters","toRestQueryStringParameters","restRequest_","status_1","authTokenData","authToken","querystring","xhr","XMLHttpRequest","responseText","INTERRUPT_REASON","Repo","forceRestClient","dataUpdateCount","eventQueue_","nextWriteId_","interceptServerDataCallback_","persistentConnection_","authTokenProvider","authOverride","statsReporter_","transactions_init_","infoData_","infoSyncTree_","infoEvents","updateInfo_","serverSyncTree_","serverTime","offsetNode","offset","generateServerValues","isMerge","taggedChildren","taggedSnap","rerunTransactions_","interceptServerData_","connectStatus","runOnDisconnectEvents_","getNextWriteId_","newVal","newNodeUnresolved","success","clearEvents","callOnCompleteCallback","abortTransactions_","childrenToMerge","empty","changedKey","changedValue","writeId_1","resolvedOnDisconnectTree","showDelta","longestName","reduce","previousValue","currentValue","statsIncrementCounter","metric","__database","Database","RangedFilter","indexedFilter_","startPost_","getStartPost_","endPost_","getEndPost_","getStartPost","getEndPost","LimitedFilter","rangedFilter_","limit_","getLimit","reverse_","isViewFromLeft","fullLimitUpdateChild_","inRange","indexCompare_1","foundStartPost","changeAccumulator","indexCmp_1","newChildNamedNode","windowBoundary","oldChildSnap","compareNext","remainsInWindow","nextChildInRange","QueryParams","limitSet_","startSet_","startNameSet_","endSet_","endNameSet_","viewFrom_","indexStartValue_","indexStartName_","indexEndValue_","indexEndName_","WIRE_PROTOCOL_CONSTANTS_","VIEW_FROM_LEFT","copy_","newLimit","VIEW_FROM_RIGHT","WIRE_PROTOCOL_CONSTANTS","INDEX_START_VALUE","INDEX_START_NAME","INDEX_END_VALUE","INDEX_END_NAME","LIMIT","viewFrom","VIEW_FROM","INDEX","REST_CONSTANTS","REST_QUERY_CONSTANTS_","qs","ORDER_BY","START_AT","END_AT","LIMIT_TO_FIRST","LIMIT_TO_LAST","Reference","parentPath","getRoot","databaseProp","transaction","transactionUpdate","applyLocally","promiseComplete","startTransaction","setPriority","thennablePushRef","pushRef","TreeNode","childCount","Tree","parent_","subTree","pathObj","setValue","updateParents_","forEachDescendant","includeSelf","childrenFirst","forEachAncestor","forEachImmediateDescendantWithValue","updateChild_","childEmpty","childExists","TransactionStatus","MAX_TRANSACTION_RETRIES_","transactionQueueTree_","watchRef","unwatcher","order","retryCount","abortReason","currentWriteId","currentInputSnapshot","currentOutputSnapshotRaw","currentOutputSnapshotResolved","currentState","getLatestState_","RUN","queueNode","nodeQueue","priorityForNode","currentNode","sendReadyTransactions_","excludeSets","pruneCompletedTransactionsBelowNode_","queue","buildTransactionQueue_","allRun","sendTransactionQueue_","setsToIgnore","txn","latestState","snapToSend","latestHash","SENT","dataToSend","pathToSend","COMPLETED","SENT_NEEDS_ABORT","NEEDS_ABORT","rootMostTransactionNode","getAncestorTransactionNode_","rerunTransactionQueue_","txnsToRerun","abortTransaction","newDataNode","hasExplicitPriority","oldWriteId","newNodeResolved","lastInput","transactionNode","transactionQueue","aggregateTransactionQueuesForNode_","to","from","abortTransactionsOnNode_","lastSent","DATABASE_URL_OPTION","_staticInstance","RepoManager","repos_","useRestClient_","appName","dbUrl","databaseFromApp","createRepo","deleteRepo","appRepos","DatabaseInternals","checkDeleted_","refFromURL","apiName","parsedURL","goOffline","goOnline","ServerValue","TIMESTAMP","forceLongPolling","forceWebSockets","setSecurityDebugCallback","interceptServerData","freeze","DataConnection","simpleListen","echo","onEcho","RealTimeConnection","hijackHash","newHash","oldPut","opt_onComplete","opt_hash","ConnectionTarget","listens","firebaseRef","TEST_ACCESS","registerDatabase","instance","unused","originalModule","webpackPolyfill","instances","defaultLogLevel","INFO","defaultLogHandler","logType","toISOString","DEBUG","info","WARN","ERROR","_logLevel","_logHandler","debug","setLogLevel","level","inst","fetch","support","searchParams","iterable","blob","Blob","formData","arrayBuffer","viewClasses","isDataView","DataView","isPrototypeOf","isArrayBufferView","ArrayBuffer","isView","normalizeName","normalizeValue","iteratorFor","items","Headers","append","header","oldValue","has","consumed","bodyUsed","fileReaderReady","reader","readBlobAsArrayBuffer","FileReader","readAsArrayBuffer","readBlobAsText","readAsText","readArrayBufferAsText","buf","Uint8Array","chars","fromCharCode","bufferClone","byteLength","buffer","Body","_initBody","_bodyInit","_bodyText","_bodyBlob","FormData","_bodyFormData","URLSearchParams","_bodyArrayBuffer","text","decode","parse","normalizeMethod","method","upcased","Request","input","credentials","mode","referrer","form","bytes","parseHeaders","rawHeaders","preProcessedHeaders","line","Response","bodyInit","ok","statusText","redirectStatuses","redirect","init","getAllResponseHeaders","responseURL","ontimeout","withCredentials","responseType","setRequestHeader","polyfill","assertion","byteArrayToString","c1","c2","c3","c4","byteToCharMap_","charToByteMap_","byteToCharMapWebSafe_","charToByteMapWebSafe_","ENCODED_VALS_BASE","ENCODED_VALS","ENCODED_VALS_WEBSAFE","HAS_NATIVE_SUPPORT","atob","opt_webSafe","init_","byteToCharMap","output","byte1","haveByte2","byte2","haveByte3","byte3","outByte1","outByte2","outByte3","outByte4","encodeString","btoa","decodeString","decodeStringToByteArray","charToByteMap","haveByte4","byte4","base64Decode","dateValue","prop","getUA","ERROR_NAME","captureStackTrace","patchCapture","captureFake","FirebaseError","pattern","template","fullCode","claims","signature","isValidTimestamp","validSince","validUntil","issuedAtTime","decoded","extend","objTo","objFrom","isNonNullObject","rv","opt_obj","opt_this","querystringParams","arrayVal","querystringDecode","tokens","Hash","blockSize","chain_","buf_","W_","pad_","inbuf_","total_","reset","compress_","opt_offset","opt_length","lengthMinusBlock","inbuf","totalBits","executor","onNoObservers","ObserverProxy","subscribe","observers","unsubscribes","observerCount","task","finalized","forEachObserver","observer","nextOrObserver","implementsAnyMethods","unsub","unsubscribeOne","finalError","sendOne","onError","methods_1","minCount","maxCount","argCount","argError","argName","validateNamespace","stringToByteArray$1"],"mappings":"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","file":"ssr-bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"JkW7\");\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap f9c434f48d470c715ea0","/*\r\n * window-size\r\n * https://github.com/jonschlinkert/window-size\r\n *\r\n * Copyright (c) 2014 Jon Schlinkert\r\n * Licensed under the MIT license.\r\n */\r\n\r\nconst tty = require('tty')\r\n\r\nmodule.exports = (function() {\r\n  var width;\r\n  var height;\r\n\r\n  if(tty.isatty(1) && tty.isatty(2)) {\r\n    if(process.stdout.getWindowSize) {\r\n      width = process.stdout.getWindowSize(1)[0];\r\n      height = process.stdout.getWindowSize(1)[1];\r\n    } else if (tty.getWindowSize) {\r\n      width = tty.getWindowSize()[1];\r\n      height = tty.getWindowSize()[0];\r\n    } else if (process.stdout.columns && process.stdout.rows) {\r\n      height = process.stdout.columns;\r\n      width = process.stdout.rows;\r\n    }\r\n  } else {\r\n    new Error('Error: could not get window size with tty or process.stdout');\r\n  }\r\n  return {\r\n    height: height,\r\n    width: width\r\n  }\r\n})();\n\n\n// WEBPACK FOOTER //\n// ./node_modules/window-size/index.js","module.exports = require(\"tty\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"tty\"\n// module id = Axko\n// module chunks = 0","!function(){\"use strict\";function e(e,t){var n,o,r,i,l=W;for(i=arguments.length;i-- >2;)P.push(arguments[i]);t&&null!=t.children&&(P.length||P.push(t.children),delete t.children);while(P.length)if((o=P.pop())&&void 0!==o.pop)for(i=o.length;i--;)P.push(o[i]);else\"boolean\"==typeof o&&(o=null),(r=\"function\"!=typeof e)&&(null==o?o=\"\":\"number\"==typeof o?o+=\"\":\"string\"!=typeof o&&(r=!1)),r&&n?l[l.length-1]+=o:l===W?l=[o]:l.push(o),n=r;var a=new T;return a.nodeName=e,a.children=l,a.attributes=null==t?void 0:t,a.key=null==t?void 0:t.key,void 0!==M.vnode&&M.vnode(a),a}function t(e,t){for(var n in t)e[n]=t[n];return e}function n(e,t){null!=e&&(\"function\"==typeof e?e(t):e.current=t)}function o(n,o){return e(n.nodeName,t(t({},n.attributes),o),arguments.length>2?[].slice.call(arguments,2):n.children)}function r(e){!e.__d&&(e.__d=!0)&&1==V.push(e)&&(M.debounceRendering||D)(i)}function i(){var e;while(e=V.pop())e.__d&&x(e)}function l(e,t,n){return\"string\"==typeof t||\"number\"==typeof t?void 0!==e.splitText:\"string\"==typeof t.nodeName?!e._componentConstructor&&a(e,t.nodeName):n||e._componentConstructor===t.nodeName}function a(e,t){return e.__n===t||e.nodeName.toLowerCase()===t.toLowerCase()}function u(e){var n=t({},e.attributes);n.children=e.children;var o=e.nodeName.defaultProps;if(void 0!==o)for(var r in o)void 0===n[r]&&(n[r]=o[r]);return n}function c(e,t){var n=t?document.createElementNS(\"http://www.w3.org/2000/svg\",e):document.createElement(e);return n.__n=e,n}function p(e){var t=e.parentNode;t&&t.removeChild(e)}function s(e,t,o,r,i){if(\"className\"===t&&(t=\"class\"),\"key\"===t);else if(\"ref\"===t)n(o,null),n(r,e);else if(\"class\"!==t||i)if(\"style\"===t){if(r&&\"string\"!=typeof r&&\"string\"!=typeof o||(e.style.cssText=r||\"\"),r&&\"object\"==typeof r){if(\"string\"!=typeof o)for(var l in o)l in r||(e.style[l]=\"\");for(var l in r)e.style[l]=\"number\"==typeof r[l]&&!1===E.test(l)?r[l]+\"px\":r[l]}}else if(\"dangerouslySetInnerHTML\"===t)r&&(e.innerHTML=r.__html||\"\");else if(\"o\"==t[0]&&\"n\"==t[1]){var a=t!==(t=t.replace(/Capture$/,\"\"));t=t.toLowerCase().substring(2),r?o||e.addEventListener(t,_,a):e.removeEventListener(t,_,a),(e.__l||(e.__l={}))[t]=r}else if(\"list\"!==t&&\"type\"!==t&&!i&&t in e){try{e[t]=null==r?\"\":r}catch(e){}null!=r&&!1!==r||\"spellcheck\"==t||e.removeAttribute(t)}else{var u=i&&t!==(t=t.replace(/^xlink:?/,\"\"));null==r||!1===r?u?e.removeAttributeNS(\"http://www.w3.org/1999/xlink\",t.toLowerCase()):e.removeAttribute(t):\"function\"!=typeof r&&(u?e.setAttributeNS(\"http://www.w3.org/1999/xlink\",t.toLowerCase(),r):e.setAttribute(t,r))}else e.className=r||\"\"}function _(e){return this.__l[e.type](M.event&&M.event(e)||e)}function f(){var e;while(e=A.shift())M.afterMount&&M.afterMount(e),e.componentDidMount&&e.componentDidMount()}function d(e,t,n,o,r,i){H++||(R=null!=r&&void 0!==r.ownerSVGElement,B=null!=e&&!(\"__preactattr_\"in e));var l=h(e,t,n,o,i);return r&&l.parentNode!==r&&r.appendChild(l),--H||(B=!1,i||f()),l}function h(e,t,n,o,r){var i=e,l=R;if(null!=t&&\"boolean\"!=typeof t||(t=\"\"),\"string\"==typeof t||\"number\"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||r)?e.nodeValue!=t&&(e.nodeValue=t):(i=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(i,e),v(e,!0))),i.__preactattr_=!0,i;var u=t.nodeName;if(\"function\"==typeof u)return N(e,t,n,o);if(R=\"svg\"===u||\"foreignObject\"!==u&&R,u+=\"\",(!e||!a(e,u))&&(i=c(u,R),e)){while(e.firstChild)i.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(i,e),v(e,!0)}var p=i.firstChild,s=i.__preactattr_,_=t.children;if(null==s){s=i.__preactattr_={};for(var f=i.attributes,d=f.length;d--;)s[f[d].name]=f[d].value}return!B&&_&&1===_.length&&\"string\"==typeof _[0]&&null!=p&&void 0!==p.splitText&&null==p.nextSibling?p.nodeValue!=_[0]&&(p.nodeValue=_[0]):(_&&_.length||null!=p)&&m(i,_,n,o,B||null!=s.dangerouslySetInnerHTML),y(i,t.attributes,s),R=l,i}function m(e,t,n,o,r){var i,a,u,c,s,_=e.childNodes,f=[],d={},m=0,b=0,y=_.length,g=0,w=t?t.length:0;if(0!==y)for(var C=0;C<y;C++){var x=_[C],N=x.__preactattr_,k=w&&N?x._component?x._component.__k:N.key:null;null!=k?(m++,d[k]=x):(N||(void 0!==x.splitText?!r||x.nodeValue.trim():r))&&(f[g++]=x)}if(0!==w)for(var C=0;C<w;C++){c=t[C],s=null;var k=c.key;if(null!=k)m&&void 0!==d[k]&&(s=d[k],d[k]=void 0,m--);else if(b<g)for(i=b;i<g;i++)if(void 0!==f[i]&&l(a=f[i],c,r)){s=a,f[i]=void 0,i===g-1&&g--,i===b&&b++;break}s=h(s,c,n,o),u=_[C],s&&s!==e&&s!==u&&(null==u?e.appendChild(s):s===u.nextSibling?p(u):e.insertBefore(s,u))}if(m)for(var C in d)void 0!==d[C]&&v(d[C],!1);while(b<=g)void 0!==(s=f[g--])&&v(s,!1)}function v(e,t){var o=e._component;o?k(o):(null!=e.__preactattr_&&n(e.__preactattr_.ref,null),!1!==t&&null!=e.__preactattr_||p(e),b(e))}function b(e){e=e.lastChild;while(e){var t=e.previousSibling;v(e,!0),e=t}}function y(e,t,n){var o;for(o in n)t&&null!=t[o]||null==n[o]||s(e,o,n[o],n[o]=void 0,R);for(o in t)\"children\"===o||\"innerHTML\"===o||o in n&&t[o]===(\"value\"===o||\"checked\"===o?e[o]:n[o])||s(e,o,n[o],n[o]=t[o],R)}function g(e,t,n){var o,r=F.length;e.prototype&&e.prototype.render?(o=new e(t,n),U.call(o,t,n)):(o=new U(t,n),o.constructor=e,o.render=w);while(r--)if(F[r].constructor===e)return o.__b=F[r].__b,F.splice(r,1),o;return o}function w(e,t,n){return this.constructor(e,n)}function C(e,t,o,i,l){e.__x||(e.__x=!0,e.__r=t.ref,e.__k=t.key,delete t.ref,delete t.key,void 0===e.constructor.getDerivedStateFromProps&&(!e.base||l?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,i)),i&&i!==e.context&&(e.__c||(e.__c=e.context),e.context=i),e.__p||(e.__p=e.props),e.props=t,e.__x=!1,0!==o&&(1!==o&&!1===M.syncComponentUpdates&&e.base?r(e):x(e,1,l)),n(e.__r,e))}function x(e,n,o,r){if(!e.__x){var i,l,a,c=e.props,p=e.state,s=e.context,_=e.__p||c,h=e.__s||p,m=e.__c||s,b=e.base,y=e.__b,w=b||y,N=e._component,U=!1,S=m;if(e.constructor.getDerivedStateFromProps&&(p=t(t({},p),e.constructor.getDerivedStateFromProps(c,p)),e.state=p),b&&(e.props=_,e.state=h,e.context=m,2!==n&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(c,p,s)?U=!0:e.componentWillUpdate&&e.componentWillUpdate(c,p,s),e.props=c,e.state=p,e.context=s),e.__p=e.__s=e.__c=e.__b=null,e.__d=!1,!U){i=e.render(c,p,s),e.getChildContext&&(s=t(t({},s),e.getChildContext())),b&&e.getSnapshotBeforeUpdate&&(S=e.getSnapshotBeforeUpdate(_,h));var L,T,P=i&&i.nodeName;if(\"function\"==typeof P){var W=u(i);l=N,l&&l.constructor===P&&W.key==l.__k?C(l,W,1,s,!1):(L=l,e._component=l=g(P,W,s),l.__b=l.__b||y,l.__u=e,C(l,W,0,s,!1),x(l,1,o,!0)),T=l.base}else a=w,L=N,L&&(a=e._component=null),(w||1===n)&&(a&&(a._component=null),T=d(a,i,s,o||!b,w&&w.parentNode,!0));if(w&&T!==w&&l!==N){var D=w.parentNode;D&&T!==D&&(D.replaceChild(T,w),L||(w._component=null,v(w,!1)))}if(L&&k(L),e.base=T,T&&!r){var E=e,V=e;while(V=V.__u)(E=V).base=T;T._component=E,T._componentConstructor=E.constructor}}!b||o?A.push(e):U||(e.componentDidUpdate&&e.componentDidUpdate(_,h,S),M.afterUpdate&&M.afterUpdate(e));while(e.__h.length)e.__h.pop().call(e);H||r||f()}}function N(e,t,n,o){var r=e&&e._component,i=r,l=e,a=r&&e._componentConstructor===t.nodeName,c=a,p=u(t);while(r&&!c&&(r=r.__u))c=r.constructor===t.nodeName;return r&&c&&(!o||r._component)?(C(r,p,3,n,o),e=r.base):(i&&!a&&(k(i),e=l=null),r=g(t.nodeName,p,n),e&&!r.__b&&(r.__b=e,l=null),C(r,p,1,n,o),e=r.base,l&&e!==l&&(l._component=null,v(l,!1))),e}function k(e){M.beforeUnmount&&M.beforeUnmount(e);var t=e.base;e.__x=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var o=e._component;o?k(o):t&&(null!=t.__preactattr_&&n(t.__preactattr_.ref,null),e.__b=t,p(t),F.push(e),b(t)),n(e.__r,null)}function U(e,t){this.__d=!0,this.context=t,this.props=e,this.state=this.state||{},this.__h=[]}function S(e,t,n){return d(n,e,{},!1,t,!1)}function L(){return{}}var T=function(){},M={},P=[],W=[],D=\"function\"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,E=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,V=[],A=[],H=0,R=!1,B=!1,F=[];t(U.prototype,{setState:function(e,n){this.__s||(this.__s=this.state),this.state=t(t({},this.state),\"function\"==typeof e?e(this.state,this.props):e),n&&this.__h.push(n),r(this)},forceUpdate:function(e){e&&this.__h.push(e),x(this,2)},render:function(){}});var j={h:e,createElement:e,cloneElement:o,createRef:L,Component:U,render:S,rerender:i,options:M};\"undefined\"!=typeof module?module.exports=j:self.preact=j}();\n//# sourceMappingURL=preact.min.js.map\n\n\n// WEBPACK FOOTER //\n// ./node_modules/preact/dist/preact.min.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./style.css\n// module id = FWi5\n// module chunks = 0","/*!\n  Copyright (c) 2017 Jed Watson.\n  Licensed under the MIT License (MIT), see\n  http://jedwatson.github.io/classnames\n*/\n/* global define */\n\n(function () {\n\t'use strict';\n\n\tvar hasOwn = {}.hasOwnProperty;\n\n\tfunction classNames () {\n\t\tvar classes = [];\n\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tvar arg = arguments[i];\n\t\t\tif (!arg) continue;\n\n\t\t\tvar argType = typeof arg;\n\n\t\t\tif (argType === 'string' || argType === 'number') {\n\t\t\t\tclasses.push(arg);\n\t\t\t} else if (Array.isArray(arg) && arg.length) {\n\t\t\t\tvar inner = classNames.apply(null, arg);\n\t\t\t\tif (inner) {\n\t\t\t\t\tclasses.push(inner);\n\t\t\t\t}\n\t\t\t} else if (argType === 'object') {\n\t\t\t\tfor (var key in arg) {\n\t\t\t\t\tif (hasOwn.call(arg, key) && arg[key]) {\n\t\t\t\t\t\tclasses.push(key);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn classes.join(' ');\n\t}\n\n\tif (typeof module !== 'undefined' && module.exports) {\n\t\tclassNames.default = classNames;\n\t\tmodule.exports = classNames;\n\t} else if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {\n\t\t// register as 'classnames', consistent with npm package name\n\t\tdefine('classnames', [], function () {\n\t\t\treturn classNames;\n\t\t});\n\t} else {\n\t\twindow.classNames = classNames;\n\t}\n}());\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/classnames/index.js","import 'whatwg-fetch';\n\n// Store setTimeout reference so promise-polyfill will be unaffected by\n// other code modifying setTimeout (like sinon.useFakeTimers())\nvar setTimeoutFunc = setTimeout;\n\nfunction noop() {}\n\n// Polyfill for Function.prototype.bind\nfunction bind(fn, thisArg) {\n  return function() {\n    fn.apply(thisArg, arguments);\n  };\n}\n\nfunction Promise(fn) {\n  if (!(this instanceof Promise))\n    throw new TypeError('Promises must be constructed via new');\n  if (typeof fn !== 'function') throw new TypeError('not a function');\n  this._state = 0;\n  this._handled = false;\n  this._value = undefined;\n  this._deferreds = [];\n\n  doResolve(fn, this);\n}\n\nfunction handle(self, deferred) {\n  while (self._state === 3) {\n    self = self._value;\n  }\n  if (self._state === 0) {\n    self._deferreds.push(deferred);\n    return;\n  }\n  self._handled = true;\n  Promise._immediateFn(function() {\n    var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n    if (cb === null) {\n      (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n      return;\n    }\n    var ret;\n    try {\n      ret = cb(self._value);\n    } catch (e) {\n      reject(deferred.promise, e);\n      return;\n    }\n    resolve(deferred.promise, ret);\n  });\n}\n\nfunction resolve(self, newValue) {\n  try {\n    // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n    if (newValue === self)\n      throw new TypeError('A promise cannot be resolved with itself.');\n    if (\n      newValue &&\n      (typeof newValue === 'object' || typeof newValue === 'function')\n    ) {\n      var then = newValue.then;\n      if (newValue instanceof Promise) {\n        self._state = 3;\n        self._value = newValue;\n        finale(self);\n        return;\n      } else if (typeof then === 'function') {\n        doResolve(bind(then, newValue), self);\n        return;\n      }\n    }\n    self._state = 1;\n    self._value = newValue;\n    finale(self);\n  } catch (e) {\n    reject(self, e);\n  }\n}\n\nfunction reject(self, newValue) {\n  self._state = 2;\n  self._value = newValue;\n  finale(self);\n}\n\nfunction finale(self) {\n  if (self._state === 2 && self._deferreds.length === 0) {\n    Promise._immediateFn(function() {\n      if (!self._handled) {\n        Promise._unhandledRejectionFn(self._value);\n      }\n    });\n  }\n\n  for (var i = 0, len = self._deferreds.length; i < len; i++) {\n    handle(self, self._deferreds[i]);\n  }\n  self._deferreds = null;\n}\n\nfunction Handler(onFulfilled, onRejected, promise) {\n  this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n  this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n  this.promise = promise;\n}\n\n/**\n * Take a potentially misbehaving resolver function and make sure\n * onFulfilled and onRejected are only called once.\n *\n * Makes no guarantees about asynchrony.\n */\nfunction doResolve(fn, self) {\n  var done = false;\n  try {\n    fn(\n      function(value) {\n        if (done) return;\n        done = true;\n        resolve(self, value);\n      },\n      function(reason) {\n        if (done) return;\n        done = true;\n        reject(self, reason);\n      }\n    );\n  } catch (ex) {\n    if (done) return;\n    done = true;\n    reject(self, ex);\n  }\n}\n\nPromise.prototype['catch'] = function(onRejected) {\n  return this.then(null, onRejected);\n};\n\nPromise.prototype.then = function(onFulfilled, onRejected) {\n  var prom = new this.constructor(noop);\n\n  handle(this, new Handler(onFulfilled, onRejected, prom));\n  return prom;\n};\n\nPromise.prototype['finally'] = function(callback) {\n  var constructor = this.constructor;\n  return this.then(\n    function(value) {\n      return constructor.resolve(callback()).then(function() {\n        return value;\n      });\n    },\n    function(reason) {\n      return constructor.resolve(callback()).then(function() {\n        return constructor.reject(reason);\n      });\n    }\n  );\n};\n\nPromise.all = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!arr || typeof arr.length === 'undefined')\n      throw new TypeError('Promise.all accepts an array');\n    var args = Array.prototype.slice.call(arr);\n    if (args.length === 0) return resolve([]);\n    var remaining = args.length;\n\n    function res(i, val) {\n      try {\n        if (val && (typeof val === 'object' || typeof val === 'function')) {\n          var then = val.then;\n          if (typeof then === 'function') {\n            then.call(\n              val,\n              function(val) {\n                res(i, val);\n              },\n              reject\n            );\n            return;\n          }\n        }\n        args[i] = val;\n        if (--remaining === 0) {\n          resolve(args);\n        }\n      } catch (ex) {\n        reject(ex);\n      }\n    }\n\n    for (var i = 0; i < args.length; i++) {\n      res(i, args[i]);\n    }\n  });\n};\n\nPromise.resolve = function(value) {\n  if (value && typeof value === 'object' && value.constructor === Promise) {\n    return value;\n  }\n\n  return new Promise(function(resolve) {\n    resolve(value);\n  });\n};\n\nPromise.reject = function(value) {\n  return new Promise(function(resolve, reject) {\n    reject(value);\n  });\n};\n\nPromise.race = function(values) {\n  return new Promise(function(resolve, reject) {\n    for (var i = 0, len = values.length; i < len; i++) {\n      values[i].then(resolve, reject);\n    }\n  });\n};\n\n// Use polyfill for setImmediate for performance gains\nPromise._immediateFn =\n  (typeof setImmediate === 'function' &&\n    function(fn) {\n      setImmediate(fn);\n    }) ||\n  function(fn) {\n    setTimeoutFunc(fn, 0);\n  };\n\nPromise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n  if (typeof console !== 'undefined' && console) {\n    console.warn('Possible Unhandled Promise Rejection:', err); // eslint-disable-line no-console\n  }\n};\n\nvar globalNS = (function() {\n  // the only reliable means to get the global object is\n  // `Function('return this')()`\n  // However, this causes CSP violations in Chrome apps.\n  if (typeof self !== 'undefined') {\n    return self;\n  }\n  if (typeof window !== 'undefined') {\n    return window;\n  }\n  if (typeof global !== 'undefined') {\n    return global;\n  }\n  throw new Error('unable to locate global object');\n})();\n\nif (!globalNS.Promise) {\n  globalNS.Promise = Promise;\n}\n\nfunction createCommonjsModule(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\nvar _global = createCommonjsModule(function (module) {\n// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\nvar global = module.exports = typeof window != 'undefined' && window.Math == Math\n  ? window : typeof self != 'undefined' && self.Math == Math ? self\n  // eslint-disable-next-line no-new-func\n  : Function('return this')();\nif (typeof __g == 'number') __g = global; // eslint-disable-line no-undef\n});\n\nvar _core = createCommonjsModule(function (module) {\nvar core = module.exports = { version: '2.5.5' };\nif (typeof __e == 'number') __e = core; // eslint-disable-line no-undef\n});\nvar _core_1 = _core.version;\n\nvar _isObject = function (it) {\n  return typeof it === 'object' ? it !== null : typeof it === 'function';\n};\n\nvar _anObject = function (it) {\n  if (!_isObject(it)) throw TypeError(it + ' is not an object!');\n  return it;\n};\n\nvar _fails = function (exec) {\n  try {\n    return !!exec();\n  } catch (e) {\n    return true;\n  }\n};\n\n// Thank's IE8 for his funny defineProperty\nvar _descriptors = !_fails(function () {\n  return Object.defineProperty({}, 'a', { get: function () { return 7; } }).a != 7;\n});\n\nvar document = _global.document;\n// typeof document.createElement is 'object' in old IE\nvar is = _isObject(document) && _isObject(document.createElement);\nvar _domCreate = function (it) {\n  return is ? document.createElement(it) : {};\n};\n\nvar _ie8DomDefine = !_descriptors && !_fails(function () {\n  return Object.defineProperty(_domCreate('div'), 'a', { get: function () { return 7; } }).a != 7;\n});\n\n// 7.1.1 ToPrimitive(input [, PreferredType])\n\n// instead of the ES6 spec version, we didn't implement @@toPrimitive case\n// and the second argument - flag - preferred type is a string\nvar _toPrimitive = function (it, S) {\n  if (!_isObject(it)) return it;\n  var fn, val;\n  if (S && typeof (fn = it.toString) == 'function' && !_isObject(val = fn.call(it))) return val;\n  if (typeof (fn = it.valueOf) == 'function' && !_isObject(val = fn.call(it))) return val;\n  if (!S && typeof (fn = it.toString) == 'function' && !_isObject(val = fn.call(it))) return val;\n  throw TypeError(\"Can't convert object to primitive value\");\n};\n\nvar dP = Object.defineProperty;\n\nvar f = _descriptors ? Object.defineProperty : function defineProperty(O, P, Attributes) {\n  _anObject(O);\n  P = _toPrimitive(P, true);\n  _anObject(Attributes);\n  if (_ie8DomDefine) try {\n    return dP(O, P, Attributes);\n  } catch (e) { /* empty */ }\n  if ('get' in Attributes || 'set' in Attributes) throw TypeError('Accessors not supported!');\n  if ('value' in Attributes) O[P] = Attributes.value;\n  return O;\n};\n\nvar _objectDp = {\n\tf: f\n};\n\nvar _propertyDesc = function (bitmap, value) {\n  return {\n    enumerable: !(bitmap & 1),\n    configurable: !(bitmap & 2),\n    writable: !(bitmap & 4),\n    value: value\n  };\n};\n\nvar _hide = _descriptors ? function (object, key, value) {\n  return _objectDp.f(object, key, _propertyDesc(1, value));\n} : function (object, key, value) {\n  object[key] = value;\n  return object;\n};\n\nvar hasOwnProperty = {}.hasOwnProperty;\nvar _has = function (it, key) {\n  return hasOwnProperty.call(it, key);\n};\n\nvar id = 0;\nvar px = Math.random();\nvar _uid = function (key) {\n  return 'Symbol('.concat(key === undefined ? '' : key, ')_', (++id + px).toString(36));\n};\n\nvar _redefine = createCommonjsModule(function (module) {\nvar SRC = _uid('src');\nvar TO_STRING = 'toString';\nvar $toString = Function[TO_STRING];\nvar TPL = ('' + $toString).split(TO_STRING);\n\n_core.inspectSource = function (it) {\n  return $toString.call(it);\n};\n\n(module.exports = function (O, key, val, safe) {\n  var isFunction = typeof val == 'function';\n  if (isFunction) _has(val, 'name') || _hide(val, 'name', key);\n  if (O[key] === val) return;\n  if (isFunction) _has(val, SRC) || _hide(val, SRC, O[key] ? '' + O[key] : TPL.join(String(key)));\n  if (O === _global) {\n    O[key] = val;\n  } else if (!safe) {\n    delete O[key];\n    _hide(O, key, val);\n  } else if (O[key]) {\n    O[key] = val;\n  } else {\n    _hide(O, key, val);\n  }\n// add fake Function#toString for correct work wrapped methods / constructors with methods like LoDash isNative\n})(Function.prototype, TO_STRING, function toString() {\n  return typeof this == 'function' && this[SRC] || $toString.call(this);\n});\n});\n\nvar _aFunction = function (it) {\n  if (typeof it != 'function') throw TypeError(it + ' is not a function!');\n  return it;\n};\n\n// optional / simple context binding\n\nvar _ctx = function (fn, that, length) {\n  _aFunction(fn);\n  if (that === undefined) return fn;\n  switch (length) {\n    case 1: return function (a) {\n      return fn.call(that, a);\n    };\n    case 2: return function (a, b) {\n      return fn.call(that, a, b);\n    };\n    case 3: return function (a, b, c) {\n      return fn.call(that, a, b, c);\n    };\n  }\n  return function (/* ...args */) {\n    return fn.apply(that, arguments);\n  };\n};\n\nvar PROTOTYPE = 'prototype';\n\nvar $export = function (type, name, source) {\n  var IS_FORCED = type & $export.F;\n  var IS_GLOBAL = type & $export.G;\n  var IS_STATIC = type & $export.S;\n  var IS_PROTO = type & $export.P;\n  var IS_BIND = type & $export.B;\n  var target = IS_GLOBAL ? _global : IS_STATIC ? _global[name] || (_global[name] = {}) : (_global[name] || {})[PROTOTYPE];\n  var exports = IS_GLOBAL ? _core : _core[name] || (_core[name] = {});\n  var expProto = exports[PROTOTYPE] || (exports[PROTOTYPE] = {});\n  var key, own, out, exp;\n  if (IS_GLOBAL) source = name;\n  for (key in source) {\n    // contains in native\n    own = !IS_FORCED && target && target[key] !== undefined;\n    // export native or passed\n    out = (own ? target : source)[key];\n    // bind timers to global for call from export context\n    exp = IS_BIND && own ? _ctx(out, _global) : IS_PROTO && typeof out == 'function' ? _ctx(Function.call, out) : out;\n    // extend global\n    if (target) _redefine(target, key, out, type & $export.U);\n    // export\n    if (exports[key] != out) _hide(exports, key, exp);\n    if (IS_PROTO && expProto[key] != out) expProto[key] = out;\n  }\n};\n_global.core = _core;\n// type bitmap\n$export.F = 1;   // forced\n$export.G = 2;   // global\n$export.S = 4;   // static\n$export.P = 8;   // proto\n$export.B = 16;  // bind\n$export.W = 32;  // wrap\n$export.U = 64;  // safe\n$export.R = 128; // real proto method for `library`\nvar _export = $export;\n\nvar toString = {}.toString;\n\nvar _cof = function (it) {\n  return toString.call(it).slice(8, -1);\n};\n\n// fallback for non-array-like ES3 and non-enumerable old V8 strings\n\n// eslint-disable-next-line no-prototype-builtins\nvar _iobject = Object('z').propertyIsEnumerable(0) ? Object : function (it) {\n  return _cof(it) == 'String' ? it.split('') : Object(it);\n};\n\n// 7.2.1 RequireObjectCoercible(argument)\nvar _defined = function (it) {\n  if (it == undefined) throw TypeError(\"Can't call method on  \" + it);\n  return it;\n};\n\n// 7.1.13 ToObject(argument)\n\nvar _toObject = function (it) {\n  return Object(_defined(it));\n};\n\n// 7.1.4 ToInteger\nvar ceil = Math.ceil;\nvar floor = Math.floor;\nvar _toInteger = function (it) {\n  return isNaN(it = +it) ? 0 : (it > 0 ? floor : ceil)(it);\n};\n\n// 7.1.15 ToLength\n\nvar min = Math.min;\nvar _toLength = function (it) {\n  return it > 0 ? min(_toInteger(it), 0x1fffffffffffff) : 0; // pow(2, 53) - 1 == 9007199254740991\n};\n\n// 7.2.2 IsArray(argument)\n\nvar _isArray = Array.isArray || function isArray(arg) {\n  return _cof(arg) == 'Array';\n};\n\nvar SHARED = '__core-js_shared__';\nvar store = _global[SHARED] || (_global[SHARED] = {});\nvar _shared = function (key) {\n  return store[key] || (store[key] = {});\n};\n\nvar _wks = createCommonjsModule(function (module) {\nvar store = _shared('wks');\n\nvar Symbol = _global.Symbol;\nvar USE_SYMBOL = typeof Symbol == 'function';\n\nvar $exports = module.exports = function (name) {\n  return store[name] || (store[name] =\n    USE_SYMBOL && Symbol[name] || (USE_SYMBOL ? Symbol : _uid)('Symbol.' + name));\n};\n\n$exports.store = store;\n});\n\nvar SPECIES = _wks('species');\n\nvar _arraySpeciesConstructor = function (original) {\n  var C;\n  if (_isArray(original)) {\n    C = original.constructor;\n    // cross-realm fallback\n    if (typeof C == 'function' && (C === Array || _isArray(C.prototype))) C = undefined;\n    if (_isObject(C)) {\n      C = C[SPECIES];\n      if (C === null) C = undefined;\n    }\n  } return C === undefined ? Array : C;\n};\n\n// 9.4.2.3 ArraySpeciesCreate(originalArray, length)\n\n\nvar _arraySpeciesCreate = function (original, length) {\n  return new (_arraySpeciesConstructor(original))(length);\n};\n\n// 0 -> Array#forEach\n// 1 -> Array#map\n// 2 -> Array#filter\n// 3 -> Array#some\n// 4 -> Array#every\n// 5 -> Array#find\n// 6 -> Array#findIndex\n\n\n\n\n\nvar _arrayMethods = function (TYPE, $create) {\n  var IS_MAP = TYPE == 1;\n  var IS_FILTER = TYPE == 2;\n  var IS_SOME = TYPE == 3;\n  var IS_EVERY = TYPE == 4;\n  var IS_FIND_INDEX = TYPE == 6;\n  var NO_HOLES = TYPE == 5 || IS_FIND_INDEX;\n  var create = $create || _arraySpeciesCreate;\n  return function ($this, callbackfn, that) {\n    var O = _toObject($this);\n    var self = _iobject(O);\n    var f = _ctx(callbackfn, that, 3);\n    var length = _toLength(self.length);\n    var index = 0;\n    var result = IS_MAP ? create($this, length) : IS_FILTER ? create($this, 0) : undefined;\n    var val, res;\n    for (;length > index; index++) if (NO_HOLES || index in self) {\n      val = self[index];\n      res = f(val, index, O);\n      if (TYPE) {\n        if (IS_MAP) result[index] = res;   // map\n        else if (res) switch (TYPE) {\n          case 3: return true;             // some\n          case 5: return val;              // find\n          case 6: return index;            // findIndex\n          case 2: result.push(val);        // filter\n        } else if (IS_EVERY) return false; // every\n      }\n    }\n    return IS_FIND_INDEX ? -1 : IS_SOME || IS_EVERY ? IS_EVERY : result;\n  };\n};\n\n// 22.1.3.31 Array.prototype[@@unscopables]\nvar UNSCOPABLES = _wks('unscopables');\nvar ArrayProto = Array.prototype;\nif (ArrayProto[UNSCOPABLES] == undefined) _hide(ArrayProto, UNSCOPABLES, {});\nvar _addToUnscopables = function (key) {\n  ArrayProto[UNSCOPABLES][key] = true;\n};\n\n// 22.1.3.8 Array.prototype.find(predicate, thisArg = undefined)\n\nvar $find = _arrayMethods(5);\nvar KEY = 'find';\nvar forced = true;\n// Shouldn't skip holes\nif (KEY in []) Array(1)[KEY](function () { forced = false; });\n_export(_export.P + _export.F * forced, 'Array', {\n  find: function find(callbackfn /* , that = undefined */) {\n    return $find(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n_addToUnscopables(KEY);\n\nvar find = _core.Array.find;\n\n// 22.1.3.9 Array.prototype.findIndex(predicate, thisArg = undefined)\n\nvar $find$1 = _arrayMethods(6);\nvar KEY$1 = 'findIndex';\nvar forced$1 = true;\n// Shouldn't skip holes\nif (KEY$1 in []) Array(1)[KEY$1](function () { forced$1 = false; });\n_export(_export.P + _export.F * forced$1, 'Array', {\n  findIndex: function findIndex(callbackfn /* , that = undefined */) {\n    return $find$1(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n_addToUnscopables(KEY$1);\n\nvar findIndex = _core.Array.findIndex;\n\n// to indexed object, toObject with fallback for non-array-like ES3 strings\n\n\nvar _toIobject = function (it) {\n  return _iobject(_defined(it));\n};\n\nvar max = Math.max;\nvar min$1 = Math.min;\nvar _toAbsoluteIndex = function (index, length) {\n  index = _toInteger(index);\n  return index < 0 ? max(index + length, 0) : min$1(index, length);\n};\n\n// false -> Array#indexOf\n// true  -> Array#includes\n\n\n\nvar _arrayIncludes = function (IS_INCLUDES) {\n  return function ($this, el, fromIndex) {\n    var O = _toIobject($this);\n    var length = _toLength(O.length);\n    var index = _toAbsoluteIndex(fromIndex, length);\n    var value;\n    // Array#includes uses SameValueZero equality algorithm\n    // eslint-disable-next-line no-self-compare\n    if (IS_INCLUDES && el != el) while (length > index) {\n      value = O[index++];\n      // eslint-disable-next-line no-self-compare\n      if (value != value) return true;\n    // Array#indexOf ignores holes, Array#includes - not\n    } else for (;length > index; index++) if (IS_INCLUDES || index in O) {\n      if (O[index] === el) return IS_INCLUDES || index || 0;\n    } return !IS_INCLUDES && -1;\n  };\n};\n\nvar shared = _shared('keys');\n\nvar _sharedKey = function (key) {\n  return shared[key] || (shared[key] = _uid(key));\n};\n\nvar arrayIndexOf = _arrayIncludes(false);\nvar IE_PROTO = _sharedKey('IE_PROTO');\n\nvar _objectKeysInternal = function (object, names) {\n  var O = _toIobject(object);\n  var i = 0;\n  var result = [];\n  var key;\n  for (key in O) if (key != IE_PROTO) _has(O, key) && result.push(key);\n  // Don't enum bug & hidden keys\n  while (names.length > i) if (_has(O, key = names[i++])) {\n    ~arrayIndexOf(result, key) || result.push(key);\n  }\n  return result;\n};\n\n// IE 8- don't enum bug keys\nvar _enumBugKeys = (\n  'constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf'\n).split(',');\n\n// 19.1.2.14 / 15.2.3.14 Object.keys(O)\n\n\n\nvar _objectKeys = Object.keys || function keys(O) {\n  return _objectKeysInternal(O, _enumBugKeys);\n};\n\nvar f$1 = Object.getOwnPropertySymbols;\n\nvar _objectGops = {\n\tf: f$1\n};\n\nvar f$2 = {}.propertyIsEnumerable;\n\nvar _objectPie = {\n\tf: f$2\n};\n\n// 19.1.2.1 Object.assign(target, source, ...)\n\n\n\n\n\nvar $assign = Object.assign;\n\n// should work with symbols and should have deterministic property order (V8 bug)\nvar _objectAssign = !$assign || _fails(function () {\n  var A = {};\n  var B = {};\n  // eslint-disable-next-line no-undef\n  var S = Symbol();\n  var K = 'abcdefghijklmnopqrst';\n  A[S] = 7;\n  K.split('').forEach(function (k) { B[k] = k; });\n  return $assign({}, A)[S] != 7 || Object.keys($assign({}, B)).join('') != K;\n}) ? function assign(target, source) { // eslint-disable-line no-unused-vars\n  var T = _toObject(target);\n  var aLen = arguments.length;\n  var index = 1;\n  var getSymbols = _objectGops.f;\n  var isEnum = _objectPie.f;\n  while (aLen > index) {\n    var S = _iobject(arguments[index++]);\n    var keys = getSymbols ? _objectKeys(S).concat(getSymbols(S)) : _objectKeys(S);\n    var length = keys.length;\n    var j = 0;\n    var key;\n    while (length > j) if (isEnum.call(S, key = keys[j++])) T[key] = S[key];\n  } return T;\n} : $assign;\n\n// 19.1.3.1 Object.assign(target, source)\n\n\n_export(_export.S + _export.F, 'Object', { assign: _objectAssign });\n\nvar assign = _core.Object.assign;\n\n// 7.2.8 IsRegExp(argument)\n\n\nvar MATCH = _wks('match');\nvar _isRegexp = function (it) {\n  var isRegExp;\n  return _isObject(it) && ((isRegExp = it[MATCH]) !== undefined ? !!isRegExp : _cof(it) == 'RegExp');\n};\n\n// helper for String#{startsWith, endsWith, includes}\n\n\n\nvar _stringContext = function (that, searchString, NAME) {\n  if (_isRegexp(searchString)) throw TypeError('String#' + NAME + \" doesn't accept regex!\");\n  return String(_defined(that));\n};\n\nvar MATCH$1 = _wks('match');\nvar _failsIsRegexp = function (KEY) {\n  var re = /./;\n  try {\n    '/./'[KEY](re);\n  } catch (e) {\n    try {\n      re[MATCH$1] = false;\n      return !'/./'[KEY](re);\n    } catch (f) { /* empty */ }\n  } return true;\n};\n\nvar STARTS_WITH = 'startsWith';\nvar $startsWith = ''[STARTS_WITH];\n\n_export(_export.P + _export.F * _failsIsRegexp(STARTS_WITH), 'String', {\n  startsWith: function startsWith(searchString /* , position = 0 */) {\n    var that = _stringContext(this, searchString, STARTS_WITH);\n    var index = _toLength(Math.min(arguments.length > 1 ? arguments[1] : undefined, that.length));\n    var search = String(searchString);\n    return $startsWith\n      ? $startsWith.call(that, search, index)\n      : that.slice(index, index + search.length) === search;\n  }\n});\n\nvar startsWith = _core.String.startsWith;\n\nvar _stringRepeat = function repeat(count) {\n  var str = String(_defined(this));\n  var res = '';\n  var n = _toInteger(count);\n  if (n < 0 || n == Infinity) throw RangeError(\"Count can't be negative\");\n  for (;n > 0; (n >>>= 1) && (str += str)) if (n & 1) res += str;\n  return res;\n};\n\n_export(_export.P, 'String', {\n  // 21.1.3.13 String.prototype.repeat(count)\n  repeat: _stringRepeat\n});\n\nvar repeat = _core.String.repeat;\n\nvar _meta = createCommonjsModule(function (module) {\nvar META = _uid('meta');\n\n\nvar setDesc = _objectDp.f;\nvar id = 0;\nvar isExtensible = Object.isExtensible || function () {\n  return true;\n};\nvar FREEZE = !_fails(function () {\n  return isExtensible(Object.preventExtensions({}));\n});\nvar setMeta = function (it) {\n  setDesc(it, META, { value: {\n    i: 'O' + ++id, // object ID\n    w: {}          // weak collections IDs\n  } });\n};\nvar fastKey = function (it, create) {\n  // return primitive with prefix\n  if (!_isObject(it)) return typeof it == 'symbol' ? it : (typeof it == 'string' ? 'S' : 'P') + it;\n  if (!_has(it, META)) {\n    // can't set metadata to uncaught frozen object\n    if (!isExtensible(it)) return 'F';\n    // not necessary to add metadata\n    if (!create) return 'E';\n    // add missing metadata\n    setMeta(it);\n  // return object ID\n  } return it[META].i;\n};\nvar getWeak = function (it, create) {\n  if (!_has(it, META)) {\n    // can't set metadata to uncaught frozen object\n    if (!isExtensible(it)) return true;\n    // not necessary to add metadata\n    if (!create) return false;\n    // add missing metadata\n    setMeta(it);\n  // return hash weak collections IDs\n  } return it[META].w;\n};\n// add metadata on freeze-family methods calling\nvar onFreeze = function (it) {\n  if (FREEZE && meta.NEED && isExtensible(it) && !_has(it, META)) setMeta(it);\n  return it;\n};\nvar meta = module.exports = {\n  KEY: META,\n  NEED: false,\n  fastKey: fastKey,\n  getWeak: getWeak,\n  onFreeze: onFreeze\n};\n});\nvar _meta_1 = _meta.KEY;\nvar _meta_2 = _meta.NEED;\nvar _meta_3 = _meta.fastKey;\nvar _meta_4 = _meta.getWeak;\nvar _meta_5 = _meta.onFreeze;\n\nvar def = _objectDp.f;\n\nvar TAG = _wks('toStringTag');\n\nvar _setToStringTag = function (it, tag, stat) {\n  if (it && !_has(it = stat ? it : it.prototype, TAG)) def(it, TAG, { configurable: true, value: tag });\n};\n\nvar f$3 = _wks;\n\nvar _wksExt = {\n\tf: f$3\n};\n\nvar _library = false;\n\nvar defineProperty = _objectDp.f;\nvar _wksDefine = function (name) {\n  var $Symbol = _core.Symbol || (_core.Symbol = _library ? {} : _global.Symbol || {});\n  if (name.charAt(0) != '_' && !(name in $Symbol)) defineProperty($Symbol, name, { value: _wksExt.f(name) });\n};\n\n// all enumerable object keys, includes symbols\n\n\n\nvar _enumKeys = function (it) {\n  var result = _objectKeys(it);\n  var getSymbols = _objectGops.f;\n  if (getSymbols) {\n    var symbols = getSymbols(it);\n    var isEnum = _objectPie.f;\n    var i = 0;\n    var key;\n    while (symbols.length > i) if (isEnum.call(it, key = symbols[i++])) result.push(key);\n  } return result;\n};\n\nvar _objectDps = _descriptors ? Object.defineProperties : function defineProperties(O, Properties) {\n  _anObject(O);\n  var keys = _objectKeys(Properties);\n  var length = keys.length;\n  var i = 0;\n  var P;\n  while (length > i) _objectDp.f(O, P = keys[i++], Properties[P]);\n  return O;\n};\n\nvar document$1 = _global.document;\nvar _html = document$1 && document$1.documentElement;\n\n// 19.1.2.2 / 15.2.3.5 Object.create(O [, Properties])\n\n\n\nvar IE_PROTO$1 = _sharedKey('IE_PROTO');\nvar Empty = function () { /* empty */ };\nvar PROTOTYPE$1 = 'prototype';\n\n// Create object with fake `null` prototype: use iframe Object with cleared prototype\nvar createDict = function () {\n  // Thrash, waste and sodomy: IE GC bug\n  var iframe = _domCreate('iframe');\n  var i = _enumBugKeys.length;\n  var lt = '<';\n  var gt = '>';\n  var iframeDocument;\n  iframe.style.display = 'none';\n  _html.appendChild(iframe);\n  iframe.src = 'javascript:'; // eslint-disable-line no-script-url\n  // createDict = iframe.contentWindow.Object;\n  // html.removeChild(iframe);\n  iframeDocument = iframe.contentWindow.document;\n  iframeDocument.open();\n  iframeDocument.write(lt + 'script' + gt + 'document.F=Object' + lt + '/script' + gt);\n  iframeDocument.close();\n  createDict = iframeDocument.F;\n  while (i--) delete createDict[PROTOTYPE$1][_enumBugKeys[i]];\n  return createDict();\n};\n\nvar _objectCreate = Object.create || function create(O, Properties) {\n  var result;\n  if (O !== null) {\n    Empty[PROTOTYPE$1] = _anObject(O);\n    result = new Empty();\n    Empty[PROTOTYPE$1] = null;\n    // add \"__proto__\" for Object.getPrototypeOf polyfill\n    result[IE_PROTO$1] = O;\n  } else result = createDict();\n  return Properties === undefined ? result : _objectDps(result, Properties);\n};\n\n// 19.1.2.7 / 15.2.3.4 Object.getOwnPropertyNames(O)\n\nvar hiddenKeys = _enumBugKeys.concat('length', 'prototype');\n\nvar f$4 = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {\n  return _objectKeysInternal(O, hiddenKeys);\n};\n\nvar _objectGopn = {\n\tf: f$4\n};\n\n// fallback for IE11 buggy Object.getOwnPropertyNames with iframe and window\n\nvar gOPN = _objectGopn.f;\nvar toString$1 = {}.toString;\n\nvar windowNames = typeof window == 'object' && window && Object.getOwnPropertyNames\n  ? Object.getOwnPropertyNames(window) : [];\n\nvar getWindowNames = function (it) {\n  try {\n    return gOPN(it);\n  } catch (e) {\n    return windowNames.slice();\n  }\n};\n\nvar f$5 = function getOwnPropertyNames(it) {\n  return windowNames && toString$1.call(it) == '[object Window]' ? getWindowNames(it) : gOPN(_toIobject(it));\n};\n\nvar _objectGopnExt = {\n\tf: f$5\n};\n\nvar gOPD = Object.getOwnPropertyDescriptor;\n\nvar f$6 = _descriptors ? gOPD : function getOwnPropertyDescriptor(O, P) {\n  O = _toIobject(O);\n  P = _toPrimitive(P, true);\n  if (_ie8DomDefine) try {\n    return gOPD(O, P);\n  } catch (e) { /* empty */ }\n  if (_has(O, P)) return _propertyDesc(!_objectPie.f.call(O, P), O[P]);\n};\n\nvar _objectGopd = {\n\tf: f$6\n};\n\n// ECMAScript 6 symbols shim\n\n\n\n\n\nvar META = _meta.KEY;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar gOPD$1 = _objectGopd.f;\nvar dP$1 = _objectDp.f;\nvar gOPN$1 = _objectGopnExt.f;\nvar $Symbol = _global.Symbol;\nvar $JSON = _global.JSON;\nvar _stringify = $JSON && $JSON.stringify;\nvar PROTOTYPE$2 = 'prototype';\nvar HIDDEN = _wks('_hidden');\nvar TO_PRIMITIVE = _wks('toPrimitive');\nvar isEnum = {}.propertyIsEnumerable;\nvar SymbolRegistry = _shared('symbol-registry');\nvar AllSymbols = _shared('symbols');\nvar OPSymbols = _shared('op-symbols');\nvar ObjectProto = Object[PROTOTYPE$2];\nvar USE_NATIVE = typeof $Symbol == 'function';\nvar QObject = _global.QObject;\n// Don't use setters in Qt Script, https://github.com/zloirock/core-js/issues/173\nvar setter = !QObject || !QObject[PROTOTYPE$2] || !QObject[PROTOTYPE$2].findChild;\n\n// fallback for old Android, https://code.google.com/p/v8/issues/detail?id=687\nvar setSymbolDesc = _descriptors && _fails(function () {\n  return _objectCreate(dP$1({}, 'a', {\n    get: function () { return dP$1(this, 'a', { value: 7 }).a; }\n  })).a != 7;\n}) ? function (it, key, D) {\n  var protoDesc = gOPD$1(ObjectProto, key);\n  if (protoDesc) delete ObjectProto[key];\n  dP$1(it, key, D);\n  if (protoDesc && it !== ObjectProto) dP$1(ObjectProto, key, protoDesc);\n} : dP$1;\n\nvar wrap = function (tag) {\n  var sym = AllSymbols[tag] = _objectCreate($Symbol[PROTOTYPE$2]);\n  sym._k = tag;\n  return sym;\n};\n\nvar isSymbol = USE_NATIVE && typeof $Symbol.iterator == 'symbol' ? function (it) {\n  return typeof it == 'symbol';\n} : function (it) {\n  return it instanceof $Symbol;\n};\n\nvar $defineProperty = function defineProperty(it, key, D) {\n  if (it === ObjectProto) $defineProperty(OPSymbols, key, D);\n  _anObject(it);\n  key = _toPrimitive(key, true);\n  _anObject(D);\n  if (_has(AllSymbols, key)) {\n    if (!D.enumerable) {\n      if (!_has(it, HIDDEN)) dP$1(it, HIDDEN, _propertyDesc(1, {}));\n      it[HIDDEN][key] = true;\n    } else {\n      if (_has(it, HIDDEN) && it[HIDDEN][key]) it[HIDDEN][key] = false;\n      D = _objectCreate(D, { enumerable: _propertyDesc(0, false) });\n    } return setSymbolDesc(it, key, D);\n  } return dP$1(it, key, D);\n};\nvar $defineProperties = function defineProperties(it, P) {\n  _anObject(it);\n  var keys = _enumKeys(P = _toIobject(P));\n  var i = 0;\n  var l = keys.length;\n  var key;\n  while (l > i) $defineProperty(it, key = keys[i++], P[key]);\n  return it;\n};\nvar $create = function create(it, P) {\n  return P === undefined ? _objectCreate(it) : $defineProperties(_objectCreate(it), P);\n};\nvar $propertyIsEnumerable = function propertyIsEnumerable(key) {\n  var E = isEnum.call(this, key = _toPrimitive(key, true));\n  if (this === ObjectProto && _has(AllSymbols, key) && !_has(OPSymbols, key)) return false;\n  return E || !_has(this, key) || !_has(AllSymbols, key) || _has(this, HIDDEN) && this[HIDDEN][key] ? E : true;\n};\nvar $getOwnPropertyDescriptor = function getOwnPropertyDescriptor(it, key) {\n  it = _toIobject(it);\n  key = _toPrimitive(key, true);\n  if (it === ObjectProto && _has(AllSymbols, key) && !_has(OPSymbols, key)) return;\n  var D = gOPD$1(it, key);\n  if (D && _has(AllSymbols, key) && !(_has(it, HIDDEN) && it[HIDDEN][key])) D.enumerable = true;\n  return D;\n};\nvar $getOwnPropertyNames = function getOwnPropertyNames(it) {\n  var names = gOPN$1(_toIobject(it));\n  var result = [];\n  var i = 0;\n  var key;\n  while (names.length > i) {\n    if (!_has(AllSymbols, key = names[i++]) && key != HIDDEN && key != META) result.push(key);\n  } return result;\n};\nvar $getOwnPropertySymbols = function getOwnPropertySymbols(it) {\n  var IS_OP = it === ObjectProto;\n  var names = gOPN$1(IS_OP ? OPSymbols : _toIobject(it));\n  var result = [];\n  var i = 0;\n  var key;\n  while (names.length > i) {\n    if (_has(AllSymbols, key = names[i++]) && (IS_OP ? _has(ObjectProto, key) : true)) result.push(AllSymbols[key]);\n  } return result;\n};\n\n// 19.4.1.1 Symbol([description])\nif (!USE_NATIVE) {\n  $Symbol = function Symbol() {\n    if (this instanceof $Symbol) throw TypeError('Symbol is not a constructor!');\n    var tag = _uid(arguments.length > 0 ? arguments[0] : undefined);\n    var $set = function (value) {\n      if (this === ObjectProto) $set.call(OPSymbols, value);\n      if (_has(this, HIDDEN) && _has(this[HIDDEN], tag)) this[HIDDEN][tag] = false;\n      setSymbolDesc(this, tag, _propertyDesc(1, value));\n    };\n    if (_descriptors && setter) setSymbolDesc(ObjectProto, tag, { configurable: true, set: $set });\n    return wrap(tag);\n  };\n  _redefine($Symbol[PROTOTYPE$2], 'toString', function toString() {\n    return this._k;\n  });\n\n  _objectGopd.f = $getOwnPropertyDescriptor;\n  _objectDp.f = $defineProperty;\n  _objectGopn.f = _objectGopnExt.f = $getOwnPropertyNames;\n  _objectPie.f = $propertyIsEnumerable;\n  _objectGops.f = $getOwnPropertySymbols;\n\n  if (_descriptors && !_library) {\n    _redefine(ObjectProto, 'propertyIsEnumerable', $propertyIsEnumerable, true);\n  }\n\n  _wksExt.f = function (name) {\n    return wrap(_wks(name));\n  };\n}\n\n_export(_export.G + _export.W + _export.F * !USE_NATIVE, { Symbol: $Symbol });\n\nfor (var es6Symbols = (\n  // 19.4.2.2, 19.4.2.3, 19.4.2.4, 19.4.2.6, 19.4.2.8, 19.4.2.9, 19.4.2.10, 19.4.2.11, 19.4.2.12, 19.4.2.13, 19.4.2.14\n  'hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables'\n).split(','), j = 0; es6Symbols.length > j;)_wks(es6Symbols[j++]);\n\nfor (var wellKnownSymbols = _objectKeys(_wks.store), k = 0; wellKnownSymbols.length > k;) _wksDefine(wellKnownSymbols[k++]);\n\n_export(_export.S + _export.F * !USE_NATIVE, 'Symbol', {\n  // 19.4.2.1 Symbol.for(key)\n  'for': function (key) {\n    return _has(SymbolRegistry, key += '')\n      ? SymbolRegistry[key]\n      : SymbolRegistry[key] = $Symbol(key);\n  },\n  // 19.4.2.5 Symbol.keyFor(sym)\n  keyFor: function keyFor(sym) {\n    if (!isSymbol(sym)) throw TypeError(sym + ' is not a symbol!');\n    for (var key in SymbolRegistry) if (SymbolRegistry[key] === sym) return key;\n  },\n  useSetter: function () { setter = true; },\n  useSimple: function () { setter = false; }\n});\n\n_export(_export.S + _export.F * !USE_NATIVE, 'Object', {\n  // 19.1.2.2 Object.create(O [, Properties])\n  create: $create,\n  // 19.1.2.4 Object.defineProperty(O, P, Attributes)\n  defineProperty: $defineProperty,\n  // 19.1.2.3 Object.defineProperties(O, Properties)\n  defineProperties: $defineProperties,\n  // 19.1.2.6 Object.getOwnPropertyDescriptor(O, P)\n  getOwnPropertyDescriptor: $getOwnPropertyDescriptor,\n  // 19.1.2.7 Object.getOwnPropertyNames(O)\n  getOwnPropertyNames: $getOwnPropertyNames,\n  // 19.1.2.8 Object.getOwnPropertySymbols(O)\n  getOwnPropertySymbols: $getOwnPropertySymbols\n});\n\n// 24.3.2 JSON.stringify(value [, replacer [, space]])\n$JSON && _export(_export.S + _export.F * (!USE_NATIVE || _fails(function () {\n  var S = $Symbol();\n  // MS Edge converts symbol values to JSON as {}\n  // WebKit converts symbol values to JSON as null\n  // V8 throws on boxed symbols\n  return _stringify([S]) != '[null]' || _stringify({ a: S }) != '{}' || _stringify(Object(S)) != '{}';\n})), 'JSON', {\n  stringify: function stringify(it) {\n    var args = [it];\n    var i = 1;\n    var replacer, $replacer;\n    while (arguments.length > i) args.push(arguments[i++]);\n    $replacer = replacer = args[1];\n    if (!_isObject(replacer) && it === undefined || isSymbol(it)) return; // IE8 returns string on undefined\n    if (!_isArray(replacer)) replacer = function (key, value) {\n      if (typeof $replacer == 'function') value = $replacer.call(this, key, value);\n      if (!isSymbol(value)) return value;\n    };\n    args[1] = replacer;\n    return _stringify.apply($JSON, args);\n  }\n});\n\n// 19.4.3.4 Symbol.prototype[@@toPrimitive](hint)\n$Symbol[PROTOTYPE$2][TO_PRIMITIVE] || _hide($Symbol[PROTOTYPE$2], TO_PRIMITIVE, $Symbol[PROTOTYPE$2].valueOf);\n// 19.4.3.5 Symbol.prototype[@@toStringTag]\n_setToStringTag($Symbol, 'Symbol');\n// 20.2.1.9 Math[@@toStringTag]\n_setToStringTag(Math, 'Math', true);\n// 24.3.3 JSON[@@toStringTag]\n_setToStringTag(_global.JSON, 'JSON', true);\n\n// getting tag from 19.1.3.6 Object.prototype.toString()\n\nvar TAG$1 = _wks('toStringTag');\n// ES3 wrong here\nvar ARG = _cof(function () { return arguments; }()) == 'Arguments';\n\n// fallback for IE11 Script Access Denied error\nvar tryGet = function (it, key) {\n  try {\n    return it[key];\n  } catch (e) { /* empty */ }\n};\n\nvar _classof = function (it) {\n  var O, T, B;\n  return it === undefined ? 'Undefined' : it === null ? 'Null'\n    // @@toStringTag case\n    : typeof (T = tryGet(O = Object(it), TAG$1)) == 'string' ? T\n    // builtinTag case\n    : ARG ? _cof(O)\n    // ES3 arguments fallback\n    : (B = _cof(O)) == 'Object' && typeof O.callee == 'function' ? 'Arguments' : B;\n};\n\n// 19.1.3.6 Object.prototype.toString()\n\nvar test = {};\ntest[_wks('toStringTag')] = 'z';\nif (test + '' != '[object z]') {\n  _redefine(Object.prototype, 'toString', function toString() {\n    return '[object ' + _classof(this) + ']';\n  }, true);\n}\n\n_wksDefine('asyncIterator');\n\n_wksDefine('observable');\n\nvar symbol = _core.Symbol;\n\n// true  -> String#at\n// false -> String#codePointAt\nvar _stringAt = function (TO_STRING) {\n  return function (that, pos) {\n    var s = String(_defined(that));\n    var i = _toInteger(pos);\n    var l = s.length;\n    var a, b;\n    if (i < 0 || i >= l) return TO_STRING ? '' : undefined;\n    a = s.charCodeAt(i);\n    return a < 0xd800 || a > 0xdbff || i + 1 === l || (b = s.charCodeAt(i + 1)) < 0xdc00 || b > 0xdfff\n      ? TO_STRING ? s.charAt(i) : a\n      : TO_STRING ? s.slice(i, i + 2) : (a - 0xd800 << 10) + (b - 0xdc00) + 0x10000;\n  };\n};\n\nvar _iterators = {};\n\nvar IteratorPrototype = {};\n\n// 25.1.2.1.1 %IteratorPrototype%[@@iterator]()\n_hide(IteratorPrototype, _wks('iterator'), function () { return this; });\n\nvar _iterCreate = function (Constructor, NAME, next) {\n  Constructor.prototype = _objectCreate(IteratorPrototype, { next: _propertyDesc(1, next) });\n  _setToStringTag(Constructor, NAME + ' Iterator');\n};\n\n// 19.1.2.9 / 15.2.3.2 Object.getPrototypeOf(O)\n\n\nvar IE_PROTO$2 = _sharedKey('IE_PROTO');\nvar ObjectProto$1 = Object.prototype;\n\nvar _objectGpo = Object.getPrototypeOf || function (O) {\n  O = _toObject(O);\n  if (_has(O, IE_PROTO$2)) return O[IE_PROTO$2];\n  if (typeof O.constructor == 'function' && O instanceof O.constructor) {\n    return O.constructor.prototype;\n  } return O instanceof Object ? ObjectProto$1 : null;\n};\n\nvar ITERATOR = _wks('iterator');\nvar BUGGY = !([].keys && 'next' in [].keys()); // Safari has buggy iterators w/o `next`\nvar FF_ITERATOR = '@@iterator';\nvar KEYS = 'keys';\nvar VALUES = 'values';\n\nvar returnThis = function () { return this; };\n\nvar _iterDefine = function (Base, NAME, Constructor, next, DEFAULT, IS_SET, FORCED) {\n  _iterCreate(Constructor, NAME, next);\n  var getMethod = function (kind) {\n    if (!BUGGY && kind in proto) return proto[kind];\n    switch (kind) {\n      case KEYS: return function keys() { return new Constructor(this, kind); };\n      case VALUES: return function values() { return new Constructor(this, kind); };\n    } return function entries() { return new Constructor(this, kind); };\n  };\n  var TAG = NAME + ' Iterator';\n  var DEF_VALUES = DEFAULT == VALUES;\n  var VALUES_BUG = false;\n  var proto = Base.prototype;\n  var $native = proto[ITERATOR] || proto[FF_ITERATOR] || DEFAULT && proto[DEFAULT];\n  var $default = $native || getMethod(DEFAULT);\n  var $entries = DEFAULT ? !DEF_VALUES ? $default : getMethod('entries') : undefined;\n  var $anyNative = NAME == 'Array' ? proto.entries || $native : $native;\n  var methods, key, IteratorPrototype;\n  // Fix native\n  if ($anyNative) {\n    IteratorPrototype = _objectGpo($anyNative.call(new Base()));\n    if (IteratorPrototype !== Object.prototype && IteratorPrototype.next) {\n      // Set @@toStringTag to native iterators\n      _setToStringTag(IteratorPrototype, TAG, true);\n      // fix for some old engines\n      if (!_library && typeof IteratorPrototype[ITERATOR] != 'function') _hide(IteratorPrototype, ITERATOR, returnThis);\n    }\n  }\n  // fix Array#{values, @@iterator}.name in V8 / FF\n  if (DEF_VALUES && $native && $native.name !== VALUES) {\n    VALUES_BUG = true;\n    $default = function values() { return $native.call(this); };\n  }\n  // Define iterator\n  if ((!_library || FORCED) && (BUGGY || VALUES_BUG || !proto[ITERATOR])) {\n    _hide(proto, ITERATOR, $default);\n  }\n  // Plug for library\n  _iterators[NAME] = $default;\n  _iterators[TAG] = returnThis;\n  if (DEFAULT) {\n    methods = {\n      values: DEF_VALUES ? $default : getMethod(VALUES),\n      keys: IS_SET ? $default : getMethod(KEYS),\n      entries: $entries\n    };\n    if (FORCED) for (key in methods) {\n      if (!(key in proto)) _redefine(proto, key, methods[key]);\n    } else _export(_export.P + _export.F * (BUGGY || VALUES_BUG), NAME, methods);\n  }\n  return methods;\n};\n\nvar $at = _stringAt(true);\n\n// 21.1.3.27 String.prototype[@@iterator]()\n_iterDefine(String, 'String', function (iterated) {\n  this._t = String(iterated); // target\n  this._i = 0;                // next index\n// 21.1.5.2.1 %StringIteratorPrototype%.next()\n}, function () {\n  var O = this._t;\n  var index = this._i;\n  var point;\n  if (index >= O.length) return { value: undefined, done: true };\n  point = $at(O, index);\n  this._i += point.length;\n  return { value: point, done: false };\n});\n\nvar _iterStep = function (done, value) {\n  return { value: value, done: !!done };\n};\n\n// 22.1.3.4 Array.prototype.entries()\n// 22.1.3.13 Array.prototype.keys()\n// 22.1.3.29 Array.prototype.values()\n// 22.1.3.30 Array.prototype[@@iterator]()\nvar es6_array_iterator = _iterDefine(Array, 'Array', function (iterated, kind) {\n  this._t = _toIobject(iterated); // target\n  this._i = 0;                   // next index\n  this._k = kind;                // kind\n// 22.1.5.2.1 %ArrayIteratorPrototype%.next()\n}, function () {\n  var O = this._t;\n  var kind = this._k;\n  var index = this._i++;\n  if (!O || index >= O.length) {\n    this._t = undefined;\n    return _iterStep(1);\n  }\n  if (kind == 'keys') return _iterStep(0, index);\n  if (kind == 'values') return _iterStep(0, O[index]);\n  return _iterStep(0, [index, O[index]]);\n}, 'values');\n\n// argumentsList[@@iterator] is %ArrayProto_values% (9.4.4.6, 9.4.4.7)\n_iterators.Arguments = _iterators.Array;\n\n_addToUnscopables('keys');\n_addToUnscopables('values');\n_addToUnscopables('entries');\n\nvar ITERATOR$1 = _wks('iterator');\nvar TO_STRING_TAG = _wks('toStringTag');\nvar ArrayValues = _iterators.Array;\n\nvar DOMIterables = {\n  CSSRuleList: true, // TODO: Not spec compliant, should be false.\n  CSSStyleDeclaration: false,\n  CSSValueList: false,\n  ClientRectList: false,\n  DOMRectList: false,\n  DOMStringList: false,\n  DOMTokenList: true,\n  DataTransferItemList: false,\n  FileList: false,\n  HTMLAllCollection: false,\n  HTMLCollection: false,\n  HTMLFormElement: false,\n  HTMLSelectElement: false,\n  MediaList: true, // TODO: Not spec compliant, should be false.\n  MimeTypeArray: false,\n  NamedNodeMap: false,\n  NodeList: true,\n  PaintRequestList: false,\n  Plugin: false,\n  PluginArray: false,\n  SVGLengthList: false,\n  SVGNumberList: false,\n  SVGPathSegList: false,\n  SVGPointList: false,\n  SVGStringList: false,\n  SVGTransformList: false,\n  SourceBufferList: false,\n  StyleSheetList: true, // TODO: Not spec compliant, should be false.\n  TextTrackCueList: false,\n  TextTrackList: false,\n  TouchList: false\n};\n\nfor (var collections = _objectKeys(DOMIterables), i = 0; i < collections.length; i++) {\n  var NAME = collections[i];\n  var explicit = DOMIterables[NAME];\n  var Collection = _global[NAME];\n  var proto = Collection && Collection.prototype;\n  var key;\n  if (proto) {\n    if (!proto[ITERATOR$1]) _hide(proto, ITERATOR$1, ArrayValues);\n    if (!proto[TO_STRING_TAG]) _hide(proto, TO_STRING_TAG, NAME);\n    _iterators[NAME] = ArrayValues;\n    if (explicit) for (key in es6_array_iterator) if (!proto[key]) _redefine(proto, key, es6_array_iterator[key], true);\n  }\n}\n\nvar iterator = _wksExt.f('iterator');\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/@firebase/polyfill/dist/index.esm.js","import '@firebase/polyfill';\nimport firebase from '@firebase/app';\n\n/**\r\n * Copyright 2018 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nexport default firebase;\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/firebase/app/dist/index.esm.js","import '@firebase/database';\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/firebase/database/dist/index.esm.js","import firebase from 'firebase/app'\nimport 'firebase/database'\n\nconst config = {\n  apiKey: \"AIzaSyBeyNtKCVeK7dSnZX0xr6qWCrKj5PnTmfM\",\n  authDomain: \"flexicon-757a0.firebaseapp.com\",\n  databaseURL: \"https://flexicon-757a0.firebaseio.com\",\n  projectId: \"flexicon-757a0\",\n  storageBucket: \"flexicon-757a0.appspot.com\",\n  messagingSenderId: \"357714471064\"\n}\n\nfirebase.initializeApp(config)\nexport default firebase\n\n\n\n// WEBPACK FOOTER //\n// ./firebase.js","import './style'\nimport { Component } from 'preact'\nimport firebase from './firebase.js'\nimport './assets/style.css'\nimport { width } from 'window-size';\n\nexport default class App extends Component {\n\tstate = {\n\t\tword: '',\n\t\ttranslation: '',\n\t\ttranslations: [],\n\t\taddWord: '',\n\t\taddTranslation: '',\n\n\t\tshowStartPage: true,\n\t\tshowAddNewWord: false,\n\t\tshowWordAdded: false,\n\t\tplusHover: false,\n\t\tshowShare: false\n\t}\n\n\tisShowAddNewBlock = false;\n\n\thandleChange = (e) => {\n\t\tthis.setState({ word: e.target.value })\n\t\tthis.checkWord()\n\t}\n\n\thandleAddWordChange = (e) => {\n\t\tthis.setState({ addWord: e.target.value })\n\t}\n\n\thandleAddTranslationChange = (e) => {\n\t\tthis.setState({ addTranslation: e.target.value })\n\t}\n\n\tcheckWord = () => {\n\t\tthis.setState({ translation: '' })\n\t\tlet obj = this.state.translations.find(word => word.word === this.state.word)\n\t\tif (obj) {\n\t\t\tthis.setState({ translation: obj.translation })\n\t\t}\n\t}\n\n\taddTranslation = () => {\n\t\tconst translationsRef = firebase.database().ref('translations');\n\t\tconst item = {\n\t\t\tword: this.state.addWord,\n\t\t\ttranslation: this.state.addTranslation\n\t\t}\n\t\tif (this.state.addWord.length > 0 && this.state.addTranslation.length > 0) {\n\t\t\ttranslationsRef.push(item);\n\t\t\tthis.setState({\n\t\t\t\taddWord: '',\n\t\t\t\taddTranslation: '',\n\t\t\t\tshowWordAdded: true\n\t\t\t});\n\t\t}\n\t}\n\n\tpopulate = () => {\n\t\tconst translationsRef = firebase.database().ref('translations');\n\n\t\ttranslations.map(o => translationsRef.push(o));\n\t}\n\n\tshowAddNew = () => {\n\t\tthis.setState({ plusHover: true })\n\t}\n\n\thideAddNew = () => {\n\t\tthis.setState({ plusHover: false })\n\t}\n\n\tshowAddNew = () => {\n\t\tthis.setState({ showShare: true })\n\t}\n\n\thideAddNew = () => {\n\t\tthis.setState({ showShare: false })\n\t}\n\n\ttoggleAddNewWord = () => {\n\t\tthis.setState({\n\t\t\tshowAddNewWord: !this.state.showAddNewWord,\n\t\t\tshowWordAdded: false,\n\t\t\tword: '',\n\t\t\ttranslation: ''\n\t\t})\n\t\tthis.isShowAddNewBlock ? this.isShowAddNewBlock = false : setTimeout(() => this.isShowAddNewBlock = true, 100)\n\t}\n\n\thideStartPage = () => {\n\t\tthis.setState({ showStartPage: false })\n\t}\n\n\tshowShareBtns = () => {\n\n\t}\n\n\tcomponentDidMount() {\n\t\tconst translationsRef = firebase.database().ref('translations');\n\t\ttranslationsRef.on('value', (snapshot) => {\n\t\t\tlet translations = snapshot.val()\n\t\t\tlet newState = []\n\t\t\tfor (let item in translations) {\n\t\t\t\tnewState.push({\n\t\t\t\t\tid: item,\n\t\t\t\t\tword: translations[item].word,\n\t\t\t\t\ttranslation: translations[item].translation\n\t\t\t\t})\n\t\t\t}\n\t\t\tthis.setState({\n\t\t\t\ttranslations: newState\n\t\t\t})\n\t\t})\n\t\t\n\t\tdocument.onclick = (e) => {\n\t\t\tif(e.target.className !== 'add-new-block'\n\t\t\t\t\t&& e.target.className !== 'add-new-block-input'\n\t\t\t\t\t&& e.target.className !== 'add-btn'\n\t\t\t\t\t&& this.isShowAddNewBlock){\n\t\t\t\tthis.toggleAddNewWord();\n\t\t\t}\n\t\t};\n\t}\n\n\trender() {\n\t\tconst classNames = require('classnames')\n\t\tconst addNewClass = classNames({\n      'add-new-container_text': true,\n      'hide': !this.state.plusHover\n\t\t})\n\n\t\treturn (\n\t\t\t<div style={'height: calc(100% - 50px)'}>\n\t\t\t\t{ this.state.showStartPage ?\n\t\t\t\t\t<div className='startPage'>\n\t\t\t\t\t\t<div className='startPage_text'>Флексикон - толковый словарь молодежного сленга, который даже бабушке объяснит, что лойс и лось - это разные вещи.</div>\n\t\t\t\t\t\t<div className='startPage_btn' onClick={this.hideStartPage}>ОКИЧ</div>\n\t\t\t\t\t</div> : ''\n\t\t\t\t}\n\t\t\t\t<div className='container'>\n\t\t\t\t\t<img src='/assets/r.svg' alt='R' />\n\t\t\t\t\t<p className='line' />\n\t\t\t\t\t<div className='head'>\n\t\t\t\t\t\t<img src='/assets/flexicon.svg' alt='Flexicon' />\n\t\t\t\t\t\t<div className=\"add-new-container\">\n\t\t\t\t\t\t\t<div className={addNewClass}>ДОБАВИТЬ НОВОЕ СЛОВО</div>\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tclassName='plus'\n\t\t\t\t\t\t\t\tsrc='/assets/plus.svg'\n\t\t\t\t\t\t\t\talt='plus'\n\t\t\t\t\t\t\t\tonMouseEnter={this.showAddNew}\n\t\t\t\t\t\t\t\tonMouseLeave={this.hideAddNew}\n\t\t\t\t\t\t\t\tonClick={this.toggleAddNewWord}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.state.showAddNewWord ?\n\t\t\t\t\t\t\t\t\t<div className='add-new-block'>\n\t\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\t\t\tplaceholder='напиши слово'\n\t\t\t\t\t\t\t\t\t\t\tvalue={this.state.addWord}\n\t\t\t\t\t\t\t\t\t\t\tonInput={this.handleAddWordChange}\n\t\t\t\t\t\t\t\t\t\t\tclassName='add-new-block-input'\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t\t\t\t\tplaceholder='напиши перевод'\n\t\t\t\t\t\t\t\t\t\t\tvalue={this.state.addTranslation}\n\t\t\t\t\t\t\t\t\t\t\tonInput={this.handleAddTranslationChange}\n\t\t\t\t\t\t\t\t\t\t\tclassName='add-new-block-input'\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<img className='add-btn' src='/assets/add-btn.svg' alt='plus' onClick={this.addTranslation} />\n\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tthis.state.showWordAdded ? \n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"wordAdded\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"wordAddedText\">Пушка, твое слово добавлено в словарь! Можешь сразу чекнуть его в нашем флексиконе!</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<img src='/assets/okich.svg' alt='start page text' onClick={this.toggleAddNewWord} />\n\t\t\t\t\t\t\t\t\t\t\t\t</div> : ''\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t</div> : ''\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t{ \n\t\t\t\t\t\t!this.state.showAddNewWord ?\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\tclassName='text-to-translate'\n\t\t\t\t\t\t\t\t\tvalue={this.state.word}\n\t\t\t\t\t\t\t\t\tonInput={this.handleChange}\n\t\t\t\t\t\t\t\t\tplaceholder='напиши слово'\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<div className='translation-result'>\n\t\t\t\t\t\t\t\t\t{this.state.translation}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div> : ''\t\t\n\t\t\t\t\t}\n\t\t\t\t\t<div className=\"shareContainer\"\n\t\t\t\t\t\tstyle={this.state.showShare ? 'width: 100%' : ''}\n\t\t\t\t\t\tonMouseEnter={this.showAddNew}\n\t\t\t\t\t\tonMouseLeave={this.hideAddNew}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div className=\"box\">\n\t\t\t\t\t\t\t<img src='/assets/arrow.svg' />\n\t\t\t\t\t\t\t<span>share</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.state.showShare ?\n\t\t\t\t\t\t\t\t<div className=\"shareBlock\">\n\t\t\t\t\t\t\t\t\t<a href={`https://www.linkedin.com/shareArticle?mini=true&url=${window.location.href}`} target=\"_blank\">LinkedIn</a>\n\t\t\t\t\t\t\t\t</div> : ''\n\t\t\t\t\t\t}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./index.js","import { createSubscribe, deepCopy, deepExtend, ErrorFactory, patchProperty } from '@firebase/util';\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar contains = function (obj, key) {\r\n    return Object.prototype.hasOwnProperty.call(obj, key);\r\n};\r\nvar DEFAULT_ENTRY_NAME = '[DEFAULT]';\r\n// An array to capture listeners before the true auth functions\r\n// exist\r\nvar tokenListeners = [];\r\n/**\r\n * Global context object for a collection of services using\r\n * a shared authentication state.\r\n */\r\nvar FirebaseAppImpl = /** @class */ (function () {\r\n    function FirebaseAppImpl(options, config, firebase_) {\r\n        this.firebase_ = firebase_;\r\n        this.isDeleted_ = false;\r\n        this.services_ = {};\r\n        this.name_ = config.name;\r\n        this._automaticDataCollectionEnabled =\r\n            config.automaticDataCollectionEnabled || false;\r\n        this.options_ = deepCopy(options);\r\n        this.INTERNAL = {\r\n            getUid: function () { return null; },\r\n            getToken: function () { return Promise.resolve(null); },\r\n            addAuthTokenListener: function (callback) {\r\n                tokenListeners.push(callback);\r\n                // Make sure callback is called, asynchronously, in the absence of the auth module\r\n                setTimeout(function () { return callback(null); }, 0);\r\n            },\r\n            removeAuthTokenListener: function (callback) {\r\n                tokenListeners = tokenListeners.filter(function (listener) { return listener !== callback; });\r\n            }\r\n        };\r\n    }\r\n    Object.defineProperty(FirebaseAppImpl.prototype, \"automaticDataCollectionEnabled\", {\r\n        get: function () {\r\n            this.checkDestroyed_();\r\n            return this._automaticDataCollectionEnabled;\r\n        },\r\n        set: function (val) {\r\n            this.checkDestroyed_();\r\n            this._automaticDataCollectionEnabled = val;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FirebaseAppImpl.prototype, \"name\", {\r\n        get: function () {\r\n            this.checkDestroyed_();\r\n            return this.name_;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FirebaseAppImpl.prototype, \"options\", {\r\n        get: function () {\r\n            this.checkDestroyed_();\r\n            return this.options_;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    FirebaseAppImpl.prototype.delete = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve) {\r\n            _this.checkDestroyed_();\r\n            resolve();\r\n        })\r\n            .then(function () {\r\n            _this.firebase_.INTERNAL.removeApp(_this.name_);\r\n            var services = [];\r\n            Object.keys(_this.services_).forEach(function (serviceKey) {\r\n                Object.keys(_this.services_[serviceKey]).forEach(function (instanceKey) {\r\n                    services.push(_this.services_[serviceKey][instanceKey]);\r\n                });\r\n            });\r\n            return Promise.all(services.map(function (service) {\r\n                return service.INTERNAL.delete();\r\n            }));\r\n        })\r\n            .then(function () {\r\n            _this.isDeleted_ = true;\r\n            _this.services_ = {};\r\n        });\r\n    };\r\n    /**\r\n     * Return a service instance associated with this app (creating it\r\n     * on demand), identified by the passed instanceIdentifier.\r\n     *\r\n     * NOTE: Currently storage is the only one that is leveraging this\r\n     * functionality. They invoke it by calling:\r\n     *\r\n     * ```javascript\r\n     * firebase.app().storage('STORAGE BUCKET ID')\r\n     * ```\r\n     *\r\n     * The service name is passed to this already\r\n     * @internal\r\n     */\r\n    FirebaseAppImpl.prototype._getService = function (name, instanceIdentifier) {\r\n        if (instanceIdentifier === void 0) { instanceIdentifier = DEFAULT_ENTRY_NAME; }\r\n        this.checkDestroyed_();\r\n        if (!this.services_[name]) {\r\n            this.services_[name] = {};\r\n        }\r\n        if (!this.services_[name][instanceIdentifier]) {\r\n            /**\r\n             * If a custom instance has been defined (i.e. not '[DEFAULT]')\r\n             * then we will pass that instance on, otherwise we pass `null`\r\n             */\r\n            var instanceSpecifier = instanceIdentifier !== DEFAULT_ENTRY_NAME\r\n                ? instanceIdentifier\r\n                : undefined;\r\n            var service = this.firebase_.INTERNAL.factories[name](this, this.extendApp.bind(this), instanceSpecifier);\r\n            this.services_[name][instanceIdentifier] = service;\r\n        }\r\n        return this.services_[name][instanceIdentifier];\r\n    };\r\n    /**\r\n     * Callback function used to extend an App instance at the time\r\n     * of service instance creation.\r\n     */\r\n    FirebaseAppImpl.prototype.extendApp = function (props) {\r\n        var _this = this;\r\n        // Copy the object onto the FirebaseAppImpl prototype\r\n        deepExtend(this, props);\r\n        /**\r\n         * If the app has overwritten the addAuthTokenListener stub, forward\r\n         * the active token listeners on to the true fxn.\r\n         *\r\n         * TODO: This function is required due to our current module\r\n         * structure. Once we are able to rely strictly upon a single module\r\n         * implementation, this code should be refactored and Auth should\r\n         * provide these stubs and the upgrade logic\r\n         */\r\n        if (props.INTERNAL && props.INTERNAL.addAuthTokenListener) {\r\n            tokenListeners.forEach(function (listener) {\r\n                _this.INTERNAL.addAuthTokenListener(listener);\r\n            });\r\n            tokenListeners = [];\r\n        }\r\n    };\r\n    /**\r\n     * This function will throw an Error if the App has already been deleted -\r\n     * use before performing API actions on the App.\r\n     */\r\n    FirebaseAppImpl.prototype.checkDestroyed_ = function () {\r\n        if (this.isDeleted_) {\r\n            error('app-deleted', { name: this.name_ });\r\n        }\r\n    };\r\n    return FirebaseAppImpl;\r\n}());\r\n// Prevent dead-code elimination of these methods w/o invalid property\r\n// copying.\r\n(FirebaseAppImpl.prototype.name && FirebaseAppImpl.prototype.options) ||\r\n    FirebaseAppImpl.prototype.delete ||\r\n    console.log('dc');\r\n/**\r\n * Return a firebase namespace object.\r\n *\r\n * In production, this will be called exactly once and the result\r\n * assigned to the 'firebase' global.  It may be called multiple times\r\n * in unit tests.\r\n */\r\nfunction createFirebaseNamespace() {\r\n    var apps_ = {};\r\n    var factories = {};\r\n    var appHooks = {};\r\n    // A namespace is a plain JavaScript Object.\r\n    var namespace = {\r\n        // Hack to prevent Babel from modifying the object returned\r\n        // as the firebase namespace.\r\n        __esModule: true,\r\n        initializeApp: initializeApp,\r\n        app: app,\r\n        apps: null,\r\n        Promise: Promise,\r\n        SDK_VERSION: '5.5.9',\r\n        INTERNAL: {\r\n            registerService: registerService,\r\n            createFirebaseNamespace: createFirebaseNamespace,\r\n            extendNamespace: extendNamespace,\r\n            createSubscribe: createSubscribe,\r\n            ErrorFactory: ErrorFactory,\r\n            removeApp: removeApp,\r\n            factories: factories,\r\n            useAsService: useAsService,\r\n            Promise: Promise,\r\n            deepExtend: deepExtend\r\n        }\r\n    };\r\n    // Inject a circular default export to allow Babel users who were previously\r\n    // using:\r\n    //\r\n    //   import firebase from 'firebase';\r\n    //   which becomes: var firebase = require('firebase').default;\r\n    //\r\n    // instead of\r\n    //\r\n    //   import * as firebase from 'firebase';\r\n    //   which becomes: var firebase = require('firebase');\r\n    patchProperty(namespace, 'default', namespace);\r\n    // firebase.apps is a read-only getter.\r\n    Object.defineProperty(namespace, 'apps', {\r\n        get: getApps\r\n    });\r\n    /**\r\n     * Called by App.delete() - but before any services associated with the App\r\n     * are deleted.\r\n     */\r\n    function removeApp(name) {\r\n        var app = apps_[name];\r\n        callAppHooks(app, 'delete');\r\n        delete apps_[name];\r\n    }\r\n    /**\r\n     * Get the App object for a given name (or DEFAULT).\r\n     */\r\n    function app(name) {\r\n        name = name || DEFAULT_ENTRY_NAME;\r\n        if (!contains(apps_, name)) {\r\n            error('no-app', { name: name });\r\n        }\r\n        return apps_[name];\r\n    }\r\n    patchProperty(app, 'App', FirebaseAppImpl);\r\n    function initializeApp(options, rawConfig) {\r\n        if (rawConfig === void 0) { rawConfig = {}; }\r\n        if (typeof rawConfig !== 'object' || rawConfig === null) {\r\n            var name_1 = rawConfig;\r\n            rawConfig = { name: name_1 };\r\n        }\r\n        var config = rawConfig;\r\n        if (config.name === undefined) {\r\n            config.name = DEFAULT_ENTRY_NAME;\r\n        }\r\n        var name = config.name;\r\n        if (typeof name !== 'string' || !name) {\r\n            error('bad-app-name', { name: name + '' });\r\n        }\r\n        if (contains(apps_, name)) {\r\n            error('duplicate-app', { name: name });\r\n        }\r\n        var app = new FirebaseAppImpl(options, config, namespace);\r\n        apps_[name] = app;\r\n        callAppHooks(app, 'create');\r\n        return app;\r\n    }\r\n    /*\r\n     * Return an array of all the non-deleted FirebaseApps.\r\n     */\r\n    function getApps() {\r\n        // Make a copy so caller cannot mutate the apps list.\r\n        return Object.keys(apps_).map(function (name) { return apps_[name]; });\r\n    }\r\n    /*\r\n     * Register a Firebase Service.\r\n     *\r\n     * firebase.INTERNAL.registerService()\r\n     *\r\n     * TODO: Implement serviceProperties.\r\n     */\r\n    function registerService(name, createService, serviceProperties, appHook, allowMultipleInstances) {\r\n        // Cannot re-register a service that already exists\r\n        if (factories[name]) {\r\n            error('duplicate-service', { name: name });\r\n        }\r\n        // Capture the service factory for later service instantiation\r\n        factories[name] = createService;\r\n        // Capture the appHook, if passed\r\n        if (appHook) {\r\n            appHooks[name] = appHook;\r\n            // Run the **new** app hook on all existing apps\r\n            getApps().forEach(function (app) {\r\n                appHook('create', app);\r\n            });\r\n        }\r\n        // The Service namespace is an accessor function ...\r\n        var serviceNamespace = function (appArg) {\r\n            if (appArg === void 0) { appArg = app(); }\r\n            if (typeof appArg[name] !== 'function') {\r\n                // Invalid argument.\r\n                // This happens in the following case: firebase.storage('gs:/')\r\n                error('invalid-app-argument', { name: name });\r\n            }\r\n            // Forward service instance lookup to the FirebaseApp.\r\n            return appArg[name]();\r\n        };\r\n        // ... and a container for service-level properties.\r\n        if (serviceProperties !== undefined) {\r\n            deepExtend(serviceNamespace, serviceProperties);\r\n        }\r\n        // Monkey-patch the serviceNamespace onto the firebase namespace\r\n        namespace[name] = serviceNamespace;\r\n        // Patch the FirebaseAppImpl prototype\r\n        FirebaseAppImpl.prototype[name] = function () {\r\n            var args = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                args[_i] = arguments[_i];\r\n            }\r\n            var serviceFxn = this._getService.bind(this, name);\r\n            return serviceFxn.apply(this, allowMultipleInstances ? args : []);\r\n        };\r\n        return serviceNamespace;\r\n    }\r\n    /**\r\n     * Patch the top-level firebase namespace with additional properties.\r\n     *\r\n     * firebase.INTERNAL.extendNamespace()\r\n     */\r\n    function extendNamespace(props) {\r\n        deepExtend(namespace, props);\r\n    }\r\n    function callAppHooks(app, eventName) {\r\n        Object.keys(factories).forEach(function (serviceName) {\r\n            // Ignore virtual services\r\n            var factoryName = useAsService(app, serviceName);\r\n            if (factoryName === null) {\r\n                return;\r\n            }\r\n            if (appHooks[factoryName]) {\r\n                appHooks[factoryName](eventName, app);\r\n            }\r\n        });\r\n    }\r\n    // Map the requested service to a registered service name\r\n    // (used to map auth to serverAuth service when needed).\r\n    function useAsService(app, name) {\r\n        if (name === 'serverAuth') {\r\n            return null;\r\n        }\r\n        var useService = name;\r\n        var options = app.options;\r\n        return useService;\r\n    }\r\n    return namespace;\r\n}\r\nfunction error(code, args) {\r\n    throw appErrors.create(code, args);\r\n}\r\n// TypeScript does not support non-string indexes!\r\n// let errors: {[code: AppError: string} = {\r\nvar errors = {\r\n    'no-app': \"No Firebase App '{$name}' has been created - \" +\r\n        'call Firebase App.initializeApp()',\r\n    'bad-app-name': \"Illegal App name: '{$name}\",\r\n    'duplicate-app': \"Firebase App named '{$name}' already exists\",\r\n    'app-deleted': \"Firebase App named '{$name}' already deleted\",\r\n    'duplicate-service': \"Firebase service named '{$name}' already registered\",\r\n    'sa-not-supported': 'Initializing the Firebase SDK with a service ' +\r\n        'account is only allowed in a Node.js environment. On client ' +\r\n        'devices, you should instead initialize the SDK with an api key and ' +\r\n        'auth domain',\r\n    'invalid-app-argument': 'firebase.{$name}() takes either no argument or a ' +\r\n        'Firebase App instance.'\r\n};\r\nvar appErrors = new ErrorFactory('app', 'Firebase', errors);\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar firebase = createFirebaseNamespace();\n\nexport default firebase;\nexport { firebase };\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/@firebase/app/dist/index.esm.js","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = Object.setPrototypeOf ||\r\n    ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n    function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = Object.assign || function __assign(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n    }\r\n    return t;\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r);  }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { if (o[n]) i[n] = function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; }; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator];\r\n    return m ? m.call(o) : typeof __values === \"function\" ? __values(o) : o[Symbol.iterator]();\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/tslib/tslib.es6.js","import { jsonEval, stringify, contains, assert, forEach, base64, Sha1, stringToByteArray, isNodeSdk, stringLength, safeGet, errorPrefix, validateArgCount, validateCallback, Deferred, assertionError, clone, map, getCount, getAnyKey, every, validateContextObject, isEmpty, getValues, findValue, findKey, deepCopy, isMobileCordova, base64Encode, CONSTANTS, isAdmin, isValidFormat, isReactNative, querystring } from '@firebase/util';\nimport { Logger, LogLevel } from '@firebase/logger';\nimport { __awaiter, __generator, __extends } from 'tslib';\nimport firebase from '@firebase/app';\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Wraps a DOM Storage object and:\r\n * - automatically encode objects as JSON strings before storing them to allow us to store arbitrary types.\r\n * - prefixes names with \"firebase:\" to avoid collisions with app data.\r\n *\r\n * We automatically (see storage.js) create two such wrappers, one for sessionStorage,\r\n * and one for localStorage.\r\n *\r\n * @constructor\r\n */\r\nvar DOMStorageWrapper = /** @class */ (function () {\r\n    /**\r\n     * @param {Storage} domStorage_ The underlying storage object (e.g. localStorage or sessionStorage)\r\n     */\r\n    function DOMStorageWrapper(domStorage_) {\r\n        this.domStorage_ = domStorage_;\r\n        // Use a prefix to avoid collisions with other stuff saved by the app.\r\n        this.prefix_ = 'firebase:';\r\n    }\r\n    /**\r\n     * @param {string} key The key to save the value under\r\n     * @param {?Object} value The value being stored, or null to remove the key.\r\n     */\r\n    DOMStorageWrapper.prototype.set = function (key, value) {\r\n        if (value == null) {\r\n            this.domStorage_.removeItem(this.prefixedName_(key));\r\n        }\r\n        else {\r\n            this.domStorage_.setItem(this.prefixedName_(key), stringify(value));\r\n        }\r\n    };\r\n    /**\r\n     * @param {string} key\r\n     * @return {*} The value that was stored under this key, or null\r\n     */\r\n    DOMStorageWrapper.prototype.get = function (key) {\r\n        var storedVal = this.domStorage_.getItem(this.prefixedName_(key));\r\n        if (storedVal == null) {\r\n            return null;\r\n        }\r\n        else {\r\n            return jsonEval(storedVal);\r\n        }\r\n    };\r\n    /**\r\n     * @param {string} key\r\n     */\r\n    DOMStorageWrapper.prototype.remove = function (key) {\r\n        this.domStorage_.removeItem(this.prefixedName_(key));\r\n    };\r\n    /**\r\n     * @param {string} name\r\n     * @return {string}\r\n     */\r\n    DOMStorageWrapper.prototype.prefixedName_ = function (name) {\r\n        return this.prefix_ + name;\r\n    };\r\n    DOMStorageWrapper.prototype.toString = function () {\r\n        return this.domStorage_.toString();\r\n    };\r\n    return DOMStorageWrapper;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * An in-memory storage implementation that matches the API of DOMStorageWrapper\r\n * (TODO: create interface for both to implement).\r\n *\r\n * @constructor\r\n */\r\nvar MemoryStorage = /** @class */ (function () {\r\n    function MemoryStorage() {\r\n        this.cache_ = {};\r\n        this.isInMemoryStorage = true;\r\n    }\r\n    MemoryStorage.prototype.set = function (key, value) {\r\n        if (value == null) {\r\n            delete this.cache_[key];\r\n        }\r\n        else {\r\n            this.cache_[key] = value;\r\n        }\r\n    };\r\n    MemoryStorage.prototype.get = function (key) {\r\n        if (contains(this.cache_, key)) {\r\n            return this.cache_[key];\r\n        }\r\n        return null;\r\n    };\r\n    MemoryStorage.prototype.remove = function (key) {\r\n        delete this.cache_[key];\r\n    };\r\n    return MemoryStorage;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Helper to create a DOMStorageWrapper or else fall back to MemoryStorage.\r\n * TODO: Once MemoryStorage and DOMStorageWrapper have a shared interface this method annotation should change\r\n * to reflect this type\r\n *\r\n * @param {string} domStorageName Name of the underlying storage object\r\n *   (e.g. 'localStorage' or 'sessionStorage').\r\n * @return {?} Turning off type information until a common interface is defined.\r\n */\r\nvar createStoragefor = function (domStorageName) {\r\n    try {\r\n        // NOTE: just accessing \"localStorage\" or \"window['localStorage']\" may throw a security exception,\r\n        // so it must be inside the try/catch.\r\n        if (typeof window !== 'undefined' &&\r\n            typeof window[domStorageName] !== 'undefined') {\r\n            // Need to test cache. Just because it's here doesn't mean it works\r\n            var domStorage = window[domStorageName];\r\n            domStorage.setItem('firebase:sentinel', 'cache');\r\n            domStorage.removeItem('firebase:sentinel');\r\n            return new DOMStorageWrapper(domStorage);\r\n        }\r\n    }\r\n    catch (e) { }\r\n    // Failed to create wrapper.  Just return in-memory storage.\r\n    // TODO: log?\r\n    return new MemoryStorage();\r\n};\r\n/** A storage object that lasts across sessions */\r\nvar PersistentStorage = createStoragefor('localStorage');\r\n/** A storage object that only lasts one session */\r\nvar SessionStorage = createStoragefor('sessionStorage');\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar logClient = new Logger('@firebase/database');\r\n/**\r\n * Returns a locally-unique ID (generated by just incrementing up from 0 each time its called).\r\n * @type {function(): number} Generated ID.\r\n */\r\nvar LUIDGenerator = (function () {\r\n    var id = 1;\r\n    return function () {\r\n        return id++;\r\n    };\r\n})();\r\n/**\r\n * Sha1 hash of the input string\r\n * @param {!string} str The string to hash\r\n * @return {!string} The resulting hash\r\n */\r\nvar sha1 = function (str) {\r\n    var utf8Bytes = stringToByteArray(str);\r\n    var sha1 = new Sha1();\r\n    sha1.update(utf8Bytes);\r\n    var sha1Bytes = sha1.digest();\r\n    return base64.encodeByteArray(sha1Bytes);\r\n};\r\n/**\r\n * @param {...*} var_args\r\n * @return {string}\r\n * @private\r\n */\r\nvar buildLogMessage_ = function () {\r\n    var var_args = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        var_args[_i] = arguments[_i];\r\n    }\r\n    var message = '';\r\n    for (var i = 0; i < var_args.length; i++) {\r\n        if (Array.isArray(var_args[i]) ||\r\n            (var_args[i] &&\r\n                typeof var_args[i] === 'object' &&\r\n                typeof var_args[i].length === 'number')) {\r\n            message += buildLogMessage_.apply(null, var_args[i]);\r\n        }\r\n        else if (typeof var_args[i] === 'object') {\r\n            message += stringify(var_args[i]);\r\n        }\r\n        else {\r\n            message += var_args[i];\r\n        }\r\n        message += ' ';\r\n    }\r\n    return message;\r\n};\r\n/**\r\n * Use this for all debug messages in Firebase.\r\n * @type {?function(string)}\r\n */\r\nvar logger = null;\r\n/**\r\n * Flag to check for log availability on first log message\r\n * @type {boolean}\r\n * @private\r\n */\r\nvar firstLog_ = true;\r\n/**\r\n * The implementation of Firebase.enableLogging (defined here to break dependencies)\r\n * @param {boolean|?function(string)} logger_ A flag to turn on logging, or a custom logger\r\n * @param {boolean=} persistent Whether or not to persist logging settings across refreshes\r\n */\r\nvar enableLogging = function (logger_, persistent) {\r\n    assert(!persistent || (logger_ === true || logger_ === false), \"Can't turn on custom loggers persistently.\");\r\n    if (logger_ === true) {\r\n        logClient.logLevel = LogLevel.VERBOSE;\r\n        logger = logClient.log.bind(logClient);\r\n        if (persistent)\r\n            SessionStorage.set('logging_enabled', true);\r\n    }\r\n    else if (typeof logger_ === 'function') {\r\n        logger = logger_;\r\n    }\r\n    else {\r\n        logger = null;\r\n        SessionStorage.remove('logging_enabled');\r\n    }\r\n};\r\n/**\r\n *\r\n * @param {...(string|Arguments)} var_args\r\n */\r\nvar log = function () {\r\n    var var_args = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        var_args[_i] = arguments[_i];\r\n    }\r\n    if (firstLog_ === true) {\r\n        firstLog_ = false;\r\n        if (logger === null && SessionStorage.get('logging_enabled') === true)\r\n            enableLogging(true);\r\n    }\r\n    if (logger) {\r\n        var message = buildLogMessage_.apply(null, var_args);\r\n        logger(message);\r\n    }\r\n};\r\n/**\r\n * @param {!string} prefix\r\n * @return {function(...[*])}\r\n */\r\nvar logWrapper = function (prefix) {\r\n    return function () {\r\n        var var_args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            var_args[_i] = arguments[_i];\r\n        }\r\n        log.apply(void 0, [prefix].concat(var_args));\r\n    };\r\n};\r\n/**\r\n * @param {...string} var_args\r\n */\r\nvar error = function () {\r\n    var var_args = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        var_args[_i] = arguments[_i];\r\n    }\r\n    var message = 'FIREBASE INTERNAL ERROR: ' + buildLogMessage_.apply(void 0, var_args);\r\n    logClient.error(message);\r\n};\r\n/**\r\n * @param {...string} var_args\r\n */\r\nvar fatal = function () {\r\n    var var_args = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        var_args[_i] = arguments[_i];\r\n    }\r\n    var message = \"FIREBASE FATAL ERROR: \" + buildLogMessage_.apply(void 0, var_args);\r\n    logClient.error(message);\r\n    throw new Error(message);\r\n};\r\n/**\r\n * @param {...*} var_args\r\n */\r\nvar warn = function () {\r\n    var var_args = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        var_args[_i] = arguments[_i];\r\n    }\r\n    var message = 'FIREBASE WARNING: ' + buildLogMessage_.apply(void 0, var_args);\r\n    logClient.warn(message);\r\n};\r\n/**\r\n * Logs a warning if the containing page uses https. Called when a call to new Firebase\r\n * does not use https.\r\n */\r\nvar warnIfPageIsSecure = function () {\r\n    // Be very careful accessing browser globals. Who knows what may or may not exist.\r\n    if (typeof window !== 'undefined' &&\r\n        window.location &&\r\n        window.location.protocol &&\r\n        window.location.protocol.indexOf('https:') !== -1) {\r\n        warn('Insecure Firebase access from a secure page. ' +\r\n            'Please use https in calls to new Firebase().');\r\n    }\r\n};\r\n/**\r\n * Returns true if data is NaN, or +/- Infinity.\r\n * @param {*} data\r\n * @return {boolean}\r\n */\r\nvar isInvalidJSONNumber = function (data) {\r\n    return (typeof data === 'number' &&\r\n        (data != data || // NaN\r\n            data == Number.POSITIVE_INFINITY ||\r\n            data == Number.NEGATIVE_INFINITY));\r\n};\r\n/**\r\n * @param {function()} fn\r\n */\r\nvar executeWhenDOMReady = function (fn) {\r\n    if (isNodeSdk() || document.readyState === 'complete') {\r\n        fn();\r\n    }\r\n    else {\r\n        // Modeled after jQuery. Try DOMContentLoaded and onreadystatechange (which\r\n        // fire before onload), but fall back to onload.\r\n        var called_1 = false;\r\n        var wrappedFn_1 = function () {\r\n            if (!document.body) {\r\n                setTimeout(wrappedFn_1, Math.floor(10));\r\n                return;\r\n            }\r\n            if (!called_1) {\r\n                called_1 = true;\r\n                fn();\r\n            }\r\n        };\r\n        if (document.addEventListener) {\r\n            document.addEventListener('DOMContentLoaded', wrappedFn_1, false);\r\n            // fallback to onload.\r\n            window.addEventListener('load', wrappedFn_1, false);\r\n        }\r\n        else if (document.attachEvent) {\r\n            // IE.\r\n            document.attachEvent('onreadystatechange', function () {\r\n                if (document.readyState === 'complete')\r\n                    wrappedFn_1();\r\n            });\r\n            // fallback to onload.\r\n            window.attachEvent('onload', wrappedFn_1);\r\n            // jQuery has an extra hack for IE that we could employ (based on\r\n            // http://javascript.nwbox.com/IEContentLoaded/) But it looks really old.\r\n            // I'm hoping we don't need it.\r\n        }\r\n    }\r\n};\r\n/**\r\n * Minimum key name. Invalid for actual data, used as a marker to sort before any valid names\r\n * @type {!string}\r\n */\r\nvar MIN_NAME = '[MIN_NAME]';\r\n/**\r\n * Maximum key name. Invalid for actual data, used as a marker to sort above any valid names\r\n * @type {!string}\r\n */\r\nvar MAX_NAME = '[MAX_NAME]';\r\n/**\r\n * Compares valid Firebase key names, plus min and max name\r\n * @param {!string} a\r\n * @param {!string} b\r\n * @return {!number}\r\n */\r\nvar nameCompare = function (a, b) {\r\n    if (a === b) {\r\n        return 0;\r\n    }\r\n    else if (a === MIN_NAME || b === MAX_NAME) {\r\n        return -1;\r\n    }\r\n    else if (b === MIN_NAME || a === MAX_NAME) {\r\n        return 1;\r\n    }\r\n    else {\r\n        var aAsInt = tryParseInt(a), bAsInt = tryParseInt(b);\r\n        if (aAsInt !== null) {\r\n            if (bAsInt !== null) {\r\n                return aAsInt - bAsInt == 0 ? a.length - b.length : aAsInt - bAsInt;\r\n            }\r\n            else {\r\n                return -1;\r\n            }\r\n        }\r\n        else if (bAsInt !== null) {\r\n            return 1;\r\n        }\r\n        else {\r\n            return a < b ? -1 : 1;\r\n        }\r\n    }\r\n};\r\n/**\r\n * @param {!string} a\r\n * @param {!string} b\r\n * @return {!number} comparison result.\r\n */\r\nvar stringCompare = function (a, b) {\r\n    if (a === b) {\r\n        return 0;\r\n    }\r\n    else if (a < b) {\r\n        return -1;\r\n    }\r\n    else {\r\n        return 1;\r\n    }\r\n};\r\n/**\r\n * @param {string} key\r\n * @param {Object} obj\r\n * @return {*}\r\n */\r\nvar requireKey = function (key, obj) {\r\n    if (obj && key in obj) {\r\n        return obj[key];\r\n    }\r\n    else {\r\n        throw new Error('Missing required key (' + key + ') in object: ' + stringify(obj));\r\n    }\r\n};\r\n/**\r\n * @param {*} obj\r\n * @return {string}\r\n */\r\nvar ObjectToUniqueKey = function (obj) {\r\n    if (typeof obj !== 'object' || obj === null)\r\n        return stringify(obj);\r\n    var keys = [];\r\n    for (var k in obj) {\r\n        keys.push(k);\r\n    }\r\n    // Export as json, but with the keys sorted.\r\n    keys.sort();\r\n    var key = '{';\r\n    for (var i = 0; i < keys.length; i++) {\r\n        if (i !== 0)\r\n            key += ',';\r\n        key += stringify(keys[i]);\r\n        key += ':';\r\n        key += ObjectToUniqueKey(obj[keys[i]]);\r\n    }\r\n    key += '}';\r\n    return key;\r\n};\r\n/**\r\n * Splits a string into a number of smaller segments of maximum size\r\n * @param {!string} str The string\r\n * @param {!number} segsize The maximum number of chars in the string.\r\n * @return {Array.<string>} The string, split into appropriately-sized chunks\r\n */\r\nvar splitStringBySize = function (str, segsize) {\r\n    var len = str.length;\r\n    if (len <= segsize) {\r\n        return [str];\r\n    }\r\n    var dataSegs = [];\r\n    for (var c = 0; c < len; c += segsize) {\r\n        if (c + segsize > len) {\r\n            dataSegs.push(str.substring(c, len));\r\n        }\r\n        else {\r\n            dataSegs.push(str.substring(c, c + segsize));\r\n        }\r\n    }\r\n    return dataSegs;\r\n};\r\n/**\r\n * Apply a function to each (key, value) pair in an object or\r\n * apply a function to each (index, value) pair in an array\r\n * @param {!(Object|Array)} obj The object or array to iterate over\r\n * @param {function(?, ?)} fn The function to apply\r\n */\r\nvar each = function (obj, fn) {\r\n    if (Array.isArray(obj)) {\r\n        for (var i = 0; i < obj.length; ++i) {\r\n            fn(i, obj[i]);\r\n        }\r\n    }\r\n    else {\r\n        /**\r\n         * in the conversion of code we removed the goog.object.forEach\r\n         * function which did a value,key callback. We standardized on\r\n         * a single impl that does a key, value callback. So we invert\r\n         * to not have to touch the `each` code points\r\n         */\r\n        forEach(obj, function (key, val) { return fn(val, key); });\r\n    }\r\n};\r\n/**\r\n * Borrowed from http://hg.secondlife.com/llsd/src/tip/js/typedarray.js (MIT License)\r\n * I made one modification at the end and removed the NaN / Infinity\r\n * handling (since it seemed broken [caused an overflow] and we don't need it).  See MJL comments.\r\n * @param {!number} v A double\r\n * @return {string}\r\n */\r\nvar doubleToIEEE754String = function (v) {\r\n    assert(!isInvalidJSONNumber(v), 'Invalid JSON number'); // MJL\r\n    var ebits = 11, fbits = 52;\r\n    var bias = (1 << (ebits - 1)) - 1, s, e, f, ln, i, bits, str;\r\n    // Compute sign, exponent, fraction\r\n    // Skip NaN / Infinity handling --MJL.\r\n    if (v === 0) {\r\n        e = 0;\r\n        f = 0;\r\n        s = 1 / v === -Infinity ? 1 : 0;\r\n    }\r\n    else {\r\n        s = v < 0;\r\n        v = Math.abs(v);\r\n        if (v >= Math.pow(2, 1 - bias)) {\r\n            // Normalized\r\n            ln = Math.min(Math.floor(Math.log(v) / Math.LN2), bias);\r\n            e = ln + bias;\r\n            f = Math.round(v * Math.pow(2, fbits - ln) - Math.pow(2, fbits));\r\n        }\r\n        else {\r\n            // Denormalized\r\n            e = 0;\r\n            f = Math.round(v / Math.pow(2, 1 - bias - fbits));\r\n        }\r\n    }\r\n    // Pack sign, exponent, fraction\r\n    bits = [];\r\n    for (i = fbits; i; i -= 1) {\r\n        bits.push(f % 2 ? 1 : 0);\r\n        f = Math.floor(f / 2);\r\n    }\r\n    for (i = ebits; i; i -= 1) {\r\n        bits.push(e % 2 ? 1 : 0);\r\n        e = Math.floor(e / 2);\r\n    }\r\n    bits.push(s ? 1 : 0);\r\n    bits.reverse();\r\n    str = bits.join('');\r\n    // Return the data as a hex string. --MJL\r\n    var hexByteString = '';\r\n    for (i = 0; i < 64; i += 8) {\r\n        var hexByte = parseInt(str.substr(i, 8), 2).toString(16);\r\n        if (hexByte.length === 1)\r\n            hexByte = '0' + hexByte;\r\n        hexByteString = hexByteString + hexByte;\r\n    }\r\n    return hexByteString.toLowerCase();\r\n};\r\n/**\r\n * Used to detect if we're in a Chrome content script (which executes in an\r\n * isolated environment where long-polling doesn't work).\r\n * @return {boolean}\r\n */\r\nvar isChromeExtensionContentScript = function () {\r\n    return !!(typeof window === 'object' &&\r\n        window['chrome'] &&\r\n        window['chrome']['extension'] &&\r\n        !/^chrome/.test(window.location.href));\r\n};\r\n/**\r\n * Used to detect if we're in a Windows 8 Store app.\r\n * @return {boolean}\r\n */\r\nvar isWindowsStoreApp = function () {\r\n    // Check for the presence of a couple WinRT globals\r\n    return typeof Windows === 'object' && typeof Windows.UI === 'object';\r\n};\r\n/**\r\n * Converts a server error code to a Javascript Error\r\n * @param {!string} code\r\n * @param {!Query} query\r\n * @return {Error}\r\n */\r\nvar errorForServerCode = function (code, query) {\r\n    var reason = 'Unknown Error';\r\n    if (code === 'too_big') {\r\n        reason =\r\n            'The data requested exceeds the maximum size ' +\r\n                'that can be accessed with a single request.';\r\n    }\r\n    else if (code == 'permission_denied') {\r\n        reason = \"Client doesn't have permission to access the desired data.\";\r\n    }\r\n    else if (code == 'unavailable') {\r\n        reason = 'The service is unavailable';\r\n    }\r\n    var error = new Error(code + ' at ' + query.path.toString() + ': ' + reason);\r\n    error.code = code.toUpperCase();\r\n    return error;\r\n};\r\n/**\r\n * Used to test for integer-looking strings\r\n * @type {RegExp}\r\n * @private\r\n */\r\nvar INTEGER_REGEXP_ = new RegExp('^-?\\\\d{1,10}$');\r\n/**\r\n * If the string contains a 32-bit integer, return it.  Else return null.\r\n * @param {!string} str\r\n * @return {?number}\r\n */\r\nvar tryParseInt = function (str) {\r\n    if (INTEGER_REGEXP_.test(str)) {\r\n        var intVal = Number(str);\r\n        if (intVal >= -2147483648 && intVal <= 2147483647) {\r\n            return intVal;\r\n        }\r\n    }\r\n    return null;\r\n};\r\n/**\r\n * Helper to run some code but catch any exceptions and re-throw them later.\r\n * Useful for preventing user callbacks from breaking internal code.\r\n *\r\n * Re-throwing the exception from a setTimeout is a little evil, but it's very\r\n * convenient (we don't have to try to figure out when is a safe point to\r\n * re-throw it), and the behavior seems reasonable:\r\n *\r\n * * If you aren't pausing on exceptions, you get an error in the console with\r\n *   the correct stack trace.\r\n * * If you're pausing on all exceptions, the debugger will pause on your\r\n *   exception and then again when we rethrow it.\r\n * * If you're only pausing on uncaught exceptions, the debugger will only pause\r\n *   on us re-throwing it.\r\n *\r\n * @param {!function()} fn The code to guard.\r\n */\r\nvar exceptionGuard = function (fn) {\r\n    try {\r\n        fn();\r\n    }\r\n    catch (e) {\r\n        // Re-throw exception when it's safe.\r\n        setTimeout(function () {\r\n            // It used to be that \"throw e\" would result in a good console error with\r\n            // relevant context, but as of Chrome 39, you just get the firebase.js\r\n            // file/line number where we re-throw it, which is useless. So we log\r\n            // e.stack explicitly.\r\n            var stack = e.stack || '';\r\n            warn('Exception was thrown by user callback.', stack);\r\n            throw e;\r\n        }, Math.floor(0));\r\n    }\r\n};\r\n/**\r\n * @return {boolean} true if we think we're currently being crawled.\r\n */\r\nvar beingCrawled = function () {\r\n    var userAgent = (typeof window === 'object' &&\r\n        window['navigator'] &&\r\n        window['navigator']['userAgent']) ||\r\n        '';\r\n    // For now we whitelist the most popular crawlers.  We should refine this to be the set of crawlers we\r\n    // believe to support JavaScript/AJAX rendering.\r\n    // NOTE: Google Webmaster Tools doesn't really belong, but their \"This is how a visitor to your website\r\n    // would have seen the page\" is flaky if we don't treat it as a crawler.\r\n    return (userAgent.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i) >= 0);\r\n};\r\n/**\r\n * Same as setTimeout() except on Node.JS it will /not/ prevent the process from exiting.\r\n *\r\n * It is removed with clearTimeout() as normal.\r\n *\r\n * @param {Function} fn Function to run.\r\n * @param {number} time Milliseconds to wait before running.\r\n * @return {number|Object} The setTimeout() return value.\r\n */\r\nvar setTimeoutNonBlocking = function (fn, time) {\r\n    var timeout = setTimeout(fn, time);\r\n    if (typeof timeout === 'object' && timeout['unref']) {\r\n        timeout['unref']();\r\n    }\r\n    return timeout;\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * An immutable object representing a parsed path.  It's immutable so that you\r\n * can pass them around to other functions without worrying about them changing\r\n * it.\r\n */\r\nvar Path = /** @class */ (function () {\r\n    /**\r\n     * @param {string|Array.<string>} pathOrString Path string to parse,\r\n     *      or another path, or the raw tokens array\r\n     * @param {number=} pieceNum\r\n     */\r\n    function Path(pathOrString, pieceNum) {\r\n        if (pieceNum === void 0) {\r\n            this.pieces_ = pathOrString.split('/');\r\n            // Remove empty pieces.\r\n            var copyTo = 0;\r\n            for (var i = 0; i < this.pieces_.length; i++) {\r\n                if (this.pieces_[i].length > 0) {\r\n                    this.pieces_[copyTo] = this.pieces_[i];\r\n                    copyTo++;\r\n                }\r\n            }\r\n            this.pieces_.length = copyTo;\r\n            this.pieceNum_ = 0;\r\n        }\r\n        else {\r\n            this.pieces_ = pathOrString;\r\n            this.pieceNum_ = pieceNum;\r\n        }\r\n    }\r\n    Object.defineProperty(Path, \"Empty\", {\r\n        /**\r\n         * Singleton to represent an empty path\r\n         *\r\n         * @const\r\n         */\r\n        get: function () {\r\n            return new Path('');\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Path.prototype.getFront = function () {\r\n        if (this.pieceNum_ >= this.pieces_.length)\r\n            return null;\r\n        return this.pieces_[this.pieceNum_];\r\n    };\r\n    /**\r\n     * @return {number} The number of segments in this path\r\n     */\r\n    Path.prototype.getLength = function () {\r\n        return this.pieces_.length - this.pieceNum_;\r\n    };\r\n    /**\r\n     * @return {!Path}\r\n     */\r\n    Path.prototype.popFront = function () {\r\n        var pieceNum = this.pieceNum_;\r\n        if (pieceNum < this.pieces_.length) {\r\n            pieceNum++;\r\n        }\r\n        return new Path(this.pieces_, pieceNum);\r\n    };\r\n    /**\r\n     * @return {?string}\r\n     */\r\n    Path.prototype.getBack = function () {\r\n        if (this.pieceNum_ < this.pieces_.length)\r\n            return this.pieces_[this.pieces_.length - 1];\r\n        return null;\r\n    };\r\n    Path.prototype.toString = function () {\r\n        var pathString = '';\r\n        for (var i = this.pieceNum_; i < this.pieces_.length; i++) {\r\n            if (this.pieces_[i] !== '')\r\n                pathString += '/' + this.pieces_[i];\r\n        }\r\n        return pathString || '/';\r\n    };\r\n    Path.prototype.toUrlEncodedString = function () {\r\n        var pathString = '';\r\n        for (var i = this.pieceNum_; i < this.pieces_.length; i++) {\r\n            if (this.pieces_[i] !== '')\r\n                pathString += '/' + encodeURIComponent(String(this.pieces_[i]));\r\n        }\r\n        return pathString || '/';\r\n    };\r\n    /**\r\n     * Shallow copy of the parts of the path.\r\n     *\r\n     * @param {number=} begin\r\n     * @return {!Array<string>}\r\n     */\r\n    Path.prototype.slice = function (begin) {\r\n        if (begin === void 0) { begin = 0; }\r\n        return this.pieces_.slice(this.pieceNum_ + begin);\r\n    };\r\n    /**\r\n     * @return {?Path}\r\n     */\r\n    Path.prototype.parent = function () {\r\n        if (this.pieceNum_ >= this.pieces_.length)\r\n            return null;\r\n        var pieces = [];\r\n        for (var i = this.pieceNum_; i < this.pieces_.length - 1; i++)\r\n            pieces.push(this.pieces_[i]);\r\n        return new Path(pieces, 0);\r\n    };\r\n    /**\r\n     * @param {string|!Path} childPathObj\r\n     * @return {!Path}\r\n     */\r\n    Path.prototype.child = function (childPathObj) {\r\n        var pieces = [];\r\n        for (var i = this.pieceNum_; i < this.pieces_.length; i++)\r\n            pieces.push(this.pieces_[i]);\r\n        if (childPathObj instanceof Path) {\r\n            for (var i = childPathObj.pieceNum_; i < childPathObj.pieces_.length; i++) {\r\n                pieces.push(childPathObj.pieces_[i]);\r\n            }\r\n        }\r\n        else {\r\n            var childPieces = childPathObj.split('/');\r\n            for (var i = 0; i < childPieces.length; i++) {\r\n                if (childPieces[i].length > 0)\r\n                    pieces.push(childPieces[i]);\r\n            }\r\n        }\r\n        return new Path(pieces, 0);\r\n    };\r\n    /**\r\n     * @return {boolean} True if there are no segments in this path\r\n     */\r\n    Path.prototype.isEmpty = function () {\r\n        return this.pieceNum_ >= this.pieces_.length;\r\n    };\r\n    /**\r\n     * @param {!Path} outerPath\r\n     * @param {!Path} innerPath\r\n     * @return {!Path} The path from outerPath to innerPath\r\n     */\r\n    Path.relativePath = function (outerPath, innerPath) {\r\n        var outer = outerPath.getFront(), inner = innerPath.getFront();\r\n        if (outer === null) {\r\n            return innerPath;\r\n        }\r\n        else if (outer === inner) {\r\n            return Path.relativePath(outerPath.popFront(), innerPath.popFront());\r\n        }\r\n        else {\r\n            throw new Error('INTERNAL ERROR: innerPath (' +\r\n                innerPath +\r\n                ') is not within ' +\r\n                'outerPath (' +\r\n                outerPath +\r\n                ')');\r\n        }\r\n    };\r\n    /**\r\n     * @param {!Path} left\r\n     * @param {!Path} right\r\n     * @return {number} -1, 0, 1 if left is less, equal, or greater than the right.\r\n     */\r\n    Path.comparePaths = function (left, right) {\r\n        var leftKeys = left.slice();\r\n        var rightKeys = right.slice();\r\n        for (var i = 0; i < leftKeys.length && i < rightKeys.length; i++) {\r\n            var cmp = nameCompare(leftKeys[i], rightKeys[i]);\r\n            if (cmp !== 0)\r\n                return cmp;\r\n        }\r\n        if (leftKeys.length === rightKeys.length)\r\n            return 0;\r\n        return leftKeys.length < rightKeys.length ? -1 : 1;\r\n    };\r\n    /**\r\n     *\r\n     * @param {Path} other\r\n     * @return {boolean} true if paths are the same.\r\n     */\r\n    Path.prototype.equals = function (other) {\r\n        if (this.getLength() !== other.getLength()) {\r\n            return false;\r\n        }\r\n        for (var i = this.pieceNum_, j = other.pieceNum_; i <= this.pieces_.length; i++, j++) {\r\n            if (this.pieces_[i] !== other.pieces_[j]) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n    /**\r\n     *\r\n     * @param {!Path} other\r\n     * @return {boolean} True if this path is a parent (or the same as) other\r\n     */\r\n    Path.prototype.contains = function (other) {\r\n        var i = this.pieceNum_;\r\n        var j = other.pieceNum_;\r\n        if (this.getLength() > other.getLength()) {\r\n            return false;\r\n        }\r\n        while (i < this.pieces_.length) {\r\n            if (this.pieces_[i] !== other.pieces_[j]) {\r\n                return false;\r\n            }\r\n            ++i;\r\n            ++j;\r\n        }\r\n        return true;\r\n    };\r\n    return Path;\r\n}()); // end Path\r\n/**\r\n * Dynamic (mutable) path used to count path lengths.\r\n *\r\n * This class is used to efficiently check paths for valid\r\n * length (in UTF8 bytes) and depth (used in path validation).\r\n *\r\n * Throws Error exception if path is ever invalid.\r\n *\r\n * The definition of a path always begins with '/'.\r\n */\r\nvar ValidationPath = /** @class */ (function () {\r\n    /**\r\n     * @param {!Path} path Initial Path.\r\n     * @param {string} errorPrefix_ Prefix for any error messages.\r\n     */\r\n    function ValidationPath(path, errorPrefix_) {\r\n        this.errorPrefix_ = errorPrefix_;\r\n        /** @type {!Array<string>} */\r\n        this.parts_ = path.slice();\r\n        /** @type {number} Initialize to number of '/' chars needed in path. */\r\n        this.byteLength_ = Math.max(1, this.parts_.length);\r\n        for (var i = 0; i < this.parts_.length; i++) {\r\n            this.byteLength_ += stringLength(this.parts_[i]);\r\n        }\r\n        this.checkValid_();\r\n    }\r\n    Object.defineProperty(ValidationPath, \"MAX_PATH_DEPTH\", {\r\n        /** @const {number} Maximum key depth. */\r\n        get: function () {\r\n            return 32;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ValidationPath, \"MAX_PATH_LENGTH_BYTES\", {\r\n        /** @const {number} Maximum number of (UTF8) bytes in a Firebase path. */\r\n        get: function () {\r\n            return 768;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /** @param {string} child */\r\n    ValidationPath.prototype.push = function (child) {\r\n        // Count the needed '/'\r\n        if (this.parts_.length > 0) {\r\n            this.byteLength_ += 1;\r\n        }\r\n        this.parts_.push(child);\r\n        this.byteLength_ += stringLength(child);\r\n        this.checkValid_();\r\n    };\r\n    ValidationPath.prototype.pop = function () {\r\n        var last = this.parts_.pop();\r\n        this.byteLength_ -= stringLength(last);\r\n        // Un-count the previous '/'\r\n        if (this.parts_.length > 0) {\r\n            this.byteLength_ -= 1;\r\n        }\r\n    };\r\n    ValidationPath.prototype.checkValid_ = function () {\r\n        if (this.byteLength_ > ValidationPath.MAX_PATH_LENGTH_BYTES) {\r\n            throw new Error(this.errorPrefix_ +\r\n                'has a key path longer than ' +\r\n                ValidationPath.MAX_PATH_LENGTH_BYTES +\r\n                ' bytes (' +\r\n                this.byteLength_ +\r\n                ').');\r\n        }\r\n        if (this.parts_.length > ValidationPath.MAX_PATH_DEPTH) {\r\n            throw new Error(this.errorPrefix_ +\r\n                'path specified exceeds the maximum depth that can be written (' +\r\n                ValidationPath.MAX_PATH_DEPTH +\r\n                ') or object contains a cycle ' +\r\n                this.toErrorString());\r\n        }\r\n    };\r\n    /**\r\n     * String for use in error messages - uses '.' notation for path.\r\n     *\r\n     * @return {string}\r\n     */\r\n    ValidationPath.prototype.toErrorString = function () {\r\n        if (this.parts_.length == 0) {\r\n            return '';\r\n        }\r\n        return \"in property '\" + this.parts_.join('.') + \"'\";\r\n    };\r\n    return ValidationPath;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar PROTOCOL_VERSION = '5';\r\nvar VERSION_PARAM = 'v';\r\nvar TRANSPORT_SESSION_PARAM = 's';\r\nvar REFERER_PARAM = 'r';\r\nvar FORGE_REF = 'f';\r\nvar FORGE_DOMAIN = 'firebaseio.com';\r\nvar LAST_SESSION_PARAM = 'ls';\r\nvar WEBSOCKET = 'websocket';\r\nvar LONG_POLLING = 'long_polling';\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * A class that holds metadata about a Repo object\r\n *\r\n * @constructor\r\n */\r\nvar RepoInfo = /** @class */ (function () {\r\n    /**\r\n     * @param {string} host Hostname portion of the url for the repo\r\n     * @param {boolean} secure Whether or not this repo is accessed over ssl\r\n     * @param {string} namespace The namespace represented by the repo\r\n     * @param {boolean} webSocketOnly Whether to prefer websockets over all other transports (used by Nest).\r\n     * @param {string=} persistenceKey Override the default session persistence storage key\r\n     */\r\n    function RepoInfo(host, secure, namespace, webSocketOnly, persistenceKey) {\r\n        if (persistenceKey === void 0) { persistenceKey = ''; }\r\n        this.secure = secure;\r\n        this.namespace = namespace;\r\n        this.webSocketOnly = webSocketOnly;\r\n        this.persistenceKey = persistenceKey;\r\n        this.host = host.toLowerCase();\r\n        this.domain = this.host.substr(this.host.indexOf('.') + 1);\r\n        this.internalHost = PersistentStorage.get('host:' + host) || this.host;\r\n    }\r\n    RepoInfo.prototype.needsQueryParam = function () {\r\n        return this.host !== this.internalHost || this.isCustomHost();\r\n    };\r\n    RepoInfo.prototype.isCacheableHost = function () {\r\n        return this.internalHost.substr(0, 2) === 's-';\r\n    };\r\n    RepoInfo.prototype.isDemoHost = function () {\r\n        return this.domain === 'firebaseio-demo.com';\r\n    };\r\n    RepoInfo.prototype.isCustomHost = function () {\r\n        return (this.domain !== 'firebaseio.com' && this.domain !== 'firebaseio-demo.com');\r\n    };\r\n    RepoInfo.prototype.updateHost = function (newHost) {\r\n        if (newHost !== this.internalHost) {\r\n            this.internalHost = newHost;\r\n            if (this.isCacheableHost()) {\r\n                PersistentStorage.set('host:' + this.host, this.internalHost);\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Returns the websocket URL for this repo\r\n     * @param {string} type of connection\r\n     * @param {Object} params list\r\n     * @return {string} The URL for this repo\r\n     */\r\n    RepoInfo.prototype.connectionURL = function (type, params) {\r\n        assert(typeof type === 'string', 'typeof type must == string');\r\n        assert(typeof params === 'object', 'typeof params must == object');\r\n        var connURL;\r\n        if (type === WEBSOCKET) {\r\n            connURL =\r\n                (this.secure ? 'wss://' : 'ws://') + this.internalHost + '/.ws?';\r\n        }\r\n        else if (type === LONG_POLLING) {\r\n            connURL =\r\n                (this.secure ? 'https://' : 'http://') + this.internalHost + '/.lp?';\r\n        }\r\n        else {\r\n            throw new Error('Unknown connection type: ' + type);\r\n        }\r\n        if (this.needsQueryParam()) {\r\n            params['ns'] = this.namespace;\r\n        }\r\n        var pairs = [];\r\n        forEach(params, function (key, value) {\r\n            pairs.push(key + '=' + value);\r\n        });\r\n        return connURL + pairs.join('&');\r\n    };\r\n    /** @return {string} */\r\n    RepoInfo.prototype.toString = function () {\r\n        var str = this.toURLString();\r\n        if (this.persistenceKey) {\r\n            str += '<' + this.persistenceKey + '>';\r\n        }\r\n        return str;\r\n    };\r\n    /** @return {string} */\r\n    RepoInfo.prototype.toURLString = function () {\r\n        return (this.secure ? 'https://' : 'http://') + this.host;\r\n    };\r\n    return RepoInfo;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @param {!string} pathString\r\n * @return {string}\r\n */\r\nfunction decodePath(pathString) {\r\n    var pathStringDecoded = '';\r\n    var pieces = pathString.split('/');\r\n    for (var i = 0; i < pieces.length; i++) {\r\n        if (pieces[i].length > 0) {\r\n            var piece = pieces[i];\r\n            try {\r\n                piece = decodeURIComponent(piece.replace(/\\+/g, ' '));\r\n            }\r\n            catch (e) { }\r\n            pathStringDecoded += '/' + piece;\r\n        }\r\n    }\r\n    return pathStringDecoded;\r\n}\r\n/**\r\n * @param {!string} queryString\r\n * @return {!{[key:string]:string}} key value hash\r\n */\r\nfunction decodeQuery(queryString) {\r\n    var results = {};\r\n    if (queryString.charAt(0) === '?') {\r\n        queryString = queryString.substring(1);\r\n    }\r\n    for (var _i = 0, _a = queryString.split('&'); _i < _a.length; _i++) {\r\n        var segment = _a[_i];\r\n        if (segment.length === 0) {\r\n            continue;\r\n        }\r\n        var kv = segment.split('=');\r\n        if (kv.length === 2) {\r\n            results[decodeURIComponent(kv[0])] = decodeURIComponent(kv[1]);\r\n        }\r\n        else {\r\n            warn(\"Invalid query segment '\" + segment + \"' in query '\" + queryString + \"'\");\r\n        }\r\n    }\r\n    return results;\r\n}\r\n/**\r\n *\r\n * @param {!string} dataURL\r\n * @return {{repoInfo: !RepoInfo, path: !Path}}\r\n */\r\nvar parseRepoInfo = function (dataURL) {\r\n    var parsedUrl = parseURL(dataURL), namespace = parsedUrl.subdomain;\r\n    if (parsedUrl.domain === 'firebase') {\r\n        fatal(parsedUrl.host +\r\n            ' is no longer supported. ' +\r\n            'Please use <YOUR FIREBASE>.firebaseio.com instead');\r\n    }\r\n    // Catch common error of uninitialized namespace value.\r\n    if ((!namespace || namespace == 'undefined') &&\r\n        parsedUrl.domain !== 'localhost') {\r\n        fatal('Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com');\r\n    }\r\n    if (!parsedUrl.secure) {\r\n        warnIfPageIsSecure();\r\n    }\r\n    var webSocketOnly = parsedUrl.scheme === 'ws' || parsedUrl.scheme === 'wss';\r\n    return {\r\n        repoInfo: new RepoInfo(parsedUrl.host, parsedUrl.secure, namespace, webSocketOnly),\r\n        path: new Path(parsedUrl.pathString)\r\n    };\r\n};\r\n/**\r\n *\r\n * @param {!string} dataURL\r\n * @return {{host: string, port: number, domain: string, subdomain: string, secure: boolean, scheme: string, pathString: string}}\r\n */\r\nvar parseURL = function (dataURL) {\r\n    // Default to empty strings in the event of a malformed string.\r\n    var host = '', domain = '', subdomain = '', pathString = '';\r\n    // Always default to SSL, unless otherwise specified.\r\n    var secure = true, scheme = 'https', port = 443;\r\n    // Don't do any validation here. The caller is responsible for validating the result of parsing.\r\n    if (typeof dataURL === 'string') {\r\n        // Parse scheme.\r\n        var colonInd = dataURL.indexOf('//');\r\n        if (colonInd >= 0) {\r\n            scheme = dataURL.substring(0, colonInd - 1);\r\n            dataURL = dataURL.substring(colonInd + 2);\r\n        }\r\n        // Parse host, path, and query string.\r\n        var slashInd = dataURL.indexOf('/');\r\n        if (slashInd === -1) {\r\n            slashInd = dataURL.length;\r\n        }\r\n        var questionMarkInd = dataURL.indexOf('?');\r\n        if (questionMarkInd === -1) {\r\n            questionMarkInd = dataURL.length;\r\n        }\r\n        host = dataURL.substring(0, Math.min(slashInd, questionMarkInd));\r\n        if (slashInd < questionMarkInd) {\r\n            // For pathString, questionMarkInd will always come after slashInd\r\n            pathString = decodePath(dataURL.substring(slashInd, questionMarkInd));\r\n        }\r\n        var queryParams = decodeQuery(dataURL.substring(Math.min(dataURL.length, questionMarkInd)));\r\n        // If we have a port, use scheme for determining if it's secure.\r\n        colonInd = host.indexOf(':');\r\n        if (colonInd >= 0) {\r\n            secure = scheme === 'https' || scheme === 'wss';\r\n            port = parseInt(host.substring(colonInd + 1), 10);\r\n        }\r\n        else {\r\n            colonInd = dataURL.length;\r\n        }\r\n        var parts = host.split('.');\r\n        if (parts.length === 3) {\r\n            // Normalize namespaces to lowercase to share storage / connection.\r\n            domain = parts[1];\r\n            subdomain = parts[0].toLowerCase();\r\n        }\r\n        else if (parts.length === 2) {\r\n            domain = parts[0];\r\n        }\r\n        else if (parts[0].slice(0, colonInd).toLowerCase() === 'localhost') {\r\n            domain = 'localhost';\r\n        }\r\n        // Support `ns` query param if subdomain not already set\r\n        if (subdomain === '' && 'ns' in queryParams) {\r\n            subdomain = queryParams['ns'];\r\n        }\r\n    }\r\n    return {\r\n        host: host,\r\n        port: port,\r\n        domain: domain,\r\n        subdomain: subdomain,\r\n        secure: secure,\r\n        scheme: scheme,\r\n        pathString: pathString\r\n    };\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * True for invalid Firebase keys\r\n * @type {RegExp}\r\n * @private\r\n */\r\nvar INVALID_KEY_REGEX_ = /[\\[\\].#$\\/\\u0000-\\u001F\\u007F]/;\r\n/**\r\n * True for invalid Firebase paths.\r\n * Allows '/' in paths.\r\n * @type {RegExp}\r\n * @private\r\n */\r\nvar INVALID_PATH_REGEX_ = /[\\[\\].#$\\u0000-\\u001F\\u007F]/;\r\n/**\r\n * Maximum number of characters to allow in leaf value\r\n * @type {number}\r\n * @private\r\n */\r\nvar MAX_LEAF_SIZE_ = 10 * 1024 * 1024;\r\n/**\r\n * @param {*} key\r\n * @return {boolean}\r\n */\r\nvar isValidKey = function (key) {\r\n    return (typeof key === 'string' && key.length !== 0 && !INVALID_KEY_REGEX_.test(key));\r\n};\r\n/**\r\n * @param {string} pathString\r\n * @return {boolean}\r\n */\r\nvar isValidPathString = function (pathString) {\r\n    return (typeof pathString === 'string' &&\r\n        pathString.length !== 0 &&\r\n        !INVALID_PATH_REGEX_.test(pathString));\r\n};\r\n/**\r\n * @param {string} pathString\r\n * @return {boolean}\r\n */\r\nvar isValidRootPathString = function (pathString) {\r\n    if (pathString) {\r\n        // Allow '/.info/' at the beginning.\r\n        pathString = pathString.replace(/^\\/*\\.info(\\/|$)/, '/');\r\n    }\r\n    return isValidPathString(pathString);\r\n};\r\n/**\r\n * @param {*} priority\r\n * @return {boolean}\r\n */\r\nvar isValidPriority = function (priority) {\r\n    return (priority === null ||\r\n        typeof priority === 'string' ||\r\n        (typeof priority === 'number' && !isInvalidJSONNumber(priority)) ||\r\n        (priority && typeof priority === 'object' && contains(priority, '.sv')));\r\n};\r\n/**\r\n * Pre-validate a datum passed as an argument to Firebase function.\r\n *\r\n * @param {string} fnName\r\n * @param {number} argumentNumber\r\n * @param {*} data\r\n * @param {!Path} path\r\n * @param {boolean} optional\r\n */\r\nvar validateFirebaseDataArg = function (fnName, argumentNumber, data, path, optional) {\r\n    if (optional && data === undefined)\r\n        return;\r\n    validateFirebaseData(errorPrefix(fnName, argumentNumber, optional), data, path);\r\n};\r\n/**\r\n * Validate a data object client-side before sending to server.\r\n *\r\n * @param {string} errorPrefix\r\n * @param {*} data\r\n * @param {!Path|!ValidationPath} path_\r\n */\r\nvar validateFirebaseData = function (errorPrefix$$1, data, path_) {\r\n    var path = path_ instanceof Path ? new ValidationPath(path_, errorPrefix$$1) : path_;\r\n    if (data === undefined) {\r\n        throw new Error(errorPrefix$$1 + 'contains undefined ' + path.toErrorString());\r\n    }\r\n    if (typeof data === 'function') {\r\n        throw new Error(errorPrefix$$1 +\r\n            'contains a function ' +\r\n            path.toErrorString() +\r\n            ' with contents = ' +\r\n            data.toString());\r\n    }\r\n    if (isInvalidJSONNumber(data)) {\r\n        throw new Error(errorPrefix$$1 + 'contains ' + data.toString() + ' ' + path.toErrorString());\r\n    }\r\n    // Check max leaf size, but try to avoid the utf8 conversion if we can.\r\n    if (typeof data === 'string' &&\r\n        data.length > MAX_LEAF_SIZE_ / 3 &&\r\n        stringLength(data) > MAX_LEAF_SIZE_) {\r\n        throw new Error(errorPrefix$$1 +\r\n            'contains a string greater than ' +\r\n            MAX_LEAF_SIZE_ +\r\n            ' utf8 bytes ' +\r\n            path.toErrorString() +\r\n            \" ('\" +\r\n            data.substring(0, 50) +\r\n            \"...')\");\r\n    }\r\n    // TODO = Perf = Consider combining the recursive validation of keys into NodeFromJSON\r\n    // to save extra walking of large objects.\r\n    if (data && typeof data === 'object') {\r\n        var hasDotValue_1 = false, hasActualChild_1 = false;\r\n        forEach(data, function (key, value) {\r\n            if (key === '.value') {\r\n                hasDotValue_1 = true;\r\n            }\r\n            else if (key !== '.priority' && key !== '.sv') {\r\n                hasActualChild_1 = true;\r\n                if (!isValidKey(key)) {\r\n                    throw new Error(errorPrefix$$1 +\r\n                        ' contains an invalid key (' +\r\n                        key +\r\n                        ') ' +\r\n                        path.toErrorString() +\r\n                        '.  Keys must be non-empty strings ' +\r\n                        'and can\\'t contain \".\", \"#\", \"$\", \"/\", \"[\", or \"]\"');\r\n                }\r\n            }\r\n            path.push(key);\r\n            validateFirebaseData(errorPrefix$$1, value, path);\r\n            path.pop();\r\n        });\r\n        if (hasDotValue_1 && hasActualChild_1) {\r\n            throw new Error(errorPrefix$$1 +\r\n                ' contains \".value\" child ' +\r\n                path.toErrorString() +\r\n                ' in addition to actual children.');\r\n        }\r\n    }\r\n};\r\n/**\r\n * Pre-validate paths passed in the firebase function.\r\n *\r\n * @param {string} errorPrefix\r\n * @param {Array<!Path>} mergePaths\r\n */\r\nvar validateFirebaseMergePaths = function (errorPrefix$$1, mergePaths) {\r\n    var i, curPath;\r\n    for (i = 0; i < mergePaths.length; i++) {\r\n        curPath = mergePaths[i];\r\n        var keys = curPath.slice();\r\n        for (var j = 0; j < keys.length; j++) {\r\n            if (keys[j] === '.priority' && j === keys.length - 1) {\r\n                // .priority is OK\r\n            }\r\n            else if (!isValidKey(keys[j])) {\r\n                throw new Error(errorPrefix$$1 +\r\n                    'contains an invalid key (' +\r\n                    keys[j] +\r\n                    ') in path ' +\r\n                    curPath.toString() +\r\n                    '. Keys must be non-empty strings ' +\r\n                    'and can\\'t contain \".\", \"#\", \"$\", \"/\", \"[\", or \"]\"');\r\n            }\r\n        }\r\n    }\r\n    // Check that update keys are not descendants of each other.\r\n    // We rely on the property that sorting guarantees that ancestors come\r\n    // right before descendants.\r\n    mergePaths.sort(Path.comparePaths);\r\n    var prevPath = null;\r\n    for (i = 0; i < mergePaths.length; i++) {\r\n        curPath = mergePaths[i];\r\n        if (prevPath !== null && prevPath.contains(curPath)) {\r\n            throw new Error(errorPrefix$$1 +\r\n                'contains a path ' +\r\n                prevPath.toString() +\r\n                ' that is ancestor of another path ' +\r\n                curPath.toString());\r\n        }\r\n        prevPath = curPath;\r\n    }\r\n};\r\n/**\r\n * pre-validate an object passed as an argument to firebase function (\r\n * must be an object - e.g. for firebase.update()).\r\n *\r\n * @param {string} fnName\r\n * @param {number} argumentNumber\r\n * @param {*} data\r\n * @param {!Path} path\r\n * @param {boolean} optional\r\n */\r\nvar validateFirebaseMergeDataArg = function (fnName, argumentNumber, data, path, optional) {\r\n    if (optional && data === undefined)\r\n        return;\r\n    var errorPrefix$$1 = errorPrefix(fnName, argumentNumber, optional);\r\n    if (!(data && typeof data === 'object') || Array.isArray(data)) {\r\n        throw new Error(errorPrefix$$1 + ' must be an object containing the children to replace.');\r\n    }\r\n    var mergePaths = [];\r\n    forEach(data, function (key, value) {\r\n        var curPath = new Path(key);\r\n        validateFirebaseData(errorPrefix$$1, value, path.child(curPath));\r\n        if (curPath.getBack() === '.priority') {\r\n            if (!isValidPriority(value)) {\r\n                throw new Error(errorPrefix$$1 +\r\n                    \"contains an invalid value for '\" +\r\n                    curPath.toString() +\r\n                    \"', which must be a valid \" +\r\n                    'Firebase priority (a string, finite number, server value, or null).');\r\n            }\r\n        }\r\n        mergePaths.push(curPath);\r\n    });\r\n    validateFirebaseMergePaths(errorPrefix$$1, mergePaths);\r\n};\r\nvar validatePriority = function (fnName, argumentNumber, priority, optional) {\r\n    if (optional && priority === undefined)\r\n        return;\r\n    if (isInvalidJSONNumber(priority))\r\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) +\r\n            'is ' +\r\n            priority.toString() +\r\n            ', but must be a valid Firebase priority (a string, finite number, ' +\r\n            'server value, or null).');\r\n    // Special case to allow importing data with a .sv.\r\n    if (!isValidPriority(priority))\r\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) +\r\n            'must be a valid Firebase priority ' +\r\n            '(a string, finite number, server value, or null).');\r\n};\r\nvar validateEventType = function (fnName, argumentNumber, eventType, optional) {\r\n    if (optional && eventType === undefined)\r\n        return;\r\n    switch (eventType) {\r\n        case 'value':\r\n        case 'child_added':\r\n        case 'child_removed':\r\n        case 'child_changed':\r\n        case 'child_moved':\r\n            break;\r\n        default:\r\n            throw new Error(errorPrefix(fnName, argumentNumber, optional) +\r\n                'must be a valid event type = \"value\", \"child_added\", \"child_removed\", ' +\r\n                '\"child_changed\", or \"child_moved\".');\r\n    }\r\n};\r\nvar validateKey = function (fnName, argumentNumber, key, optional) {\r\n    if (optional && key === undefined)\r\n        return;\r\n    if (!isValidKey(key))\r\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) +\r\n            'was an invalid key = \"' +\r\n            key +\r\n            '\".  Firebase keys must be non-empty strings and ' +\r\n            'can\\'t contain \".\", \"#\", \"$\", \"/\", \"[\", or \"]\").');\r\n};\r\nvar validatePathString = function (fnName, argumentNumber, pathString, optional) {\r\n    if (optional && pathString === undefined)\r\n        return;\r\n    if (!isValidPathString(pathString))\r\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) +\r\n            'was an invalid path = \"' +\r\n            pathString +\r\n            '\". Paths must be non-empty strings and ' +\r\n            'can\\'t contain \".\", \"#\", \"$\", \"[\", or \"]\"');\r\n};\r\nvar validateRootPathString = function (fnName, argumentNumber, pathString, optional) {\r\n    if (pathString) {\r\n        // Allow '/.info/' at the beginning.\r\n        pathString = pathString.replace(/^\\/*\\.info(\\/|$)/, '/');\r\n    }\r\n    validatePathString(fnName, argumentNumber, pathString, optional);\r\n};\r\nvar validateWritablePath = function (fnName, path) {\r\n    if (path.getFront() === '.info') {\r\n        throw new Error(fnName + \" failed = Can't modify data under /.info/\");\r\n    }\r\n};\r\nvar validateUrl = function (fnName, argumentNumber, parsedUrl) {\r\n    // TODO = Validate server better.\r\n    var pathString = parsedUrl.path.toString();\r\n    if (!(typeof parsedUrl.repoInfo.host === 'string') ||\r\n        parsedUrl.repoInfo.host.length === 0 ||\r\n        (!isValidKey(parsedUrl.repoInfo.namespace) &&\r\n            parsedUrl.repoInfo.host.split(':')[0] !== 'localhost') ||\r\n        (pathString.length !== 0 && !isValidRootPathString(pathString))) {\r\n        throw new Error(errorPrefix(fnName, argumentNumber, false) +\r\n            'must be a valid firebase URL and ' +\r\n            'the path can\\'t contain \".\", \"#\", \"$\", \"[\", or \"]\".');\r\n    }\r\n};\r\nvar validateBoolean = function (fnName, argumentNumber, bool, optional) {\r\n    if (optional && bool === undefined)\r\n        return;\r\n    if (typeof bool !== 'boolean')\r\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) + 'must be a boolean.');\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @constructor\r\n */\r\nvar OnDisconnect = /** @class */ (function () {\r\n    /**\r\n     * @param {!Repo} repo_\r\n     * @param {!Path} path_\r\n     */\r\n    function OnDisconnect(repo_, path_) {\r\n        this.repo_ = repo_;\r\n        this.path_ = path_;\r\n    }\r\n    /**\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!firebase.Promise}\r\n     */\r\n    OnDisconnect.prototype.cancel = function (onComplete) {\r\n        validateArgCount('OnDisconnect.cancel', 0, 1, arguments.length);\r\n        validateCallback('OnDisconnect.cancel', 1, onComplete, true);\r\n        var deferred = new Deferred();\r\n        this.repo_.onDisconnectCancel(this.path_, deferred.wrapCallback(onComplete));\r\n        return deferred.promise;\r\n    };\r\n    /**\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!firebase.Promise}\r\n     */\r\n    OnDisconnect.prototype.remove = function (onComplete) {\r\n        validateArgCount('OnDisconnect.remove', 0, 1, arguments.length);\r\n        validateWritablePath('OnDisconnect.remove', this.path_);\r\n        validateCallback('OnDisconnect.remove', 1, onComplete, true);\r\n        var deferred = new Deferred();\r\n        this.repo_.onDisconnectSet(this.path_, null, deferred.wrapCallback(onComplete));\r\n        return deferred.promise;\r\n    };\r\n    /**\r\n     * @param {*} value\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!firebase.Promise}\r\n     */\r\n    OnDisconnect.prototype.set = function (value, onComplete) {\r\n        validateArgCount('OnDisconnect.set', 1, 2, arguments.length);\r\n        validateWritablePath('OnDisconnect.set', this.path_);\r\n        validateFirebaseDataArg('OnDisconnect.set', 1, value, this.path_, false);\r\n        validateCallback('OnDisconnect.set', 2, onComplete, true);\r\n        var deferred = new Deferred();\r\n        this.repo_.onDisconnectSet(this.path_, value, deferred.wrapCallback(onComplete));\r\n        return deferred.promise;\r\n    };\r\n    /**\r\n     * @param {*} value\r\n     * @param {number|string|null} priority\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!firebase.Promise}\r\n     */\r\n    OnDisconnect.prototype.setWithPriority = function (value, priority, onComplete) {\r\n        validateArgCount('OnDisconnect.setWithPriority', 2, 3, arguments.length);\r\n        validateWritablePath('OnDisconnect.setWithPriority', this.path_);\r\n        validateFirebaseDataArg('OnDisconnect.setWithPriority', 1, value, this.path_, false);\r\n        validatePriority('OnDisconnect.setWithPriority', 2, priority, false);\r\n        validateCallback('OnDisconnect.setWithPriority', 3, onComplete, true);\r\n        var deferred = new Deferred();\r\n        this.repo_.onDisconnectSetWithPriority(this.path_, value, priority, deferred.wrapCallback(onComplete));\r\n        return deferred.promise;\r\n    };\r\n    /**\r\n     * @param {!Object} objectToMerge\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!firebase.Promise}\r\n     */\r\n    OnDisconnect.prototype.update = function (objectToMerge, onComplete) {\r\n        validateArgCount('OnDisconnect.update', 1, 2, arguments.length);\r\n        validateWritablePath('OnDisconnect.update', this.path_);\r\n        if (Array.isArray(objectToMerge)) {\r\n            var newObjectToMerge = {};\r\n            for (var i = 0; i < objectToMerge.length; ++i) {\r\n                newObjectToMerge['' + i] = objectToMerge[i];\r\n            }\r\n            objectToMerge = newObjectToMerge;\r\n            warn('Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the ' +\r\n                'existing data, or an Object with integer keys if you really do want to only update some of the children.');\r\n        }\r\n        validateFirebaseMergeDataArg('OnDisconnect.update', 1, objectToMerge, this.path_, false);\r\n        validateCallback('OnDisconnect.update', 2, onComplete, true);\r\n        var deferred = new Deferred();\r\n        this.repo_.onDisconnectUpdate(this.path_, objectToMerge, deferred.wrapCallback(onComplete));\r\n        return deferred.promise;\r\n    };\r\n    return OnDisconnect;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar TransactionResult = /** @class */ (function () {\r\n    /**\r\n     * A type for the resolve value of Firebase.transaction.\r\n     * @constructor\r\n     * @dict\r\n     * @param {boolean} committed\r\n     * @param {DataSnapshot} snapshot\r\n     */\r\n    function TransactionResult(committed, snapshot) {\r\n        this.committed = committed;\r\n        this.snapshot = snapshot;\r\n    }\r\n    // Do not create public documentation. This is intended to make JSON serialization work but is otherwise unnecessary\r\n    // for end-users\r\n    TransactionResult.prototype.toJSON = function () {\r\n        validateArgCount('TransactionResult.toJSON', 0, 1, arguments.length);\r\n        return { committed: this.committed, snapshot: this.snapshot.toJSON() };\r\n    };\r\n    return TransactionResult;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Fancy ID generator that creates 20-character string identifiers with the\r\n * following properties:\r\n *\r\n * 1. They're based on timestamp so that they sort *after* any existing ids.\r\n * 2. They contain 72-bits of random data after the timestamp so that IDs won't\r\n *    collide with other clients' IDs.\r\n * 3. They sort *lexicographically* (so the timestamp is converted to characters\r\n *    that will sort properly).\r\n * 4. They're monotonically increasing. Even if you generate more than one in\r\n *    the same timestamp, the latter ones will sort after the former ones. We do\r\n *    this by using the previous random bits but \"incrementing\" them by 1 (only\r\n *    in the case of a timestamp collision).\r\n */\r\nvar nextPushId = (function () {\r\n    // Modeled after base64 web-safe chars, but ordered by ASCII.\r\n    var PUSH_CHARS = '-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz';\r\n    // Timestamp of last push, used to prevent local collisions if you push twice\r\n    // in one ms.\r\n    var lastPushTime = 0;\r\n    // We generate 72-bits of randomness which get turned into 12 characters and\r\n    // appended to the timestamp to prevent collisions with other clients. We\r\n    // store the last characters we generated because in the event of a collision,\r\n    // we'll use those same characters except \"incremented\" by one.\r\n    var lastRandChars = [];\r\n    return function (now) {\r\n        var duplicateTime = now === lastPushTime;\r\n        lastPushTime = now;\r\n        var i;\r\n        var timeStampChars = new Array(8);\r\n        for (i = 7; i >= 0; i--) {\r\n            timeStampChars[i] = PUSH_CHARS.charAt(now % 64);\r\n            // NOTE: Can't use << here because javascript will convert to int and lose\r\n            // the upper bits.\r\n            now = Math.floor(now / 64);\r\n        }\r\n        assert(now === 0, 'Cannot push at time == 0');\r\n        var id = timeStampChars.join('');\r\n        if (!duplicateTime) {\r\n            for (i = 0; i < 12; i++) {\r\n                lastRandChars[i] = Math.floor(Math.random() * 64);\r\n            }\r\n        }\r\n        else {\r\n            // If the timestamp hasn't changed since last push, use the same random\r\n            // number, except incremented by 1.\r\n            for (i = 11; i >= 0 && lastRandChars[i] === 63; i--) {\r\n                lastRandChars[i] = 0;\r\n            }\r\n            lastRandChars[i]++;\r\n        }\r\n        for (i = 0; i < 12; i++) {\r\n            id += PUSH_CHARS.charAt(lastRandChars[i]);\r\n        }\r\n        assert(id.length === 20, 'nextPushId: Length should be 20.');\r\n        return id;\r\n    };\r\n})();\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n *\r\n * @param {!string} name\r\n * @param {!Node} node\r\n * @constructor\r\n * @struct\r\n */\r\nvar NamedNode = /** @class */ (function () {\r\n    function NamedNode(name, node) {\r\n        this.name = name;\r\n        this.node = node;\r\n    }\r\n    /**\r\n     *\r\n     * @param {!string} name\r\n     * @param {!Node} node\r\n     * @return {NamedNode}\r\n     */\r\n    NamedNode.Wrap = function (name, node) {\r\n        return new NamedNode(name, node);\r\n    };\r\n    return NamedNode;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n *\r\n * @constructor\r\n */\r\nvar Index = /** @class */ (function () {\r\n    function Index() {\r\n    }\r\n    /**\r\n     * @return {function(!NamedNode, !NamedNode):number} A standalone comparison function for\r\n     * this index\r\n     */\r\n    Index.prototype.getCompare = function () {\r\n        return this.compare.bind(this);\r\n    };\r\n    /**\r\n     * Given a before and after value for a node, determine if the indexed value has changed. Even if they are different,\r\n     * it's possible that the changes are isolated to parts of the snapshot that are not indexed.\r\n     *\r\n     * @param {!Node} oldNode\r\n     * @param {!Node} newNode\r\n     * @return {boolean} True if the portion of the snapshot being indexed changed between oldNode and newNode\r\n     */\r\n    Index.prototype.indexedValueChanged = function (oldNode, newNode) {\r\n        var oldWrapped = new NamedNode(MIN_NAME, oldNode);\r\n        var newWrapped = new NamedNode(MIN_NAME, newNode);\r\n        return this.compare(oldWrapped, newWrapped) !== 0;\r\n    };\r\n    /**\r\n     * @return {!NamedNode} a node wrapper that will sort equal to or less than\r\n     * any other node wrapper, using this index\r\n     */\r\n    Index.prototype.minPost = function () {\r\n        return NamedNode.MIN;\r\n    };\r\n    return Index;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar __EMPTY_NODE;\r\nvar KeyIndex = /** @class */ (function (_super) {\r\n    __extends(KeyIndex, _super);\r\n    function KeyIndex() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    Object.defineProperty(KeyIndex, \"__EMPTY_NODE\", {\r\n        get: function () {\r\n            return __EMPTY_NODE;\r\n        },\r\n        set: function (val) {\r\n            __EMPTY_NODE = val;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    KeyIndex.prototype.compare = function (a, b) {\r\n        return nameCompare(a.name, b.name);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    KeyIndex.prototype.isDefinedOn = function (node) {\r\n        // We could probably return true here (since every node has a key), but it's never called\r\n        // so just leaving unimplemented for now.\r\n        throw assertionError('KeyIndex.isDefinedOn not expected to be called.');\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    KeyIndex.prototype.indexedValueChanged = function (oldNode, newNode) {\r\n        return false; // The key for a node never changes.\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    KeyIndex.prototype.minPost = function () {\r\n        return NamedNode.MIN;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    KeyIndex.prototype.maxPost = function () {\r\n        // TODO: This should really be created once and cached in a static property, but\r\n        // NamedNode isn't defined yet, so I can't use it in a static.  Bleh.\r\n        return new NamedNode(MAX_NAME, __EMPTY_NODE);\r\n    };\r\n    /**\r\n     * @param {*} indexValue\r\n     * @param {string} name\r\n     * @return {!NamedNode}\r\n     */\r\n    KeyIndex.prototype.makePost = function (indexValue, name) {\r\n        assert(typeof indexValue === 'string', 'KeyIndex indexValue must always be a string.');\r\n        // We just use empty node, but it'll never be compared, since our comparator only looks at name.\r\n        return new NamedNode(indexValue, __EMPTY_NODE);\r\n    };\r\n    /**\r\n     * @return {!string} String representation for inclusion in a query spec\r\n     */\r\n    KeyIndex.prototype.toString = function () {\r\n        return '.key';\r\n    };\r\n    return KeyIndex;\r\n}(Index));\r\nvar KEY_INDEX = new KeyIndex();\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar MAX_NODE;\r\nfunction setMaxNode(val) {\r\n    MAX_NODE = val;\r\n}\r\n/**\r\n * @param {(!string|!number)} priority\r\n * @return {!string}\r\n */\r\nvar priorityHashText = function (priority) {\r\n    if (typeof priority === 'number')\r\n        return 'number:' + doubleToIEEE754String(priority);\r\n    else\r\n        return 'string:' + priority;\r\n};\r\n/**\r\n * Validates that a priority snapshot Node is valid.\r\n *\r\n * @param {!Node} priorityNode\r\n */\r\nvar validatePriorityNode = function (priorityNode) {\r\n    if (priorityNode.isLeafNode()) {\r\n        var val = priorityNode.val();\r\n        assert(typeof val === 'string' ||\r\n            typeof val === 'number' ||\r\n            (typeof val === 'object' && contains(val, '.sv')), 'Priority must be a string or number.');\r\n    }\r\n    else {\r\n        assert(priorityNode === MAX_NODE || priorityNode.isEmpty(), 'priority of unexpected type.');\r\n    }\r\n    // Don't call getPriority() on MAX_NODE to avoid hitting assertion.\r\n    assert(priorityNode === MAX_NODE || priorityNode.getPriority().isEmpty(), \"Priority nodes can't have a priority of their own.\");\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar __childrenNodeConstructor;\r\n/**\r\n * LeafNode is a class for storing leaf nodes in a DataSnapshot.  It\r\n * implements Node and stores the value of the node (a string,\r\n * number, or boolean) accessible via getValue().\r\n */\r\nvar LeafNode = /** @class */ (function () {\r\n    /**\r\n     * @implements {Node}\r\n     * @param {!(string|number|boolean|Object)} value_ The value to store in this leaf node.\r\n     *                                         The object type is possible in the event of a deferred value\r\n     * @param {!Node=} priorityNode_ The priority of this node.\r\n     */\r\n    function LeafNode(value_, priorityNode_) {\r\n        if (priorityNode_ === void 0) { priorityNode_ = LeafNode.__childrenNodeConstructor.EMPTY_NODE; }\r\n        this.value_ = value_;\r\n        this.priorityNode_ = priorityNode_;\r\n        this.lazyHash_ = null;\r\n        assert(this.value_ !== undefined && this.value_ !== null, \"LeafNode shouldn't be created with null/undefined value.\");\r\n        validatePriorityNode(this.priorityNode_);\r\n    }\r\n    Object.defineProperty(LeafNode, \"__childrenNodeConstructor\", {\r\n        get: function () {\r\n            return __childrenNodeConstructor;\r\n        },\r\n        set: function (val) {\r\n            __childrenNodeConstructor = val;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.isLeafNode = function () {\r\n        return true;\r\n    };\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.getPriority = function () {\r\n        return this.priorityNode_;\r\n    };\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.updatePriority = function (newPriorityNode) {\r\n        return new LeafNode(this.value_, newPriorityNode);\r\n    };\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.getImmediateChild = function (childName) {\r\n        // Hack to treat priority as a regular child\r\n        if (childName === '.priority') {\r\n            return this.priorityNode_;\r\n        }\r\n        else {\r\n            return LeafNode.__childrenNodeConstructor.EMPTY_NODE;\r\n        }\r\n    };\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.getChild = function (path) {\r\n        if (path.isEmpty()) {\r\n            return this;\r\n        }\r\n        else if (path.getFront() === '.priority') {\r\n            return this.priorityNode_;\r\n        }\r\n        else {\r\n            return LeafNode.__childrenNodeConstructor.EMPTY_NODE;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LeafNode.prototype.hasChild = function () {\r\n        return false;\r\n    };\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.getPredecessorChildName = function (childName, childNode) {\r\n        return null;\r\n    };\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.updateImmediateChild = function (childName, newChildNode) {\r\n        if (childName === '.priority') {\r\n            return this.updatePriority(newChildNode);\r\n        }\r\n        else if (newChildNode.isEmpty() && childName !== '.priority') {\r\n            return this;\r\n        }\r\n        else {\r\n            return LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(childName, newChildNode).updatePriority(this.priorityNode_);\r\n        }\r\n    };\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.updateChild = function (path, newChildNode) {\r\n        var front = path.getFront();\r\n        if (front === null) {\r\n            return newChildNode;\r\n        }\r\n        else if (newChildNode.isEmpty() && front !== '.priority') {\r\n            return this;\r\n        }\r\n        else {\r\n            assert(front !== '.priority' || path.getLength() === 1, '.priority must be the last token in a path');\r\n            return this.updateImmediateChild(front, LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateChild(path.popFront(), newChildNode));\r\n        }\r\n    };\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.isEmpty = function () {\r\n        return false;\r\n    };\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.numChildren = function () {\r\n        return 0;\r\n    };\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.forEachChild = function (index, action) {\r\n        return false;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LeafNode.prototype.val = function (exportFormat) {\r\n        if (exportFormat && !this.getPriority().isEmpty())\r\n            return {\r\n                '.value': this.getValue(),\r\n                '.priority': this.getPriority().val()\r\n            };\r\n        else\r\n            return this.getValue();\r\n    };\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.hash = function () {\r\n        if (this.lazyHash_ === null) {\r\n            var toHash = '';\r\n            if (!this.priorityNode_.isEmpty())\r\n                toHash +=\r\n                    'priority:' +\r\n                        priorityHashText(this.priorityNode_.val()) +\r\n                        ':';\r\n            var type = typeof this.value_;\r\n            toHash += type + ':';\r\n            if (type === 'number') {\r\n                toHash += doubleToIEEE754String(this.value_);\r\n            }\r\n            else {\r\n                toHash += this.value_;\r\n            }\r\n            this.lazyHash_ = sha1(toHash);\r\n        }\r\n        return this.lazyHash_;\r\n    };\r\n    /**\r\n     * Returns the value of the leaf node.\r\n     * @return {Object|string|number|boolean} The value of the node.\r\n     */\r\n    LeafNode.prototype.getValue = function () {\r\n        return this.value_;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LeafNode.prototype.compareTo = function (other) {\r\n        if (other === LeafNode.__childrenNodeConstructor.EMPTY_NODE) {\r\n            return 1;\r\n        }\r\n        else if (other instanceof LeafNode.__childrenNodeConstructor) {\r\n            return -1;\r\n        }\r\n        else {\r\n            assert(other.isLeafNode(), 'Unknown node type');\r\n            return this.compareToLeafNode_(other);\r\n        }\r\n    };\r\n    /**\r\n     * Comparison specifically for two leaf nodes\r\n     * @param {!LeafNode} otherLeaf\r\n     * @return {!number}\r\n     * @private\r\n     */\r\n    LeafNode.prototype.compareToLeafNode_ = function (otherLeaf) {\r\n        var otherLeafType = typeof otherLeaf.value_;\r\n        var thisLeafType = typeof this.value_;\r\n        var otherIndex = LeafNode.VALUE_TYPE_ORDER.indexOf(otherLeafType);\r\n        var thisIndex = LeafNode.VALUE_TYPE_ORDER.indexOf(thisLeafType);\r\n        assert(otherIndex >= 0, 'Unknown leaf type: ' + otherLeafType);\r\n        assert(thisIndex >= 0, 'Unknown leaf type: ' + thisLeafType);\r\n        if (otherIndex === thisIndex) {\r\n            // Same type, compare values\r\n            if (thisLeafType === 'object') {\r\n                // Deferred value nodes are all equal, but we should also never get to this point...\r\n                return 0;\r\n            }\r\n            else {\r\n                // Note that this works because true > false, all others are number or string comparisons\r\n                if (this.value_ < otherLeaf.value_) {\r\n                    return -1;\r\n                }\r\n                else if (this.value_ === otherLeaf.value_) {\r\n                    return 0;\r\n                }\r\n                else {\r\n                    return 1;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            return thisIndex - otherIndex;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LeafNode.prototype.withIndex = function () {\r\n        return this;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LeafNode.prototype.isIndexed = function () {\r\n        return true;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LeafNode.prototype.equals = function (other) {\r\n        /**\r\n         * @inheritDoc\r\n         */\r\n        if (other === this) {\r\n            return true;\r\n        }\r\n        else if (other.isLeafNode()) {\r\n            var otherLeaf = other;\r\n            return (this.value_ === otherLeaf.value_ &&\r\n                this.priorityNode_.equals(otherLeaf.priorityNode_));\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    };\r\n    /**\r\n     * The sort order for comparing leaf nodes of different types. If two leaf nodes have\r\n     * the same type, the comparison falls back to their value\r\n     * @type {Array.<!string>}\r\n     * @const\r\n     */\r\n    LeafNode.VALUE_TYPE_ORDER = ['object', 'boolean', 'number', 'string'];\r\n    return LeafNode;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar nodeFromJSON;\r\nvar MAX_NODE$1;\r\nfunction setNodeFromJSON(val) {\r\n    nodeFromJSON = val;\r\n}\r\nfunction setMaxNode$1(val) {\r\n    MAX_NODE$1 = val;\r\n}\r\n/**\r\n * @constructor\r\n * @extends {Index}\r\n * @private\r\n */\r\nvar PriorityIndex = /** @class */ (function (_super) {\r\n    __extends(PriorityIndex, _super);\r\n    function PriorityIndex() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PriorityIndex.prototype.compare = function (a, b) {\r\n        var aPriority = a.node.getPriority();\r\n        var bPriority = b.node.getPriority();\r\n        var indexCmp = aPriority.compareTo(bPriority);\r\n        if (indexCmp === 0) {\r\n            return nameCompare(a.name, b.name);\r\n        }\r\n        else {\r\n            return indexCmp;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PriorityIndex.prototype.isDefinedOn = function (node) {\r\n        return !node.getPriority().isEmpty();\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PriorityIndex.prototype.indexedValueChanged = function (oldNode, newNode) {\r\n        return !oldNode.getPriority().equals(newNode.getPriority());\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PriorityIndex.prototype.minPost = function () {\r\n        return NamedNode.MIN;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PriorityIndex.prototype.maxPost = function () {\r\n        return new NamedNode(MAX_NAME, new LeafNode('[PRIORITY-POST]', MAX_NODE$1));\r\n    };\r\n    /**\r\n     * @param {*} indexValue\r\n     * @param {string} name\r\n     * @return {!NamedNode}\r\n     */\r\n    PriorityIndex.prototype.makePost = function (indexValue, name) {\r\n        var priorityNode = nodeFromJSON(indexValue);\r\n        return new NamedNode(name, new LeafNode('[PRIORITY-POST]', priorityNode));\r\n    };\r\n    /**\r\n     * @return {!string} String representation for inclusion in a query spec\r\n     */\r\n    PriorityIndex.prototype.toString = function () {\r\n        return '.priority';\r\n    };\r\n    return PriorityIndex;\r\n}(Index));\r\nvar PRIORITY_INDEX = new PriorityIndex();\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * An iterator over an LLRBNode.\r\n */\r\nvar SortedMapIterator = /** @class */ (function () {\r\n    /**\r\n     * @template K, V, T\r\n     * @param {LLRBNode|LLRBEmptyNode} node Node to iterate.\r\n     * @param {?K} startKey\r\n     * @param {function(K, K): number} comparator\r\n     * @param {boolean} isReverse_ Whether or not to iterate in reverse\r\n     * @param {(function(K, V):T)=} resultGenerator_\r\n     */\r\n    function SortedMapIterator(node, startKey, comparator, isReverse_, resultGenerator_) {\r\n        if (resultGenerator_ === void 0) { resultGenerator_ = null; }\r\n        this.isReverse_ = isReverse_;\r\n        this.resultGenerator_ = resultGenerator_;\r\n        /** @private\r\n         * @type {Array.<!LLRBNode>}\r\n         */\r\n        this.nodeStack_ = [];\r\n        var cmp = 1;\r\n        while (!node.isEmpty()) {\r\n            node = node;\r\n            cmp = startKey ? comparator(node.key, startKey) : 1;\r\n            // flip the comparison if we're going in reverse\r\n            if (isReverse_)\r\n                cmp *= -1;\r\n            if (cmp < 0) {\r\n                // This node is less than our start key. ignore it\r\n                if (this.isReverse_) {\r\n                    node = node.left;\r\n                }\r\n                else {\r\n                    node = node.right;\r\n                }\r\n            }\r\n            else if (cmp === 0) {\r\n                // This node is exactly equal to our start key. Push it on the stack, but stop iterating;\r\n                this.nodeStack_.push(node);\r\n                break;\r\n            }\r\n            else {\r\n                // This node is greater than our start key, add it to the stack and move to the next one\r\n                this.nodeStack_.push(node);\r\n                if (this.isReverse_) {\r\n                    node = node.right;\r\n                }\r\n                else {\r\n                    node = node.left;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    SortedMapIterator.prototype.getNext = function () {\r\n        if (this.nodeStack_.length === 0)\r\n            return null;\r\n        var node = this.nodeStack_.pop();\r\n        var result;\r\n        if (this.resultGenerator_)\r\n            result = this.resultGenerator_(node.key, node.value);\r\n        else\r\n            result = { key: node.key, value: node.value };\r\n        if (this.isReverse_) {\r\n            node = node.left;\r\n            while (!node.isEmpty()) {\r\n                this.nodeStack_.push(node);\r\n                node = node.right;\r\n            }\r\n        }\r\n        else {\r\n            node = node.right;\r\n            while (!node.isEmpty()) {\r\n                this.nodeStack_.push(node);\r\n                node = node.left;\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n    SortedMapIterator.prototype.hasNext = function () {\r\n        return this.nodeStack_.length > 0;\r\n    };\r\n    SortedMapIterator.prototype.peek = function () {\r\n        if (this.nodeStack_.length === 0)\r\n            return null;\r\n        var node = this.nodeStack_[this.nodeStack_.length - 1];\r\n        if (this.resultGenerator_) {\r\n            return this.resultGenerator_(node.key, node.value);\r\n        }\r\n        else {\r\n            return { key: node.key, value: node.value };\r\n        }\r\n    };\r\n    return SortedMapIterator;\r\n}());\r\n/**\r\n * Represents a node in a Left-leaning Red-Black tree.\r\n */\r\nvar LLRBNode = /** @class */ (function () {\r\n    /**\r\n     * @template K, V\r\n     * @param {!K} key Key associated with this node.\r\n     * @param {!V} value Value associated with this node.\r\n     * @param {?boolean} color Whether this node is red.\r\n     * @param {?(LLRBNode|LLRBEmptyNode)=} left Left child.\r\n     * @param {?(LLRBNode|LLRBEmptyNode)=} right Right child.\r\n     */\r\n    function LLRBNode(key, value, color, left, right) {\r\n        this.key = key;\r\n        this.value = value;\r\n        this.color = color != null ? color : LLRBNode.RED;\r\n        this.left =\r\n            left != null ? left : SortedMap.EMPTY_NODE;\r\n        this.right =\r\n            right != null ? right : SortedMap.EMPTY_NODE;\r\n    }\r\n    /**\r\n     * Returns a copy of the current node, optionally replacing pieces of it.\r\n     *\r\n     * @param {?K} key New key for the node, or null.\r\n     * @param {?V} value New value for the node, or null.\r\n     * @param {?boolean} color New color for the node, or null.\r\n     * @param {?LLRBNode|LLRBEmptyNode} left New left child for the node, or null.\r\n     * @param {?LLRBNode|LLRBEmptyNode} right New right child for the node, or null.\r\n     * @return {!LLRBNode} The node copy.\r\n     */\r\n    LLRBNode.prototype.copy = function (key, value, color, left, right) {\r\n        return new LLRBNode(key != null ? key : this.key, value != null ? value : this.value, color != null ? color : this.color, left != null ? left : this.left, right != null ? right : this.right);\r\n    };\r\n    /**\r\n     * @return {number} The total number of nodes in the tree.\r\n     */\r\n    LLRBNode.prototype.count = function () {\r\n        return this.left.count() + 1 + this.right.count();\r\n    };\r\n    /**\r\n     * @return {boolean} True if the tree is empty.\r\n     */\r\n    LLRBNode.prototype.isEmpty = function () {\r\n        return false;\r\n    };\r\n    /**\r\n     * Traverses the tree in key order and calls the specified action function\r\n     * for each node.\r\n     *\r\n     * @param {function(!K, !V):*} action Callback function to be called for each\r\n     *   node.  If it returns true, traversal is aborted.\r\n     * @return {*} The first truthy value returned by action, or the last falsey\r\n     *   value returned by action\r\n     */\r\n    LLRBNode.prototype.inorderTraversal = function (action) {\r\n        return (this.left.inorderTraversal(action) ||\r\n            action(this.key, this.value) ||\r\n            this.right.inorderTraversal(action));\r\n    };\r\n    /**\r\n     * Traverses the tree in reverse key order and calls the specified action function\r\n     * for each node.\r\n     *\r\n     * @param {function(!Object, !Object)} action Callback function to be called for each\r\n     * node.  If it returns true, traversal is aborted.\r\n     * @return {*} True if traversal was aborted.\r\n     */\r\n    LLRBNode.prototype.reverseTraversal = function (action) {\r\n        return (this.right.reverseTraversal(action) ||\r\n            action(this.key, this.value) ||\r\n            this.left.reverseTraversal(action));\r\n    };\r\n    /**\r\n     * @return {!Object} The minimum node in the tree.\r\n     * @private\r\n     */\r\n    LLRBNode.prototype.min_ = function () {\r\n        if (this.left.isEmpty()) {\r\n            return this;\r\n        }\r\n        else {\r\n            return this.left.min_();\r\n        }\r\n    };\r\n    /**\r\n     * @return {!K} The maximum key in the tree.\r\n     */\r\n    LLRBNode.prototype.minKey = function () {\r\n        return this.min_().key;\r\n    };\r\n    /**\r\n     * @return {!K} The maximum key in the tree.\r\n     */\r\n    LLRBNode.prototype.maxKey = function () {\r\n        if (this.right.isEmpty()) {\r\n            return this.key;\r\n        }\r\n        else {\r\n            return this.right.maxKey();\r\n        }\r\n    };\r\n    /**\r\n     *\r\n     * @param {!Object} key Key to insert.\r\n     * @param {!Object} value Value to insert.\r\n     * @param {Comparator} comparator Comparator.\r\n     * @return {!LLRBNode} New tree, with the key/value added.\r\n     */\r\n    LLRBNode.prototype.insert = function (key, value, comparator) {\r\n        var cmp, n;\r\n        n = this;\r\n        cmp = comparator(key, n.key);\r\n        if (cmp < 0) {\r\n            n = n.copy(null, null, null, n.left.insert(key, value, comparator), null);\r\n        }\r\n        else if (cmp === 0) {\r\n            n = n.copy(null, value, null, null, null);\r\n        }\r\n        else {\r\n            n = n.copy(null, null, null, null, n.right.insert(key, value, comparator));\r\n        }\r\n        return n.fixUp_();\r\n    };\r\n    /**\r\n     * @private\r\n     * @return {!LLRBNode|LLRBEmptyNode} New tree, with the minimum key removed.\r\n     */\r\n    LLRBNode.prototype.removeMin_ = function () {\r\n        if (this.left.isEmpty()) {\r\n            return SortedMap.EMPTY_NODE;\r\n        }\r\n        var n = this;\r\n        if (!n.left.isRed_() && !n.left.left.isRed_())\r\n            n = n.moveRedLeft_();\r\n        n = n.copy(null, null, null, n.left.removeMin_(), null);\r\n        return n.fixUp_();\r\n    };\r\n    /**\r\n     * @param {!Object} key The key of the item to remove.\r\n     * @param {Comparator} comparator Comparator.\r\n     * @return {!LLRBNode|LLRBEmptyNode} New tree, with the specified item removed.\r\n     */\r\n    LLRBNode.prototype.remove = function (key, comparator) {\r\n        var n, smallest;\r\n        n = this;\r\n        if (comparator(key, n.key) < 0) {\r\n            if (!n.left.isEmpty() && !n.left.isRed_() && !n.left.left.isRed_()) {\r\n                n = n.moveRedLeft_();\r\n            }\r\n            n = n.copy(null, null, null, n.left.remove(key, comparator), null);\r\n        }\r\n        else {\r\n            if (n.left.isRed_())\r\n                n = n.rotateRight_();\r\n            if (!n.right.isEmpty() && !n.right.isRed_() && !n.right.left.isRed_()) {\r\n                n = n.moveRedRight_();\r\n            }\r\n            if (comparator(key, n.key) === 0) {\r\n                if (n.right.isEmpty()) {\r\n                    return SortedMap.EMPTY_NODE;\r\n                }\r\n                else {\r\n                    smallest = n.right.min_();\r\n                    n = n.copy(smallest.key, smallest.value, null, null, n.right.removeMin_());\r\n                }\r\n            }\r\n            n = n.copy(null, null, null, null, n.right.remove(key, comparator));\r\n        }\r\n        return n.fixUp_();\r\n    };\r\n    /**\r\n     * @private\r\n     * @return {boolean} Whether this is a RED node.\r\n     */\r\n    LLRBNode.prototype.isRed_ = function () {\r\n        return this.color;\r\n    };\r\n    /**\r\n     * @private\r\n     * @return {!LLRBNode} New tree after performing any needed rotations.\r\n     */\r\n    LLRBNode.prototype.fixUp_ = function () {\r\n        var n = this;\r\n        if (n.right.isRed_() && !n.left.isRed_())\r\n            n = n.rotateLeft_();\r\n        if (n.left.isRed_() && n.left.left.isRed_())\r\n            n = n.rotateRight_();\r\n        if (n.left.isRed_() && n.right.isRed_())\r\n            n = n.colorFlip_();\r\n        return n;\r\n    };\r\n    /**\r\n     * @private\r\n     * @return {!LLRBNode} New tree, after moveRedLeft.\r\n     */\r\n    LLRBNode.prototype.moveRedLeft_ = function () {\r\n        var n = this.colorFlip_();\r\n        if (n.right.left.isRed_()) {\r\n            n = n.copy(null, null, null, null, n.right.rotateRight_());\r\n            n = n.rotateLeft_();\r\n            n = n.colorFlip_();\r\n        }\r\n        return n;\r\n    };\r\n    /**\r\n     * @private\r\n     * @return {!LLRBNode} New tree, after moveRedRight.\r\n     */\r\n    LLRBNode.prototype.moveRedRight_ = function () {\r\n        var n = this.colorFlip_();\r\n        if (n.left.left.isRed_()) {\r\n            n = n.rotateRight_();\r\n            n = n.colorFlip_();\r\n        }\r\n        return n;\r\n    };\r\n    /**\r\n     * @private\r\n     * @return {!LLRBNode} New tree, after rotateLeft.\r\n     */\r\n    LLRBNode.prototype.rotateLeft_ = function () {\r\n        var nl = this.copy(null, null, LLRBNode.RED, null, this.right.left);\r\n        return this.right.copy(null, null, this.color, nl, null);\r\n    };\r\n    /**\r\n     * @private\r\n     * @return {!LLRBNode} New tree, after rotateRight.\r\n     */\r\n    LLRBNode.prototype.rotateRight_ = function () {\r\n        var nr = this.copy(null, null, LLRBNode.RED, this.left.right, null);\r\n        return this.left.copy(null, null, this.color, null, nr);\r\n    };\r\n    /**\r\n     * @private\r\n     * @return {!LLRBNode} New tree, after colorFlip.\r\n     */\r\n    LLRBNode.prototype.colorFlip_ = function () {\r\n        var left = this.left.copy(null, null, !this.left.color, null, null);\r\n        var right = this.right.copy(null, null, !this.right.color, null, null);\r\n        return this.copy(null, null, !this.color, left, right);\r\n    };\r\n    /**\r\n     * For testing.\r\n     *\r\n     * @private\r\n     * @return {boolean} True if all is well.\r\n     */\r\n    LLRBNode.prototype.checkMaxDepth_ = function () {\r\n        var blackDepth = this.check_();\r\n        return Math.pow(2.0, blackDepth) <= this.count() + 1;\r\n    };\r\n    /**\r\n     * @private\r\n     * @return {number} Not sure what this returns exactly. :-).\r\n     */\r\n    LLRBNode.prototype.check_ = function () {\r\n        var blackDepth;\r\n        if (this.isRed_() && this.left.isRed_()) {\r\n            throw new Error('Red node has red child(' + this.key + ',' + this.value + ')');\r\n        }\r\n        if (this.right.isRed_()) {\r\n            throw new Error('Right child of (' + this.key + ',' + this.value + ') is red');\r\n        }\r\n        blackDepth = this.left.check_();\r\n        if (blackDepth !== this.right.check_()) {\r\n            throw new Error('Black depths differ');\r\n        }\r\n        else {\r\n            return blackDepth + (this.isRed_() ? 0 : 1);\r\n        }\r\n    };\r\n    LLRBNode.RED = true;\r\n    LLRBNode.BLACK = false;\r\n    return LLRBNode;\r\n}());\r\n/**\r\n * Represents an empty node (a leaf node in the Red-Black Tree).\r\n */\r\nvar LLRBEmptyNode = /** @class */ (function () {\r\n    function LLRBEmptyNode() {\r\n    }\r\n    /**\r\n     * Returns a copy of the current node.\r\n     *\r\n     * @return {!LLRBEmptyNode} The node copy.\r\n     */\r\n    LLRBEmptyNode.prototype.copy = function (key, value, color, left, right) {\r\n        return this;\r\n    };\r\n    /**\r\n     * Returns a copy of the tree, with the specified key/value added.\r\n     *\r\n     * @param {!K} key Key to be added.\r\n     * @param {!V} value Value to be added.\r\n     * @param {Comparator} comparator Comparator.\r\n     * @return {!LLRBNode} New tree, with item added.\r\n     */\r\n    LLRBEmptyNode.prototype.insert = function (key, value, comparator) {\r\n        return new LLRBNode(key, value, null);\r\n    };\r\n    /**\r\n     * Returns a copy of the tree, with the specified key removed.\r\n     *\r\n     * @param {!K} key The key to remove.\r\n     * @param {Comparator} comparator Comparator.\r\n     * @return {!LLRBEmptyNode} New tree, with item removed.\r\n     */\r\n    LLRBEmptyNode.prototype.remove = function (key, comparator) {\r\n        return this;\r\n    };\r\n    /**\r\n     * @return {number} The total number of nodes in the tree.\r\n     */\r\n    LLRBEmptyNode.prototype.count = function () {\r\n        return 0;\r\n    };\r\n    /**\r\n     * @return {boolean} True if the tree is empty.\r\n     */\r\n    LLRBEmptyNode.prototype.isEmpty = function () {\r\n        return true;\r\n    };\r\n    /**\r\n     * Traverses the tree in key order and calls the specified action function\r\n     * for each node.\r\n     *\r\n     * @param {function(!K, !V):*} action Callback function to be called for each\r\n     * node.  If it returns true, traversal is aborted.\r\n     * @return {boolean} True if traversal was aborted.\r\n     */\r\n    LLRBEmptyNode.prototype.inorderTraversal = function (action) {\r\n        return false;\r\n    };\r\n    /**\r\n     * Traverses the tree in reverse key order and calls the specified action function\r\n     * for each node.\r\n     *\r\n     * @param {function(!K, !V)} action Callback function to be called for each\r\n     * node.  If it returns true, traversal is aborted.\r\n     * @return {boolean} True if traversal was aborted.\r\n     */\r\n    LLRBEmptyNode.prototype.reverseTraversal = function (action) {\r\n        return false;\r\n    };\r\n    /**\r\n     * @return {null}\r\n     */\r\n    LLRBEmptyNode.prototype.minKey = function () {\r\n        return null;\r\n    };\r\n    /**\r\n     * @return {null}\r\n     */\r\n    LLRBEmptyNode.prototype.maxKey = function () {\r\n        return null;\r\n    };\r\n    /**\r\n     * @private\r\n     * @return {number} Not sure what this returns exactly. :-).\r\n     */\r\n    LLRBEmptyNode.prototype.check_ = function () {\r\n        return 0;\r\n    };\r\n    /**\r\n     * @private\r\n     * @return {boolean} Whether this node is red.\r\n     */\r\n    LLRBEmptyNode.prototype.isRed_ = function () {\r\n        return false;\r\n    };\r\n    return LLRBEmptyNode;\r\n}());\r\n/**\r\n * An immutable sorted map implementation, based on a Left-leaning Red-Black\r\n * tree.\r\n */\r\nvar SortedMap = /** @class */ (function () {\r\n    /**\r\n     * @template K, V\r\n     * @param {function(K, K):number} comparator_ Key comparator.\r\n     * @param {LLRBNode=} root_ (Optional) Root node for the map.\r\n     */\r\n    function SortedMap(comparator_, root_) {\r\n        if (root_ === void 0) { root_ = SortedMap.EMPTY_NODE; }\r\n        this.comparator_ = comparator_;\r\n        this.root_ = root_;\r\n    }\r\n    /**\r\n     * Returns a copy of the map, with the specified key/value added or replaced.\r\n     * (TODO: We should perhaps rename this method to 'put')\r\n     *\r\n     * @param {!K} key Key to be added.\r\n     * @param {!V} value Value to be added.\r\n     * @return {!SortedMap.<K, V>} New map, with item added.\r\n     */\r\n    SortedMap.prototype.insert = function (key, value) {\r\n        return new SortedMap(this.comparator_, this.root_\r\n            .insert(key, value, this.comparator_)\r\n            .copy(null, null, LLRBNode.BLACK, null, null));\r\n    };\r\n    /**\r\n     * Returns a copy of the map, with the specified key removed.\r\n     *\r\n     * @param {!K} key The key to remove.\r\n     * @return {!SortedMap.<K, V>} New map, with item removed.\r\n     */\r\n    SortedMap.prototype.remove = function (key) {\r\n        return new SortedMap(this.comparator_, this.root_\r\n            .remove(key, this.comparator_)\r\n            .copy(null, null, LLRBNode.BLACK, null, null));\r\n    };\r\n    /**\r\n     * Returns the value of the node with the given key, or null.\r\n     *\r\n     * @param {!K} key The key to look up.\r\n     * @return {?V} The value of the node with the given key, or null if the\r\n     * key doesn't exist.\r\n     */\r\n    SortedMap.prototype.get = function (key) {\r\n        var cmp;\r\n        var node = this.root_;\r\n        while (!node.isEmpty()) {\r\n            cmp = this.comparator_(key, node.key);\r\n            if (cmp === 0) {\r\n                return node.value;\r\n            }\r\n            else if (cmp < 0) {\r\n                node = node.left;\r\n            }\r\n            else if (cmp > 0) {\r\n                node = node.right;\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    /**\r\n     * Returns the key of the item *before* the specified key, or null if key is the first item.\r\n     * @param {K} key The key to find the predecessor of\r\n     * @return {?K} The predecessor key.\r\n     */\r\n    SortedMap.prototype.getPredecessorKey = function (key) {\r\n        var cmp, node = this.root_, rightParent = null;\r\n        while (!node.isEmpty()) {\r\n            cmp = this.comparator_(key, node.key);\r\n            if (cmp === 0) {\r\n                if (!node.left.isEmpty()) {\r\n                    node = node.left;\r\n                    while (!node.right.isEmpty())\r\n                        node = node.right;\r\n                    return node.key;\r\n                }\r\n                else if (rightParent) {\r\n                    return rightParent.key;\r\n                }\r\n                else {\r\n                    return null; // first item.\r\n                }\r\n            }\r\n            else if (cmp < 0) {\r\n                node = node.left;\r\n            }\r\n            else if (cmp > 0) {\r\n                rightParent = node;\r\n                node = node.right;\r\n            }\r\n        }\r\n        throw new Error('Attempted to find predecessor key for a nonexistent key.  What gives?');\r\n    };\r\n    /**\r\n     * @return {boolean} True if the map is empty.\r\n     */\r\n    SortedMap.prototype.isEmpty = function () {\r\n        return this.root_.isEmpty();\r\n    };\r\n    /**\r\n     * @return {number} The total number of nodes in the map.\r\n     */\r\n    SortedMap.prototype.count = function () {\r\n        return this.root_.count();\r\n    };\r\n    /**\r\n     * @return {?K} The minimum key in the map.\r\n     */\r\n    SortedMap.prototype.minKey = function () {\r\n        return this.root_.minKey();\r\n    };\r\n    /**\r\n     * @return {?K} The maximum key in the map.\r\n     */\r\n    SortedMap.prototype.maxKey = function () {\r\n        return this.root_.maxKey();\r\n    };\r\n    /**\r\n     * Traverses the map in key order and calls the specified action function\r\n     * for each key/value pair.\r\n     *\r\n     * @param {function(!K, !V):*} action Callback function to be called\r\n     * for each key/value pair.  If action returns true, traversal is aborted.\r\n     * @return {*} The first truthy value returned by action, or the last falsey\r\n     *   value returned by action\r\n     */\r\n    SortedMap.prototype.inorderTraversal = function (action) {\r\n        return this.root_.inorderTraversal(action);\r\n    };\r\n    /**\r\n     * Traverses the map in reverse key order and calls the specified action function\r\n     * for each key/value pair.\r\n     *\r\n     * @param {function(!Object, !Object)} action Callback function to be called\r\n     * for each key/value pair.  If action returns true, traversal is aborted.\r\n     * @return {*} True if the traversal was aborted.\r\n     */\r\n    SortedMap.prototype.reverseTraversal = function (action) {\r\n        return this.root_.reverseTraversal(action);\r\n    };\r\n    /**\r\n     * Returns an iterator over the SortedMap.\r\n     * @template T\r\n     * @param {(function(K, V):T)=} resultGenerator\r\n     * @return {SortedMapIterator.<K, V, T>} The iterator.\r\n     */\r\n    SortedMap.prototype.getIterator = function (resultGenerator) {\r\n        return new SortedMapIterator(this.root_, null, this.comparator_, false, resultGenerator);\r\n    };\r\n    SortedMap.prototype.getIteratorFrom = function (key, resultGenerator) {\r\n        return new SortedMapIterator(this.root_, key, this.comparator_, false, resultGenerator);\r\n    };\r\n    SortedMap.prototype.getReverseIteratorFrom = function (key, resultGenerator) {\r\n        return new SortedMapIterator(this.root_, key, this.comparator_, true, resultGenerator);\r\n    };\r\n    SortedMap.prototype.getReverseIterator = function (resultGenerator) {\r\n        return new SortedMapIterator(this.root_, null, this.comparator_, true, resultGenerator);\r\n    };\r\n    /**\r\n     * Always use the same empty node, to reduce memory.\r\n     * @const\r\n     */\r\n    SortedMap.EMPTY_NODE = new LLRBEmptyNode();\r\n    return SortedMap;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar LOG_2 = Math.log(2);\r\n/**\r\n * @constructor\r\n */\r\nvar Base12Num = /** @class */ (function () {\r\n    /**\r\n     * @param {number} length\r\n     */\r\n    function Base12Num(length) {\r\n        var logBase2 = function (num) {\r\n            return parseInt((Math.log(num) / LOG_2), 10);\r\n        };\r\n        var bitMask = function (bits) { return parseInt(Array(bits + 1).join('1'), 2); };\r\n        this.count = logBase2(length + 1);\r\n        this.current_ = this.count - 1;\r\n        var mask = bitMask(this.count);\r\n        this.bits_ = (length + 1) & mask;\r\n    }\r\n    /**\r\n     * @return {boolean}\r\n     */\r\n    Base12Num.prototype.nextBitIsOne = function () {\r\n        //noinspection JSBitwiseOperatorUsage\r\n        var result = !(this.bits_ & (0x1 << this.current_));\r\n        this.current_--;\r\n        return result;\r\n    };\r\n    return Base12Num;\r\n}());\r\n/**\r\n * Takes a list of child nodes and constructs a SortedSet using the given comparison\r\n * function\r\n *\r\n * Uses the algorithm described in the paper linked here:\r\n * http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.46.1458\r\n *\r\n * @template K, V\r\n * @param {Array.<!NamedNode>} childList Unsorted list of children\r\n * @param {function(!NamedNode, !NamedNode):number} cmp The comparison method to be used\r\n * @param {(function(NamedNode):K)=} keyFn An optional function to extract K from a node wrapper, if K's\r\n *                                                        type is not NamedNode\r\n * @param {(function(K, K):number)=} mapSortFn An optional override for comparator used by the generated sorted map\r\n * @return {SortedMap.<K, V>}\r\n */\r\nvar buildChildSet = function (childList, cmp, keyFn, mapSortFn) {\r\n    childList.sort(cmp);\r\n    var buildBalancedTree = function (low, high) {\r\n        var length = high - low;\r\n        var namedNode;\r\n        var key;\r\n        if (length == 0) {\r\n            return null;\r\n        }\r\n        else if (length == 1) {\r\n            namedNode = childList[low];\r\n            key = keyFn ? keyFn(namedNode) : namedNode;\r\n            return new LLRBNode(key, namedNode.node, LLRBNode.BLACK, null, null);\r\n        }\r\n        else {\r\n            var middle = parseInt((length / 2), 10) + low;\r\n            var left = buildBalancedTree(low, middle);\r\n            var right = buildBalancedTree(middle + 1, high);\r\n            namedNode = childList[middle];\r\n            key = keyFn ? keyFn(namedNode) : namedNode;\r\n            return new LLRBNode(key, namedNode.node, LLRBNode.BLACK, left, right);\r\n        }\r\n    };\r\n    var buildFrom12Array = function (base12) {\r\n        var node = null;\r\n        var root = null;\r\n        var index = childList.length;\r\n        var buildPennant = function (chunkSize, color) {\r\n            var low = index - chunkSize;\r\n            var high = index;\r\n            index -= chunkSize;\r\n            var childTree = buildBalancedTree(low + 1, high);\r\n            var namedNode = childList[low];\r\n            var key = keyFn ? keyFn(namedNode) : namedNode;\r\n            attachPennant(new LLRBNode(key, namedNode.node, color, null, childTree));\r\n        };\r\n        var attachPennant = function (pennant) {\r\n            if (node) {\r\n                node.left = pennant;\r\n                node = pennant;\r\n            }\r\n            else {\r\n                root = pennant;\r\n                node = pennant;\r\n            }\r\n        };\r\n        for (var i = 0; i < base12.count; ++i) {\r\n            var isOne = base12.nextBitIsOne();\r\n            // The number of nodes taken in each slice is 2^(arr.length - (i + 1))\r\n            var chunkSize = Math.pow(2, base12.count - (i + 1));\r\n            if (isOne) {\r\n                buildPennant(chunkSize, LLRBNode.BLACK);\r\n            }\r\n            else {\r\n                // current == 2\r\n                buildPennant(chunkSize, LLRBNode.BLACK);\r\n                buildPennant(chunkSize, LLRBNode.RED);\r\n            }\r\n        }\r\n        return root;\r\n    };\r\n    var base12 = new Base12Num(childList.length);\r\n    var root = buildFrom12Array(base12);\r\n    return new SortedMap(mapSortFn || cmp, root);\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _defaultIndexMap;\r\nvar fallbackObject = {};\r\n/**\r\n *\r\n * @param {Object.<string, FallbackType|SortedMap.<NamedNode, Node>>} indexes\r\n * @param {Object.<string, Index>} indexSet\r\n * @constructor\r\n */\r\nvar IndexMap = /** @class */ (function () {\r\n    function IndexMap(indexes_, indexSet_) {\r\n        this.indexes_ = indexes_;\r\n        this.indexSet_ = indexSet_;\r\n    }\r\n    Object.defineProperty(IndexMap, \"Default\", {\r\n        /**\r\n         * The default IndexMap for nodes without a priority\r\n         * @type {!IndexMap}\r\n         * @const\r\n         */\r\n        get: function () {\r\n            assert(fallbackObject && PRIORITY_INDEX, 'ChildrenNode.ts has not been loaded');\r\n            _defaultIndexMap =\r\n                _defaultIndexMap ||\r\n                    new IndexMap({ '.priority': fallbackObject }, { '.priority': PRIORITY_INDEX });\r\n            return _defaultIndexMap;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     *\r\n     * @param {!string} indexKey\r\n     * @return {?SortedMap.<NamedNode, Node>}\r\n     */\r\n    IndexMap.prototype.get = function (indexKey) {\r\n        var sortedMap = safeGet(this.indexes_, indexKey);\r\n        if (!sortedMap)\r\n            throw new Error('No index defined for ' + indexKey);\r\n        if (sortedMap === fallbackObject) {\r\n            // The index exists, but it falls back to just name comparison. Return null so that the calling code uses the\r\n            // regular child map\r\n            return null;\r\n        }\r\n        else {\r\n            return sortedMap;\r\n        }\r\n    };\r\n    /**\r\n     * @param {!Index} indexDefinition\r\n     * @return {boolean}\r\n     */\r\n    IndexMap.prototype.hasIndex = function (indexDefinition) {\r\n        return contains(this.indexSet_, indexDefinition.toString());\r\n    };\r\n    /**\r\n     * @param {!Index} indexDefinition\r\n     * @param {!SortedMap.<string, !Node>} existingChildren\r\n     * @return {!IndexMap}\r\n     */\r\n    IndexMap.prototype.addIndex = function (indexDefinition, existingChildren) {\r\n        assert(indexDefinition !== KEY_INDEX, \"KeyIndex always exists and isn't meant to be added to the IndexMap.\");\r\n        var childList = [];\r\n        var sawIndexedValue = false;\r\n        var iter = existingChildren.getIterator(NamedNode.Wrap);\r\n        var next = iter.getNext();\r\n        while (next) {\r\n            sawIndexedValue =\r\n                sawIndexedValue || indexDefinition.isDefinedOn(next.node);\r\n            childList.push(next);\r\n            next = iter.getNext();\r\n        }\r\n        var newIndex;\r\n        if (sawIndexedValue) {\r\n            newIndex = buildChildSet(childList, indexDefinition.getCompare());\r\n        }\r\n        else {\r\n            newIndex = fallbackObject;\r\n        }\r\n        var indexName = indexDefinition.toString();\r\n        var newIndexSet = clone(this.indexSet_);\r\n        newIndexSet[indexName] = indexDefinition;\r\n        var newIndexes = clone(this.indexes_);\r\n        newIndexes[indexName] = newIndex;\r\n        return new IndexMap(newIndexes, newIndexSet);\r\n    };\r\n    /**\r\n     * Ensure that this node is properly tracked in any indexes that we're maintaining\r\n     * @param {!NamedNode} namedNode\r\n     * @param {!SortedMap.<string, !Node>} existingChildren\r\n     * @return {!IndexMap}\r\n     */\r\n    IndexMap.prototype.addToIndexes = function (namedNode, existingChildren) {\r\n        var _this = this;\r\n        var newIndexes = map(this.indexes_, function (indexedChildren, indexName) {\r\n            var index = safeGet(_this.indexSet_, indexName);\r\n            assert(index, 'Missing index implementation for ' + indexName);\r\n            if (indexedChildren === fallbackObject) {\r\n                // Check to see if we need to index everything\r\n                if (index.isDefinedOn(namedNode.node)) {\r\n                    // We need to build this index\r\n                    var childList = [];\r\n                    var iter = existingChildren.getIterator(NamedNode.Wrap);\r\n                    var next = iter.getNext();\r\n                    while (next) {\r\n                        if (next.name != namedNode.name) {\r\n                            childList.push(next);\r\n                        }\r\n                        next = iter.getNext();\r\n                    }\r\n                    childList.push(namedNode);\r\n                    return buildChildSet(childList, index.getCompare());\r\n                }\r\n                else {\r\n                    // No change, this remains a fallback\r\n                    return fallbackObject;\r\n                }\r\n            }\r\n            else {\r\n                var existingSnap = existingChildren.get(namedNode.name);\r\n                var newChildren = indexedChildren;\r\n                if (existingSnap) {\r\n                    newChildren = newChildren.remove(new NamedNode(namedNode.name, existingSnap));\r\n                }\r\n                return newChildren.insert(namedNode, namedNode.node);\r\n            }\r\n        });\r\n        return new IndexMap(newIndexes, this.indexSet_);\r\n    };\r\n    /**\r\n     * Create a new IndexMap instance with the given value removed\r\n     * @param {!NamedNode} namedNode\r\n     * @param {!SortedMap.<string, !Node>} existingChildren\r\n     * @return {!IndexMap}\r\n     */\r\n    IndexMap.prototype.removeFromIndexes = function (namedNode, existingChildren) {\r\n        var newIndexes = map(this.indexes_, function (indexedChildren) {\r\n            if (indexedChildren === fallbackObject) {\r\n                // This is the fallback. Just return it, nothing to do in this case\r\n                return indexedChildren;\r\n            }\r\n            else {\r\n                var existingSnap = existingChildren.get(namedNode.name);\r\n                if (existingSnap) {\r\n                    return indexedChildren.remove(new NamedNode(namedNode.name, existingSnap));\r\n                }\r\n                else {\r\n                    // No record of this child\r\n                    return indexedChildren;\r\n                }\r\n            }\r\n        });\r\n        return new IndexMap(newIndexes, this.indexSet_);\r\n    };\r\n    return IndexMap;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction NAME_ONLY_COMPARATOR(left, right) {\r\n    return nameCompare(left.name, right.name);\r\n}\r\nfunction NAME_COMPARATOR(left, right) {\r\n    return nameCompare(left, right);\r\n}\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// TODO: For memory savings, don't store priorityNode_ if it's empty.\r\nvar EMPTY_NODE;\r\n/**\r\n * ChildrenNode is a class for storing internal nodes in a DataSnapshot\r\n * (i.e. nodes with children).  It implements Node and stores the\r\n * list of children in the children property, sorted by child name.\r\n *\r\n * @constructor\r\n * @implements {Node}\r\n */\r\nvar ChildrenNode = /** @class */ (function () {\r\n    /**\r\n     *\r\n     * @param {!SortedMap.<string, !Node>} children_ List of children\r\n     * of this node..\r\n     * @param {?Node} priorityNode_ The priority of this node (as a snapshot node).\r\n     * @param {!IndexMap} indexMap_\r\n     */\r\n    function ChildrenNode(children_, priorityNode_, indexMap_) {\r\n        this.children_ = children_;\r\n        this.priorityNode_ = priorityNode_;\r\n        this.indexMap_ = indexMap_;\r\n        this.lazyHash_ = null;\r\n        /**\r\n         * Note: The only reason we allow null priority is for EMPTY_NODE, since we can't use\r\n         * EMPTY_NODE as the priority of EMPTY_NODE.  We might want to consider making EMPTY_NODE its own\r\n         * class instead of an empty ChildrenNode.\r\n         */\r\n        if (this.priorityNode_) {\r\n            validatePriorityNode(this.priorityNode_);\r\n        }\r\n        if (this.children_.isEmpty()) {\r\n            assert(!this.priorityNode_ || this.priorityNode_.isEmpty(), 'An empty node cannot have a priority');\r\n        }\r\n    }\r\n    Object.defineProperty(ChildrenNode, \"EMPTY_NODE\", {\r\n        get: function () {\r\n            return (EMPTY_NODE ||\r\n                (EMPTY_NODE = new ChildrenNode(new SortedMap(NAME_COMPARATOR), null, IndexMap.Default)));\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.isLeafNode = function () {\r\n        return false;\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.getPriority = function () {\r\n        return this.priorityNode_ || EMPTY_NODE;\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.updatePriority = function (newPriorityNode) {\r\n        if (this.children_.isEmpty()) {\r\n            // Don't allow priorities on empty nodes\r\n            return this;\r\n        }\r\n        else {\r\n            return new ChildrenNode(this.children_, newPriorityNode, this.indexMap_);\r\n        }\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.getImmediateChild = function (childName) {\r\n        // Hack to treat priority as a regular child\r\n        if (childName === '.priority') {\r\n            return this.getPriority();\r\n        }\r\n        else {\r\n            var child = this.children_.get(childName);\r\n            return child === null ? EMPTY_NODE : child;\r\n        }\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.getChild = function (path) {\r\n        var front = path.getFront();\r\n        if (front === null)\r\n            return this;\r\n        return this.getImmediateChild(front).getChild(path.popFront());\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.hasChild = function (childName) {\r\n        return this.children_.get(childName) !== null;\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.updateImmediateChild = function (childName, newChildNode) {\r\n        assert(newChildNode, 'We should always be passing snapshot nodes');\r\n        if (childName === '.priority') {\r\n            return this.updatePriority(newChildNode);\r\n        }\r\n        else {\r\n            var namedNode = new NamedNode(childName, newChildNode);\r\n            var newChildren = void 0, newIndexMap = void 0, newPriority = void 0;\r\n            if (newChildNode.isEmpty()) {\r\n                newChildren = this.children_.remove(childName);\r\n                newIndexMap = this.indexMap_.removeFromIndexes(namedNode, this.children_);\r\n            }\r\n            else {\r\n                newChildren = this.children_.insert(childName, newChildNode);\r\n                newIndexMap = this.indexMap_.addToIndexes(namedNode, this.children_);\r\n            }\r\n            newPriority = newChildren.isEmpty() ? EMPTY_NODE : this.priorityNode_;\r\n            return new ChildrenNode(newChildren, newPriority, newIndexMap);\r\n        }\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.updateChild = function (path, newChildNode) {\r\n        var front = path.getFront();\r\n        if (front === null) {\r\n            return newChildNode;\r\n        }\r\n        else {\r\n            assert(path.getFront() !== '.priority' || path.getLength() === 1, '.priority must be the last token in a path');\r\n            var newImmediateChild = this.getImmediateChild(front).updateChild(path.popFront(), newChildNode);\r\n            return this.updateImmediateChild(front, newImmediateChild);\r\n        }\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.isEmpty = function () {\r\n        return this.children_.isEmpty();\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.numChildren = function () {\r\n        return this.children_.count();\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.val = function (exportFormat) {\r\n        if (this.isEmpty())\r\n            return null;\r\n        var obj = {};\r\n        var numKeys = 0, maxKey = 0, allIntegerKeys = true;\r\n        this.forEachChild(PRIORITY_INDEX, function (key, childNode) {\r\n            obj[key] = childNode.val(exportFormat);\r\n            numKeys++;\r\n            if (allIntegerKeys && ChildrenNode.INTEGER_REGEXP_.test(key)) {\r\n                maxKey = Math.max(maxKey, Number(key));\r\n            }\r\n            else {\r\n                allIntegerKeys = false;\r\n            }\r\n        });\r\n        if (!exportFormat && allIntegerKeys && maxKey < 2 * numKeys) {\r\n            // convert to array.\r\n            var array = [];\r\n            for (var key in obj)\r\n                array[key] = obj[key];\r\n            return array;\r\n        }\r\n        else {\r\n            if (exportFormat && !this.getPriority().isEmpty()) {\r\n                obj['.priority'] = this.getPriority().val();\r\n            }\r\n            return obj;\r\n        }\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.hash = function () {\r\n        if (this.lazyHash_ === null) {\r\n            var toHash_1 = '';\r\n            if (!this.getPriority().isEmpty())\r\n                toHash_1 +=\r\n                    'priority:' +\r\n                        priorityHashText(this.getPriority().val()) +\r\n                        ':';\r\n            this.forEachChild(PRIORITY_INDEX, function (key, childNode) {\r\n                var childHash = childNode.hash();\r\n                if (childHash !== '')\r\n                    toHash_1 += ':' + key + ':' + childHash;\r\n            });\r\n            this.lazyHash_ = toHash_1 === '' ? '' : sha1(toHash_1);\r\n        }\r\n        return this.lazyHash_;\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.getPredecessorChildName = function (childName, childNode, index) {\r\n        var idx = this.resolveIndex_(index);\r\n        if (idx) {\r\n            var predecessor = idx.getPredecessorKey(new NamedNode(childName, childNode));\r\n            return predecessor ? predecessor.name : null;\r\n        }\r\n        else {\r\n            return this.children_.getPredecessorKey(childName);\r\n        }\r\n    };\r\n    /**\r\n     * @param {!Index} indexDefinition\r\n     * @return {?string}\r\n     */\r\n    ChildrenNode.prototype.getFirstChildName = function (indexDefinition) {\r\n        var idx = this.resolveIndex_(indexDefinition);\r\n        if (idx) {\r\n            var minKey = idx.minKey();\r\n            return minKey && minKey.name;\r\n        }\r\n        else {\r\n            return this.children_.minKey();\r\n        }\r\n    };\r\n    /**\r\n     * @param {!Index} indexDefinition\r\n     * @return {?NamedNode}\r\n     */\r\n    ChildrenNode.prototype.getFirstChild = function (indexDefinition) {\r\n        var minKey = this.getFirstChildName(indexDefinition);\r\n        if (minKey) {\r\n            return new NamedNode(minKey, this.children_.get(minKey));\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    };\r\n    /**\r\n     * Given an index, return the key name of the largest value we have, according to that index\r\n     * @param {!Index} indexDefinition\r\n     * @return {?string}\r\n     */\r\n    ChildrenNode.prototype.getLastChildName = function (indexDefinition) {\r\n        var idx = this.resolveIndex_(indexDefinition);\r\n        if (idx) {\r\n            var maxKey = idx.maxKey();\r\n            return maxKey && maxKey.name;\r\n        }\r\n        else {\r\n            return this.children_.maxKey();\r\n        }\r\n    };\r\n    /**\r\n     * @param {!Index} indexDefinition\r\n     * @return {?NamedNode}\r\n     */\r\n    ChildrenNode.prototype.getLastChild = function (indexDefinition) {\r\n        var maxKey = this.getLastChildName(indexDefinition);\r\n        if (maxKey) {\r\n            return new NamedNode(maxKey, this.children_.get(maxKey));\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ChildrenNode.prototype.forEachChild = function (index, action) {\r\n        var idx = this.resolveIndex_(index);\r\n        if (idx) {\r\n            return idx.inorderTraversal(function (wrappedNode) {\r\n                return action(wrappedNode.name, wrappedNode.node);\r\n            });\r\n        }\r\n        else {\r\n            return this.children_.inorderTraversal(action);\r\n        }\r\n    };\r\n    /**\r\n     * @param {!Index} indexDefinition\r\n     * @return {SortedMapIterator}\r\n     */\r\n    ChildrenNode.prototype.getIterator = function (indexDefinition) {\r\n        return this.getIteratorFrom(indexDefinition.minPost(), indexDefinition);\r\n    };\r\n    /**\r\n     *\r\n     * @param {!NamedNode} startPost\r\n     * @param {!Index} indexDefinition\r\n     * @return {!SortedMapIterator}\r\n     */\r\n    ChildrenNode.prototype.getIteratorFrom = function (startPost, indexDefinition) {\r\n        var idx = this.resolveIndex_(indexDefinition);\r\n        if (idx) {\r\n            return idx.getIteratorFrom(startPost, function (key) { return key; });\r\n        }\r\n        else {\r\n            var iterator = this.children_.getIteratorFrom(startPost.name, NamedNode.Wrap);\r\n            var next = iterator.peek();\r\n            while (next != null && indexDefinition.compare(next, startPost) < 0) {\r\n                iterator.getNext();\r\n                next = iterator.peek();\r\n            }\r\n            return iterator;\r\n        }\r\n    };\r\n    /**\r\n     * @param {!Index} indexDefinition\r\n     * @return {!SortedMapIterator}\r\n     */\r\n    ChildrenNode.prototype.getReverseIterator = function (indexDefinition) {\r\n        return this.getReverseIteratorFrom(indexDefinition.maxPost(), indexDefinition);\r\n    };\r\n    /**\r\n     * @param {!NamedNode} endPost\r\n     * @param {!Index} indexDefinition\r\n     * @return {!SortedMapIterator}\r\n     */\r\n    ChildrenNode.prototype.getReverseIteratorFrom = function (endPost, indexDefinition) {\r\n        var idx = this.resolveIndex_(indexDefinition);\r\n        if (idx) {\r\n            return idx.getReverseIteratorFrom(endPost, function (key) {\r\n                return key;\r\n            });\r\n        }\r\n        else {\r\n            var iterator = this.children_.getReverseIteratorFrom(endPost.name, NamedNode.Wrap);\r\n            var next = iterator.peek();\r\n            while (next != null && indexDefinition.compare(next, endPost) > 0) {\r\n                iterator.getNext();\r\n                next = iterator.peek();\r\n            }\r\n            return iterator;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ChildrenNode.prototype.compareTo = function (other) {\r\n        if (this.isEmpty()) {\r\n            if (other.isEmpty()) {\r\n                return 0;\r\n            }\r\n            else {\r\n                return -1;\r\n            }\r\n        }\r\n        else if (other.isLeafNode() || other.isEmpty()) {\r\n            return 1;\r\n        }\r\n        else if (other === MAX_NODE$2) {\r\n            return -1;\r\n        }\r\n        else {\r\n            // Must be another node with children.\r\n            return 0;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ChildrenNode.prototype.withIndex = function (indexDefinition) {\r\n        if (indexDefinition === KEY_INDEX ||\r\n            this.indexMap_.hasIndex(indexDefinition)) {\r\n            return this;\r\n        }\r\n        else {\r\n            var newIndexMap = this.indexMap_.addIndex(indexDefinition, this.children_);\r\n            return new ChildrenNode(this.children_, this.priorityNode_, newIndexMap);\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ChildrenNode.prototype.isIndexed = function (index) {\r\n        return index === KEY_INDEX || this.indexMap_.hasIndex(index);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ChildrenNode.prototype.equals = function (other) {\r\n        if (other === this) {\r\n            return true;\r\n        }\r\n        else if (other.isLeafNode()) {\r\n            return false;\r\n        }\r\n        else {\r\n            var otherChildrenNode = other;\r\n            if (!this.getPriority().equals(otherChildrenNode.getPriority())) {\r\n                return false;\r\n            }\r\n            else if (this.children_.count() === otherChildrenNode.children_.count()) {\r\n                var thisIter = this.getIterator(PRIORITY_INDEX);\r\n                var otherIter = otherChildrenNode.getIterator(PRIORITY_INDEX);\r\n                var thisCurrent = thisIter.getNext();\r\n                var otherCurrent = otherIter.getNext();\r\n                while (thisCurrent && otherCurrent) {\r\n                    if (thisCurrent.name !== otherCurrent.name ||\r\n                        !thisCurrent.node.equals(otherCurrent.node)) {\r\n                        return false;\r\n                    }\r\n                    thisCurrent = thisIter.getNext();\r\n                    otherCurrent = otherIter.getNext();\r\n                }\r\n                return thisCurrent === null && otherCurrent === null;\r\n            }\r\n            else {\r\n                return false;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Returns a SortedMap ordered by index, or null if the default (by-key) ordering can be used\r\n     * instead.\r\n     *\r\n     * @private\r\n     * @param {!Index} indexDefinition\r\n     * @return {?SortedMap.<NamedNode, Node>}\r\n     */\r\n    ChildrenNode.prototype.resolveIndex_ = function (indexDefinition) {\r\n        if (indexDefinition === KEY_INDEX) {\r\n            return null;\r\n        }\r\n        else {\r\n            return this.indexMap_.get(indexDefinition.toString());\r\n        }\r\n    };\r\n    /**\r\n     * @private\r\n     * @type {RegExp}\r\n     */\r\n    ChildrenNode.INTEGER_REGEXP_ = /^(0|[1-9]\\d*)$/;\r\n    return ChildrenNode;\r\n}());\r\n/**\r\n * @constructor\r\n * @extends {ChildrenNode}\r\n * @private\r\n */\r\nvar MaxNode = /** @class */ (function (_super) {\r\n    __extends(MaxNode, _super);\r\n    function MaxNode() {\r\n        return _super.call(this, new SortedMap(NAME_COMPARATOR), ChildrenNode.EMPTY_NODE, IndexMap.Default) || this;\r\n    }\r\n    MaxNode.prototype.compareTo = function (other) {\r\n        if (other === this) {\r\n            return 0;\r\n        }\r\n        else {\r\n            return 1;\r\n        }\r\n    };\r\n    MaxNode.prototype.equals = function (other) {\r\n        // Not that we every compare it, but MAX_NODE is only ever equal to itself\r\n        return other === this;\r\n    };\r\n    MaxNode.prototype.getPriority = function () {\r\n        return this;\r\n    };\r\n    MaxNode.prototype.getImmediateChild = function (childName) {\r\n        return ChildrenNode.EMPTY_NODE;\r\n    };\r\n    MaxNode.prototype.isEmpty = function () {\r\n        return false;\r\n    };\r\n    return MaxNode;\r\n}(ChildrenNode));\r\n/**\r\n * Marker that will sort higher than any other snapshot.\r\n * @type {!MAX_NODE}\r\n * @const\r\n */\r\nvar MAX_NODE$2 = new MaxNode();\r\nObject.defineProperties(NamedNode, {\r\n    MIN: {\r\n        value: new NamedNode(MIN_NAME, ChildrenNode.EMPTY_NODE)\r\n    },\r\n    MAX: {\r\n        value: new NamedNode(MAX_NAME, MAX_NODE$2)\r\n    }\r\n});\r\n/**\r\n * Reference Extensions\r\n */\r\nKeyIndex.__EMPTY_NODE = ChildrenNode.EMPTY_NODE;\r\nLeafNode.__childrenNodeConstructor = ChildrenNode;\r\nsetMaxNode(MAX_NODE$2);\r\nsetMaxNode$1(MAX_NODE$2);\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar USE_HINZE = true;\r\n/**\r\n * Constructs a snapshot node representing the passed JSON and returns it.\r\n * @param {*} json JSON to create a node for.\r\n * @param {?string|?number=} priority Optional priority to use.  This will be ignored if the\r\n * passed JSON contains a .priority property.\r\n * @return {!Node}\r\n */\r\nfunction nodeFromJSON$1(json, priority) {\r\n    if (priority === void 0) { priority = null; }\r\n    if (json === null) {\r\n        return ChildrenNode.EMPTY_NODE;\r\n    }\r\n    if (typeof json === 'object' && '.priority' in json) {\r\n        priority = json['.priority'];\r\n    }\r\n    assert(priority === null ||\r\n        typeof priority === 'string' ||\r\n        typeof priority === 'number' ||\r\n        (typeof priority === 'object' && '.sv' in priority), 'Invalid priority type found: ' + typeof priority);\r\n    if (typeof json === 'object' && '.value' in json && json['.value'] !== null) {\r\n        json = json['.value'];\r\n    }\r\n    // Valid leaf nodes include non-objects or server-value wrapper objects\r\n    if (typeof json !== 'object' || '.sv' in json) {\r\n        var jsonLeaf = json;\r\n        return new LeafNode(jsonLeaf, nodeFromJSON$1(priority));\r\n    }\r\n    if (!(json instanceof Array) && USE_HINZE) {\r\n        var children_1 = [];\r\n        var childrenHavePriority_1 = false;\r\n        var hinzeJsonObj_1 = json;\r\n        forEach(hinzeJsonObj_1, function (key, child) {\r\n            if (typeof key !== 'string' || key.substring(0, 1) !== '.') {\r\n                // Ignore metadata nodes\r\n                var childNode = nodeFromJSON$1(hinzeJsonObj_1[key]);\r\n                if (!childNode.isEmpty()) {\r\n                    childrenHavePriority_1 =\r\n                        childrenHavePriority_1 || !childNode.getPriority().isEmpty();\r\n                    children_1.push(new NamedNode(key, childNode));\r\n                }\r\n            }\r\n        });\r\n        if (children_1.length == 0) {\r\n            return ChildrenNode.EMPTY_NODE;\r\n        }\r\n        var childSet = buildChildSet(children_1, NAME_ONLY_COMPARATOR, function (namedNode) { return namedNode.name; }, NAME_COMPARATOR);\r\n        if (childrenHavePriority_1) {\r\n            var sortedChildSet = buildChildSet(children_1, PRIORITY_INDEX.getCompare());\r\n            return new ChildrenNode(childSet, nodeFromJSON$1(priority), new IndexMap({ '.priority': sortedChildSet }, { '.priority': PRIORITY_INDEX }));\r\n        }\r\n        else {\r\n            return new ChildrenNode(childSet, nodeFromJSON$1(priority), IndexMap.Default);\r\n        }\r\n    }\r\n    else {\r\n        var node_1 = ChildrenNode.EMPTY_NODE;\r\n        var jsonObj_1 = json;\r\n        forEach(jsonObj_1, function (key, childData) {\r\n            if (contains(jsonObj_1, key)) {\r\n                if (key.substring(0, 1) !== '.') {\r\n                    // ignore metadata nodes.\r\n                    var childNode = nodeFromJSON$1(childData);\r\n                    if (childNode.isLeafNode() || !childNode.isEmpty())\r\n                        node_1 = node_1.updateImmediateChild(key, childNode);\r\n                }\r\n            }\r\n        });\r\n        return node_1.updatePriority(nodeFromJSON$1(priority));\r\n    }\r\n}\r\nsetNodeFromJSON(nodeFromJSON$1);\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @constructor\r\n * @extends {Index}\r\n * @private\r\n */\r\nvar ValueIndex = /** @class */ (function (_super) {\r\n    __extends(ValueIndex, _super);\r\n    function ValueIndex() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ValueIndex.prototype.compare = function (a, b) {\r\n        var indexCmp = a.node.compareTo(b.node);\r\n        if (indexCmp === 0) {\r\n            return nameCompare(a.name, b.name);\r\n        }\r\n        else {\r\n            return indexCmp;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ValueIndex.prototype.isDefinedOn = function (node) {\r\n        return true;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ValueIndex.prototype.indexedValueChanged = function (oldNode, newNode) {\r\n        return !oldNode.equals(newNode);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ValueIndex.prototype.minPost = function () {\r\n        return NamedNode.MIN;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ValueIndex.prototype.maxPost = function () {\r\n        return NamedNode.MAX;\r\n    };\r\n    /**\r\n     * @param {*} indexValue\r\n     * @param {string} name\r\n     * @return {!NamedNode}\r\n     */\r\n    ValueIndex.prototype.makePost = function (indexValue, name) {\r\n        var valueNode = nodeFromJSON$1(indexValue);\r\n        return new NamedNode(name, valueNode);\r\n    };\r\n    /**\r\n     * @return {!string} String representation for inclusion in a query spec\r\n     */\r\n    ValueIndex.prototype.toString = function () {\r\n        return '.value';\r\n    };\r\n    return ValueIndex;\r\n}(Index));\r\nvar VALUE_INDEX = new ValueIndex();\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @param {!Path} indexPath\r\n * @constructor\r\n * @extends {Index}\r\n */\r\nvar PathIndex = /** @class */ (function (_super) {\r\n    __extends(PathIndex, _super);\r\n    function PathIndex(indexPath_) {\r\n        var _this = _super.call(this) || this;\r\n        _this.indexPath_ = indexPath_;\r\n        assert(!indexPath_.isEmpty() && indexPath_.getFront() !== '.priority', \"Can't create PathIndex with empty path or .priority key\");\r\n        return _this;\r\n    }\r\n    /**\r\n     * @param {!Node} snap\r\n     * @return {!Node}\r\n     * @protected\r\n     */\r\n    PathIndex.prototype.extractChild = function (snap) {\r\n        return snap.getChild(this.indexPath_);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PathIndex.prototype.isDefinedOn = function (node) {\r\n        return !node.getChild(this.indexPath_).isEmpty();\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PathIndex.prototype.compare = function (a, b) {\r\n        var aChild = this.extractChild(a.node);\r\n        var bChild = this.extractChild(b.node);\r\n        var indexCmp = aChild.compareTo(bChild);\r\n        if (indexCmp === 0) {\r\n            return nameCompare(a.name, b.name);\r\n        }\r\n        else {\r\n            return indexCmp;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PathIndex.prototype.makePost = function (indexValue, name) {\r\n        var valueNode = nodeFromJSON$1(indexValue);\r\n        var node = ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_, valueNode);\r\n        return new NamedNode(name, node);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PathIndex.prototype.maxPost = function () {\r\n        var node = ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_, MAX_NODE$2);\r\n        return new NamedNode(MAX_NAME, node);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PathIndex.prototype.toString = function () {\r\n        return this.indexPath_.slice().join('/');\r\n    };\r\n    return PathIndex;\r\n}(Index));\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Class representing a firebase data snapshot.  It wraps a SnapshotNode and\r\n * surfaces the public methods (val, forEach, etc.) we want to expose.\r\n */\r\nvar DataSnapshot = /** @class */ (function () {\r\n    /**\r\n     * @param {!Node} node_ A SnapshotNode to wrap.\r\n     * @param {!Reference} ref_ The ref of the location this snapshot came from.\r\n     * @param {!Index} index_ The iteration order for this snapshot\r\n     */\r\n    function DataSnapshot(node_, ref_, index_) {\r\n        this.node_ = node_;\r\n        this.ref_ = ref_;\r\n        this.index_ = index_;\r\n    }\r\n    /**\r\n     * Retrieves the snapshot contents as JSON.  Returns null if the snapshot is\r\n     * empty.\r\n     *\r\n     * @return {*} JSON representation of the DataSnapshot contents, or null if empty.\r\n     */\r\n    DataSnapshot.prototype.val = function () {\r\n        validateArgCount('DataSnapshot.val', 0, 0, arguments.length);\r\n        return this.node_.val();\r\n    };\r\n    /**\r\n     * Returns the snapshot contents as JSON, including priorities of node.  Suitable for exporting\r\n     * the entire node contents.\r\n     * @return {*} JSON representation of the DataSnapshot contents, or null if empty.\r\n     */\r\n    DataSnapshot.prototype.exportVal = function () {\r\n        validateArgCount('DataSnapshot.exportVal', 0, 0, arguments.length);\r\n        return this.node_.val(true);\r\n    };\r\n    // Do not create public documentation. This is intended to make JSON serialization work but is otherwise unnecessary\r\n    // for end-users\r\n    DataSnapshot.prototype.toJSON = function () {\r\n        // Optional spacer argument is unnecessary because we're depending on recursion rather than stringifying the content\r\n        validateArgCount('DataSnapshot.toJSON', 0, 1, arguments.length);\r\n        return this.exportVal();\r\n    };\r\n    /**\r\n     * Returns whether the snapshot contains a non-null value.\r\n     *\r\n     * @return {boolean} Whether the snapshot contains a non-null value, or is empty.\r\n     */\r\n    DataSnapshot.prototype.exists = function () {\r\n        validateArgCount('DataSnapshot.exists', 0, 0, arguments.length);\r\n        return !this.node_.isEmpty();\r\n    };\r\n    /**\r\n     * Returns a DataSnapshot of the specified child node's contents.\r\n     *\r\n     * @param {!string} childPathString Path to a child.\r\n     * @return {!DataSnapshot} DataSnapshot for child node.\r\n     */\r\n    DataSnapshot.prototype.child = function (childPathString) {\r\n        validateArgCount('DataSnapshot.child', 0, 1, arguments.length);\r\n        // Ensure the childPath is a string (can be a number)\r\n        childPathString = String(childPathString);\r\n        validatePathString('DataSnapshot.child', 1, childPathString, false);\r\n        var childPath = new Path(childPathString);\r\n        var childRef = this.ref_.child(childPath);\r\n        return new DataSnapshot(this.node_.getChild(childPath), childRef, PRIORITY_INDEX);\r\n    };\r\n    /**\r\n     * Returns whether the snapshot contains a child at the specified path.\r\n     *\r\n     * @param {!string} childPathString Path to a child.\r\n     * @return {boolean} Whether the child exists.\r\n     */\r\n    DataSnapshot.prototype.hasChild = function (childPathString) {\r\n        validateArgCount('DataSnapshot.hasChild', 1, 1, arguments.length);\r\n        validatePathString('DataSnapshot.hasChild', 1, childPathString, false);\r\n        var childPath = new Path(childPathString);\r\n        return !this.node_.getChild(childPath).isEmpty();\r\n    };\r\n    /**\r\n     * Returns the priority of the object, or null if no priority was set.\r\n     *\r\n     * @return {string|number|null} The priority.\r\n     */\r\n    DataSnapshot.prototype.getPriority = function () {\r\n        validateArgCount('DataSnapshot.getPriority', 0, 0, arguments.length);\r\n        // typecast here because we never return deferred values or internal priorities (MAX_PRIORITY)\r\n        return this.node_.getPriority().val();\r\n    };\r\n    /**\r\n     * Iterates through child nodes and calls the specified action for each one.\r\n     *\r\n     * @param {function(!DataSnapshot)} action Callback function to be called\r\n     * for each child.\r\n     * @return {boolean} True if forEach was canceled by action returning true for\r\n     * one of the child nodes.\r\n     */\r\n    DataSnapshot.prototype.forEach = function (action) {\r\n        var _this = this;\r\n        validateArgCount('DataSnapshot.forEach', 1, 1, arguments.length);\r\n        validateCallback('DataSnapshot.forEach', 1, action, false);\r\n        if (this.node_.isLeafNode())\r\n            return false;\r\n        var childrenNode = this.node_;\r\n        // Sanitize the return value to a boolean. ChildrenNode.forEachChild has a weird return type...\r\n        return !!childrenNode.forEachChild(this.index_, function (key, node) {\r\n            return action(new DataSnapshot(node, _this.ref_.child(key), PRIORITY_INDEX));\r\n        });\r\n    };\r\n    /**\r\n     * Returns whether this DataSnapshot has children.\r\n     * @return {boolean} True if the DataSnapshot contains 1 or more child nodes.\r\n     */\r\n    DataSnapshot.prototype.hasChildren = function () {\r\n        validateArgCount('DataSnapshot.hasChildren', 0, 0, arguments.length);\r\n        if (this.node_.isLeafNode())\r\n            return false;\r\n        else\r\n            return !this.node_.isEmpty();\r\n    };\r\n    Object.defineProperty(DataSnapshot.prototype, \"key\", {\r\n        get: function () {\r\n            return this.ref_.getKey();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Returns the number of children for this DataSnapshot.\r\n     * @return {number} The number of children that this DataSnapshot contains.\r\n     */\r\n    DataSnapshot.prototype.numChildren = function () {\r\n        validateArgCount('DataSnapshot.numChildren', 0, 0, arguments.length);\r\n        return this.node_.numChildren();\r\n    };\r\n    /**\r\n     * @return {Reference} The Firebase reference for the location this snapshot's data came from.\r\n     */\r\n    DataSnapshot.prototype.getRef = function () {\r\n        validateArgCount('DataSnapshot.ref', 0, 0, arguments.length);\r\n        return this.ref_;\r\n    };\r\n    Object.defineProperty(DataSnapshot.prototype, \"ref\", {\r\n        get: function () {\r\n            return this.getRef();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return DataSnapshot;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Encapsulates the data needed to raise an event\r\n * @implements {Event}\r\n */\r\nvar DataEvent = /** @class */ (function () {\r\n    /**\r\n     * @param {!string} eventType One of: value, child_added, child_changed, child_moved, child_removed\r\n     * @param {!EventRegistration} eventRegistration The function to call to with the event data. User provided\r\n     * @param {!DataSnapshot} snapshot The data backing the event\r\n     * @param {?string=} prevName Optional, the name of the previous child for child_* events.\r\n     */\r\n    function DataEvent(eventType, eventRegistration, snapshot, prevName) {\r\n        this.eventType = eventType;\r\n        this.eventRegistration = eventRegistration;\r\n        this.snapshot = snapshot;\r\n        this.prevName = prevName;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    DataEvent.prototype.getPath = function () {\r\n        var ref = this.snapshot.getRef();\r\n        if (this.eventType === 'value') {\r\n            return ref.path;\r\n        }\r\n        else {\r\n            return ref.getParent().path;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    DataEvent.prototype.getEventType = function () {\r\n        return this.eventType;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    DataEvent.prototype.getEventRunner = function () {\r\n        return this.eventRegistration.getEventRunner(this);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    DataEvent.prototype.toString = function () {\r\n        return (this.getPath().toString() +\r\n            ':' +\r\n            this.eventType +\r\n            ':' +\r\n            stringify(this.snapshot.exportVal()));\r\n    };\r\n    return DataEvent;\r\n}());\r\nvar CancelEvent = /** @class */ (function () {\r\n    /**\r\n     * @param {EventRegistration} eventRegistration\r\n     * @param {Error} error\r\n     * @param {!Path} path\r\n     */\r\n    function CancelEvent(eventRegistration, error, path) {\r\n        this.eventRegistration = eventRegistration;\r\n        this.error = error;\r\n        this.path = path;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    CancelEvent.prototype.getPath = function () {\r\n        return this.path;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    CancelEvent.prototype.getEventType = function () {\r\n        return 'cancel';\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    CancelEvent.prototype.getEventRunner = function () {\r\n        return this.eventRegistration.getEventRunner(this);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    CancelEvent.prototype.toString = function () {\r\n        return this.path.toString() + ':cancel';\r\n    };\r\n    return CancelEvent;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Represents registration for 'value' events.\r\n */\r\nvar ValueEventRegistration = /** @class */ (function () {\r\n    /**\r\n     * @param {?function(!DataSnapshot)} callback_\r\n     * @param {?function(Error)} cancelCallback_\r\n     * @param {?Object} context_\r\n     */\r\n    function ValueEventRegistration(callback_, cancelCallback_, context_) {\r\n        this.callback_ = callback_;\r\n        this.cancelCallback_ = cancelCallback_;\r\n        this.context_ = context_;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ValueEventRegistration.prototype.respondsTo = function (eventType) {\r\n        return eventType === 'value';\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ValueEventRegistration.prototype.createEvent = function (change, query) {\r\n        var index = query.getQueryParams().getIndex();\r\n        return new DataEvent('value', this, new DataSnapshot(change.snapshotNode, query.getRef(), index));\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ValueEventRegistration.prototype.getEventRunner = function (eventData) {\r\n        var ctx = this.context_;\r\n        if (eventData.getEventType() === 'cancel') {\r\n            assert(this.cancelCallback_, 'Raising a cancel event on a listener with no cancel callback');\r\n            var cancelCB_1 = this.cancelCallback_;\r\n            return function () {\r\n                // We know that error exists, we checked above that this is a cancel event\r\n                cancelCB_1.call(ctx, eventData.error);\r\n            };\r\n        }\r\n        else {\r\n            var cb_1 = this.callback_;\r\n            return function () {\r\n                cb_1.call(ctx, eventData.snapshot);\r\n            };\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ValueEventRegistration.prototype.createCancelEvent = function (error, path) {\r\n        if (this.cancelCallback_) {\r\n            return new CancelEvent(this, error, path);\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ValueEventRegistration.prototype.matches = function (other) {\r\n        if (!(other instanceof ValueEventRegistration)) {\r\n            return false;\r\n        }\r\n        else if (!other.callback_ || !this.callback_) {\r\n            // If no callback specified, we consider it to match any callback.\r\n            return true;\r\n        }\r\n        else {\r\n            return (other.callback_ === this.callback_ && other.context_ === this.context_);\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ValueEventRegistration.prototype.hasAnyCallback = function () {\r\n        return this.callback_ !== null;\r\n    };\r\n    return ValueEventRegistration;\r\n}());\r\n/**\r\n * Represents the registration of 1 or more child_xxx events.\r\n *\r\n * Currently, it is always exactly 1 child_xxx event, but the idea is we might let you\r\n * register a group of callbacks together in the future.\r\n *\r\n * @constructor\r\n * @implements {EventRegistration}\r\n */\r\nvar ChildEventRegistration = /** @class */ (function () {\r\n    /**\r\n     * @param {?Object.<string, function(!DataSnapshot, ?string=)>} callbacks_\r\n     * @param {?function(Error)} cancelCallback_\r\n     * @param {Object=} context_\r\n     */\r\n    function ChildEventRegistration(callbacks_, cancelCallback_, context_) {\r\n        this.callbacks_ = callbacks_;\r\n        this.cancelCallback_ = cancelCallback_;\r\n        this.context_ = context_;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ChildEventRegistration.prototype.respondsTo = function (eventType) {\r\n        var eventToCheck = eventType === 'children_added' ? 'child_added' : eventType;\r\n        eventToCheck =\r\n            eventToCheck === 'children_removed' ? 'child_removed' : eventToCheck;\r\n        return contains(this.callbacks_, eventToCheck);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ChildEventRegistration.prototype.createCancelEvent = function (error, path) {\r\n        if (this.cancelCallback_) {\r\n            return new CancelEvent(this, error, path);\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ChildEventRegistration.prototype.createEvent = function (change, query) {\r\n        assert(change.childName != null, 'Child events should have a childName.');\r\n        var ref = query.getRef().child(/** @type {!string} */ (change.childName));\r\n        var index = query.getQueryParams().getIndex();\r\n        return new DataEvent(change.type, this, new DataSnapshot(change.snapshotNode, ref, index), change.prevName);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ChildEventRegistration.prototype.getEventRunner = function (eventData) {\r\n        var ctx = this.context_;\r\n        if (eventData.getEventType() === 'cancel') {\r\n            assert(this.cancelCallback_, 'Raising a cancel event on a listener with no cancel callback');\r\n            var cancelCB_2 = this.cancelCallback_;\r\n            return function () {\r\n                // We know that error exists, we checked above that this is a cancel event\r\n                cancelCB_2.call(ctx, eventData.error);\r\n            };\r\n        }\r\n        else {\r\n            var cb_2 = this.callbacks_[eventData.eventType];\r\n            return function () {\r\n                cb_2.call(ctx, eventData.snapshot, eventData.prevName);\r\n            };\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ChildEventRegistration.prototype.matches = function (other) {\r\n        if (other instanceof ChildEventRegistration) {\r\n            if (!this.callbacks_ || !other.callbacks_) {\r\n                return true;\r\n            }\r\n            else if (this.context_ === other.context_) {\r\n                var otherCount = getCount(other.callbacks_);\r\n                var thisCount = getCount(this.callbacks_);\r\n                if (otherCount === thisCount) {\r\n                    // If count is 1, do an exact match on eventType, if either is defined but null, it's a match.\r\n                    //  If event types don't match, not a match\r\n                    // If count is not 1, exact match across all\r\n                    if (otherCount === 1) {\r\n                        var otherKey /** @type {!string} */ = getAnyKey(other.callbacks_);\r\n                        var thisKey /** @type {!string} */ = getAnyKey(this.callbacks_);\r\n                        return (thisKey === otherKey &&\r\n                            (!other.callbacks_[otherKey] ||\r\n                                !this.callbacks_[thisKey] ||\r\n                                other.callbacks_[otherKey] === this.callbacks_[thisKey]));\r\n                    }\r\n                    else {\r\n                        // Exact match on each key.\r\n                        return every(this.callbacks_, function (eventType, cb) { return other.callbacks_[eventType] === cb; });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ChildEventRegistration.prototype.hasAnyCallback = function () {\r\n        return this.callbacks_ !== null;\r\n    };\r\n    return ChildEventRegistration;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar __referenceConstructor;\r\n/**\r\n * A Query represents a filter to be applied to a firebase location.  This object purely represents the\r\n * query expression (and exposes our public API to build the query).  The actual query logic is in ViewBase.js.\r\n *\r\n * Since every Firebase reference is a query, Firebase inherits from this object.\r\n */\r\nvar Query = /** @class */ (function () {\r\n    function Query(repo, path, queryParams_, orderByCalled_) {\r\n        this.repo = repo;\r\n        this.path = path;\r\n        this.queryParams_ = queryParams_;\r\n        this.orderByCalled_ = orderByCalled_;\r\n    }\r\n    Object.defineProperty(Query, \"__referenceConstructor\", {\r\n        get: function () {\r\n            assert(__referenceConstructor, 'Reference.ts has not been loaded');\r\n            return __referenceConstructor;\r\n        },\r\n        set: function (val) {\r\n            __referenceConstructor = val;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Validates start/end values for queries.\r\n     * @param {!QueryParams} params\r\n     * @private\r\n     */\r\n    Query.validateQueryEndpoints_ = function (params) {\r\n        var startNode = null;\r\n        var endNode = null;\r\n        if (params.hasStart()) {\r\n            startNode = params.getIndexStartValue();\r\n        }\r\n        if (params.hasEnd()) {\r\n            endNode = params.getIndexEndValue();\r\n        }\r\n        if (params.getIndex() === KEY_INDEX) {\r\n            var tooManyArgsError = 'Query: When ordering by key, you may only pass one argument to ' +\r\n                'startAt(), endAt(), or equalTo().';\r\n            var wrongArgTypeError = 'Query: When ordering by key, the argument passed to startAt(), endAt(),' +\r\n                'or equalTo() must be a string.';\r\n            if (params.hasStart()) {\r\n                var startName = params.getIndexStartName();\r\n                if (startName != MIN_NAME) {\r\n                    throw new Error(tooManyArgsError);\r\n                }\r\n                else if (typeof startNode !== 'string') {\r\n                    throw new Error(wrongArgTypeError);\r\n                }\r\n            }\r\n            if (params.hasEnd()) {\r\n                var endName = params.getIndexEndName();\r\n                if (endName != MAX_NAME) {\r\n                    throw new Error(tooManyArgsError);\r\n                }\r\n                else if (typeof endNode !== 'string') {\r\n                    throw new Error(wrongArgTypeError);\r\n                }\r\n            }\r\n        }\r\n        else if (params.getIndex() === PRIORITY_INDEX) {\r\n            if ((startNode != null && !isValidPriority(startNode)) ||\r\n                (endNode != null && !isValidPriority(endNode))) {\r\n                throw new Error('Query: When ordering by priority, the first argument passed to startAt(), ' +\r\n                    'endAt(), or equalTo() must be a valid priority value (null, a number, or a string).');\r\n            }\r\n        }\r\n        else {\r\n            assert(params.getIndex() instanceof PathIndex ||\r\n                params.getIndex() === VALUE_INDEX, 'unknown index type.');\r\n            if ((startNode != null && typeof startNode === 'object') ||\r\n                (endNode != null && typeof endNode === 'object')) {\r\n                throw new Error('Query: First argument passed to startAt(), endAt(), or equalTo() cannot be ' +\r\n                    'an object.');\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Validates that limit* has been called with the correct combination of parameters\r\n     * @param {!QueryParams} params\r\n     * @private\r\n     */\r\n    Query.validateLimit_ = function (params) {\r\n        if (params.hasStart() &&\r\n            params.hasEnd() &&\r\n            params.hasLimit() &&\r\n            !params.hasAnchoredLimit()) {\r\n            throw new Error(\"Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.\");\r\n        }\r\n    };\r\n    /**\r\n     * Validates that no other order by call has been made\r\n     * @param {!string} fnName\r\n     * @private\r\n     */\r\n    Query.prototype.validateNoPreviousOrderByCall_ = function (fnName) {\r\n        if (this.orderByCalled_ === true) {\r\n            throw new Error(fnName + \": You can't combine multiple orderBy calls.\");\r\n        }\r\n    };\r\n    /**\r\n     * @return {!QueryParams}\r\n     */\r\n    Query.prototype.getQueryParams = function () {\r\n        return this.queryParams_;\r\n    };\r\n    /**\r\n     * @return {!Reference}\r\n     */\r\n    Query.prototype.getRef = function () {\r\n        validateArgCount('Query.ref', 0, 0, arguments.length);\r\n        // This is a slight hack. We cannot goog.require('fb.api.Firebase'), since Firebase requires fb.api.Query.\r\n        // However, we will always export 'Firebase' to the global namespace, so it's guaranteed to exist by the time this\r\n        // method gets called.\r\n        return new Query.__referenceConstructor(this.repo, this.path);\r\n    };\r\n    /**\r\n     * @param {!string} eventType\r\n     * @param {!function(DataSnapshot, string=)} callback\r\n     * @param {(function(Error)|Object)=} cancelCallbackOrContext\r\n     * @param {Object=} context\r\n     * @return {!function(DataSnapshot, string=)}\r\n     */\r\n    Query.prototype.on = function (eventType, callback, cancelCallbackOrContext, context) {\r\n        validateArgCount('Query.on', 2, 4, arguments.length);\r\n        validateEventType('Query.on', 1, eventType, false);\r\n        validateCallback('Query.on', 2, callback, false);\r\n        var ret = Query.getCancelAndContextArgs_('Query.on', cancelCallbackOrContext, context);\r\n        if (eventType === 'value') {\r\n            this.onValueEvent(callback, ret.cancel, ret.context);\r\n        }\r\n        else {\r\n            var callbacks = {};\r\n            callbacks[eventType] = callback;\r\n            this.onChildEvent(callbacks, ret.cancel, ret.context);\r\n        }\r\n        return callback;\r\n    };\r\n    /**\r\n     * @param {!function(!DataSnapshot)} callback\r\n     * @param {?function(Error)} cancelCallback\r\n     * @param {?Object} context\r\n     * @protected\r\n     */\r\n    Query.prototype.onValueEvent = function (callback, cancelCallback, context) {\r\n        var container = new ValueEventRegistration(callback, cancelCallback || null, context || null);\r\n        this.repo.addEventCallbackForQuery(this, container);\r\n    };\r\n    /**\r\n     * @param {!Object.<string, !function(!DataSnapshot, ?string)>} callbacks\r\n     * @param {?function(Error)} cancelCallback\r\n     * @param {?Object} context\r\n     * @protected\r\n     */\r\n    Query.prototype.onChildEvent = function (callbacks, cancelCallback, context) {\r\n        var container = new ChildEventRegistration(callbacks, cancelCallback, context);\r\n        this.repo.addEventCallbackForQuery(this, container);\r\n    };\r\n    /**\r\n     * @param {string=} eventType\r\n     * @param {(function(!DataSnapshot, ?string=))=} callback\r\n     * @param {Object=} context\r\n     */\r\n    Query.prototype.off = function (eventType, callback, context) {\r\n        validateArgCount('Query.off', 0, 3, arguments.length);\r\n        validateEventType('Query.off', 1, eventType, true);\r\n        validateCallback('Query.off', 2, callback, true);\r\n        validateContextObject('Query.off', 3, context, true);\r\n        var container = null;\r\n        var callbacks = null;\r\n        if (eventType === 'value') {\r\n            var valueCallback = callback || null;\r\n            container = new ValueEventRegistration(valueCallback, null, context || null);\r\n        }\r\n        else if (eventType) {\r\n            if (callback) {\r\n                callbacks = {};\r\n                callbacks[eventType] = callback;\r\n            }\r\n            container = new ChildEventRegistration(callbacks, null, context || null);\r\n        }\r\n        this.repo.removeEventCallbackForQuery(this, container);\r\n    };\r\n    /**\r\n     * Attaches a listener, waits for the first event, and then removes the listener\r\n     * @param {!string} eventType\r\n     * @param {!function(!DataSnapshot, string=)} userCallback\r\n     * @param cancelOrContext\r\n     * @param context\r\n     * @return {!firebase.Promise}\r\n     */\r\n    Query.prototype.once = function (eventType, userCallback, cancelOrContext, context) {\r\n        var _this = this;\r\n        validateArgCount('Query.once', 1, 4, arguments.length);\r\n        validateEventType('Query.once', 1, eventType, false);\r\n        validateCallback('Query.once', 2, userCallback, true);\r\n        var ret = Query.getCancelAndContextArgs_('Query.once', cancelOrContext, context);\r\n        // TODO: Implement this more efficiently (in particular, use 'get' wire protocol for 'value' event)\r\n        // TODO: consider actually wiring the callbacks into the promise. We cannot do this without a breaking change\r\n        // because the API currently expects callbacks will be called synchronously if the data is cached, but this is\r\n        // against the Promise specification.\r\n        var firstCall = true;\r\n        var deferred = new Deferred();\r\n        // A dummy error handler in case a user wasn't expecting promises\r\n        deferred.promise.catch(function () { });\r\n        var onceCallback = function (snapshot) {\r\n            // NOTE: Even though we unsubscribe, we may get called multiple times if a single action (e.g. set() with JSON)\r\n            // triggers multiple events (e.g. child_added or child_changed).\r\n            if (firstCall) {\r\n                firstCall = false;\r\n                _this.off(eventType, onceCallback);\r\n                if (userCallback) {\r\n                    userCallback.bind(ret.context)(snapshot);\r\n                }\r\n                deferred.resolve(snapshot);\r\n            }\r\n        };\r\n        this.on(eventType, onceCallback, \r\n        /*cancel=*/ function (err) {\r\n            _this.off(eventType, onceCallback);\r\n            if (ret.cancel)\r\n                ret.cancel.bind(ret.context)(err);\r\n            deferred.reject(err);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n    /**\r\n     * Set a limit and anchor it to the start of the window.\r\n     * @param {!number} limit\r\n     * @return {!Query}\r\n     */\r\n    Query.prototype.limitToFirst = function (limit) {\r\n        validateArgCount('Query.limitToFirst', 1, 1, arguments.length);\r\n        if (typeof limit !== 'number' ||\r\n            Math.floor(limit) !== limit ||\r\n            limit <= 0) {\r\n            throw new Error('Query.limitToFirst: First argument must be a positive integer.');\r\n        }\r\n        if (this.queryParams_.hasLimit()) {\r\n            throw new Error('Query.limitToFirst: Limit was already set (by another call to limit, ' +\r\n                'limitToFirst, or limitToLast).');\r\n        }\r\n        return new Query(this.repo, this.path, this.queryParams_.limitToFirst(limit), this.orderByCalled_);\r\n    };\r\n    /**\r\n     * Set a limit and anchor it to the end of the window.\r\n     * @param {!number} limit\r\n     * @return {!Query}\r\n     */\r\n    Query.prototype.limitToLast = function (limit) {\r\n        validateArgCount('Query.limitToLast', 1, 1, arguments.length);\r\n        if (typeof limit !== 'number' ||\r\n            Math.floor(limit) !== limit ||\r\n            limit <= 0) {\r\n            throw new Error('Query.limitToLast: First argument must be a positive integer.');\r\n        }\r\n        if (this.queryParams_.hasLimit()) {\r\n            throw new Error('Query.limitToLast: Limit was already set (by another call to limit, ' +\r\n                'limitToFirst, or limitToLast).');\r\n        }\r\n        return new Query(this.repo, this.path, this.queryParams_.limitToLast(limit), this.orderByCalled_);\r\n    };\r\n    /**\r\n     * Given a child path, return a new query ordered by the specified grandchild path.\r\n     * @param {!string} path\r\n     * @return {!Query}\r\n     */\r\n    Query.prototype.orderByChild = function (path) {\r\n        validateArgCount('Query.orderByChild', 1, 1, arguments.length);\r\n        if (path === '$key') {\r\n            throw new Error('Query.orderByChild: \"$key\" is invalid.  Use Query.orderByKey() instead.');\r\n        }\r\n        else if (path === '$priority') {\r\n            throw new Error('Query.orderByChild: \"$priority\" is invalid.  Use Query.orderByPriority() instead.');\r\n        }\r\n        else if (path === '$value') {\r\n            throw new Error('Query.orderByChild: \"$value\" is invalid.  Use Query.orderByValue() instead.');\r\n        }\r\n        validatePathString('Query.orderByChild', 1, path, false);\r\n        this.validateNoPreviousOrderByCall_('Query.orderByChild');\r\n        var parsedPath = new Path(path);\r\n        if (parsedPath.isEmpty()) {\r\n            throw new Error('Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.');\r\n        }\r\n        var index = new PathIndex(parsedPath);\r\n        var newParams = this.queryParams_.orderBy(index);\r\n        Query.validateQueryEndpoints_(newParams);\r\n        return new Query(this.repo, this.path, newParams, /*orderByCalled=*/ true);\r\n    };\r\n    /**\r\n     * Return a new query ordered by the KeyIndex\r\n     * @return {!Query}\r\n     */\r\n    Query.prototype.orderByKey = function () {\r\n        validateArgCount('Query.orderByKey', 0, 0, arguments.length);\r\n        this.validateNoPreviousOrderByCall_('Query.orderByKey');\r\n        var newParams = this.queryParams_.orderBy(KEY_INDEX);\r\n        Query.validateQueryEndpoints_(newParams);\r\n        return new Query(this.repo, this.path, newParams, /*orderByCalled=*/ true);\r\n    };\r\n    /**\r\n     * Return a new query ordered by the PriorityIndex\r\n     * @return {!Query}\r\n     */\r\n    Query.prototype.orderByPriority = function () {\r\n        validateArgCount('Query.orderByPriority', 0, 0, arguments.length);\r\n        this.validateNoPreviousOrderByCall_('Query.orderByPriority');\r\n        var newParams = this.queryParams_.orderBy(PRIORITY_INDEX);\r\n        Query.validateQueryEndpoints_(newParams);\r\n        return new Query(this.repo, this.path, newParams, /*orderByCalled=*/ true);\r\n    };\r\n    /**\r\n     * Return a new query ordered by the ValueIndex\r\n     * @return {!Query}\r\n     */\r\n    Query.prototype.orderByValue = function () {\r\n        validateArgCount('Query.orderByValue', 0, 0, arguments.length);\r\n        this.validateNoPreviousOrderByCall_('Query.orderByValue');\r\n        var newParams = this.queryParams_.orderBy(VALUE_INDEX);\r\n        Query.validateQueryEndpoints_(newParams);\r\n        return new Query(this.repo, this.path, newParams, /*orderByCalled=*/ true);\r\n    };\r\n    /**\r\n     * @param {number|string|boolean|null} value\r\n     * @param {?string=} name\r\n     * @return {!Query}\r\n     */\r\n    Query.prototype.startAt = function (value, name) {\r\n        if (value === void 0) { value = null; }\r\n        validateArgCount('Query.startAt', 0, 2, arguments.length);\r\n        validateFirebaseDataArg('Query.startAt', 1, value, this.path, true);\r\n        validateKey('Query.startAt', 2, name, true);\r\n        var newParams = this.queryParams_.startAt(value, name);\r\n        Query.validateLimit_(newParams);\r\n        Query.validateQueryEndpoints_(newParams);\r\n        if (this.queryParams_.hasStart()) {\r\n            throw new Error('Query.startAt: Starting point was already set (by another call to startAt ' +\r\n                'or equalTo).');\r\n        }\r\n        // Calling with no params tells us to start at the beginning.\r\n        if (value === undefined) {\r\n            value = null;\r\n            name = null;\r\n        }\r\n        return new Query(this.repo, this.path, newParams, this.orderByCalled_);\r\n    };\r\n    /**\r\n     * @param {number|string|boolean|null} value\r\n     * @param {?string=} name\r\n     * @return {!Query}\r\n     */\r\n    Query.prototype.endAt = function (value, name) {\r\n        if (value === void 0) { value = null; }\r\n        validateArgCount('Query.endAt', 0, 2, arguments.length);\r\n        validateFirebaseDataArg('Query.endAt', 1, value, this.path, true);\r\n        validateKey('Query.endAt', 2, name, true);\r\n        var newParams = this.queryParams_.endAt(value, name);\r\n        Query.validateLimit_(newParams);\r\n        Query.validateQueryEndpoints_(newParams);\r\n        if (this.queryParams_.hasEnd()) {\r\n            throw new Error('Query.endAt: Ending point was already set (by another call to endAt or ' +\r\n                'equalTo).');\r\n        }\r\n        return new Query(this.repo, this.path, newParams, this.orderByCalled_);\r\n    };\r\n    /**\r\n     * Load the selection of children with exactly the specified value, and, optionally,\r\n     * the specified name.\r\n     * @param {number|string|boolean|null} value\r\n     * @param {string=} name\r\n     * @return {!Query}\r\n     */\r\n    Query.prototype.equalTo = function (value, name) {\r\n        validateArgCount('Query.equalTo', 1, 2, arguments.length);\r\n        validateFirebaseDataArg('Query.equalTo', 1, value, this.path, false);\r\n        validateKey('Query.equalTo', 2, name, true);\r\n        if (this.queryParams_.hasStart()) {\r\n            throw new Error('Query.equalTo: Starting point was already set (by another call to startAt or ' +\r\n                'equalTo).');\r\n        }\r\n        if (this.queryParams_.hasEnd()) {\r\n            throw new Error('Query.equalTo: Ending point was already set (by another call to endAt or ' +\r\n                'equalTo).');\r\n        }\r\n        return this.startAt(value, name).endAt(value, name);\r\n    };\r\n    /**\r\n     * @return {!string} URL for this location.\r\n     */\r\n    Query.prototype.toString = function () {\r\n        validateArgCount('Query.toString', 0, 0, arguments.length);\r\n        return this.repo.toString() + this.path.toUrlEncodedString();\r\n    };\r\n    // Do not create public documentation. This is intended to make JSON serialization work but is otherwise unnecessary\r\n    // for end-users.\r\n    Query.prototype.toJSON = function () {\r\n        // An optional spacer argument is unnecessary for a string.\r\n        validateArgCount('Query.toJSON', 0, 1, arguments.length);\r\n        return this.toString();\r\n    };\r\n    /**\r\n     * An object representation of the query parameters used by this Query.\r\n     * @return {!Object}\r\n     */\r\n    Query.prototype.queryObject = function () {\r\n        return this.queryParams_.getQueryObject();\r\n    };\r\n    /**\r\n     * @return {!string}\r\n     */\r\n    Query.prototype.queryIdentifier = function () {\r\n        var obj = this.queryObject();\r\n        var id = ObjectToUniqueKey(obj);\r\n        return id === '{}' ? 'default' : id;\r\n    };\r\n    /**\r\n     * Return true if this query and the provided query are equivalent; otherwise, return false.\r\n     * @param {Query} other\r\n     * @return {boolean}\r\n     */\r\n    Query.prototype.isEqual = function (other) {\r\n        validateArgCount('Query.isEqual', 1, 1, arguments.length);\r\n        if (!(other instanceof Query)) {\r\n            var error$$1 = 'Query.isEqual failed: First argument must be an instance of firebase.database.Query.';\r\n            throw new Error(error$$1);\r\n        }\r\n        var sameRepo = this.repo === other.repo;\r\n        var samePath = this.path.equals(other.path);\r\n        var sameQueryIdentifier = this.queryIdentifier() === other.queryIdentifier();\r\n        return sameRepo && samePath && sameQueryIdentifier;\r\n    };\r\n    /**\r\n     * Helper used by .on and .once to extract the context and or cancel arguments.\r\n     * @param {!string} fnName The function name (on or once)\r\n     * @param {(function(Error)|Object)=} cancelOrContext\r\n     * @param {Object=} context\r\n     * @return {{cancel: ?function(Error), context: ?Object}}\r\n     * @private\r\n     */\r\n    Query.getCancelAndContextArgs_ = function (fnName, cancelOrContext, context) {\r\n        var ret = { cancel: null, context: null };\r\n        if (cancelOrContext && context) {\r\n            ret.cancel = cancelOrContext;\r\n            validateCallback(fnName, 3, ret.cancel, true);\r\n            ret.context = context;\r\n            validateContextObject(fnName, 4, ret.context, true);\r\n        }\r\n        else if (cancelOrContext) {\r\n            // we have either a cancel callback or a context.\r\n            if (typeof cancelOrContext === 'object' && cancelOrContext !== null) {\r\n                // it's a context!\r\n                ret.context = cancelOrContext;\r\n            }\r\n            else if (typeof cancelOrContext === 'function') {\r\n                ret.cancel = cancelOrContext;\r\n            }\r\n            else {\r\n                throw new Error(errorPrefix(fnName, 3, true) +\r\n                    ' must either be a cancel callback or a context object.');\r\n            }\r\n        }\r\n        return ret;\r\n    };\r\n    Object.defineProperty(Query.prototype, \"ref\", {\r\n        get: function () {\r\n            return this.getRef();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return Query;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Implements a set with a count of elements.\r\n *\r\n * @template K, V\r\n */\r\nvar CountedSet = /** @class */ (function () {\r\n    function CountedSet() {\r\n        this.set = {};\r\n    }\r\n    /**\r\n     * @param {!K} item\r\n     * @param {V} val\r\n     */\r\n    CountedSet.prototype.add = function (item, val) {\r\n        this.set[item] = val !== null ? val : true;\r\n    };\r\n    /**\r\n     * @param {!K} key\r\n     * @return {boolean}\r\n     */\r\n    CountedSet.prototype.contains = function (key) {\r\n        return contains(this.set, key);\r\n    };\r\n    /**\r\n     * @param {!K} item\r\n     * @return {V}\r\n     */\r\n    CountedSet.prototype.get = function (item) {\r\n        return this.contains(item) ? this.set[item] : undefined;\r\n    };\r\n    /**\r\n     * @param {!K} item\r\n     */\r\n    CountedSet.prototype.remove = function (item) {\r\n        delete this.set[item];\r\n    };\r\n    /**\r\n     * Deletes everything in the set\r\n     */\r\n    CountedSet.prototype.clear = function () {\r\n        this.set = {};\r\n    };\r\n    /**\r\n     * True if there's nothing in the set\r\n     * @return {boolean}\r\n     */\r\n    CountedSet.prototype.isEmpty = function () {\r\n        return isEmpty(this.set);\r\n    };\r\n    /**\r\n     * @return {number} The number of items in the set\r\n     */\r\n    CountedSet.prototype.count = function () {\r\n        return getCount(this.set);\r\n    };\r\n    /**\r\n     * Run a function on each k,v pair in the set\r\n     * @param {function(K, V)} fn\r\n     */\r\n    CountedSet.prototype.each = function (fn) {\r\n        forEach(this.set, function (k, v) { return fn(k, v); });\r\n    };\r\n    /**\r\n     * Mostly for debugging\r\n     * @return {Array.<K>} The keys present in this CountedSet\r\n     */\r\n    CountedSet.prototype.keys = function () {\r\n        var keys = [];\r\n        forEach(this.set, function (k) {\r\n            keys.push(k);\r\n        });\r\n        return keys;\r\n    };\r\n    return CountedSet;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Helper class to store a sparse set of snapshots.\r\n *\r\n * @constructor\r\n */\r\nvar SparseSnapshotTree = /** @class */ (function () {\r\n    function SparseSnapshotTree() {\r\n        /**\r\n         * @private\r\n         * @type {Node}\r\n         */\r\n        this.value_ = null;\r\n        /**\r\n         * @private\r\n         * @type {CountedSet}\r\n         */\r\n        this.children_ = null;\r\n    }\r\n    /**\r\n     * Gets the node stored at the given path if one exists.\r\n     *\r\n     * @param {!Path} path Path to look up snapshot for.\r\n     * @return {?Node} The retrieved node, or null.\r\n     */\r\n    SparseSnapshotTree.prototype.find = function (path) {\r\n        if (this.value_ != null) {\r\n            return this.value_.getChild(path);\r\n        }\r\n        else if (!path.isEmpty() && this.children_ != null) {\r\n            var childKey = path.getFront();\r\n            path = path.popFront();\r\n            if (this.children_.contains(childKey)) {\r\n                var childTree = this.children_.get(childKey);\r\n                return childTree.find(path);\r\n            }\r\n            else {\r\n                return null;\r\n            }\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    };\r\n    /**\r\n     * Stores the given node at the specified path. If there is already a node\r\n     * at a shallower path, it merges the new data into that snapshot node.\r\n     *\r\n     * @param {!Path} path Path to look up snapshot for.\r\n     * @param {!Node} data The new data, or null.\r\n     */\r\n    SparseSnapshotTree.prototype.remember = function (path, data) {\r\n        if (path.isEmpty()) {\r\n            this.value_ = data;\r\n            this.children_ = null;\r\n        }\r\n        else if (this.value_ !== null) {\r\n            this.value_ = this.value_.updateChild(path, data);\r\n        }\r\n        else {\r\n            if (this.children_ == null) {\r\n                this.children_ = new CountedSet();\r\n            }\r\n            var childKey = path.getFront();\r\n            if (!this.children_.contains(childKey)) {\r\n                this.children_.add(childKey, new SparseSnapshotTree());\r\n            }\r\n            var child = this.children_.get(childKey);\r\n            path = path.popFront();\r\n            child.remember(path, data);\r\n        }\r\n    };\r\n    /**\r\n     * Purge the data at path from the cache.\r\n     *\r\n     * @param {!Path} path Path to look up snapshot for.\r\n     * @return {boolean} True if this node should now be removed.\r\n     */\r\n    SparseSnapshotTree.prototype.forget = function (path) {\r\n        if (path.isEmpty()) {\r\n            this.value_ = null;\r\n            this.children_ = null;\r\n            return true;\r\n        }\r\n        else {\r\n            if (this.value_ !== null) {\r\n                if (this.value_.isLeafNode()) {\r\n                    // We're trying to forget a node that doesn't exist\r\n                    return false;\r\n                }\r\n                else {\r\n                    var value = this.value_;\r\n                    this.value_ = null;\r\n                    var self_1 = this;\r\n                    value.forEachChild(PRIORITY_INDEX, function (key, tree) {\r\n                        self_1.remember(new Path(key), tree);\r\n                    });\r\n                    return this.forget(path);\r\n                }\r\n            }\r\n            else if (this.children_ !== null) {\r\n                var childKey = path.getFront();\r\n                path = path.popFront();\r\n                if (this.children_.contains(childKey)) {\r\n                    var safeToRemove = this.children_.get(childKey).forget(path);\r\n                    if (safeToRemove) {\r\n                        this.children_.remove(childKey);\r\n                    }\r\n                }\r\n                if (this.children_.isEmpty()) {\r\n                    this.children_ = null;\r\n                    return true;\r\n                }\r\n                else {\r\n                    return false;\r\n                }\r\n            }\r\n            else {\r\n                return true;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Recursively iterates through all of the stored tree and calls the\r\n     * callback on each one.\r\n     *\r\n     * @param {!Path} prefixPath Path to look up node for.\r\n     * @param {!Function} func The function to invoke for each tree.\r\n     */\r\n    SparseSnapshotTree.prototype.forEachTree = function (prefixPath, func) {\r\n        if (this.value_ !== null) {\r\n            func(prefixPath, this.value_);\r\n        }\r\n        else {\r\n            this.forEachChild(function (key, tree) {\r\n                var path = new Path(prefixPath.toString() + '/' + key);\r\n                tree.forEachTree(path, func);\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * Iterates through each immediate child and triggers the callback.\r\n     *\r\n     * @param {!Function} func The function to invoke for each child.\r\n     */\r\n    SparseSnapshotTree.prototype.forEachChild = function (func) {\r\n        if (this.children_ !== null) {\r\n            this.children_.each(function (key, tree) {\r\n                func(key, tree);\r\n            });\r\n        }\r\n    };\r\n    return SparseSnapshotTree;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Generate placeholders for deferred values.\r\n * @param {?Object} values\r\n * @return {!Object}\r\n */\r\nvar generateWithValues = function (values) {\r\n    values = values || {};\r\n    values['timestamp'] = values['timestamp'] || new Date().getTime();\r\n    return values;\r\n};\r\n/**\r\n * Value to use when firing local events. When writing server values, fire\r\n * local events with an approximate value, otherwise return value as-is.\r\n * @param {(Object|string|number|boolean)} value\r\n * @param {!Object} serverValues\r\n * @return {!(string|number|boolean)}\r\n */\r\nvar resolveDeferredValue = function (value, serverValues) {\r\n    if (!value || typeof value !== 'object') {\r\n        return value;\r\n    }\r\n    else {\r\n        assert('.sv' in value, 'Unexpected leaf node or priority contents');\r\n        return serverValues[value['.sv']];\r\n    }\r\n};\r\n/**\r\n * Recursively replace all deferred values and priorities in the tree with the\r\n * specified generated replacement values.\r\n * @param {!SparseSnapshotTree} tree\r\n * @param {!Object} serverValues\r\n * @return {!SparseSnapshotTree}\r\n */\r\nvar resolveDeferredValueTree = function (tree, serverValues) {\r\n    var resolvedTree = new SparseSnapshotTree();\r\n    tree.forEachTree(new Path(''), function (path, node) {\r\n        resolvedTree.remember(path, resolveDeferredValueSnapshot(node, serverValues));\r\n    });\r\n    return resolvedTree;\r\n};\r\n/**\r\n * Recursively replace all deferred values and priorities in the node with the\r\n * specified generated replacement values.  If there are no server values in the node,\r\n * it'll be returned as-is.\r\n * @param {!Node} node\r\n * @param {!Object} serverValues\r\n * @return {!Node}\r\n */\r\nvar resolveDeferredValueSnapshot = function (node, serverValues) {\r\n    var rawPri = node.getPriority().val();\r\n    var priority = resolveDeferredValue(rawPri, serverValues);\r\n    var newNode;\r\n    if (node.isLeafNode()) {\r\n        var leafNode = node;\r\n        var value = resolveDeferredValue(leafNode.getValue(), serverValues);\r\n        if (value !== leafNode.getValue() ||\r\n            priority !== leafNode.getPriority().val()) {\r\n            return new LeafNode(value, nodeFromJSON$1(priority));\r\n        }\r\n        else {\r\n            return node;\r\n        }\r\n    }\r\n    else {\r\n        var childrenNode = node;\r\n        newNode = childrenNode;\r\n        if (priority !== childrenNode.getPriority().val()) {\r\n            newNode = newNode.updatePriority(new LeafNode(priority));\r\n        }\r\n        childrenNode.forEachChild(PRIORITY_INDEX, function (childName, childNode) {\r\n            var newChildNode = resolveDeferredValueSnapshot(childNode, serverValues);\r\n            if (newChildNode !== childNode) {\r\n                newNode = newNode.updateImmediateChild(childName, newChildNode);\r\n            }\r\n        });\r\n        return newNode;\r\n    }\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n *\r\n * @enum\r\n */\r\nvar OperationType;\r\n(function (OperationType) {\r\n    OperationType[OperationType[\"OVERWRITE\"] = 0] = \"OVERWRITE\";\r\n    OperationType[OperationType[\"MERGE\"] = 1] = \"MERGE\";\r\n    OperationType[OperationType[\"ACK_USER_WRITE\"] = 2] = \"ACK_USER_WRITE\";\r\n    OperationType[OperationType[\"LISTEN_COMPLETE\"] = 3] = \"LISTEN_COMPLETE\";\r\n})(OperationType || (OperationType = {}));\r\n/**\r\n * @param {boolean} fromUser\r\n * @param {boolean} fromServer\r\n * @param {?string} queryId\r\n * @param {boolean} tagged\r\n * @constructor\r\n */\r\nvar OperationSource = /** @class */ (function () {\r\n    function OperationSource(fromUser, fromServer, queryId, tagged) {\r\n        this.fromUser = fromUser;\r\n        this.fromServer = fromServer;\r\n        this.queryId = queryId;\r\n        this.tagged = tagged;\r\n        assert(!tagged || fromServer, 'Tagged queries must be from server.');\r\n    }\r\n    /**\r\n     * @const\r\n     * @type {!OperationSource}\r\n     */\r\n    OperationSource.User = new OperationSource(\r\n    /*fromUser=*/ true, false, null, \r\n    /*tagged=*/ false);\r\n    /**\r\n     * @const\r\n     * @type {!OperationSource}\r\n     */\r\n    OperationSource.Server = new OperationSource(false, \r\n    /*fromServer=*/ true, null, \r\n    /*tagged=*/ false);\r\n    /**\r\n     * @param {string} queryId\r\n     * @return {!OperationSource}\r\n     */\r\n    OperationSource.forServerTaggedQuery = function (queryId) {\r\n        return new OperationSource(false, \r\n        /*fromServer=*/ true, queryId, \r\n        /*tagged=*/ true);\r\n    };\r\n    return OperationSource;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar AckUserWrite = /** @class */ (function () {\r\n    /**\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!ImmutableTree<!boolean>} affectedTree A tree containing true for each affected path. Affected paths can't overlap.\r\n     * @param {!boolean} revert\r\n     */\r\n    function AckUserWrite(\r\n    /**@inheritDoc */ path, \r\n    /**@inheritDoc */ affectedTree, \r\n    /**@inheritDoc */ revert) {\r\n        this.path = path;\r\n        this.affectedTree = affectedTree;\r\n        this.revert = revert;\r\n        /** @inheritDoc */\r\n        this.type = OperationType.ACK_USER_WRITE;\r\n        /** @inheritDoc */\r\n        this.source = OperationSource.User;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    AckUserWrite.prototype.operationForChild = function (childName) {\r\n        if (!this.path.isEmpty()) {\r\n            assert(this.path.getFront() === childName, 'operationForChild called for unrelated child.');\r\n            return new AckUserWrite(this.path.popFront(), this.affectedTree, this.revert);\r\n        }\r\n        else if (this.affectedTree.value != null) {\r\n            assert(this.affectedTree.children.isEmpty(), 'affectedTree should not have overlapping affected paths.');\r\n            // All child locations are affected as well; just return same operation.\r\n            return this;\r\n        }\r\n        else {\r\n            var childTree = this.affectedTree.subtree(new Path(childName));\r\n            return new AckUserWrite(Path.Empty, childTree, this.revert);\r\n        }\r\n    };\r\n    return AckUserWrite;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar emptyChildrenSingleton;\r\n/**\r\n * Singleton empty children collection.\r\n *\r\n * @const\r\n * @type {!SortedMap.<string, !ImmutableTree.<?>>}\r\n */\r\nvar EmptyChildren = function () {\r\n    if (!emptyChildrenSingleton) {\r\n        emptyChildrenSingleton = new SortedMap(stringCompare);\r\n    }\r\n    return emptyChildrenSingleton;\r\n};\r\n/**\r\n * A tree with immutable elements.\r\n */\r\nvar ImmutableTree = /** @class */ (function () {\r\n    /**\r\n     * @template T\r\n     * @param {?T} value\r\n     * @param {SortedMap.<string, !ImmutableTree.<T>>=} children\r\n     */\r\n    function ImmutableTree(value, children) {\r\n        if (children === void 0) { children = EmptyChildren(); }\r\n        this.value = value;\r\n        this.children = children;\r\n    }\r\n    /**\r\n     * @template T\r\n     * @param {!Object.<string, !T>} obj\r\n     * @return {!ImmutableTree.<!T>}\r\n     */\r\n    ImmutableTree.fromObject = function (obj) {\r\n        var tree = ImmutableTree.Empty;\r\n        forEach(obj, function (childPath, childSnap) {\r\n            tree = tree.set(new Path(childPath), childSnap);\r\n        });\r\n        return tree;\r\n    };\r\n    /**\r\n     * True if the value is empty and there are no children\r\n     * @return {boolean}\r\n     */\r\n    ImmutableTree.prototype.isEmpty = function () {\r\n        return this.value === null && this.children.isEmpty();\r\n    };\r\n    /**\r\n     * Given a path and predicate, return the first node and the path to that node\r\n     * where the predicate returns true.\r\n     *\r\n     * TODO Do a perf test -- If we're creating a bunch of {path: value:} objects\r\n     * on the way back out, it may be better to pass down a pathSoFar obj.\r\n     *\r\n     * @param {!Path} relativePath The remainder of the path\r\n     * @param {function(T):boolean} predicate The predicate to satisfy to return a\r\n     *   node\r\n     * @return {?{path:!Path, value:!T}}\r\n     */\r\n    ImmutableTree.prototype.findRootMostMatchingPathAndValue = function (relativePath, predicate) {\r\n        if (this.value != null && predicate(this.value)) {\r\n            return { path: Path.Empty, value: this.value };\r\n        }\r\n        else {\r\n            if (relativePath.isEmpty()) {\r\n                return null;\r\n            }\r\n            else {\r\n                var front = relativePath.getFront();\r\n                var child = this.children.get(front);\r\n                if (child !== null) {\r\n                    var childExistingPathAndValue = child.findRootMostMatchingPathAndValue(relativePath.popFront(), predicate);\r\n                    if (childExistingPathAndValue != null) {\r\n                        var fullPath = new Path(front).child(childExistingPathAndValue.path);\r\n                        return { path: fullPath, value: childExistingPathAndValue.value };\r\n                    }\r\n                    else {\r\n                        return null;\r\n                    }\r\n                }\r\n                else {\r\n                    return null;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Find, if it exists, the shortest subpath of the given path that points a defined\r\n     * value in the tree\r\n     * @param {!Path} relativePath\r\n     * @return {?{path: !Path, value: !T}}\r\n     */\r\n    ImmutableTree.prototype.findRootMostValueAndPath = function (relativePath) {\r\n        return this.findRootMostMatchingPathAndValue(relativePath, function () { return true; });\r\n    };\r\n    /**\r\n     * @param {!Path} relativePath\r\n     * @return {!ImmutableTree.<T>} The subtree at the given path\r\n     */\r\n    ImmutableTree.prototype.subtree = function (relativePath) {\r\n        if (relativePath.isEmpty()) {\r\n            return this;\r\n        }\r\n        else {\r\n            var front = relativePath.getFront();\r\n            var childTree = this.children.get(front);\r\n            if (childTree !== null) {\r\n                return childTree.subtree(relativePath.popFront());\r\n            }\r\n            else {\r\n                return ImmutableTree.Empty;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Sets a value at the specified path.\r\n     *\r\n     * @param {!Path} relativePath Path to set value at.\r\n     * @param {?T} toSet Value to set.\r\n     * @return {!ImmutableTree.<T>} Resulting tree.\r\n     */\r\n    ImmutableTree.prototype.set = function (relativePath, toSet) {\r\n        if (relativePath.isEmpty()) {\r\n            return new ImmutableTree(toSet, this.children);\r\n        }\r\n        else {\r\n            var front = relativePath.getFront();\r\n            var child = this.children.get(front) || ImmutableTree.Empty;\r\n            var newChild = child.set(relativePath.popFront(), toSet);\r\n            var newChildren = this.children.insert(front, newChild);\r\n            return new ImmutableTree(this.value, newChildren);\r\n        }\r\n    };\r\n    /**\r\n     * Removes the value at the specified path.\r\n     *\r\n     * @param {!Path} relativePath Path to value to remove.\r\n     * @return {!ImmutableTree.<T>} Resulting tree.\r\n     */\r\n    ImmutableTree.prototype.remove = function (relativePath) {\r\n        if (relativePath.isEmpty()) {\r\n            if (this.children.isEmpty()) {\r\n                return ImmutableTree.Empty;\r\n            }\r\n            else {\r\n                return new ImmutableTree(null, this.children);\r\n            }\r\n        }\r\n        else {\r\n            var front = relativePath.getFront();\r\n            var child = this.children.get(front);\r\n            if (child) {\r\n                var newChild = child.remove(relativePath.popFront());\r\n                var newChildren = void 0;\r\n                if (newChild.isEmpty()) {\r\n                    newChildren = this.children.remove(front);\r\n                }\r\n                else {\r\n                    newChildren = this.children.insert(front, newChild);\r\n                }\r\n                if (this.value === null && newChildren.isEmpty()) {\r\n                    return ImmutableTree.Empty;\r\n                }\r\n                else {\r\n                    return new ImmutableTree(this.value, newChildren);\r\n                }\r\n            }\r\n            else {\r\n                return this;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Gets a value from the tree.\r\n     *\r\n     * @param {!Path} relativePath Path to get value for.\r\n     * @return {?T} Value at path, or null.\r\n     */\r\n    ImmutableTree.prototype.get = function (relativePath) {\r\n        if (relativePath.isEmpty()) {\r\n            return this.value;\r\n        }\r\n        else {\r\n            var front = relativePath.getFront();\r\n            var child = this.children.get(front);\r\n            if (child) {\r\n                return child.get(relativePath.popFront());\r\n            }\r\n            else {\r\n                return null;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Replace the subtree at the specified path with the given new tree.\r\n     *\r\n     * @param {!Path} relativePath Path to replace subtree for.\r\n     * @param {!ImmutableTree} newTree New tree.\r\n     * @return {!ImmutableTree} Resulting tree.\r\n     */\r\n    ImmutableTree.prototype.setTree = function (relativePath, newTree) {\r\n        if (relativePath.isEmpty()) {\r\n            return newTree;\r\n        }\r\n        else {\r\n            var front = relativePath.getFront();\r\n            var child = this.children.get(front) || ImmutableTree.Empty;\r\n            var newChild = child.setTree(relativePath.popFront(), newTree);\r\n            var newChildren = void 0;\r\n            if (newChild.isEmpty()) {\r\n                newChildren = this.children.remove(front);\r\n            }\r\n            else {\r\n                newChildren = this.children.insert(front, newChild);\r\n            }\r\n            return new ImmutableTree(this.value, newChildren);\r\n        }\r\n    };\r\n    /**\r\n     * Performs a depth first fold on this tree. Transforms a tree into a single\r\n     * value, given a function that operates on the path to a node, an optional\r\n     * current value, and a map of child names to folded subtrees\r\n     * @template V\r\n     * @param {function(Path, ?T, Object.<string, V>):V} fn\r\n     * @return {V}\r\n     */\r\n    ImmutableTree.prototype.fold = function (fn) {\r\n        return this.fold_(Path.Empty, fn);\r\n    };\r\n    /**\r\n     * Recursive helper for public-facing fold() method\r\n     * @template V\r\n     * @param {!Path} pathSoFar\r\n     * @param {function(Path, ?T, Object.<string, V>):V} fn\r\n     * @return {V}\r\n     * @private\r\n     */\r\n    ImmutableTree.prototype.fold_ = function (pathSoFar, fn) {\r\n        var accum = {};\r\n        this.children.inorderTraversal(function (childKey, childTree) {\r\n            accum[childKey] = childTree.fold_(pathSoFar.child(childKey), fn);\r\n        });\r\n        return fn(pathSoFar, this.value, accum);\r\n    };\r\n    /**\r\n     * Find the first matching value on the given path. Return the result of applying f to it.\r\n     * @template V\r\n     * @param {!Path} path\r\n     * @param {!function(!Path, !T):?V} f\r\n     * @return {?V}\r\n     */\r\n    ImmutableTree.prototype.findOnPath = function (path, f) {\r\n        return this.findOnPath_(path, Path.Empty, f);\r\n    };\r\n    ImmutableTree.prototype.findOnPath_ = function (pathToFollow, pathSoFar, f) {\r\n        var result = this.value ? f(pathSoFar, this.value) : false;\r\n        if (result) {\r\n            return result;\r\n        }\r\n        else {\r\n            if (pathToFollow.isEmpty()) {\r\n                return null;\r\n            }\r\n            else {\r\n                var front = pathToFollow.getFront();\r\n                var nextChild = this.children.get(front);\r\n                if (nextChild) {\r\n                    return nextChild.findOnPath_(pathToFollow.popFront(), pathSoFar.child(front), f);\r\n                }\r\n                else {\r\n                    return null;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!function(!Path, !T)} f\r\n     * @returns {!ImmutableTree.<T>}\r\n     */\r\n    ImmutableTree.prototype.foreachOnPath = function (path, f) {\r\n        return this.foreachOnPath_(path, Path.Empty, f);\r\n    };\r\n    ImmutableTree.prototype.foreachOnPath_ = function (pathToFollow, currentRelativePath, f) {\r\n        if (pathToFollow.isEmpty()) {\r\n            return this;\r\n        }\r\n        else {\r\n            if (this.value) {\r\n                f(currentRelativePath, this.value);\r\n            }\r\n            var front = pathToFollow.getFront();\r\n            var nextChild = this.children.get(front);\r\n            if (nextChild) {\r\n                return nextChild.foreachOnPath_(pathToFollow.popFront(), currentRelativePath.child(front), f);\r\n            }\r\n            else {\r\n                return ImmutableTree.Empty;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Calls the given function for each node in the tree that has a value.\r\n     *\r\n     * @param {function(!Path, !T)} f A function to be called with\r\n     *   the path from the root of the tree to a node, and the value at that node.\r\n     *   Called in depth-first order.\r\n     */\r\n    ImmutableTree.prototype.foreach = function (f) {\r\n        this.foreach_(Path.Empty, f);\r\n    };\r\n    ImmutableTree.prototype.foreach_ = function (currentRelativePath, f) {\r\n        this.children.inorderTraversal(function (childName, childTree) {\r\n            childTree.foreach_(currentRelativePath.child(childName), f);\r\n        });\r\n        if (this.value) {\r\n            f(currentRelativePath, this.value);\r\n        }\r\n    };\r\n    /**\r\n     *\r\n     * @param {function(string, !T)} f\r\n     */\r\n    ImmutableTree.prototype.foreachChild = function (f) {\r\n        this.children.inorderTraversal(function (childName, childTree) {\r\n            if (childTree.value) {\r\n                f(childName, childTree.value);\r\n            }\r\n        });\r\n    };\r\n    ImmutableTree.Empty = new ImmutableTree(null);\r\n    return ImmutableTree;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @param {!OperationSource} source\r\n * @param {!Path} path\r\n * @constructor\r\n * @implements {Operation}\r\n */\r\nvar ListenComplete = /** @class */ (function () {\r\n    function ListenComplete(source, path) {\r\n        this.source = source;\r\n        this.path = path;\r\n        /** @inheritDoc */\r\n        this.type = OperationType.LISTEN_COMPLETE;\r\n    }\r\n    ListenComplete.prototype.operationForChild = function (childName) {\r\n        if (this.path.isEmpty()) {\r\n            return new ListenComplete(this.source, Path.Empty);\r\n        }\r\n        else {\r\n            return new ListenComplete(this.source, this.path.popFront());\r\n        }\r\n    };\r\n    return ListenComplete;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @param {!OperationSource} source\r\n * @param {!Path} path\r\n * @param {!Node} snap\r\n * @constructor\r\n * @implements {Operation}\r\n */\r\nvar Overwrite = /** @class */ (function () {\r\n    function Overwrite(source, path, snap) {\r\n        this.source = source;\r\n        this.path = path;\r\n        this.snap = snap;\r\n        /** @inheritDoc */\r\n        this.type = OperationType.OVERWRITE;\r\n    }\r\n    Overwrite.prototype.operationForChild = function (childName) {\r\n        if (this.path.isEmpty()) {\r\n            return new Overwrite(this.source, Path.Empty, this.snap.getImmediateChild(childName));\r\n        }\r\n        else {\r\n            return new Overwrite(this.source, this.path.popFront(), this.snap);\r\n        }\r\n    };\r\n    return Overwrite;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @param {!OperationSource} source\r\n * @param {!Path} path\r\n * @param {!ImmutableTree.<!Node>} children\r\n * @constructor\r\n * @implements {Operation}\r\n */\r\nvar Merge = /** @class */ (function () {\r\n    function Merge(\r\n    /**@inheritDoc */ source, \r\n    /**@inheritDoc */ path, \r\n    /**@inheritDoc */ children) {\r\n        this.source = source;\r\n        this.path = path;\r\n        this.children = children;\r\n        /** @inheritDoc */\r\n        this.type = OperationType.MERGE;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    Merge.prototype.operationForChild = function (childName) {\r\n        if (this.path.isEmpty()) {\r\n            var childTree = this.children.subtree(new Path(childName));\r\n            if (childTree.isEmpty()) {\r\n                // This child is unaffected\r\n                return null;\r\n            }\r\n            else if (childTree.value) {\r\n                // We have a snapshot for the child in question.  This becomes an overwrite of the child.\r\n                return new Overwrite(this.source, Path.Empty, childTree.value);\r\n            }\r\n            else {\r\n                // This is a merge at a deeper level\r\n                return new Merge(this.source, Path.Empty, childTree);\r\n            }\r\n        }\r\n        else {\r\n            assert(this.path.getFront() === childName, \"Can't get a merge for a child not on the path of the operation\");\r\n            return new Merge(this.source, this.path.popFront(), this.children);\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    Merge.prototype.toString = function () {\r\n        return ('Operation(' +\r\n            this.path +\r\n            ': ' +\r\n            this.source.toString() +\r\n            ' merge: ' +\r\n            this.children.toString() +\r\n            ')');\r\n    };\r\n    return Merge;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * A cache node only stores complete children. Additionally it holds a flag whether the node can be considered fully\r\n * initialized in the sense that we know at one point in time this represented a valid state of the world, e.g.\r\n * initialized with data from the server, or a complete overwrite by the client. The filtered flag also tracks\r\n * whether a node potentially had children removed due to a filter.\r\n */\r\nvar CacheNode = /** @class */ (function () {\r\n    /**\r\n     * @param {!Node} node_\r\n     * @param {boolean} fullyInitialized_\r\n     * @param {boolean} filtered_\r\n     */\r\n    function CacheNode(node_, fullyInitialized_, filtered_) {\r\n        this.node_ = node_;\r\n        this.fullyInitialized_ = fullyInitialized_;\r\n        this.filtered_ = filtered_;\r\n    }\r\n    /**\r\n     * Returns whether this node was fully initialized with either server data or a complete overwrite by the client\r\n     * @return {boolean}\r\n     */\r\n    CacheNode.prototype.isFullyInitialized = function () {\r\n        return this.fullyInitialized_;\r\n    };\r\n    /**\r\n     * Returns whether this node is potentially missing children due to a filter applied to the node\r\n     * @return {boolean}\r\n     */\r\n    CacheNode.prototype.isFiltered = function () {\r\n        return this.filtered_;\r\n    };\r\n    /**\r\n     * @param {!Path} path\r\n     * @return {boolean}\r\n     */\r\n    CacheNode.prototype.isCompleteForPath = function (path) {\r\n        if (path.isEmpty()) {\r\n            return this.isFullyInitialized() && !this.filtered_;\r\n        }\r\n        var childKey = path.getFront();\r\n        return this.isCompleteForChild(childKey);\r\n    };\r\n    /**\r\n     * @param {!string} key\r\n     * @return {boolean}\r\n     */\r\n    CacheNode.prototype.isCompleteForChild = function (key) {\r\n        return ((this.isFullyInitialized() && !this.filtered_) || this.node_.hasChild(key));\r\n    };\r\n    /**\r\n     * @return {!Node}\r\n     */\r\n    CacheNode.prototype.getNode = function () {\r\n        return this.node_;\r\n    };\r\n    return CacheNode;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Stores the data we have cached for a view.\r\n *\r\n * serverSnap is the cached server data, eventSnap is the cached event data (server data plus any local writes).\r\n *\r\n * @constructor\r\n */\r\nvar ViewCache = /** @class */ (function () {\r\n    /**\r\n     *\r\n     * @param {!CacheNode} eventCache_\r\n     * @param {!CacheNode} serverCache_\r\n     */\r\n    function ViewCache(eventCache_, serverCache_) {\r\n        this.eventCache_ = eventCache_;\r\n        this.serverCache_ = serverCache_;\r\n    }\r\n    /**\r\n     * @param {!Node} eventSnap\r\n     * @param {boolean} complete\r\n     * @param {boolean} filtered\r\n     * @return {!ViewCache}\r\n     */\r\n    ViewCache.prototype.updateEventSnap = function (eventSnap, complete, filtered) {\r\n        return new ViewCache(new CacheNode(eventSnap, complete, filtered), this.serverCache_);\r\n    };\r\n    /**\r\n     * @param {!Node} serverSnap\r\n     * @param {boolean} complete\r\n     * @param {boolean} filtered\r\n     * @return {!ViewCache}\r\n     */\r\n    ViewCache.prototype.updateServerSnap = function (serverSnap, complete, filtered) {\r\n        return new ViewCache(this.eventCache_, new CacheNode(serverSnap, complete, filtered));\r\n    };\r\n    /**\r\n     * @return {!CacheNode}\r\n     */\r\n    ViewCache.prototype.getEventCache = function () {\r\n        return this.eventCache_;\r\n    };\r\n    /**\r\n     * @return {?Node}\r\n     */\r\n    ViewCache.prototype.getCompleteEventSnap = function () {\r\n        return this.eventCache_.isFullyInitialized()\r\n            ? this.eventCache_.getNode()\r\n            : null;\r\n    };\r\n    /**\r\n     * @return {!CacheNode}\r\n     */\r\n    ViewCache.prototype.getServerCache = function () {\r\n        return this.serverCache_;\r\n    };\r\n    /**\r\n     * @return {?Node}\r\n     */\r\n    ViewCache.prototype.getCompleteServerSnap = function () {\r\n        return this.serverCache_.isFullyInitialized()\r\n            ? this.serverCache_.getNode()\r\n            : null;\r\n    };\r\n    /**\r\n     * @const\r\n     * @type {ViewCache}\r\n     */\r\n    ViewCache.Empty = new ViewCache(new CacheNode(ChildrenNode.EMPTY_NODE, \r\n    /*fullyInitialized=*/ false, \r\n    /*filtered=*/ false), new CacheNode(ChildrenNode.EMPTY_NODE, \r\n    /*fullyInitialized=*/ false, \r\n    /*filtered=*/ false));\r\n    return ViewCache;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @constructor\r\n * @struct\r\n * @param {!string} type The event type\r\n * @param {!Node} snapshotNode The data\r\n * @param {string=} childName The name for this child, if it's a child event\r\n * @param {Node=} oldSnap Used for intermediate processing of child changed events\r\n * @param {string=} prevName The name for the previous child, if applicable\r\n */\r\nvar Change = /** @class */ (function () {\r\n    function Change(type, snapshotNode, childName, oldSnap, prevName) {\r\n        this.type = type;\r\n        this.snapshotNode = snapshotNode;\r\n        this.childName = childName;\r\n        this.oldSnap = oldSnap;\r\n        this.prevName = prevName;\r\n    }\r\n    /**\r\n     * @param {!Node} snapshot\r\n     * @return {!Change}\r\n     */\r\n    Change.valueChange = function (snapshot) {\r\n        return new Change(Change.VALUE, snapshot);\r\n    };\r\n    /**\r\n     * @param {string} childKey\r\n     * @param {!Node} snapshot\r\n     * @return {!Change}\r\n     */\r\n    Change.childAddedChange = function (childKey, snapshot) {\r\n        return new Change(Change.CHILD_ADDED, snapshot, childKey);\r\n    };\r\n    /**\r\n     * @param {string} childKey\r\n     * @param {!Node} snapshot\r\n     * @return {!Change}\r\n     */\r\n    Change.childRemovedChange = function (childKey, snapshot) {\r\n        return new Change(Change.CHILD_REMOVED, snapshot, childKey);\r\n    };\r\n    /**\r\n     * @param {string} childKey\r\n     * @param {!Node} newSnapshot\r\n     * @param {!Node} oldSnapshot\r\n     * @return {!Change}\r\n     */\r\n    Change.childChangedChange = function (childKey, newSnapshot, oldSnapshot) {\r\n        return new Change(Change.CHILD_CHANGED, newSnapshot, childKey, oldSnapshot);\r\n    };\r\n    /**\r\n     * @param {string} childKey\r\n     * @param {!Node} snapshot\r\n     * @return {!Change}\r\n     */\r\n    Change.childMovedChange = function (childKey, snapshot) {\r\n        return new Change(Change.CHILD_MOVED, snapshot, childKey);\r\n    };\r\n    //event types\r\n    /** Event type for a child added */\r\n    Change.CHILD_ADDED = 'child_added';\r\n    /** Event type for a child removed */\r\n    Change.CHILD_REMOVED = 'child_removed';\r\n    /** Event type for a child changed */\r\n    Change.CHILD_CHANGED = 'child_changed';\r\n    /** Event type for a child moved */\r\n    Change.CHILD_MOVED = 'child_moved';\r\n    /** Event type for a value change */\r\n    Change.VALUE = 'value';\r\n    return Change;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Doesn't really filter nodes but applies an index to the node and keeps track of any changes\r\n *\r\n * @constructor\r\n * @implements {NodeFilter}\r\n * @param {!Index} index\r\n */\r\nvar IndexedFilter = /** @class */ (function () {\r\n    function IndexedFilter(index_) {\r\n        this.index_ = index_;\r\n    }\r\n    IndexedFilter.prototype.updateChild = function (snap, key, newChild, affectedPath, source, optChangeAccumulator) {\r\n        assert(snap.isIndexed(this.index_), 'A node must be indexed if only a child is updated');\r\n        var oldChild = snap.getImmediateChild(key);\r\n        // Check if anything actually changed.\r\n        if (oldChild.getChild(affectedPath).equals(newChild.getChild(affectedPath))) {\r\n            // There's an edge case where a child can enter or leave the view because affectedPath was set to null.\r\n            // In this case, affectedPath will appear null in both the old and new snapshots.  So we need\r\n            // to avoid treating these cases as \"nothing changed.\"\r\n            if (oldChild.isEmpty() == newChild.isEmpty()) {\r\n                // Nothing changed.\r\n                // This assert should be valid, but it's expensive (can dominate perf testing) so don't actually do it.\r\n                //assert(oldChild.equals(newChild), 'Old and new snapshots should be equal.');\r\n                return snap;\r\n            }\r\n        }\r\n        if (optChangeAccumulator != null) {\r\n            if (newChild.isEmpty()) {\r\n                if (snap.hasChild(key)) {\r\n                    optChangeAccumulator.trackChildChange(Change.childRemovedChange(key, oldChild));\r\n                }\r\n                else {\r\n                    assert(snap.isLeafNode(), 'A child remove without an old child only makes sense on a leaf node');\r\n                }\r\n            }\r\n            else if (oldChild.isEmpty()) {\r\n                optChangeAccumulator.trackChildChange(Change.childAddedChange(key, newChild));\r\n            }\r\n            else {\r\n                optChangeAccumulator.trackChildChange(Change.childChangedChange(key, newChild, oldChild));\r\n            }\r\n        }\r\n        if (snap.isLeafNode() && newChild.isEmpty()) {\r\n            return snap;\r\n        }\r\n        else {\r\n            // Make sure the node is indexed\r\n            return snap.updateImmediateChild(key, newChild).withIndex(this.index_);\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    IndexedFilter.prototype.updateFullNode = function (oldSnap, newSnap, optChangeAccumulator) {\r\n        if (optChangeAccumulator != null) {\r\n            if (!oldSnap.isLeafNode()) {\r\n                oldSnap.forEachChild(PRIORITY_INDEX, function (key, childNode) {\r\n                    if (!newSnap.hasChild(key)) {\r\n                        optChangeAccumulator.trackChildChange(Change.childRemovedChange(key, childNode));\r\n                    }\r\n                });\r\n            }\r\n            if (!newSnap.isLeafNode()) {\r\n                newSnap.forEachChild(PRIORITY_INDEX, function (key, childNode) {\r\n                    if (oldSnap.hasChild(key)) {\r\n                        var oldChild = oldSnap.getImmediateChild(key);\r\n                        if (!oldChild.equals(childNode)) {\r\n                            optChangeAccumulator.trackChildChange(Change.childChangedChange(key, childNode, oldChild));\r\n                        }\r\n                    }\r\n                    else {\r\n                        optChangeAccumulator.trackChildChange(Change.childAddedChange(key, childNode));\r\n                    }\r\n                });\r\n            }\r\n        }\r\n        return newSnap.withIndex(this.index_);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    IndexedFilter.prototype.updatePriority = function (oldSnap, newPriority) {\r\n        if (oldSnap.isEmpty()) {\r\n            return ChildrenNode.EMPTY_NODE;\r\n        }\r\n        else {\r\n            return oldSnap.updatePriority(newPriority);\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    IndexedFilter.prototype.filtersNodes = function () {\r\n        return false;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    IndexedFilter.prototype.getIndexedFilter = function () {\r\n        return this;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    IndexedFilter.prototype.getIndex = function () {\r\n        return this.index_;\r\n    };\r\n    return IndexedFilter;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @constructor\r\n */\r\nvar ChildChangeAccumulator = /** @class */ (function () {\r\n    function ChildChangeAccumulator() {\r\n        this.changeMap_ = {};\r\n    }\r\n    /**\r\n     * @param {!Change} change\r\n     */\r\n    ChildChangeAccumulator.prototype.trackChildChange = function (change) {\r\n        var type = change.type;\r\n        var childKey /** @type {!string} */ = change.childName;\r\n        assert(type == Change.CHILD_ADDED ||\r\n            type == Change.CHILD_CHANGED ||\r\n            type == Change.CHILD_REMOVED, 'Only child changes supported for tracking');\r\n        assert(childKey !== '.priority', 'Only non-priority child changes can be tracked.');\r\n        var oldChange = safeGet(this.changeMap_, childKey);\r\n        if (oldChange) {\r\n            var oldType = oldChange.type;\r\n            if (type == Change.CHILD_ADDED && oldType == Change.CHILD_REMOVED) {\r\n                this.changeMap_[childKey] = Change.childChangedChange(childKey, change.snapshotNode, oldChange.snapshotNode);\r\n            }\r\n            else if (type == Change.CHILD_REMOVED &&\r\n                oldType == Change.CHILD_ADDED) {\r\n                delete this.changeMap_[childKey];\r\n            }\r\n            else if (type == Change.CHILD_REMOVED &&\r\n                oldType == Change.CHILD_CHANGED) {\r\n                this.changeMap_[childKey] = Change.childRemovedChange(childKey, oldChange.oldSnap);\r\n            }\r\n            else if (type == Change.CHILD_CHANGED &&\r\n                oldType == Change.CHILD_ADDED) {\r\n                this.changeMap_[childKey] = Change.childAddedChange(childKey, change.snapshotNode);\r\n            }\r\n            else if (type == Change.CHILD_CHANGED &&\r\n                oldType == Change.CHILD_CHANGED) {\r\n                this.changeMap_[childKey] = Change.childChangedChange(childKey, change.snapshotNode, oldChange.oldSnap);\r\n            }\r\n            else {\r\n                throw assertionError('Illegal combination of changes: ' +\r\n                    change +\r\n                    ' occurred after ' +\r\n                    oldChange);\r\n            }\r\n        }\r\n        else {\r\n            this.changeMap_[childKey] = change;\r\n        }\r\n    };\r\n    /**\r\n     * @return {!Array.<!Change>}\r\n     */\r\n    ChildChangeAccumulator.prototype.getChanges = function () {\r\n        return getValues(this.changeMap_);\r\n    };\r\n    return ChildChangeAccumulator;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * An implementation of CompleteChildSource that never returns any additional children\r\n *\r\n * @private\r\n * @constructor\r\n * @implements CompleteChildSource\r\n */\r\nvar NoCompleteChildSource_ = /** @class */ (function () {\r\n    function NoCompleteChildSource_() {\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    NoCompleteChildSource_.prototype.getCompleteChild = function (childKey) {\r\n        return null;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    NoCompleteChildSource_.prototype.getChildAfterChild = function (index, child, reverse) {\r\n        return null;\r\n    };\r\n    return NoCompleteChildSource_;\r\n}());\r\n/**\r\n * Singleton instance.\r\n * @const\r\n * @type {!CompleteChildSource}\r\n */\r\nvar NO_COMPLETE_CHILD_SOURCE = new NoCompleteChildSource_();\r\n/**\r\n * An implementation of CompleteChildSource that uses a WriteTree in addition to any other server data or\r\n * old event caches available to calculate complete children.\r\n *\r\n *\r\n * @implements CompleteChildSource\r\n */\r\nvar WriteTreeCompleteChildSource = /** @class */ (function () {\r\n    /**\r\n     * @param {!WriteTreeRef} writes_\r\n     * @param {!ViewCache} viewCache_\r\n     * @param {?Node} optCompleteServerCache_\r\n     */\r\n    function WriteTreeCompleteChildSource(writes_, viewCache_, optCompleteServerCache_) {\r\n        if (optCompleteServerCache_ === void 0) { optCompleteServerCache_ = null; }\r\n        this.writes_ = writes_;\r\n        this.viewCache_ = viewCache_;\r\n        this.optCompleteServerCache_ = optCompleteServerCache_;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    WriteTreeCompleteChildSource.prototype.getCompleteChild = function (childKey) {\r\n        var node = this.viewCache_.getEventCache();\r\n        if (node.isCompleteForChild(childKey)) {\r\n            return node.getNode().getImmediateChild(childKey);\r\n        }\r\n        else {\r\n            var serverNode = this.optCompleteServerCache_ != null\r\n                ? new CacheNode(this.optCompleteServerCache_, true, false)\r\n                : this.viewCache_.getServerCache();\r\n            return this.writes_.calcCompleteChild(childKey, serverNode);\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    WriteTreeCompleteChildSource.prototype.getChildAfterChild = function (index, child, reverse) {\r\n        var completeServerData = this.optCompleteServerCache_ != null\r\n            ? this.optCompleteServerCache_\r\n            : this.viewCache_.getCompleteServerSnap();\r\n        var nodes = this.writes_.calcIndexedSlice(completeServerData, child, 1, reverse, index);\r\n        if (nodes.length === 0) {\r\n            return null;\r\n        }\r\n        else {\r\n            return nodes[0];\r\n        }\r\n    };\r\n    return WriteTreeCompleteChildSource;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @constructor\r\n * @struct\r\n */\r\nvar ProcessorResult = /** @class */ (function () {\r\n    /**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {!Array.<!Change>} changes\r\n     */\r\n    function ProcessorResult(viewCache, changes) {\r\n        this.viewCache = viewCache;\r\n        this.changes = changes;\r\n    }\r\n    return ProcessorResult;\r\n}());\r\n/**\r\n * @constructor\r\n */\r\nvar ViewProcessor = /** @class */ (function () {\r\n    /**\r\n     * @param {!NodeFilter} filter_\r\n     */\r\n    function ViewProcessor(filter_) {\r\n        this.filter_ = filter_;\r\n    }\r\n    /**\r\n     * @param {!ViewCache} viewCache\r\n     */\r\n    ViewProcessor.prototype.assertIndexed = function (viewCache) {\r\n        assert(viewCache\r\n            .getEventCache()\r\n            .getNode()\r\n            .isIndexed(this.filter_.getIndex()), 'Event snap not indexed');\r\n        assert(viewCache\r\n            .getServerCache()\r\n            .getNode()\r\n            .isIndexed(this.filter_.getIndex()), 'Server snap not indexed');\r\n    };\r\n    /**\r\n     * @param {!ViewCache} oldViewCache\r\n     * @param {!Operation} operation\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} completeCache\r\n     * @return {!ProcessorResult}\r\n     */\r\n    ViewProcessor.prototype.applyOperation = function (oldViewCache, operation, writesCache, completeCache) {\r\n        var accumulator = new ChildChangeAccumulator();\r\n        var newViewCache, filterServerNode;\r\n        if (operation.type === OperationType.OVERWRITE) {\r\n            var overwrite = operation;\r\n            if (overwrite.source.fromUser) {\r\n                newViewCache = this.applyUserOverwrite_(oldViewCache, overwrite.path, overwrite.snap, writesCache, completeCache, accumulator);\r\n            }\r\n            else {\r\n                assert(overwrite.source.fromServer, 'Unknown source.');\r\n                // We filter the node if it's a tagged update or the node has been previously filtered  and the\r\n                // update is not at the root in which case it is ok (and necessary) to mark the node unfiltered\r\n                // again\r\n                filterServerNode =\r\n                    overwrite.source.tagged ||\r\n                        (oldViewCache.getServerCache().isFiltered() &&\r\n                            !overwrite.path.isEmpty());\r\n                newViewCache = this.applyServerOverwrite_(oldViewCache, overwrite.path, overwrite.snap, writesCache, completeCache, filterServerNode, accumulator);\r\n            }\r\n        }\r\n        else if (operation.type === OperationType.MERGE) {\r\n            var merge = operation;\r\n            if (merge.source.fromUser) {\r\n                newViewCache = this.applyUserMerge_(oldViewCache, merge.path, merge.children, writesCache, completeCache, accumulator);\r\n            }\r\n            else {\r\n                assert(merge.source.fromServer, 'Unknown source.');\r\n                // We filter the node if it's a tagged update or the node has been previously filtered\r\n                filterServerNode =\r\n                    merge.source.tagged || oldViewCache.getServerCache().isFiltered();\r\n                newViewCache = this.applyServerMerge_(oldViewCache, merge.path, merge.children, writesCache, completeCache, filterServerNode, accumulator);\r\n            }\r\n        }\r\n        else if (operation.type === OperationType.ACK_USER_WRITE) {\r\n            var ackUserWrite = operation;\r\n            if (!ackUserWrite.revert) {\r\n                newViewCache = this.ackUserWrite_(oldViewCache, ackUserWrite.path, ackUserWrite.affectedTree, writesCache, completeCache, accumulator);\r\n            }\r\n            else {\r\n                newViewCache = this.revertUserWrite_(oldViewCache, ackUserWrite.path, writesCache, completeCache, accumulator);\r\n            }\r\n        }\r\n        else if (operation.type === OperationType.LISTEN_COMPLETE) {\r\n            newViewCache = this.listenComplete_(oldViewCache, operation.path, writesCache, accumulator);\r\n        }\r\n        else {\r\n            throw assertionError('Unknown operation type: ' + operation.type);\r\n        }\r\n        var changes = accumulator.getChanges();\r\n        ViewProcessor.maybeAddValueEvent_(oldViewCache, newViewCache, changes);\r\n        return new ProcessorResult(newViewCache, changes);\r\n    };\r\n    /**\r\n     * @param {!ViewCache} oldViewCache\r\n     * @param {!ViewCache} newViewCache\r\n     * @param {!Array.<!Change>} accumulator\r\n     * @private\r\n     */\r\n    ViewProcessor.maybeAddValueEvent_ = function (oldViewCache, newViewCache, accumulator) {\r\n        var eventSnap = newViewCache.getEventCache();\r\n        if (eventSnap.isFullyInitialized()) {\r\n            var isLeafOrEmpty = eventSnap.getNode().isLeafNode() || eventSnap.getNode().isEmpty();\r\n            var oldCompleteSnap = oldViewCache.getCompleteEventSnap();\r\n            if (accumulator.length > 0 ||\r\n                !oldViewCache.getEventCache().isFullyInitialized() ||\r\n                (isLeafOrEmpty &&\r\n                    !eventSnap\r\n                        .getNode()\r\n                        .equals(/** @type {!Node} */ (oldCompleteSnap))) ||\r\n                !eventSnap\r\n                    .getNode()\r\n                    .getPriority()\r\n                    .equals(oldCompleteSnap.getPriority())) {\r\n                accumulator.push(Change.valueChange(\r\n                /** @type {!Node} */ newViewCache.getCompleteEventSnap()));\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {!Path} changePath\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {!CompleteChildSource} source\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\r\n    ViewProcessor.prototype.generateEventCacheAfterServerEvent_ = function (viewCache, changePath, writesCache, source, accumulator) {\r\n        var oldEventSnap = viewCache.getEventCache();\r\n        if (writesCache.shadowingWrite(changePath) != null) {\r\n            // we have a shadowing write, ignore changes\r\n            return viewCache;\r\n        }\r\n        else {\r\n            var newEventCache = void 0, serverNode = void 0;\r\n            if (changePath.isEmpty()) {\r\n                // TODO: figure out how this plays with \"sliding ack windows\"\r\n                assert(viewCache.getServerCache().isFullyInitialized(), 'If change path is empty, we must have complete server data');\r\n                if (viewCache.getServerCache().isFiltered()) {\r\n                    // We need to special case this, because we need to only apply writes to complete children, or\r\n                    // we might end up raising events for incomplete children. If the server data is filtered deep\r\n                    // writes cannot be guaranteed to be complete\r\n                    var serverCache = viewCache.getCompleteServerSnap();\r\n                    var completeChildren = serverCache instanceof ChildrenNode\r\n                        ? serverCache\r\n                        : ChildrenNode.EMPTY_NODE;\r\n                    var completeEventChildren = writesCache.calcCompleteEventChildren(completeChildren);\r\n                    newEventCache = this.filter_.updateFullNode(viewCache.getEventCache().getNode(), completeEventChildren, accumulator);\r\n                }\r\n                else {\r\n                    var completeNode = writesCache.calcCompleteEventCache(viewCache.getCompleteServerSnap());\r\n                    newEventCache = this.filter_.updateFullNode(viewCache.getEventCache().getNode(), completeNode, accumulator);\r\n                }\r\n            }\r\n            else {\r\n                var childKey = changePath.getFront();\r\n                if (childKey == '.priority') {\r\n                    assert(changePath.getLength() == 1, \"Can't have a priority with additional path components\");\r\n                    var oldEventNode = oldEventSnap.getNode();\r\n                    serverNode = viewCache.getServerCache().getNode();\r\n                    // we might have overwrites for this priority\r\n                    var updatedPriority = writesCache.calcEventCacheAfterServerOverwrite(changePath, oldEventNode, serverNode);\r\n                    if (updatedPriority != null) {\r\n                        newEventCache = this.filter_.updatePriority(oldEventNode, updatedPriority);\r\n                    }\r\n                    else {\r\n                        // priority didn't change, keep old node\r\n                        newEventCache = oldEventSnap.getNode();\r\n                    }\r\n                }\r\n                else {\r\n                    var childChangePath = changePath.popFront();\r\n                    // update child\r\n                    var newEventChild = void 0;\r\n                    if (oldEventSnap.isCompleteForChild(childKey)) {\r\n                        serverNode = viewCache.getServerCache().getNode();\r\n                        var eventChildUpdate = writesCache.calcEventCacheAfterServerOverwrite(changePath, oldEventSnap.getNode(), serverNode);\r\n                        if (eventChildUpdate != null) {\r\n                            newEventChild = oldEventSnap\r\n                                .getNode()\r\n                                .getImmediateChild(childKey)\r\n                                .updateChild(childChangePath, eventChildUpdate);\r\n                        }\r\n                        else {\r\n                            // Nothing changed, just keep the old child\r\n                            newEventChild = oldEventSnap\r\n                                .getNode()\r\n                                .getImmediateChild(childKey);\r\n                        }\r\n                    }\r\n                    else {\r\n                        newEventChild = writesCache.calcCompleteChild(childKey, viewCache.getServerCache());\r\n                    }\r\n                    if (newEventChild != null) {\r\n                        newEventCache = this.filter_.updateChild(oldEventSnap.getNode(), childKey, newEventChild, childChangePath, source, accumulator);\r\n                    }\r\n                    else {\r\n                        // no complete child available or no change\r\n                        newEventCache = oldEventSnap.getNode();\r\n                    }\r\n                }\r\n            }\r\n            return viewCache.updateEventSnap(newEventCache, oldEventSnap.isFullyInitialized() || changePath.isEmpty(), this.filter_.filtersNodes());\r\n        }\r\n    };\r\n    /**\r\n     * @param {!ViewCache} oldViewCache\r\n     * @param {!Path} changePath\r\n     * @param {!Node} changedSnap\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} completeCache\r\n     * @param {boolean} filterServerNode\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\r\n    ViewProcessor.prototype.applyServerOverwrite_ = function (oldViewCache, changePath, changedSnap, writesCache, completeCache, filterServerNode, accumulator) {\r\n        var oldServerSnap = oldViewCache.getServerCache();\r\n        var newServerCache;\r\n        var serverFilter = filterServerNode\r\n            ? this.filter_\r\n            : this.filter_.getIndexedFilter();\r\n        if (changePath.isEmpty()) {\r\n            newServerCache = serverFilter.updateFullNode(oldServerSnap.getNode(), changedSnap, null);\r\n        }\r\n        else if (serverFilter.filtersNodes() && !oldServerSnap.isFiltered()) {\r\n            // we want to filter the server node, but we didn't filter the server node yet, so simulate a full update\r\n            var newServerNode = oldServerSnap\r\n                .getNode()\r\n                .updateChild(changePath, changedSnap);\r\n            newServerCache = serverFilter.updateFullNode(oldServerSnap.getNode(), newServerNode, null);\r\n        }\r\n        else {\r\n            var childKey = changePath.getFront();\r\n            if (!oldServerSnap.isCompleteForPath(changePath) &&\r\n                changePath.getLength() > 1) {\r\n                // We don't update incomplete nodes with updates intended for other listeners\r\n                return oldViewCache;\r\n            }\r\n            var childChangePath = changePath.popFront();\r\n            var childNode = oldServerSnap.getNode().getImmediateChild(childKey);\r\n            var newChildNode = childNode.updateChild(childChangePath, changedSnap);\r\n            if (childKey == '.priority') {\r\n                newServerCache = serverFilter.updatePriority(oldServerSnap.getNode(), newChildNode);\r\n            }\r\n            else {\r\n                newServerCache = serverFilter.updateChild(oldServerSnap.getNode(), childKey, newChildNode, childChangePath, NO_COMPLETE_CHILD_SOURCE, null);\r\n            }\r\n        }\r\n        var newViewCache = oldViewCache.updateServerSnap(newServerCache, oldServerSnap.isFullyInitialized() || changePath.isEmpty(), serverFilter.filtersNodes());\r\n        var source = new WriteTreeCompleteChildSource(writesCache, newViewCache, completeCache);\r\n        return this.generateEventCacheAfterServerEvent_(newViewCache, changePath, writesCache, source, accumulator);\r\n    };\r\n    /**\r\n     * @param {!ViewCache} oldViewCache\r\n     * @param {!Path} changePath\r\n     * @param {!Node} changedSnap\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} completeCache\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\r\n    ViewProcessor.prototype.applyUserOverwrite_ = function (oldViewCache, changePath, changedSnap, writesCache, completeCache, accumulator) {\r\n        var oldEventSnap = oldViewCache.getEventCache();\r\n        var newViewCache, newEventCache;\r\n        var source = new WriteTreeCompleteChildSource(writesCache, oldViewCache, completeCache);\r\n        if (changePath.isEmpty()) {\r\n            newEventCache = this.filter_.updateFullNode(oldViewCache.getEventCache().getNode(), changedSnap, accumulator);\r\n            newViewCache = oldViewCache.updateEventSnap(newEventCache, true, this.filter_.filtersNodes());\r\n        }\r\n        else {\r\n            var childKey = changePath.getFront();\r\n            if (childKey === '.priority') {\r\n                newEventCache = this.filter_.updatePriority(oldViewCache.getEventCache().getNode(), changedSnap);\r\n                newViewCache = oldViewCache.updateEventSnap(newEventCache, oldEventSnap.isFullyInitialized(), oldEventSnap.isFiltered());\r\n            }\r\n            else {\r\n                var childChangePath = changePath.popFront();\r\n                var oldChild = oldEventSnap.getNode().getImmediateChild(childKey);\r\n                var newChild = void 0;\r\n                if (childChangePath.isEmpty()) {\r\n                    // Child overwrite, we can replace the child\r\n                    newChild = changedSnap;\r\n                }\r\n                else {\r\n                    var childNode = source.getCompleteChild(childKey);\r\n                    if (childNode != null) {\r\n                        if (childChangePath.getBack() === '.priority' &&\r\n                            childNode.getChild(childChangePath.parent()).isEmpty()) {\r\n                            // This is a priority update on an empty node. If this node exists on the server, the\r\n                            // server will send down the priority in the update, so ignore for now\r\n                            newChild = childNode;\r\n                        }\r\n                        else {\r\n                            newChild = childNode.updateChild(childChangePath, changedSnap);\r\n                        }\r\n                    }\r\n                    else {\r\n                        // There is no complete child node available\r\n                        newChild = ChildrenNode.EMPTY_NODE;\r\n                    }\r\n                }\r\n                if (!oldChild.equals(newChild)) {\r\n                    var newEventSnap = this.filter_.updateChild(oldEventSnap.getNode(), childKey, newChild, childChangePath, source, accumulator);\r\n                    newViewCache = oldViewCache.updateEventSnap(newEventSnap, oldEventSnap.isFullyInitialized(), this.filter_.filtersNodes());\r\n                }\r\n                else {\r\n                    newViewCache = oldViewCache;\r\n                }\r\n            }\r\n        }\r\n        return newViewCache;\r\n    };\r\n    /**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {string} childKey\r\n     * @return {boolean}\r\n     * @private\r\n     */\r\n    ViewProcessor.cacheHasChild_ = function (viewCache, childKey) {\r\n        return viewCache.getEventCache().isCompleteForChild(childKey);\r\n    };\r\n    /**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {!Path} path\r\n     * @param {ImmutableTree.<!Node>} changedChildren\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} serverCache\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\r\n    ViewProcessor.prototype.applyUserMerge_ = function (viewCache, path, changedChildren, writesCache, serverCache, accumulator) {\r\n        var _this = this;\r\n        // HACK: In the case of a limit query, there may be some changes that bump things out of the\r\n        // window leaving room for new items.  It's important we process these changes first, so we\r\n        // iterate the changes twice, first processing any that affect items currently in view.\r\n        // TODO: I consider an item \"in view\" if cacheHasChild is true, which checks both the server\r\n        // and event snap.  I'm not sure if this will result in edge cases when a child is in one but\r\n        // not the other.\r\n        var curViewCache = viewCache;\r\n        changedChildren.foreach(function (relativePath, childNode) {\r\n            var writePath = path.child(relativePath);\r\n            if (ViewProcessor.cacheHasChild_(viewCache, writePath.getFront())) {\r\n                curViewCache = _this.applyUserOverwrite_(curViewCache, writePath, childNode, writesCache, serverCache, accumulator);\r\n            }\r\n        });\r\n        changedChildren.foreach(function (relativePath, childNode) {\r\n            var writePath = path.child(relativePath);\r\n            if (!ViewProcessor.cacheHasChild_(viewCache, writePath.getFront())) {\r\n                curViewCache = _this.applyUserOverwrite_(curViewCache, writePath, childNode, writesCache, serverCache, accumulator);\r\n            }\r\n        });\r\n        return curViewCache;\r\n    };\r\n    /**\r\n     * @param {!Node} node\r\n     * @param {ImmutableTree.<!Node>} merge\r\n     * @return {!Node}\r\n     * @private\r\n     */\r\n    ViewProcessor.prototype.applyMerge_ = function (node, merge) {\r\n        merge.foreach(function (relativePath, childNode) {\r\n            node = node.updateChild(relativePath, childNode);\r\n        });\r\n        return node;\r\n    };\r\n    /**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {!Path} path\r\n     * @param {!ImmutableTree.<!Node>} changedChildren\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} serverCache\r\n     * @param {boolean} filterServerNode\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\r\n    ViewProcessor.prototype.applyServerMerge_ = function (viewCache, path, changedChildren, writesCache, serverCache, filterServerNode, accumulator) {\r\n        var _this = this;\r\n        // If we don't have a cache yet, this merge was intended for a previously listen in the same location. Ignore it and\r\n        // wait for the complete data update coming soon.\r\n        if (viewCache\r\n            .getServerCache()\r\n            .getNode()\r\n            .isEmpty() &&\r\n            !viewCache.getServerCache().isFullyInitialized()) {\r\n            return viewCache;\r\n        }\r\n        // HACK: In the case of a limit query, there may be some changes that bump things out of the\r\n        // window leaving room for new items.  It's important we process these changes first, so we\r\n        // iterate the changes twice, first processing any that affect items currently in view.\r\n        // TODO: I consider an item \"in view\" if cacheHasChild is true, which checks both the server\r\n        // and event snap.  I'm not sure if this will result in edge cases when a child is in one but\r\n        // not the other.\r\n        var curViewCache = viewCache;\r\n        var viewMergeTree;\r\n        if (path.isEmpty()) {\r\n            viewMergeTree = changedChildren;\r\n        }\r\n        else {\r\n            viewMergeTree = ImmutableTree.Empty.setTree(path, changedChildren);\r\n        }\r\n        var serverNode = viewCache.getServerCache().getNode();\r\n        viewMergeTree.children.inorderTraversal(function (childKey, childTree) {\r\n            if (serverNode.hasChild(childKey)) {\r\n                var serverChild = viewCache\r\n                    .getServerCache()\r\n                    .getNode()\r\n                    .getImmediateChild(childKey);\r\n                var newChild = _this.applyMerge_(serverChild, childTree);\r\n                curViewCache = _this.applyServerOverwrite_(curViewCache, new Path(childKey), newChild, writesCache, serverCache, filterServerNode, accumulator);\r\n            }\r\n        });\r\n        viewMergeTree.children.inorderTraversal(function (childKey, childMergeTree) {\r\n            var isUnknownDeepMerge = !viewCache.getServerCache().isCompleteForChild(childKey) &&\r\n                childMergeTree.value == null;\r\n            if (!serverNode.hasChild(childKey) && !isUnknownDeepMerge) {\r\n                var serverChild = viewCache\r\n                    .getServerCache()\r\n                    .getNode()\r\n                    .getImmediateChild(childKey);\r\n                var newChild = _this.applyMerge_(serverChild, childMergeTree);\r\n                curViewCache = _this.applyServerOverwrite_(curViewCache, new Path(childKey), newChild, writesCache, serverCache, filterServerNode, accumulator);\r\n            }\r\n        });\r\n        return curViewCache;\r\n    };\r\n    /**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {!Path} ackPath\r\n     * @param {!ImmutableTree<!boolean>} affectedTree\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} completeCache\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\r\n    ViewProcessor.prototype.ackUserWrite_ = function (viewCache, ackPath, affectedTree, writesCache, completeCache, accumulator) {\r\n        if (writesCache.shadowingWrite(ackPath) != null) {\r\n            return viewCache;\r\n        }\r\n        // Only filter server node if it is currently filtered\r\n        var filterServerNode = viewCache.getServerCache().isFiltered();\r\n        // Essentially we'll just get our existing server cache for the affected paths and re-apply it as a server update\r\n        // now that it won't be shadowed.\r\n        var serverCache = viewCache.getServerCache();\r\n        if (affectedTree.value != null) {\r\n            // This is an overwrite.\r\n            if ((ackPath.isEmpty() && serverCache.isFullyInitialized()) ||\r\n                serverCache.isCompleteForPath(ackPath)) {\r\n                return this.applyServerOverwrite_(viewCache, ackPath, serverCache.getNode().getChild(ackPath), writesCache, completeCache, filterServerNode, accumulator);\r\n            }\r\n            else if (ackPath.isEmpty()) {\r\n                // This is a goofy edge case where we are acking data at this location but don't have full data.  We\r\n                // should just re-apply whatever we have in our cache as a merge.\r\n                var changedChildren_1 = ImmutableTree.Empty;\r\n                serverCache.getNode().forEachChild(KEY_INDEX, function (name, node) {\r\n                    changedChildren_1 = changedChildren_1.set(new Path(name), node);\r\n                });\r\n                return this.applyServerMerge_(viewCache, ackPath, changedChildren_1, writesCache, completeCache, filterServerNode, accumulator);\r\n            }\r\n            else {\r\n                return viewCache;\r\n            }\r\n        }\r\n        else {\r\n            // This is a merge.\r\n            var changedChildren_2 = ImmutableTree.Empty;\r\n            affectedTree.foreach(function (mergePath, value) {\r\n                var serverCachePath = ackPath.child(mergePath);\r\n                if (serverCache.isCompleteForPath(serverCachePath)) {\r\n                    changedChildren_2 = changedChildren_2.set(mergePath, serverCache.getNode().getChild(serverCachePath));\r\n                }\r\n            });\r\n            return this.applyServerMerge_(viewCache, ackPath, changedChildren_2, writesCache, completeCache, filterServerNode, accumulator);\r\n        }\r\n    };\r\n    /**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {!Path} path\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\r\n    ViewProcessor.prototype.listenComplete_ = function (viewCache, path, writesCache, accumulator) {\r\n        var oldServerNode = viewCache.getServerCache();\r\n        var newViewCache = viewCache.updateServerSnap(oldServerNode.getNode(), oldServerNode.isFullyInitialized() || path.isEmpty(), oldServerNode.isFiltered());\r\n        return this.generateEventCacheAfterServerEvent_(newViewCache, path, writesCache, NO_COMPLETE_CHILD_SOURCE, accumulator);\r\n    };\r\n    /**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {!Path} path\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} completeServerCache\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\r\n    ViewProcessor.prototype.revertUserWrite_ = function (viewCache, path, writesCache, completeServerCache, accumulator) {\r\n        var complete;\r\n        if (writesCache.shadowingWrite(path) != null) {\r\n            return viewCache;\r\n        }\r\n        else {\r\n            var source = new WriteTreeCompleteChildSource(writesCache, viewCache, completeServerCache);\r\n            var oldEventCache = viewCache.getEventCache().getNode();\r\n            var newEventCache = void 0;\r\n            if (path.isEmpty() || path.getFront() === '.priority') {\r\n                var newNode = void 0;\r\n                if (viewCache.getServerCache().isFullyInitialized()) {\r\n                    newNode = writesCache.calcCompleteEventCache(viewCache.getCompleteServerSnap());\r\n                }\r\n                else {\r\n                    var serverChildren = viewCache.getServerCache().getNode();\r\n                    assert(serverChildren instanceof ChildrenNode, 'serverChildren would be complete if leaf node');\r\n                    newNode = writesCache.calcCompleteEventChildren(serverChildren);\r\n                }\r\n                newNode = newNode;\r\n                newEventCache = this.filter_.updateFullNode(oldEventCache, newNode, accumulator);\r\n            }\r\n            else {\r\n                var childKey = path.getFront();\r\n                var newChild = writesCache.calcCompleteChild(childKey, viewCache.getServerCache());\r\n                if (newChild == null &&\r\n                    viewCache.getServerCache().isCompleteForChild(childKey)) {\r\n                    newChild = oldEventCache.getImmediateChild(childKey);\r\n                }\r\n                if (newChild != null) {\r\n                    newEventCache = this.filter_.updateChild(oldEventCache, childKey, newChild, path.popFront(), source, accumulator);\r\n                }\r\n                else if (viewCache\r\n                    .getEventCache()\r\n                    .getNode()\r\n                    .hasChild(childKey)) {\r\n                    // No complete child available, delete the existing one, if any\r\n                    newEventCache = this.filter_.updateChild(oldEventCache, childKey, ChildrenNode.EMPTY_NODE, path.popFront(), source, accumulator);\r\n                }\r\n                else {\r\n                    newEventCache = oldEventCache;\r\n                }\r\n                if (newEventCache.isEmpty() &&\r\n                    viewCache.getServerCache().isFullyInitialized()) {\r\n                    // We might have reverted all child writes. Maybe the old event was a leaf node\r\n                    complete = writesCache.calcCompleteEventCache(viewCache.getCompleteServerSnap());\r\n                    if (complete.isLeafNode()) {\r\n                        newEventCache = this.filter_.updateFullNode(newEventCache, complete, accumulator);\r\n                    }\r\n                }\r\n            }\r\n            complete =\r\n                viewCache.getServerCache().isFullyInitialized() ||\r\n                    writesCache.shadowingWrite(Path.Empty) != null;\r\n            return viewCache.updateEventSnap(newEventCache, complete, this.filter_.filtersNodes());\r\n        }\r\n    };\r\n    return ViewProcessor;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * An EventGenerator is used to convert \"raw\" changes (Change) as computed by the\r\n * CacheDiffer into actual events (Event) that can be raised.  See generateEventsForChanges()\r\n * for details.\r\n *\r\n * @constructor\r\n */\r\nvar EventGenerator = /** @class */ (function () {\r\n    /**\r\n     *\r\n     * @param {!Query} query_\r\n     */\r\n    function EventGenerator(query_) {\r\n        this.query_ = query_;\r\n        /**\r\n         * @private\r\n         * @type {!Index}\r\n         */\r\n        this.index_ = this.query_.getQueryParams().getIndex();\r\n    }\r\n    /**\r\n     * Given a set of raw changes (no moved events and prevName not specified yet), and a set of\r\n     * EventRegistrations that should be notified of these changes, generate the actual events to be raised.\r\n     *\r\n     * Notes:\r\n     *  - child_moved events will be synthesized at this time for any child_changed events that affect\r\n     *    our index.\r\n     *  - prevName will be calculated based on the index ordering.\r\n     *\r\n     * @param {!Array.<!Change>} changes\r\n     * @param {!Node} eventCache\r\n     * @param {!Array.<!EventRegistration>} eventRegistrations\r\n     * @return {!Array.<!Event>}\r\n     */\r\n    EventGenerator.prototype.generateEventsForChanges = function (changes, eventCache, eventRegistrations) {\r\n        var _this = this;\r\n        var events = [];\r\n        var moves = [];\r\n        changes.forEach(function (change) {\r\n            if (change.type === Change.CHILD_CHANGED &&\r\n                _this.index_.indexedValueChanged(change.oldSnap, change.snapshotNode)) {\r\n                moves.push(Change.childMovedChange(change.childName, change.snapshotNode));\r\n            }\r\n        });\r\n        this.generateEventsForType_(events, Change.CHILD_REMOVED, changes, eventRegistrations, eventCache);\r\n        this.generateEventsForType_(events, Change.CHILD_ADDED, changes, eventRegistrations, eventCache);\r\n        this.generateEventsForType_(events, Change.CHILD_MOVED, moves, eventRegistrations, eventCache);\r\n        this.generateEventsForType_(events, Change.CHILD_CHANGED, changes, eventRegistrations, eventCache);\r\n        this.generateEventsForType_(events, Change.VALUE, changes, eventRegistrations, eventCache);\r\n        return events;\r\n    };\r\n    /**\r\n     * Given changes of a single change type, generate the corresponding events.\r\n     *\r\n     * @param {!Array.<!Event>} events\r\n     * @param {!string} eventType\r\n     * @param {!Array.<!Change>} changes\r\n     * @param {!Array.<!EventRegistration>} registrations\r\n     * @param {!Node} eventCache\r\n     * @private\r\n     */\r\n    EventGenerator.prototype.generateEventsForType_ = function (events, eventType, changes, registrations, eventCache) {\r\n        var _this = this;\r\n        var filteredChanges = changes.filter(function (change) { return change.type === eventType; });\r\n        filteredChanges.sort(this.compareChanges_.bind(this));\r\n        filteredChanges.forEach(function (change) {\r\n            var materializedChange = _this.materializeSingleChange_(change, eventCache);\r\n            registrations.forEach(function (registration) {\r\n                if (registration.respondsTo(change.type)) {\r\n                    events.push(registration.createEvent(materializedChange, _this.query_));\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * @param {!Change} change\r\n     * @param {!Node} eventCache\r\n     * @return {!Change}\r\n     * @private\r\n     */\r\n    EventGenerator.prototype.materializeSingleChange_ = function (change, eventCache) {\r\n        if (change.type === 'value' || change.type === 'child_removed') {\r\n            return change;\r\n        }\r\n        else {\r\n            change.prevName = eventCache.getPredecessorChildName(\r\n            /** @type {!string} */\r\n            change.childName, change.snapshotNode, this.index_);\r\n            return change;\r\n        }\r\n    };\r\n    /**\r\n     * @param {!Change} a\r\n     * @param {!Change} b\r\n     * @return {number}\r\n     * @private\r\n     */\r\n    EventGenerator.prototype.compareChanges_ = function (a, b) {\r\n        if (a.childName == null || b.childName == null) {\r\n            throw assertionError('Should only compare child_ events.');\r\n        }\r\n        var aWrapped = new NamedNode(a.childName, a.snapshotNode);\r\n        var bWrapped = new NamedNode(b.childName, b.snapshotNode);\r\n        return this.index_.compare(aWrapped, bWrapped);\r\n    };\r\n    return EventGenerator;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * A view represents a specific location and query that has 1 or more event registrations.\r\n *\r\n * It does several things:\r\n *  - Maintains the list of event registrations for this location/query.\r\n *  - Maintains a cache of the data visible for this location/query.\r\n *  - Applies new operations (via applyOperation), updates the cache, and based on the event\r\n *    registrations returns the set of events to be raised.\r\n * @constructor\r\n */\r\nvar View = /** @class */ (function () {\r\n    /**\r\n     *\r\n     * @param {!Query} query_\r\n     * @param {!ViewCache} initialViewCache\r\n     */\r\n    function View(query_, initialViewCache) {\r\n        this.query_ = query_;\r\n        this.eventRegistrations_ = [];\r\n        var params = this.query_.getQueryParams();\r\n        var indexFilter = new IndexedFilter(params.getIndex());\r\n        var filter = params.getNodeFilter();\r\n        /**\r\n         * @type {ViewProcessor}\r\n         * @private\r\n         */\r\n        this.processor_ = new ViewProcessor(filter);\r\n        var initialServerCache = initialViewCache.getServerCache();\r\n        var initialEventCache = initialViewCache.getEventCache();\r\n        // Don't filter server node with other filter than index, wait for tagged listen\r\n        var serverSnap = indexFilter.updateFullNode(ChildrenNode.EMPTY_NODE, initialServerCache.getNode(), null);\r\n        var eventSnap = filter.updateFullNode(ChildrenNode.EMPTY_NODE, initialEventCache.getNode(), null);\r\n        var newServerCache = new CacheNode(serverSnap, initialServerCache.isFullyInitialized(), indexFilter.filtersNodes());\r\n        var newEventCache = new CacheNode(eventSnap, initialEventCache.isFullyInitialized(), filter.filtersNodes());\r\n        /**\r\n         * @type {!ViewCache}\r\n         * @private\r\n         */\r\n        this.viewCache_ = new ViewCache(newEventCache, newServerCache);\r\n        /**\r\n         * @type {!EventGenerator}\r\n         * @private\r\n         */\r\n        this.eventGenerator_ = new EventGenerator(this.query_);\r\n    }\r\n    /**\r\n     * @return {!Query}\r\n     */\r\n    View.prototype.getQuery = function () {\r\n        return this.query_;\r\n    };\r\n    /**\r\n     * @return {?Node}\r\n     */\r\n    View.prototype.getServerCache = function () {\r\n        return this.viewCache_.getServerCache().getNode();\r\n    };\r\n    /**\r\n     * @param {!Path} path\r\n     * @return {?Node}\r\n     */\r\n    View.prototype.getCompleteServerCache = function (path) {\r\n        var cache = this.viewCache_.getCompleteServerSnap();\r\n        if (cache) {\r\n            // If this isn't a \"loadsAllData\" view, then cache isn't actually a complete cache and\r\n            // we need to see if it contains the child we're interested in.\r\n            if (this.query_.getQueryParams().loadsAllData() ||\r\n                (!path.isEmpty() && !cache.getImmediateChild(path.getFront()).isEmpty())) {\r\n                return cache.getChild(path);\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    /**\r\n     * @return {boolean}\r\n     */\r\n    View.prototype.isEmpty = function () {\r\n        return this.eventRegistrations_.length === 0;\r\n    };\r\n    /**\r\n     * @param {!EventRegistration} eventRegistration\r\n     */\r\n    View.prototype.addEventRegistration = function (eventRegistration) {\r\n        this.eventRegistrations_.push(eventRegistration);\r\n    };\r\n    /**\r\n     * @param {?EventRegistration} eventRegistration If null, remove all callbacks.\r\n     * @param {Error=} cancelError If a cancelError is provided, appropriate cancel events will be returned.\r\n     * @return {!Array.<!Event>} Cancel events, if cancelError was provided.\r\n     */\r\n    View.prototype.removeEventRegistration = function (eventRegistration, cancelError) {\r\n        var cancelEvents = [];\r\n        if (cancelError) {\r\n            assert(eventRegistration == null, 'A cancel should cancel all event registrations.');\r\n            var path_1 = this.query_.path;\r\n            this.eventRegistrations_.forEach(function (registration) {\r\n                cancelError /** @type {!Error} */ = cancelError;\r\n                var maybeEvent = registration.createCancelEvent(cancelError, path_1);\r\n                if (maybeEvent) {\r\n                    cancelEvents.push(maybeEvent);\r\n                }\r\n            });\r\n        }\r\n        if (eventRegistration) {\r\n            var remaining = [];\r\n            for (var i = 0; i < this.eventRegistrations_.length; ++i) {\r\n                var existing = this.eventRegistrations_[i];\r\n                if (!existing.matches(eventRegistration)) {\r\n                    remaining.push(existing);\r\n                }\r\n                else if (eventRegistration.hasAnyCallback()) {\r\n                    // We're removing just this one\r\n                    remaining = remaining.concat(this.eventRegistrations_.slice(i + 1));\r\n                    break;\r\n                }\r\n            }\r\n            this.eventRegistrations_ = remaining;\r\n        }\r\n        else {\r\n            this.eventRegistrations_ = [];\r\n        }\r\n        return cancelEvents;\r\n    };\r\n    /**\r\n     * Applies the given Operation, updates our cache, and returns the appropriate events.\r\n     *\r\n     * @param {!Operation} operation\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} completeServerCache\r\n     * @return {!Array.<!Event>}\r\n     */\r\n    View.prototype.applyOperation = function (operation, writesCache, completeServerCache) {\r\n        if (operation.type === OperationType.MERGE &&\r\n            operation.source.queryId !== null) {\r\n            assert(this.viewCache_.getCompleteServerSnap(), 'We should always have a full cache before handling merges');\r\n            assert(this.viewCache_.getCompleteEventSnap(), 'Missing event cache, even though we have a server cache');\r\n        }\r\n        var oldViewCache = this.viewCache_;\r\n        var result = this.processor_.applyOperation(oldViewCache, operation, writesCache, completeServerCache);\r\n        this.processor_.assertIndexed(result.viewCache);\r\n        assert(result.viewCache.getServerCache().isFullyInitialized() ||\r\n            !oldViewCache.getServerCache().isFullyInitialized(), 'Once a server snap is complete, it should never go back');\r\n        this.viewCache_ = result.viewCache;\r\n        return this.generateEventsForChanges_(result.changes, result.viewCache.getEventCache().getNode(), null);\r\n    };\r\n    /**\r\n     * @param {!EventRegistration} registration\r\n     * @return {!Array.<!Event>}\r\n     */\r\n    View.prototype.getInitialEvents = function (registration) {\r\n        var eventSnap = this.viewCache_.getEventCache();\r\n        var initialChanges = [];\r\n        if (!eventSnap.getNode().isLeafNode()) {\r\n            var eventNode = eventSnap.getNode();\r\n            eventNode.forEachChild(PRIORITY_INDEX, function (key, childNode) {\r\n                initialChanges.push(Change.childAddedChange(key, childNode));\r\n            });\r\n        }\r\n        if (eventSnap.isFullyInitialized()) {\r\n            initialChanges.push(Change.valueChange(eventSnap.getNode()));\r\n        }\r\n        return this.generateEventsForChanges_(initialChanges, eventSnap.getNode(), registration);\r\n    };\r\n    /**\r\n     * @private\r\n     * @param {!Array.<!Change>} changes\r\n     * @param {!Node} eventCache\r\n     * @param {EventRegistration=} eventRegistration\r\n     * @return {!Array.<!Event>}\r\n     */\r\n    View.prototype.generateEventsForChanges_ = function (changes, eventCache, eventRegistration) {\r\n        var registrations = eventRegistration\r\n            ? [eventRegistration]\r\n            : this.eventRegistrations_;\r\n        return this.eventGenerator_.generateEventsForChanges(changes, eventCache, registrations);\r\n    };\r\n    return View;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar __referenceConstructor$1;\r\n/**\r\n * SyncPoint represents a single location in a SyncTree with 1 or more event registrations, meaning we need to\r\n * maintain 1 or more Views at this location to cache server data and raise appropriate events for server changes\r\n * and user writes (set, transaction, update).\r\n *\r\n * It's responsible for:\r\n *  - Maintaining the set of 1 or more views necessary at this location (a SyncPoint with 0 views should be removed).\r\n *  - Proxying user / server operations to the views as appropriate (i.e. applyServerOverwrite,\r\n *    applyUserOverwrite, etc.)\r\n */\r\nvar SyncPoint = /** @class */ (function () {\r\n    function SyncPoint() {\r\n        /**\r\n         * The Views being tracked at this location in the tree, stored as a map where the key is a\r\n         * queryId and the value is the View for that query.\r\n         *\r\n         * NOTE: This list will be quite small (usually 1, but perhaps 2 or 3; any more is an odd use case).\r\n         *\r\n         * @type {!Object.<!string, !View>}\r\n         * @private\r\n         */\r\n        this.views_ = {};\r\n    }\r\n    Object.defineProperty(SyncPoint, \"__referenceConstructor\", {\r\n        get: function () {\r\n            assert(__referenceConstructor$1, 'Reference.ts has not been loaded');\r\n            return __referenceConstructor$1;\r\n        },\r\n        set: function (val) {\r\n            assert(!__referenceConstructor$1, '__referenceConstructor has already been defined');\r\n            __referenceConstructor$1 = val;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * @return {boolean}\r\n     */\r\n    SyncPoint.prototype.isEmpty = function () {\r\n        return isEmpty(this.views_);\r\n    };\r\n    /**\r\n     *\r\n     * @param {!Operation} operation\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} optCompleteServerCache\r\n     * @return {!Array.<!Event>}\r\n     */\r\n    SyncPoint.prototype.applyOperation = function (operation, writesCache, optCompleteServerCache) {\r\n        var queryId = operation.source.queryId;\r\n        if (queryId !== null) {\r\n            var view = safeGet(this.views_, queryId);\r\n            assert(view != null, 'SyncTree gave us an op for an invalid query.');\r\n            return view.applyOperation(operation, writesCache, optCompleteServerCache);\r\n        }\r\n        else {\r\n            var events_1 = [];\r\n            forEach(this.views_, function (key, view) {\r\n                events_1 = events_1.concat(view.applyOperation(operation, writesCache, optCompleteServerCache));\r\n            });\r\n            return events_1;\r\n        }\r\n    };\r\n    /**\r\n     * Add an event callback for the specified query.\r\n     *\r\n     * @param {!Query} query\r\n     * @param {!EventRegistration} eventRegistration\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} serverCache Complete server cache, if we have it.\r\n     * @param {boolean} serverCacheComplete\r\n     * @return {!Array.<!Event>} Events to raise.\r\n     */\r\n    SyncPoint.prototype.addEventRegistration = function (query, eventRegistration, writesCache, serverCache, serverCacheComplete) {\r\n        var queryId = query.queryIdentifier();\r\n        var view = safeGet(this.views_, queryId);\r\n        if (!view) {\r\n            // TODO: make writesCache take flag for complete server node\r\n            var eventCache = writesCache.calcCompleteEventCache(serverCacheComplete ? serverCache : null);\r\n            var eventCacheComplete = false;\r\n            if (eventCache) {\r\n                eventCacheComplete = true;\r\n            }\r\n            else if (serverCache instanceof ChildrenNode) {\r\n                eventCache = writesCache.calcCompleteEventChildren(serverCache);\r\n                eventCacheComplete = false;\r\n            }\r\n            else {\r\n                eventCache = ChildrenNode.EMPTY_NODE;\r\n                eventCacheComplete = false;\r\n            }\r\n            var viewCache = new ViewCache(new CacheNode(\r\n            /** @type {!Node} */ (eventCache), eventCacheComplete, false), new CacheNode(\r\n            /** @type {!Node} */ (serverCache), serverCacheComplete, false));\r\n            view = new View(query, viewCache);\r\n            this.views_[queryId] = view;\r\n        }\r\n        // This is guaranteed to exist now, we just created anything that was missing\r\n        view.addEventRegistration(eventRegistration);\r\n        return view.getInitialEvents(eventRegistration);\r\n    };\r\n    /**\r\n     * Remove event callback(s).  Return cancelEvents if a cancelError is specified.\r\n     *\r\n     * If query is the default query, we'll check all views for the specified eventRegistration.\r\n     * If eventRegistration is null, we'll remove all callbacks for the specified view(s).\r\n     *\r\n     * @param {!Query} query\r\n     * @param {?EventRegistration} eventRegistration If null, remove all callbacks.\r\n     * @param {Error=} cancelError If a cancelError is provided, appropriate cancel events will be returned.\r\n     * @return {{removed:!Array.<!Query>, events:!Array.<!Event>}} removed queries and any cancel events\r\n     */\r\n    SyncPoint.prototype.removeEventRegistration = function (query, eventRegistration, cancelError) {\r\n        var queryId = query.queryIdentifier();\r\n        var removed = [];\r\n        var cancelEvents = [];\r\n        var hadCompleteView = this.hasCompleteView();\r\n        if (queryId === 'default') {\r\n            // When you do ref.off(...), we search all views for the registration to remove.\r\n            var self_1 = this;\r\n            forEach(this.views_, function (viewQueryId, view) {\r\n                cancelEvents = cancelEvents.concat(view.removeEventRegistration(eventRegistration, cancelError));\r\n                if (view.isEmpty()) {\r\n                    delete self_1.views_[viewQueryId];\r\n                    // We'll deal with complete views later.\r\n                    if (!view\r\n                        .getQuery()\r\n                        .getQueryParams()\r\n                        .loadsAllData()) {\r\n                        removed.push(view.getQuery());\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            // remove the callback from the specific view.\r\n            var view = safeGet(this.views_, queryId);\r\n            if (view) {\r\n                cancelEvents = cancelEvents.concat(view.removeEventRegistration(eventRegistration, cancelError));\r\n                if (view.isEmpty()) {\r\n                    delete this.views_[queryId];\r\n                    // We'll deal with complete views later.\r\n                    if (!view\r\n                        .getQuery()\r\n                        .getQueryParams()\r\n                        .loadsAllData()) {\r\n                        removed.push(view.getQuery());\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (hadCompleteView && !this.hasCompleteView()) {\r\n            // We removed our last complete view.\r\n            removed.push(new SyncPoint.__referenceConstructor(query.repo, query.path));\r\n        }\r\n        return { removed: removed, events: cancelEvents };\r\n    };\r\n    /**\r\n     * @return {!Array.<!View>}\r\n     */\r\n    SyncPoint.prototype.getQueryViews = function () {\r\n        var _this = this;\r\n        var values = Object.keys(this.views_).map(function (key) { return _this.views_[key]; });\r\n        return values.filter(function (view) {\r\n            return !view\r\n                .getQuery()\r\n                .getQueryParams()\r\n                .loadsAllData();\r\n        });\r\n    };\r\n    /**\r\n     *\r\n     * @param {!Path} path The path to the desired complete snapshot\r\n     * @return {?Node} A complete cache, if it exists\r\n     */\r\n    SyncPoint.prototype.getCompleteServerCache = function (path) {\r\n        var serverCache = null;\r\n        forEach(this.views_, function (key, view) {\r\n            serverCache = serverCache || view.getCompleteServerCache(path);\r\n        });\r\n        return serverCache;\r\n    };\r\n    /**\r\n     * @param {!Query} query\r\n     * @return {?View}\r\n     */\r\n    SyncPoint.prototype.viewForQuery = function (query) {\r\n        var params = query.getQueryParams();\r\n        if (params.loadsAllData()) {\r\n            return this.getCompleteView();\r\n        }\r\n        else {\r\n            var queryId = query.queryIdentifier();\r\n            return safeGet(this.views_, queryId);\r\n        }\r\n    };\r\n    /**\r\n     * @param {!Query} query\r\n     * @return {boolean}\r\n     */\r\n    SyncPoint.prototype.viewExistsForQuery = function (query) {\r\n        return this.viewForQuery(query) != null;\r\n    };\r\n    /**\r\n     * @return {boolean}\r\n     */\r\n    SyncPoint.prototype.hasCompleteView = function () {\r\n        return this.getCompleteView() != null;\r\n    };\r\n    /**\r\n     * @return {?View}\r\n     */\r\n    SyncPoint.prototype.getCompleteView = function () {\r\n        var completeView = findValue(this.views_, function (view) {\r\n            return view\r\n                .getQuery()\r\n                .getQueryParams()\r\n                .loadsAllData();\r\n        });\r\n        return completeView || null;\r\n    };\r\n    return SyncPoint;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * This class holds a collection of writes that can be applied to nodes in unison. It abstracts away the logic with\r\n * dealing with priority writes and multiple nested writes. At any given path there is only allowed to be one write\r\n * modifying that path. Any write to an existing path or shadowing an existing path will modify that existing write\r\n * to reflect the write added.\r\n *\r\n * @constructor\r\n * @param {!ImmutableTree.<!Node>} writeTree\r\n */\r\nvar CompoundWrite = /** @class */ (function () {\r\n    function CompoundWrite(writeTree_) {\r\n        this.writeTree_ = writeTree_;\r\n    }\r\n    /**\r\n     * @param {!Path} path\r\n     * @param {!Node} node\r\n     * @return {!CompoundWrite}\r\n     */\r\n    CompoundWrite.prototype.addWrite = function (path, node) {\r\n        if (path.isEmpty()) {\r\n            return new CompoundWrite(new ImmutableTree(node));\r\n        }\r\n        else {\r\n            var rootmost = this.writeTree_.findRootMostValueAndPath(path);\r\n            if (rootmost != null) {\r\n                var rootMostPath = rootmost.path;\r\n                var value = rootmost.value;\r\n                var relativePath = Path.relativePath(rootMostPath, path);\r\n                value = value.updateChild(relativePath, node);\r\n                return new CompoundWrite(this.writeTree_.set(rootMostPath, value));\r\n            }\r\n            else {\r\n                var subtree = new ImmutableTree(node);\r\n                var newWriteTree = this.writeTree_.setTree(path, subtree);\r\n                return new CompoundWrite(newWriteTree);\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * @param {!Path} path\r\n     * @param {!Object.<string, !Node>} updates\r\n     * @return {!CompoundWrite}\r\n     */\r\n    CompoundWrite.prototype.addWrites = function (path, updates) {\r\n        var newWrite = this;\r\n        forEach(updates, function (childKey, node) {\r\n            newWrite = newWrite.addWrite(path.child(childKey), node);\r\n        });\r\n        return newWrite;\r\n    };\r\n    /**\r\n     * Will remove a write at the given path and deeper paths. This will <em>not</em> modify a write at a higher\r\n     * location, which must be removed by calling this method with that path.\r\n     *\r\n     * @param {!Path} path The path at which a write and all deeper writes should be removed\r\n     * @return {!CompoundWrite} The new CompoundWrite with the removed path\r\n     */\r\n    CompoundWrite.prototype.removeWrite = function (path) {\r\n        if (path.isEmpty()) {\r\n            return CompoundWrite.Empty;\r\n        }\r\n        else {\r\n            var newWriteTree = this.writeTree_.setTree(path, ImmutableTree.Empty);\r\n            return new CompoundWrite(newWriteTree);\r\n        }\r\n    };\r\n    /**\r\n     * Returns whether this CompoundWrite will fully overwrite a node at a given location and can therefore be\r\n     * considered \"complete\".\r\n     *\r\n     * @param {!Path} path The path to check for\r\n     * @return {boolean} Whether there is a complete write at that path\r\n     */\r\n    CompoundWrite.prototype.hasCompleteWrite = function (path) {\r\n        return this.getCompleteNode(path) != null;\r\n    };\r\n    /**\r\n     * Returns a node for a path if and only if the node is a \"complete\" overwrite at that path. This will not aggregate\r\n     * writes from deeper paths, but will return child nodes from a more shallow path.\r\n     *\r\n     * @param {!Path} path The path to get a complete write\r\n     * @return {?Node} The node if complete at that path, or null otherwise.\r\n     */\r\n    CompoundWrite.prototype.getCompleteNode = function (path) {\r\n        var rootmost = this.writeTree_.findRootMostValueAndPath(path);\r\n        if (rootmost != null) {\r\n            return this.writeTree_\r\n                .get(rootmost.path)\r\n                .getChild(Path.relativePath(rootmost.path, path));\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    };\r\n    /**\r\n     * Returns all children that are guaranteed to be a complete overwrite.\r\n     *\r\n     * @return {!Array.<NamedNode>} A list of all complete children.\r\n     */\r\n    CompoundWrite.prototype.getCompleteChildren = function () {\r\n        var children = [];\r\n        var node = this.writeTree_.value;\r\n        if (node != null) {\r\n            // If it's a leaf node, it has no children; so nothing to do.\r\n            if (!node.isLeafNode()) {\r\n                node.forEachChild(PRIORITY_INDEX, function (childName, childNode) {\r\n                    children.push(new NamedNode(childName, childNode));\r\n                });\r\n            }\r\n        }\r\n        else {\r\n            this.writeTree_.children.inorderTraversal(function (childName, childTree) {\r\n                if (childTree.value != null) {\r\n                    children.push(new NamedNode(childName, childTree.value));\r\n                }\r\n            });\r\n        }\r\n        return children;\r\n    };\r\n    /**\r\n     * @param {!Path} path\r\n     * @return {!CompoundWrite}\r\n     */\r\n    CompoundWrite.prototype.childCompoundWrite = function (path) {\r\n        if (path.isEmpty()) {\r\n            return this;\r\n        }\r\n        else {\r\n            var shadowingNode = this.getCompleteNode(path);\r\n            if (shadowingNode != null) {\r\n                return new CompoundWrite(new ImmutableTree(shadowingNode));\r\n            }\r\n            else {\r\n                return new CompoundWrite(this.writeTree_.subtree(path));\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Returns true if this CompoundWrite is empty and therefore does not modify any nodes.\r\n     * @return {boolean} Whether this CompoundWrite is empty\r\n     */\r\n    CompoundWrite.prototype.isEmpty = function () {\r\n        return this.writeTree_.isEmpty();\r\n    };\r\n    /**\r\n     * Applies this CompoundWrite to a node. The node is returned with all writes from this CompoundWrite applied to the\r\n     * node\r\n     * @param {!Node} node The node to apply this CompoundWrite to\r\n     * @return {!Node} The node with all writes applied\r\n     */\r\n    CompoundWrite.prototype.apply = function (node) {\r\n        return CompoundWrite.applySubtreeWrite_(Path.Empty, this.writeTree_, node);\r\n    };\r\n    /**\r\n     * @type {!CompoundWrite}\r\n     */\r\n    CompoundWrite.Empty = new CompoundWrite(new ImmutableTree(null));\r\n    /**\r\n     * @param {!Path} relativePath\r\n     * @param {!ImmutableTree.<!Node>} writeTree\r\n     * @param {!Node} node\r\n     * @return {!Node}\r\n     * @private\r\n     */\r\n    CompoundWrite.applySubtreeWrite_ = function (relativePath, writeTree, node) {\r\n        if (writeTree.value != null) {\r\n            // Since there a write is always a leaf, we're done here\r\n            return node.updateChild(relativePath, writeTree.value);\r\n        }\r\n        else {\r\n            var priorityWrite_1 = null;\r\n            writeTree.children.inorderTraversal(function (childKey, childTree) {\r\n                if (childKey === '.priority') {\r\n                    // Apply priorities at the end so we don't update priorities for either empty nodes or forget\r\n                    // to apply priorities to empty nodes that are later filled\r\n                    assert(childTree.value !== null, 'Priority writes must always be leaf nodes');\r\n                    priorityWrite_1 = childTree.value;\r\n                }\r\n                else {\r\n                    node = CompoundWrite.applySubtreeWrite_(relativePath.child(childKey), childTree, node);\r\n                }\r\n            });\r\n            // If there was a priority write, we only apply it if the node is not empty\r\n            if (!node.getChild(relativePath).isEmpty() && priorityWrite_1 !== null) {\r\n                node = node.updateChild(relativePath.child('.priority'), priorityWrite_1);\r\n            }\r\n            return node;\r\n        }\r\n    };\r\n    return CompoundWrite;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * WriteTree tracks all pending user-initiated writes and has methods to calculate the result of merging them\r\n * with underlying server data (to create \"event cache\" data).  Pending writes are added with addOverwrite()\r\n * and addMerge(), and removed with removeWrite().\r\n *\r\n * @constructor\r\n */\r\nvar WriteTree = /** @class */ (function () {\r\n    function WriteTree() {\r\n        /**\r\n         * A tree tracking the result of applying all visible writes.  This does not include transactions with\r\n         * applyLocally=false or writes that are completely shadowed by other writes.\r\n         *\r\n         * @type {!CompoundWrite}\r\n         * @private\r\n         */\r\n        this.visibleWrites_ = CompoundWrite.Empty;\r\n        /**\r\n         * A list of all pending writes, regardless of visibility and shadowed-ness.  Used to calculate arbitrary\r\n         * sets of the changed data, such as hidden writes (from transactions) or changes with certain writes excluded (also\r\n         * used by transactions).\r\n         *\r\n         * @type {!Array.<!WriteRecord>}\r\n         * @private\r\n         */\r\n        this.allWrites_ = [];\r\n        this.lastWriteId_ = -1;\r\n    }\r\n    /**\r\n     * Create a new WriteTreeRef for the given path. For use with a new sync point at the given path.\r\n     *\r\n     * @param {!Path} path\r\n     * @return {!WriteTreeRef}\r\n     */\r\n    WriteTree.prototype.childWrites = function (path) {\r\n        return new WriteTreeRef(path, this);\r\n    };\r\n    /**\r\n     * Record a new overwrite from user code.\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!Node} snap\r\n     * @param {!number} writeId\r\n     * @param {boolean=} visible This is set to false by some transactions. It should be excluded from event caches\r\n     */\r\n    WriteTree.prototype.addOverwrite = function (path, snap, writeId, visible) {\r\n        assert(writeId > this.lastWriteId_, 'Stacking an older write on top of newer ones');\r\n        if (visible === undefined) {\r\n            visible = true;\r\n        }\r\n        this.allWrites_.push({\r\n            path: path,\r\n            snap: snap,\r\n            writeId: writeId,\r\n            visible: visible\r\n        });\r\n        if (visible) {\r\n            this.visibleWrites_ = this.visibleWrites_.addWrite(path, snap);\r\n        }\r\n        this.lastWriteId_ = writeId;\r\n    };\r\n    /**\r\n     * Record a new merge from user code.\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!Object.<string, !Node>} changedChildren\r\n     * @param {!number} writeId\r\n     */\r\n    WriteTree.prototype.addMerge = function (path, changedChildren, writeId) {\r\n        assert(writeId > this.lastWriteId_, 'Stacking an older merge on top of newer ones');\r\n        this.allWrites_.push({\r\n            path: path,\r\n            children: changedChildren,\r\n            writeId: writeId,\r\n            visible: true\r\n        });\r\n        this.visibleWrites_ = this.visibleWrites_.addWrites(path, changedChildren);\r\n        this.lastWriteId_ = writeId;\r\n    };\r\n    /**\r\n     * @param {!number} writeId\r\n     * @return {?WriteRecord}\r\n     */\r\n    WriteTree.prototype.getWrite = function (writeId) {\r\n        for (var i = 0; i < this.allWrites_.length; i++) {\r\n            var record = this.allWrites_[i];\r\n            if (record.writeId === writeId) {\r\n                return record;\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    /**\r\n     * Remove a write (either an overwrite or merge) that has been successfully acknowledge by the server. Recalculates\r\n     * the tree if necessary.  We return true if it may have been visible, meaning views need to reevaluate.\r\n     *\r\n     * @param {!number} writeId\r\n     * @return {boolean} true if the write may have been visible (meaning we'll need to reevaluate / raise\r\n     * events as a result).\r\n     */\r\n    WriteTree.prototype.removeWrite = function (writeId) {\r\n        // Note: disabling this check. It could be a transaction that preempted another transaction, and thus was applied\r\n        // out of order.\r\n        //const validClear = revert || this.allWrites_.length === 0 || writeId <= this.allWrites_[0].writeId;\r\n        //assert(validClear, \"Either we don't have this write, or it's the first one in the queue\");\r\n        var _this = this;\r\n        var idx = this.allWrites_.findIndex(function (s) {\r\n            return s.writeId === writeId;\r\n        });\r\n        assert(idx >= 0, 'removeWrite called with nonexistent writeId.');\r\n        var writeToRemove = this.allWrites_[idx];\r\n        this.allWrites_.splice(idx, 1);\r\n        var removedWriteWasVisible = writeToRemove.visible;\r\n        var removedWriteOverlapsWithOtherWrites = false;\r\n        var i = this.allWrites_.length - 1;\r\n        while (removedWriteWasVisible && i >= 0) {\r\n            var currentWrite = this.allWrites_[i];\r\n            if (currentWrite.visible) {\r\n                if (i >= idx &&\r\n                    this.recordContainsPath_(currentWrite, writeToRemove.path)) {\r\n                    // The removed write was completely shadowed by a subsequent write.\r\n                    removedWriteWasVisible = false;\r\n                }\r\n                else if (writeToRemove.path.contains(currentWrite.path)) {\r\n                    // Either we're covering some writes or they're covering part of us (depending on which came first).\r\n                    removedWriteOverlapsWithOtherWrites = true;\r\n                }\r\n            }\r\n            i--;\r\n        }\r\n        if (!removedWriteWasVisible) {\r\n            return false;\r\n        }\r\n        else if (removedWriteOverlapsWithOtherWrites) {\r\n            // There's some shadowing going on. Just rebuild the visible writes from scratch.\r\n            this.resetTree_();\r\n            return true;\r\n        }\r\n        else {\r\n            // There's no shadowing.  We can safely just remove the write(s) from visibleWrites.\r\n            if (writeToRemove.snap) {\r\n                this.visibleWrites_ = this.visibleWrites_.removeWrite(writeToRemove.path);\r\n            }\r\n            else {\r\n                var children = writeToRemove.children;\r\n                forEach(children, function (childName) {\r\n                    _this.visibleWrites_ = _this.visibleWrites_.removeWrite(writeToRemove.path.child(childName));\r\n                });\r\n            }\r\n            return true;\r\n        }\r\n    };\r\n    /**\r\n     * Return a complete snapshot for the given path if there's visible write data at that path, else null.\r\n     * No server data is considered.\r\n     *\r\n     * @param {!Path} path\r\n     * @return {?Node}\r\n     */\r\n    WriteTree.prototype.getCompleteWriteData = function (path) {\r\n        return this.visibleWrites_.getCompleteNode(path);\r\n    };\r\n    /**\r\n     * Given optional, underlying server data, and an optional set of constraints (exclude some sets, include hidden\r\n     * writes), attempt to calculate a complete snapshot for the given path\r\n     *\r\n     * @param {!Path} treePath\r\n     * @param {?Node} completeServerCache\r\n     * @param {Array.<number>=} writeIdsToExclude An optional set to be excluded\r\n     * @param {boolean=} includeHiddenWrites Defaults to false, whether or not to layer on writes with visible set to false\r\n     * @return {?Node}\r\n     */\r\n    WriteTree.prototype.calcCompleteEventCache = function (treePath, completeServerCache, writeIdsToExclude, includeHiddenWrites) {\r\n        if (!writeIdsToExclude && !includeHiddenWrites) {\r\n            var shadowingNode = this.visibleWrites_.getCompleteNode(treePath);\r\n            if (shadowingNode != null) {\r\n                return shadowingNode;\r\n            }\r\n            else {\r\n                var subMerge = this.visibleWrites_.childCompoundWrite(treePath);\r\n                if (subMerge.isEmpty()) {\r\n                    return completeServerCache;\r\n                }\r\n                else if (completeServerCache == null &&\r\n                    !subMerge.hasCompleteWrite(Path.Empty)) {\r\n                    // We wouldn't have a complete snapshot, since there's no underlying data and no complete shadow\r\n                    return null;\r\n                }\r\n                else {\r\n                    var layeredCache = completeServerCache || ChildrenNode.EMPTY_NODE;\r\n                    return subMerge.apply(layeredCache);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            var merge = this.visibleWrites_.childCompoundWrite(treePath);\r\n            if (!includeHiddenWrites && merge.isEmpty()) {\r\n                return completeServerCache;\r\n            }\r\n            else {\r\n                // If the server cache is null, and we don't have a complete cache, we need to return null\r\n                if (!includeHiddenWrites &&\r\n                    completeServerCache == null &&\r\n                    !merge.hasCompleteWrite(Path.Empty)) {\r\n                    return null;\r\n                }\r\n                else {\r\n                    var filter = function (write) {\r\n                        return ((write.visible || includeHiddenWrites) &&\r\n                            (!writeIdsToExclude ||\r\n                                !~writeIdsToExclude.indexOf(write.writeId)) &&\r\n                            (write.path.contains(treePath) || treePath.contains(write.path)));\r\n                    };\r\n                    var mergeAtPath = WriteTree.layerTree_(this.allWrites_, filter, treePath);\r\n                    var layeredCache = completeServerCache || ChildrenNode.EMPTY_NODE;\r\n                    return mergeAtPath.apply(layeredCache);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * With optional, underlying server data, attempt to return a children node of children that we have complete data for.\r\n     * Used when creating new views, to pre-fill their complete event children snapshot.\r\n     *\r\n     * @param {!Path} treePath\r\n     * @param {?ChildrenNode} completeServerChildren\r\n     * @return {!ChildrenNode}\r\n     */\r\n    WriteTree.prototype.calcCompleteEventChildren = function (treePath, completeServerChildren) {\r\n        var completeChildren = ChildrenNode.EMPTY_NODE;\r\n        var topLevelSet = this.visibleWrites_.getCompleteNode(treePath);\r\n        if (topLevelSet) {\r\n            if (!topLevelSet.isLeafNode()) {\r\n                // we're shadowing everything. Return the children.\r\n                topLevelSet.forEachChild(PRIORITY_INDEX, function (childName, childSnap) {\r\n                    completeChildren = completeChildren.updateImmediateChild(childName, childSnap);\r\n                });\r\n            }\r\n            return completeChildren;\r\n        }\r\n        else if (completeServerChildren) {\r\n            // Layer any children we have on top of this\r\n            // We know we don't have a top-level set, so just enumerate existing children\r\n            var merge_1 = this.visibleWrites_.childCompoundWrite(treePath);\r\n            completeServerChildren.forEachChild(PRIORITY_INDEX, function (childName, childNode) {\r\n                var node = merge_1\r\n                    .childCompoundWrite(new Path(childName))\r\n                    .apply(childNode);\r\n                completeChildren = completeChildren.updateImmediateChild(childName, node);\r\n            });\r\n            // Add any complete children we have from the set\r\n            merge_1.getCompleteChildren().forEach(function (namedNode) {\r\n                completeChildren = completeChildren.updateImmediateChild(namedNode.name, namedNode.node);\r\n            });\r\n            return completeChildren;\r\n        }\r\n        else {\r\n            // We don't have anything to layer on top of. Layer on any children we have\r\n            // Note that we can return an empty snap if we have a defined delete\r\n            var merge = this.visibleWrites_.childCompoundWrite(treePath);\r\n            merge.getCompleteChildren().forEach(function (namedNode) {\r\n                completeChildren = completeChildren.updateImmediateChild(namedNode.name, namedNode.node);\r\n            });\r\n            return completeChildren;\r\n        }\r\n    };\r\n    /**\r\n     * Given that the underlying server data has updated, determine what, if anything, needs to be\r\n     * applied to the event cache.\r\n     *\r\n     * Possibilities:\r\n     *\r\n     * 1. No writes are shadowing. Events should be raised, the snap to be applied comes from the server data\r\n     *\r\n     * 2. Some write is completely shadowing. No events to be raised\r\n     *\r\n     * 3. Is partially shadowed. Events\r\n     *\r\n     * Either existingEventSnap or existingServerSnap must exist\r\n     *\r\n     * @param {!Path} treePath\r\n     * @param {!Path} childPath\r\n     * @param {?Node} existingEventSnap\r\n     * @param {?Node} existingServerSnap\r\n     * @return {?Node}\r\n     */\r\n    WriteTree.prototype.calcEventCacheAfterServerOverwrite = function (treePath, childPath, existingEventSnap, existingServerSnap) {\r\n        assert(existingEventSnap || existingServerSnap, 'Either existingEventSnap or existingServerSnap must exist');\r\n        var path = treePath.child(childPath);\r\n        if (this.visibleWrites_.hasCompleteWrite(path)) {\r\n            // At this point we can probably guarantee that we're in case 2, meaning no events\r\n            // May need to check visibility while doing the findRootMostValueAndPath call\r\n            return null;\r\n        }\r\n        else {\r\n            // No complete shadowing. We're either partially shadowing or not shadowing at all.\r\n            var childMerge = this.visibleWrites_.childCompoundWrite(path);\r\n            if (childMerge.isEmpty()) {\r\n                // We're not shadowing at all. Case 1\r\n                return existingServerSnap.getChild(childPath);\r\n            }\r\n            else {\r\n                // This could be more efficient if the serverNode + updates doesn't change the eventSnap\r\n                // However this is tricky to find out, since user updates don't necessary change the server\r\n                // snap, e.g. priority updates on empty nodes, or deep deletes. Another special case is if the server\r\n                // adds nodes, but doesn't change any existing writes. It is therefore not enough to\r\n                // only check if the updates change the serverNode.\r\n                // Maybe check if the merge tree contains these special cases and only do a full overwrite in that case?\r\n                return childMerge.apply(existingServerSnap.getChild(childPath));\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Returns a complete child for a given server snap after applying all user writes or null if there is no\r\n     * complete child for this ChildKey.\r\n     *\r\n     * @param {!Path} treePath\r\n     * @param {!string} childKey\r\n     * @param {!CacheNode} existingServerSnap\r\n     * @return {?Node}\r\n     */\r\n    WriteTree.prototype.calcCompleteChild = function (treePath, childKey, existingServerSnap) {\r\n        var path = treePath.child(childKey);\r\n        var shadowingNode = this.visibleWrites_.getCompleteNode(path);\r\n        if (shadowingNode != null) {\r\n            return shadowingNode;\r\n        }\r\n        else {\r\n            if (existingServerSnap.isCompleteForChild(childKey)) {\r\n                var childMerge = this.visibleWrites_.childCompoundWrite(path);\r\n                return childMerge.apply(existingServerSnap.getNode().getImmediateChild(childKey));\r\n            }\r\n            else {\r\n                return null;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Returns a node if there is a complete overwrite for this path. More specifically, if there is a write at\r\n     * a higher path, this will return the child of that write relative to the write and this path.\r\n     * Returns null if there is no write at this path.\r\n     *\r\n     * @param {!Path} path\r\n     * @return {?Node}\r\n     */\r\n    WriteTree.prototype.shadowingWrite = function (path) {\r\n        return this.visibleWrites_.getCompleteNode(path);\r\n    };\r\n    /**\r\n     * This method is used when processing child remove events on a query. If we can, we pull in children that were outside\r\n     * the window, but may now be in the window.\r\n     *\r\n     * @param {!Path} treePath\r\n     * @param {?Node} completeServerData\r\n     * @param {!NamedNode} startPost\r\n     * @param {!number} count\r\n     * @param {boolean} reverse\r\n     * @param {!Index} index\r\n     * @return {!Array.<!NamedNode>}\r\n     */\r\n    WriteTree.prototype.calcIndexedSlice = function (treePath, completeServerData, startPost, count, reverse, index) {\r\n        var toIterate;\r\n        var merge = this.visibleWrites_.childCompoundWrite(treePath);\r\n        var shadowingNode = merge.getCompleteNode(Path.Empty);\r\n        if (shadowingNode != null) {\r\n            toIterate = shadowingNode;\r\n        }\r\n        else if (completeServerData != null) {\r\n            toIterate = merge.apply(completeServerData);\r\n        }\r\n        else {\r\n            // no children to iterate on\r\n            return [];\r\n        }\r\n        toIterate = toIterate.withIndex(index);\r\n        if (!toIterate.isEmpty() && !toIterate.isLeafNode()) {\r\n            var nodes = [];\r\n            var cmp = index.getCompare();\r\n            var iter = reverse\r\n                ? toIterate.getReverseIteratorFrom(startPost, index)\r\n                : toIterate.getIteratorFrom(startPost, index);\r\n            var next = iter.getNext();\r\n            while (next && nodes.length < count) {\r\n                if (cmp(next, startPost) !== 0) {\r\n                    nodes.push(next);\r\n                }\r\n                next = iter.getNext();\r\n            }\r\n            return nodes;\r\n        }\r\n        else {\r\n            return [];\r\n        }\r\n    };\r\n    /**\r\n     * @param {!WriteRecord} writeRecord\r\n     * @param {!Path} path\r\n     * @return {boolean}\r\n     * @private\r\n     */\r\n    WriteTree.prototype.recordContainsPath_ = function (writeRecord, path) {\r\n        if (writeRecord.snap) {\r\n            return writeRecord.path.contains(path);\r\n        }\r\n        else {\r\n            // findKey can return undefined, so use !! to coerce to boolean\r\n            return !!findKey(writeRecord.children, function (childSnap, childName) {\r\n                return writeRecord.path.child(childName).contains(path);\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * Re-layer the writes and merges into a tree so we can efficiently calculate event snapshots\r\n     * @private\r\n     */\r\n    WriteTree.prototype.resetTree_ = function () {\r\n        this.visibleWrites_ = WriteTree.layerTree_(this.allWrites_, WriteTree.DefaultFilter_, Path.Empty);\r\n        if (this.allWrites_.length > 0) {\r\n            this.lastWriteId_ = this.allWrites_[this.allWrites_.length - 1].writeId;\r\n        }\r\n        else {\r\n            this.lastWriteId_ = -1;\r\n        }\r\n    };\r\n    /**\r\n     * The default filter used when constructing the tree. Keep everything that's visible.\r\n     *\r\n     * @param {!WriteRecord} write\r\n     * @return {boolean}\r\n     * @private\r\n     */\r\n    WriteTree.DefaultFilter_ = function (write) {\r\n        return write.visible;\r\n    };\r\n    /**\r\n     * Static method. Given an array of WriteRecords, a filter for which ones to include, and a path, construct the tree of\r\n     * event data at that path.\r\n     *\r\n     * @param {!Array.<!WriteRecord>} writes\r\n     * @param {!function(!WriteRecord):boolean} filter\r\n     * @param {!Path} treeRoot\r\n     * @return {!CompoundWrite}\r\n     * @private\r\n     */\r\n    WriteTree.layerTree_ = function (writes, filter, treeRoot) {\r\n        var compoundWrite = CompoundWrite.Empty;\r\n        for (var i = 0; i < writes.length; ++i) {\r\n            var write = writes[i];\r\n            // Theory, a later set will either:\r\n            // a) abort a relevant transaction, so no need to worry about excluding it from calculating that transaction\r\n            // b) not be relevant to a transaction (separate branch), so again will not affect the data for that transaction\r\n            if (filter(write)) {\r\n                var writePath = write.path;\r\n                var relativePath = void 0;\r\n                if (write.snap) {\r\n                    if (treeRoot.contains(writePath)) {\r\n                        relativePath = Path.relativePath(treeRoot, writePath);\r\n                        compoundWrite = compoundWrite.addWrite(relativePath, write.snap);\r\n                    }\r\n                    else if (writePath.contains(treeRoot)) {\r\n                        relativePath = Path.relativePath(writePath, treeRoot);\r\n                        compoundWrite = compoundWrite.addWrite(Path.Empty, write.snap.getChild(relativePath));\r\n                    }\r\n                    else {\r\n                        // There is no overlap between root path and write path, ignore write\r\n                    }\r\n                }\r\n                else if (write.children) {\r\n                    if (treeRoot.contains(writePath)) {\r\n                        relativePath = Path.relativePath(treeRoot, writePath);\r\n                        compoundWrite = compoundWrite.addWrites(relativePath, write.children);\r\n                    }\r\n                    else if (writePath.contains(treeRoot)) {\r\n                        relativePath = Path.relativePath(writePath, treeRoot);\r\n                        if (relativePath.isEmpty()) {\r\n                            compoundWrite = compoundWrite.addWrites(Path.Empty, write.children);\r\n                        }\r\n                        else {\r\n                            var child = safeGet(write.children, relativePath.getFront());\r\n                            if (child) {\r\n                                // There exists a child in this node that matches the root path\r\n                                var deepNode = child.getChild(relativePath.popFront());\r\n                                compoundWrite = compoundWrite.addWrite(Path.Empty, deepNode);\r\n                            }\r\n                        }\r\n                    }\r\n                    else {\r\n                        // There is no overlap between root path and write path, ignore write\r\n                    }\r\n                }\r\n                else {\r\n                    throw assertionError('WriteRecord should have .snap or .children');\r\n                }\r\n            }\r\n        }\r\n        return compoundWrite;\r\n    };\r\n    return WriteTree;\r\n}());\r\n/**\r\n * A WriteTreeRef wraps a WriteTree and a path, for convenient access to a particular subtree.  All of the methods\r\n * just proxy to the underlying WriteTree.\r\n *\r\n * @constructor\r\n */\r\nvar WriteTreeRef = /** @class */ (function () {\r\n    /**\r\n     * @param {!Path} path\r\n     * @param {!WriteTree} writeTree\r\n     */\r\n    function WriteTreeRef(path, writeTree) {\r\n        this.treePath_ = path;\r\n        this.writeTree_ = writeTree;\r\n    }\r\n    /**\r\n     * If possible, returns a complete event cache, using the underlying server data if possible. In addition, can be used\r\n     * to get a cache that includes hidden writes, and excludes arbitrary writes. Note that customizing the returned node\r\n     * can lead to a more expensive calculation.\r\n     *\r\n     * @param {?Node} completeServerCache\r\n     * @param {Array.<number>=} writeIdsToExclude Optional writes to exclude.\r\n     * @param {boolean=} includeHiddenWrites Defaults to false, whether or not to layer on writes with visible set to false\r\n     * @return {?Node}\r\n     */\r\n    WriteTreeRef.prototype.calcCompleteEventCache = function (completeServerCache, writeIdsToExclude, includeHiddenWrites) {\r\n        return this.writeTree_.calcCompleteEventCache(this.treePath_, completeServerCache, writeIdsToExclude, includeHiddenWrites);\r\n    };\r\n    /**\r\n     * If possible, returns a children node containing all of the complete children we have data for. The returned data is a\r\n     * mix of the given server data and write data.\r\n     *\r\n     * @param {?ChildrenNode} completeServerChildren\r\n     * @return {!ChildrenNode}\r\n     */\r\n    WriteTreeRef.prototype.calcCompleteEventChildren = function (completeServerChildren) {\r\n        return this.writeTree_.calcCompleteEventChildren(this.treePath_, completeServerChildren);\r\n    };\r\n    /**\r\n     * Given that either the underlying server data has updated or the outstanding writes have updated, determine what,\r\n     * if anything, needs to be applied to the event cache.\r\n     *\r\n     * Possibilities:\r\n     *\r\n     * 1. No writes are shadowing. Events should be raised, the snap to be applied comes from the server data\r\n     *\r\n     * 2. Some write is completely shadowing. No events to be raised\r\n     *\r\n     * 3. Is partially shadowed. Events should be raised\r\n     *\r\n     * Either existingEventSnap or existingServerSnap must exist, this is validated via an assert\r\n     *\r\n     * @param {!Path} path\r\n     * @param {?Node} existingEventSnap\r\n     * @param {?Node} existingServerSnap\r\n     * @return {?Node}\r\n     */\r\n    WriteTreeRef.prototype.calcEventCacheAfterServerOverwrite = function (path, existingEventSnap, existingServerSnap) {\r\n        return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_, path, existingEventSnap, existingServerSnap);\r\n    };\r\n    /**\r\n     * Returns a node if there is a complete overwrite for this path. More specifically, if there is a write at\r\n     * a higher path, this will return the child of that write relative to the write and this path.\r\n     * Returns null if there is no write at this path.\r\n     *\r\n     * @param {!Path} path\r\n     * @return {?Node}\r\n     */\r\n    WriteTreeRef.prototype.shadowingWrite = function (path) {\r\n        return this.writeTree_.shadowingWrite(this.treePath_.child(path));\r\n    };\r\n    /**\r\n     * This method is used when processing child remove events on a query. If we can, we pull in children that were outside\r\n     * the window, but may now be in the window\r\n     *\r\n     * @param {?Node} completeServerData\r\n     * @param {!NamedNode} startPost\r\n     * @param {!number} count\r\n     * @param {boolean} reverse\r\n     * @param {!Index} index\r\n     * @return {!Array.<!NamedNode>}\r\n     */\r\n    WriteTreeRef.prototype.calcIndexedSlice = function (completeServerData, startPost, count, reverse, index) {\r\n        return this.writeTree_.calcIndexedSlice(this.treePath_, completeServerData, startPost, count, reverse, index);\r\n    };\r\n    /**\r\n     * Returns a complete child for a given server snap after applying all user writes or null if there is no\r\n     * complete child for this ChildKey.\r\n     *\r\n     * @param {!string} childKey\r\n     * @param {!CacheNode} existingServerCache\r\n     * @return {?Node}\r\n     */\r\n    WriteTreeRef.prototype.calcCompleteChild = function (childKey, existingServerCache) {\r\n        return this.writeTree_.calcCompleteChild(this.treePath_, childKey, existingServerCache);\r\n    };\r\n    /**\r\n     * Return a WriteTreeRef for a child.\r\n     *\r\n     * @param {string} childName\r\n     * @return {!WriteTreeRef}\r\n     */\r\n    WriteTreeRef.prototype.child = function (childName) {\r\n        return new WriteTreeRef(this.treePath_.child(childName), this.writeTree_);\r\n    };\r\n    return WriteTreeRef;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * SyncTree is the central class for managing event callback registration, data caching, views\r\n * (query processing), and event generation.  There are typically two SyncTree instances for\r\n * each Repo, one for the normal Firebase data, and one for the .info data.\r\n *\r\n * It has a number of responsibilities, including:\r\n *  - Tracking all user event callbacks (registered via addEventRegistration() and removeEventRegistration()).\r\n *  - Applying and caching data changes for user set(), transaction(), and update() calls\r\n *    (applyUserOverwrite(), applyUserMerge()).\r\n *  - Applying and caching data changes for server data changes (applyServerOverwrite(),\r\n *    applyServerMerge()).\r\n *  - Generating user-facing events for server and user changes (all of the apply* methods\r\n *    return the set of events that need to be raised as a result).\r\n *  - Maintaining the appropriate set of server listens to ensure we are always subscribed\r\n *    to the correct set of paths and queries to satisfy the current set of user event\r\n *    callbacks (listens are started/stopped using the provided listenProvider).\r\n *\r\n * NOTE: Although SyncTree tracks event callbacks and calculates events to raise, the actual\r\n * events are returned to the caller rather than raised synchronously.\r\n *\r\n * @constructor\r\n */\r\nvar SyncTree = /** @class */ (function () {\r\n    /**\r\n     * @param {!ListenProvider} listenProvider_ Used by SyncTree to start / stop listening\r\n     *   to server data.\r\n     */\r\n    function SyncTree(listenProvider_) {\r\n        this.listenProvider_ = listenProvider_;\r\n        /**\r\n         * Tree of SyncPoints.  There's a SyncPoint at any location that has 1 or more views.\r\n         * @type {!ImmutableTree.<!SyncPoint>}\r\n         * @private\r\n         */\r\n        this.syncPointTree_ = ImmutableTree.Empty;\r\n        /**\r\n         * A tree of all pending user writes (user-initiated set()'s, transaction()'s, update()'s, etc.).\r\n         * @type {!WriteTree}\r\n         * @private\r\n         */\r\n        this.pendingWriteTree_ = new WriteTree();\r\n        this.tagToQueryMap_ = {};\r\n        this.queryToTagMap_ = {};\r\n    }\r\n    /**\r\n     * Apply the data changes for a user-generated set() or transaction() call.\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!Node} newData\r\n     * @param {number} writeId\r\n     * @param {boolean=} visible\r\n     * @return {!Array.<!Event>} Events to raise.\r\n     */\r\n    SyncTree.prototype.applyUserOverwrite = function (path, newData, writeId, visible) {\r\n        // Record pending write.\r\n        this.pendingWriteTree_.addOverwrite(path, newData, writeId, visible);\r\n        if (!visible) {\r\n            return [];\r\n        }\r\n        else {\r\n            return this.applyOperationToSyncPoints_(new Overwrite(OperationSource.User, path, newData));\r\n        }\r\n    };\r\n    /**\r\n     * Apply the data from a user-generated update() call\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!Object.<string, !Node>} changedChildren\r\n     * @param {!number} writeId\r\n     * @return {!Array.<!Event>} Events to raise.\r\n     */\r\n    SyncTree.prototype.applyUserMerge = function (path, changedChildren, writeId) {\r\n        // Record pending merge.\r\n        this.pendingWriteTree_.addMerge(path, changedChildren, writeId);\r\n        var changeTree = ImmutableTree.fromObject(changedChildren);\r\n        return this.applyOperationToSyncPoints_(new Merge(OperationSource.User, path, changeTree));\r\n    };\r\n    /**\r\n     * Acknowledge a pending user write that was previously registered with applyUserOverwrite() or applyUserMerge().\r\n     *\r\n     * @param {!number} writeId\r\n     * @param {boolean=} revert True if the given write failed and needs to be reverted\r\n     * @return {!Array.<!Event>} Events to raise.\r\n     */\r\n    SyncTree.prototype.ackUserWrite = function (writeId, revert) {\r\n        if (revert === void 0) { revert = false; }\r\n        var write = this.pendingWriteTree_.getWrite(writeId);\r\n        var needToReevaluate = this.pendingWriteTree_.removeWrite(writeId);\r\n        if (!needToReevaluate) {\r\n            return [];\r\n        }\r\n        else {\r\n            var affectedTree_1 = ImmutableTree.Empty;\r\n            if (write.snap != null) {\r\n                // overwrite\r\n                affectedTree_1 = affectedTree_1.set(Path.Empty, true);\r\n            }\r\n            else {\r\n                forEach(write.children, function (pathString, node) {\r\n                    affectedTree_1 = affectedTree_1.set(new Path(pathString), node);\r\n                });\r\n            }\r\n            return this.applyOperationToSyncPoints_(new AckUserWrite(write.path, affectedTree_1, revert));\r\n        }\r\n    };\r\n    /**\r\n     * Apply new server data for the specified path..\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!Node} newData\r\n     * @return {!Array.<!Event>} Events to raise.\r\n     */\r\n    SyncTree.prototype.applyServerOverwrite = function (path, newData) {\r\n        return this.applyOperationToSyncPoints_(new Overwrite(OperationSource.Server, path, newData));\r\n    };\r\n    /**\r\n     * Apply new server data to be merged in at the specified path.\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!Object.<string, !Node>} changedChildren\r\n     * @return {!Array.<!Event>} Events to raise.\r\n     */\r\n    SyncTree.prototype.applyServerMerge = function (path, changedChildren) {\r\n        var changeTree = ImmutableTree.fromObject(changedChildren);\r\n        return this.applyOperationToSyncPoints_(new Merge(OperationSource.Server, path, changeTree));\r\n    };\r\n    /**\r\n     * Apply a listen complete for a query\r\n     *\r\n     * @param {!Path} path\r\n     * @return {!Array.<!Event>} Events to raise.\r\n     */\r\n    SyncTree.prototype.applyListenComplete = function (path) {\r\n        return this.applyOperationToSyncPoints_(new ListenComplete(OperationSource.Server, path));\r\n    };\r\n    /**\r\n     * Apply new server data for the specified tagged query.\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!Node} snap\r\n     * @param {!number} tag\r\n     * @return {!Array.<!Event>} Events to raise.\r\n     */\r\n    SyncTree.prototype.applyTaggedQueryOverwrite = function (path, snap, tag) {\r\n        var queryKey = this.queryKeyForTag_(tag);\r\n        if (queryKey != null) {\r\n            var r = SyncTree.parseQueryKey_(queryKey);\r\n            var queryPath = r.path, queryId = r.queryId;\r\n            var relativePath = Path.relativePath(queryPath, path);\r\n            var op = new Overwrite(OperationSource.forServerTaggedQuery(queryId), relativePath, snap);\r\n            return this.applyTaggedOperation_(queryPath, op);\r\n        }\r\n        else {\r\n            // Query must have been removed already\r\n            return [];\r\n        }\r\n    };\r\n    /**\r\n     * Apply server data to be merged in for the specified tagged query.\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!Object.<string, !Node>} changedChildren\r\n     * @param {!number} tag\r\n     * @return {!Array.<!Event>} Events to raise.\r\n     */\r\n    SyncTree.prototype.applyTaggedQueryMerge = function (path, changedChildren, tag) {\r\n        var queryKey = this.queryKeyForTag_(tag);\r\n        if (queryKey) {\r\n            var r = SyncTree.parseQueryKey_(queryKey);\r\n            var queryPath = r.path, queryId = r.queryId;\r\n            var relativePath = Path.relativePath(queryPath, path);\r\n            var changeTree = ImmutableTree.fromObject(changedChildren);\r\n            var op = new Merge(OperationSource.forServerTaggedQuery(queryId), relativePath, changeTree);\r\n            return this.applyTaggedOperation_(queryPath, op);\r\n        }\r\n        else {\r\n            // We've already removed the query. No big deal, ignore the update\r\n            return [];\r\n        }\r\n    };\r\n    /**\r\n     * Apply a listen complete for a tagged query\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!number} tag\r\n     * @return {!Array.<!Event>} Events to raise.\r\n     */\r\n    SyncTree.prototype.applyTaggedListenComplete = function (path, tag) {\r\n        var queryKey = this.queryKeyForTag_(tag);\r\n        if (queryKey) {\r\n            var r = SyncTree.parseQueryKey_(queryKey);\r\n            var queryPath = r.path, queryId = r.queryId;\r\n            var relativePath = Path.relativePath(queryPath, path);\r\n            var op = new ListenComplete(OperationSource.forServerTaggedQuery(queryId), relativePath);\r\n            return this.applyTaggedOperation_(queryPath, op);\r\n        }\r\n        else {\r\n            // We've already removed the query. No big deal, ignore the update\r\n            return [];\r\n        }\r\n    };\r\n    /**\r\n     * Add an event callback for the specified query.\r\n     *\r\n     * @param {!Query} query\r\n     * @param {!EventRegistration} eventRegistration\r\n     * @return {!Array.<!Event>} Events to raise.\r\n     */\r\n    SyncTree.prototype.addEventRegistration = function (query, eventRegistration) {\r\n        var path = query.path;\r\n        var serverCache = null;\r\n        var foundAncestorDefaultView = false;\r\n        // Any covering writes will necessarily be at the root, so really all we need to find is the server cache.\r\n        // Consider optimizing this once there's a better understanding of what actual behavior will be.\r\n        this.syncPointTree_.foreachOnPath(path, function (pathToSyncPoint, sp) {\r\n            var relativePath = Path.relativePath(pathToSyncPoint, path);\r\n            serverCache = serverCache || sp.getCompleteServerCache(relativePath);\r\n            foundAncestorDefaultView =\r\n                foundAncestorDefaultView || sp.hasCompleteView();\r\n        });\r\n        var syncPoint = this.syncPointTree_.get(path);\r\n        if (!syncPoint) {\r\n            syncPoint = new SyncPoint();\r\n            this.syncPointTree_ = this.syncPointTree_.set(path, syncPoint);\r\n        }\r\n        else {\r\n            foundAncestorDefaultView =\r\n                foundAncestorDefaultView || syncPoint.hasCompleteView();\r\n            serverCache = serverCache || syncPoint.getCompleteServerCache(Path.Empty);\r\n        }\r\n        var serverCacheComplete;\r\n        if (serverCache != null) {\r\n            serverCacheComplete = true;\r\n        }\r\n        else {\r\n            serverCacheComplete = false;\r\n            serverCache = ChildrenNode.EMPTY_NODE;\r\n            var subtree = this.syncPointTree_.subtree(path);\r\n            subtree.foreachChild(function (childName, childSyncPoint) {\r\n                var completeCache = childSyncPoint.getCompleteServerCache(Path.Empty);\r\n                if (completeCache) {\r\n                    serverCache = serverCache.updateImmediateChild(childName, completeCache);\r\n                }\r\n            });\r\n        }\r\n        var viewAlreadyExists = syncPoint.viewExistsForQuery(query);\r\n        if (!viewAlreadyExists && !query.getQueryParams().loadsAllData()) {\r\n            // We need to track a tag for this query\r\n            var queryKey = SyncTree.makeQueryKey_(query);\r\n            assert(!(queryKey in this.queryToTagMap_), 'View does not exist, but we have a tag');\r\n            var tag = SyncTree.getNextQueryTag_();\r\n            this.queryToTagMap_[queryKey] = tag;\r\n            // Coerce to string to avoid sparse arrays.\r\n            this.tagToQueryMap_['_' + tag] = queryKey;\r\n        }\r\n        var writesCache = this.pendingWriteTree_.childWrites(path);\r\n        var events = syncPoint.addEventRegistration(query, eventRegistration, writesCache, serverCache, serverCacheComplete);\r\n        if (!viewAlreadyExists && !foundAncestorDefaultView) {\r\n            var view /** @type !View */ = syncPoint.viewForQuery(query);\r\n            events = events.concat(this.setupListener_(query, view));\r\n        }\r\n        return events;\r\n    };\r\n    /**\r\n     * Remove event callback(s).\r\n     *\r\n     * If query is the default query, we'll check all queries for the specified eventRegistration.\r\n     * If eventRegistration is null, we'll remove all callbacks for the specified query/queries.\r\n     *\r\n     * @param {!Query} query\r\n     * @param {?EventRegistration} eventRegistration If null, all callbacks are removed.\r\n     * @param {Error=} cancelError If a cancelError is provided, appropriate cancel events will be returned.\r\n     * @return {!Array.<!Event>} Cancel events, if cancelError was provided.\r\n     */\r\n    SyncTree.prototype.removeEventRegistration = function (query, eventRegistration, cancelError) {\r\n        var _this = this;\r\n        // Find the syncPoint first. Then deal with whether or not it has matching listeners\r\n        var path = query.path;\r\n        var maybeSyncPoint = this.syncPointTree_.get(path);\r\n        var cancelEvents = [];\r\n        // A removal on a default query affects all queries at that location. A removal on an indexed query, even one without\r\n        // other query constraints, does *not* affect all queries at that location. So this check must be for 'default', and\r\n        // not loadsAllData().\r\n        if (maybeSyncPoint &&\r\n            (query.queryIdentifier() === 'default' ||\r\n                maybeSyncPoint.viewExistsForQuery(query))) {\r\n            /**\r\n             * @type {{removed: !Array.<!Query>, events: !Array.<!Event>}}\r\n             */\r\n            var removedAndEvents = maybeSyncPoint.removeEventRegistration(query, eventRegistration, cancelError);\r\n            if (maybeSyncPoint.isEmpty()) {\r\n                this.syncPointTree_ = this.syncPointTree_.remove(path);\r\n            }\r\n            var removed = removedAndEvents.removed;\r\n            cancelEvents = removedAndEvents.events;\r\n            // We may have just removed one of many listeners and can short-circuit this whole process\r\n            // We may also not have removed a default listener, in which case all of the descendant listeners should already be\r\n            // properly set up.\r\n            //\r\n            // Since indexed queries can shadow if they don't have other query constraints, check for loadsAllData(), instead of\r\n            // queryId === 'default'\r\n            var removingDefault = -1 !==\r\n                removed.findIndex(function (query) {\r\n                    return query.getQueryParams().loadsAllData();\r\n                });\r\n            var covered = this.syncPointTree_.findOnPath(path, function (relativePath, parentSyncPoint) {\r\n                return parentSyncPoint.hasCompleteView();\r\n            });\r\n            if (removingDefault && !covered) {\r\n                var subtree = this.syncPointTree_.subtree(path);\r\n                // There are potentially child listeners. Determine what if any listens we need to send before executing the\r\n                // removal\r\n                if (!subtree.isEmpty()) {\r\n                    // We need to fold over our subtree and collect the listeners to send\r\n                    var newViews = this.collectDistinctViewsForSubTree_(subtree);\r\n                    // Ok, we've collected all the listens we need. Set them up.\r\n                    for (var i = 0; i < newViews.length; ++i) {\r\n                        var view = newViews[i], newQuery = view.getQuery();\r\n                        var listener = this.createListenerForView_(view);\r\n                        this.listenProvider_.startListening(SyncTree.queryForListening_(newQuery), this.tagForQuery_(newQuery), listener.hashFn, listener.onComplete);\r\n                    }\r\n                }\r\n                else {\r\n                    // There's nothing below us, so nothing we need to start listening on\r\n                }\r\n            }\r\n            // If we removed anything and we're not covered by a higher up listen, we need to stop listening on this query\r\n            // The above block has us covered in terms of making sure we're set up on listens lower in the tree.\r\n            // Also, note that if we have a cancelError, it's already been removed at the provider level.\r\n            if (!covered && removed.length > 0 && !cancelError) {\r\n                // If we removed a default, then we weren't listening on any of the other queries here. Just cancel the one\r\n                // default. Otherwise, we need to iterate through and cancel each individual query\r\n                if (removingDefault) {\r\n                    // We don't tag default listeners\r\n                    var defaultTag = null;\r\n                    this.listenProvider_.stopListening(SyncTree.queryForListening_(query), defaultTag);\r\n                }\r\n                else {\r\n                    removed.forEach(function (queryToRemove) {\r\n                        var tagToRemove = _this.queryToTagMap_[SyncTree.makeQueryKey_(queryToRemove)];\r\n                        _this.listenProvider_.stopListening(SyncTree.queryForListening_(queryToRemove), tagToRemove);\r\n                    });\r\n                }\r\n            }\r\n            // Now, clear all of the tags we're tracking for the removed listens\r\n            this.removeTags_(removed);\r\n        }\r\n        else {\r\n            // No-op, this listener must've been already removed\r\n        }\r\n        return cancelEvents;\r\n    };\r\n    /**\r\n     * Returns a complete cache, if we have one, of the data at a particular path. The location must have a listener above\r\n     * it, but as this is only used by transaction code, that should always be the case anyways.\r\n     *\r\n     * Note: this method will *include* hidden writes from transaction with applyLocally set to false.\r\n     * @param {!Path} path The path to the data we want\r\n     * @param {Array.<number>=} writeIdsToExclude A specific set to be excluded\r\n     * @return {?Node}\r\n     */\r\n    SyncTree.prototype.calcCompleteEventCache = function (path, writeIdsToExclude) {\r\n        var includeHiddenSets = true;\r\n        var writeTree = this.pendingWriteTree_;\r\n        var serverCache = this.syncPointTree_.findOnPath(path, function (pathSoFar, syncPoint) {\r\n            var relativePath = Path.relativePath(pathSoFar, path);\r\n            var serverCache = syncPoint.getCompleteServerCache(relativePath);\r\n            if (serverCache) {\r\n                return serverCache;\r\n            }\r\n        });\r\n        return writeTree.calcCompleteEventCache(path, serverCache, writeIdsToExclude, includeHiddenSets);\r\n    };\r\n    /**\r\n     * This collapses multiple unfiltered views into a single view, since we only need a single\r\n     * listener for them.\r\n     *\r\n     * @param {!ImmutableTree.<!SyncPoint>} subtree\r\n     * @return {!Array.<!View>}\r\n     * @private\r\n     */\r\n    SyncTree.prototype.collectDistinctViewsForSubTree_ = function (subtree) {\r\n        return subtree.fold(function (relativePath, maybeChildSyncPoint, childMap) {\r\n            if (maybeChildSyncPoint && maybeChildSyncPoint.hasCompleteView()) {\r\n                var completeView = maybeChildSyncPoint.getCompleteView();\r\n                return [completeView];\r\n            }\r\n            else {\r\n                // No complete view here, flatten any deeper listens into an array\r\n                var views_1 = [];\r\n                if (maybeChildSyncPoint) {\r\n                    views_1 = maybeChildSyncPoint.getQueryViews();\r\n                }\r\n                forEach(childMap, function (key, childViews) {\r\n                    views_1 = views_1.concat(childViews);\r\n                });\r\n                return views_1;\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * @param {!Array.<!Query>} queries\r\n     * @private\r\n     */\r\n    SyncTree.prototype.removeTags_ = function (queries) {\r\n        for (var j = 0; j < queries.length; ++j) {\r\n            var removedQuery = queries[j];\r\n            if (!removedQuery.getQueryParams().loadsAllData()) {\r\n                // We should have a tag for this\r\n                var removedQueryKey = SyncTree.makeQueryKey_(removedQuery);\r\n                var removedQueryTag = this.queryToTagMap_[removedQueryKey];\r\n                delete this.queryToTagMap_[removedQueryKey];\r\n                delete this.tagToQueryMap_['_' + removedQueryTag];\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Normalizes a query to a query we send the server for listening\r\n     * @param {!Query} query\r\n     * @return {!Query} The normalized query\r\n     * @private\r\n     */\r\n    SyncTree.queryForListening_ = function (query) {\r\n        if (query.getQueryParams().loadsAllData() &&\r\n            !query.getQueryParams().isDefault()) {\r\n            // We treat queries that load all data as default queries\r\n            // Cast is necessary because ref() technically returns Firebase which is actually fb.api.Firebase which inherits\r\n            // from Query\r\n            return /** @type {!Query} */ query.getRef();\r\n        }\r\n        else {\r\n            return query;\r\n        }\r\n    };\r\n    /**\r\n     * For a given new listen, manage the de-duplication of outstanding subscriptions.\r\n     *\r\n     * @param {!Query} query\r\n     * @param {!View} view\r\n     * @return {!Array.<!Event>} This method can return events to support synchronous data sources\r\n     * @private\r\n     */\r\n    SyncTree.prototype.setupListener_ = function (query, view) {\r\n        var path = query.path;\r\n        var tag = this.tagForQuery_(query);\r\n        var listener = this.createListenerForView_(view);\r\n        var events = this.listenProvider_.startListening(SyncTree.queryForListening_(query), tag, listener.hashFn, listener.onComplete);\r\n        var subtree = this.syncPointTree_.subtree(path);\r\n        // The root of this subtree has our query. We're here because we definitely need to send a listen for that, but we\r\n        // may need to shadow other listens as well.\r\n        if (tag) {\r\n            assert(!subtree.value.hasCompleteView(), \"If we're adding a query, it shouldn't be shadowed\");\r\n        }\r\n        else {\r\n            // Shadow everything at or below this location, this is a default listener.\r\n            var queriesToStop = subtree.fold(function (relativePath, maybeChildSyncPoint, childMap) {\r\n                if (!relativePath.isEmpty() &&\r\n                    maybeChildSyncPoint &&\r\n                    maybeChildSyncPoint.hasCompleteView()) {\r\n                    return [maybeChildSyncPoint.getCompleteView().getQuery()];\r\n                }\r\n                else {\r\n                    // No default listener here, flatten any deeper queries into an array\r\n                    var queries_1 = [];\r\n                    if (maybeChildSyncPoint) {\r\n                        queries_1 = queries_1.concat(maybeChildSyncPoint.getQueryViews().map(function (view) { return view.getQuery(); }));\r\n                    }\r\n                    forEach(childMap, function (key, childQueries) {\r\n                        queries_1 = queries_1.concat(childQueries);\r\n                    });\r\n                    return queries_1;\r\n                }\r\n            });\r\n            for (var i = 0; i < queriesToStop.length; ++i) {\r\n                var queryToStop = queriesToStop[i];\r\n                this.listenProvider_.stopListening(SyncTree.queryForListening_(queryToStop), this.tagForQuery_(queryToStop));\r\n            }\r\n        }\r\n        return events;\r\n    };\r\n    /**\r\n     *\r\n     * @param {!View} view\r\n     * @return {{hashFn: function(), onComplete: function(!string, *)}}\r\n     * @private\r\n     */\r\n    SyncTree.prototype.createListenerForView_ = function (view) {\r\n        var _this = this;\r\n        var query = view.getQuery();\r\n        var tag = this.tagForQuery_(query);\r\n        return {\r\n            hashFn: function () {\r\n                var cache = view.getServerCache() || ChildrenNode.EMPTY_NODE;\r\n                return cache.hash();\r\n            },\r\n            onComplete: function (status) {\r\n                if (status === 'ok') {\r\n                    if (tag) {\r\n                        return _this.applyTaggedListenComplete(query.path, tag);\r\n                    }\r\n                    else {\r\n                        return _this.applyListenComplete(query.path);\r\n                    }\r\n                }\r\n                else {\r\n                    // If a listen failed, kill all of the listeners here, not just the one that triggered the error.\r\n                    // Note that this may need to be scoped to just this listener if we change permissions on filtered children\r\n                    var error$$1 = errorForServerCode(status, query);\r\n                    return _this.removeEventRegistration(query, \r\n                    /*eventRegistration*/ null, error$$1);\r\n                }\r\n            }\r\n        };\r\n    };\r\n    /**\r\n     * Given a query, computes a \"queryKey\" suitable for use in our queryToTagMap_.\r\n     * @private\r\n     * @param {!Query} query\r\n     * @return {string}\r\n     */\r\n    SyncTree.makeQueryKey_ = function (query) {\r\n        return query.path.toString() + '$' + query.queryIdentifier();\r\n    };\r\n    /**\r\n     * Given a queryKey (created by makeQueryKey), parse it back into a path and queryId.\r\n     * @private\r\n     * @param {!string} queryKey\r\n     * @return {{queryId: !string, path: !Path}}\r\n     */\r\n    SyncTree.parseQueryKey_ = function (queryKey) {\r\n        var splitIndex = queryKey.indexOf('$');\r\n        assert(splitIndex !== -1 && splitIndex < queryKey.length - 1, 'Bad queryKey.');\r\n        return {\r\n            queryId: queryKey.substr(splitIndex + 1),\r\n            path: new Path(queryKey.substr(0, splitIndex))\r\n        };\r\n    };\r\n    /**\r\n     * Return the query associated with the given tag, if we have one\r\n     * @param {!number} tag\r\n     * @return {?string}\r\n     * @private\r\n     */\r\n    SyncTree.prototype.queryKeyForTag_ = function (tag) {\r\n        return this.tagToQueryMap_['_' + tag];\r\n    };\r\n    /**\r\n     * Return the tag associated with the given query.\r\n     * @param {!Query} query\r\n     * @return {?number}\r\n     * @private\r\n     */\r\n    SyncTree.prototype.tagForQuery_ = function (query) {\r\n        var queryKey = SyncTree.makeQueryKey_(query);\r\n        return safeGet(this.queryToTagMap_, queryKey);\r\n    };\r\n    /**\r\n     * Static accessor for query tags.\r\n     * @return {number}\r\n     * @private\r\n     */\r\n    SyncTree.getNextQueryTag_ = function () {\r\n        return SyncTree.nextQueryTag_++;\r\n    };\r\n    /**\r\n     * A helper method to apply tagged operations\r\n     *\r\n     * @param {!Path} queryPath\r\n     * @param {!Operation} operation\r\n     * @return {!Array.<!Event>}\r\n     * @private\r\n     */\r\n    SyncTree.prototype.applyTaggedOperation_ = function (queryPath, operation) {\r\n        var syncPoint = this.syncPointTree_.get(queryPath);\r\n        assert(syncPoint, \"Missing sync point for query tag that we're tracking\");\r\n        var writesCache = this.pendingWriteTree_.childWrites(queryPath);\r\n        return syncPoint.applyOperation(operation, writesCache, \r\n        /*serverCache=*/ null);\r\n    };\r\n    /**\r\n     * A helper method that visits all descendant and ancestor SyncPoints, applying the operation.\r\n     *\r\n     * NOTES:\r\n     * - Descendant SyncPoints will be visited first (since we raise events depth-first).\r\n  \n     * - We call applyOperation() on each SyncPoint passing three things:\r\n     *   1. A version of the Operation that has been made relative to the SyncPoint location.\r\n     *   2. A WriteTreeRef of any writes we have cached at the SyncPoint location.\r\n     *   3. A snapshot Node with cached server data, if we have it.\r\n  \n     * - We concatenate all of the events returned by each SyncPoint and return the result.\r\n     *\r\n     * @param {!Operation} operation\r\n     * @return {!Array.<!Event>}\r\n     * @private\r\n     */\r\n    SyncTree.prototype.applyOperationToSyncPoints_ = function (operation) {\r\n        return this.applyOperationHelper_(operation, this.syncPointTree_, \r\n        /*serverCache=*/ null, this.pendingWriteTree_.childWrites(Path.Empty));\r\n    };\r\n    /**\r\n     * Recursive helper for applyOperationToSyncPoints_\r\n     *\r\n     * @private\r\n     * @param {!Operation} operation\r\n     * @param {ImmutableTree.<!SyncPoint>} syncPointTree\r\n     * @param {?Node} serverCache\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @return {!Array.<!Event>}\r\n     */\r\n    SyncTree.prototype.applyOperationHelper_ = function (operation, syncPointTree, serverCache, writesCache) {\r\n        if (operation.path.isEmpty()) {\r\n            return this.applyOperationDescendantsHelper_(operation, syncPointTree, serverCache, writesCache);\r\n        }\r\n        else {\r\n            var syncPoint = syncPointTree.get(Path.Empty);\r\n            // If we don't have cached server data, see if we can get it from this SyncPoint.\r\n            if (serverCache == null && syncPoint != null) {\r\n                serverCache = syncPoint.getCompleteServerCache(Path.Empty);\r\n            }\r\n            var events = [];\r\n            var childName = operation.path.getFront();\r\n            var childOperation = operation.operationForChild(childName);\r\n            var childTree = syncPointTree.children.get(childName);\r\n            if (childTree && childOperation) {\r\n                var childServerCache = serverCache\r\n                    ? serverCache.getImmediateChild(childName)\r\n                    : null;\r\n                var childWritesCache = writesCache.child(childName);\r\n                events = events.concat(this.applyOperationHelper_(childOperation, childTree, childServerCache, childWritesCache));\r\n            }\r\n            if (syncPoint) {\r\n                events = events.concat(syncPoint.applyOperation(operation, writesCache, serverCache));\r\n            }\r\n            return events;\r\n        }\r\n    };\r\n    /**\r\n     * Recursive helper for applyOperationToSyncPoints_\r\n     *\r\n     * @private\r\n     * @param {!Operation} operation\r\n     * @param {ImmutableTree.<!SyncPoint>} syncPointTree\r\n     * @param {?Node} serverCache\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @return {!Array.<!Event>}\r\n     */\r\n    SyncTree.prototype.applyOperationDescendantsHelper_ = function (operation, syncPointTree, serverCache, writesCache) {\r\n        var _this = this;\r\n        var syncPoint = syncPointTree.get(Path.Empty);\r\n        // If we don't have cached server data, see if we can get it from this SyncPoint.\r\n        if (serverCache == null && syncPoint != null) {\r\n            serverCache = syncPoint.getCompleteServerCache(Path.Empty);\r\n        }\r\n        var events = [];\r\n        syncPointTree.children.inorderTraversal(function (childName, childTree) {\r\n            var childServerCache = serverCache\r\n                ? serverCache.getImmediateChild(childName)\r\n                : null;\r\n            var childWritesCache = writesCache.child(childName);\r\n            var childOperation = operation.operationForChild(childName);\r\n            if (childOperation) {\r\n                events = events.concat(_this.applyOperationDescendantsHelper_(childOperation, childTree, childServerCache, childWritesCache));\r\n            }\r\n        });\r\n        if (syncPoint) {\r\n            events = events.concat(syncPoint.applyOperation(operation, writesCache, serverCache));\r\n        }\r\n        return events;\r\n    };\r\n    /**\r\n     * Static tracker for next query tag.\r\n     * @type {number}\r\n     * @private\r\n     */\r\n    SyncTree.nextQueryTag_ = 1;\r\n    return SyncTree;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Mutable object which basically just stores a reference to the \"latest\" immutable snapshot.\r\n *\r\n * @constructor\r\n */\r\nvar SnapshotHolder = /** @class */ (function () {\r\n    function SnapshotHolder() {\r\n        this.rootNode_ = ChildrenNode.EMPTY_NODE;\r\n    }\r\n    SnapshotHolder.prototype.getNode = function (path) {\r\n        return this.rootNode_.getChild(path);\r\n    };\r\n    SnapshotHolder.prototype.updateSnapshot = function (path, newSnapshotNode) {\r\n        this.rootNode_ = this.rootNode_.updateChild(path, newSnapshotNode);\r\n    };\r\n    return SnapshotHolder;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Abstraction around FirebaseApp's token fetching capabilities.\r\n */\r\nvar AuthTokenProvider = /** @class */ (function () {\r\n    /**\r\n     * @param {!FirebaseApp} app_\r\n     */\r\n    function AuthTokenProvider(app_) {\r\n        this.app_ = app_;\r\n    }\r\n    /**\r\n     * @param {boolean} forceRefresh\r\n     * @return {!Promise<FirebaseAuthTokenData>}\r\n     */\r\n    AuthTokenProvider.prototype.getToken = function (forceRefresh) {\r\n        return this.app_['INTERNAL']['getToken'](forceRefresh).then(null, \r\n        // .catch\r\n        function (error$$1) {\r\n            // TODO: Need to figure out all the cases this is raised and whether\r\n            // this makes sense.\r\n            if (error$$1 && error$$1.code === 'auth/token-not-initialized') {\r\n                log('Got auth/token-not-initialized error.  Treating as null token.');\r\n                return null;\r\n            }\r\n            else {\r\n                return Promise.reject(error$$1);\r\n            }\r\n        });\r\n    };\r\n    AuthTokenProvider.prototype.addTokenChangeListener = function (listener) {\r\n        // TODO: We might want to wrap the listener and call it with no args to\r\n        // avoid a leaky abstraction, but that makes removing the listener harder.\r\n        this.app_['INTERNAL']['addAuthTokenListener'](listener);\r\n    };\r\n    AuthTokenProvider.prototype.removeTokenChangeListener = function (listener) {\r\n        this.app_['INTERNAL']['removeAuthTokenListener'](listener);\r\n    };\r\n    AuthTokenProvider.prototype.notifyForInvalidToken = function () {\r\n        var errorMessage = 'Provided authentication credentials for the app named \"' +\r\n            this.app_.name +\r\n            '\" are invalid. This usually indicates your app was not ' +\r\n            'initialized correctly. ';\r\n        if ('credential' in this.app_.options) {\r\n            errorMessage +=\r\n                'Make sure the \"credential\" property provided to initializeApp() ' +\r\n                    'is authorized to access the specified \"databaseURL\" and is from the correct ' +\r\n                    'project.';\r\n        }\r\n        else if ('serviceAccount' in this.app_.options) {\r\n            errorMessage +=\r\n                'Make sure the \"serviceAccount\" property provided to initializeApp() ' +\r\n                    'is authorized to access the specified \"databaseURL\" and is from the correct ' +\r\n                    'project.';\r\n        }\r\n        else {\r\n            errorMessage +=\r\n                'Make sure the \"apiKey\" and \"databaseURL\" properties provided to ' +\r\n                    'initializeApp() match the values provided for your app at ' +\r\n                    'https://console.firebase.google.com/.';\r\n        }\r\n        warn(errorMessage);\r\n    };\r\n    return AuthTokenProvider;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Tracks a collection of stats.\r\n *\r\n * @constructor\r\n */\r\nvar StatsCollection = /** @class */ (function () {\r\n    function StatsCollection() {\r\n        this.counters_ = {};\r\n    }\r\n    StatsCollection.prototype.incrementCounter = function (name, amount) {\r\n        if (amount === void 0) { amount = 1; }\r\n        if (!contains(this.counters_, name))\r\n            this.counters_[name] = 0;\r\n        this.counters_[name] += amount;\r\n    };\r\n    StatsCollection.prototype.get = function () {\r\n        return deepCopy(this.counters_);\r\n    };\r\n    return StatsCollection;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar StatsManager = /** @class */ (function () {\r\n    function StatsManager() {\r\n    }\r\n    StatsManager.getCollection = function (repoInfo) {\r\n        var hashString = repoInfo.toString();\r\n        if (!this.collections_[hashString]) {\r\n            this.collections_[hashString] = new StatsCollection();\r\n        }\r\n        return this.collections_[hashString];\r\n    };\r\n    StatsManager.getOrCreateReporter = function (repoInfo, creatorFunction) {\r\n        var hashString = repoInfo.toString();\r\n        if (!this.reporters_[hashString]) {\r\n            this.reporters_[hashString] = creatorFunction();\r\n        }\r\n        return this.reporters_[hashString];\r\n    };\r\n    StatsManager.collections_ = {};\r\n    StatsManager.reporters_ = {};\r\n    return StatsManager;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns the delta from the previous call to get stats.\r\n *\r\n * @param collection_ The collection to \"listen\" to.\r\n * @constructor\r\n */\r\nvar StatsListener = /** @class */ (function () {\r\n    function StatsListener(collection_) {\r\n        this.collection_ = collection_;\r\n        this.last_ = null;\r\n    }\r\n    StatsListener.prototype.get = function () {\r\n        var newStats = this.collection_.get();\r\n        var delta = clone(newStats);\r\n        if (this.last_) {\r\n            forEach(this.last_, function (stat, value) {\r\n                delta[stat] = delta[stat] - value;\r\n            });\r\n        }\r\n        this.last_ = newStats;\r\n        return delta;\r\n    };\r\n    return StatsListener;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Assuming some apps may have a short amount of time on page, and a bulk of firebase operations probably\r\n// happen on page load, we try to report our first set of stats pretty quickly, but we wait at least 10\r\n// seconds to try to ensure the Firebase connection is established / settled.\r\nvar FIRST_STATS_MIN_TIME = 10 * 1000;\r\nvar FIRST_STATS_MAX_TIME = 30 * 1000;\r\n// We'll continue to report stats on average every 5 minutes.\r\nvar REPORT_STATS_INTERVAL = 5 * 60 * 1000;\r\n/**\r\n * @constructor\r\n */\r\nvar StatsReporter = /** @class */ (function () {\r\n    /**\r\n     * @param collection\r\n     * @param server_\r\n     */\r\n    function StatsReporter(collection, server_) {\r\n        this.server_ = server_;\r\n        this.statsToReport_ = {};\r\n        this.statsListener_ = new StatsListener(collection);\r\n        var timeout = FIRST_STATS_MIN_TIME +\r\n            (FIRST_STATS_MAX_TIME - FIRST_STATS_MIN_TIME) * Math.random();\r\n        setTimeoutNonBlocking(this.reportStats_.bind(this), Math.floor(timeout));\r\n    }\r\n    StatsReporter.prototype.includeStat = function (stat) {\r\n        this.statsToReport_[stat] = true;\r\n    };\r\n    StatsReporter.prototype.reportStats_ = function () {\r\n        var _this = this;\r\n        var stats = this.statsListener_.get();\r\n        var reportedStats = {};\r\n        var haveStatsToReport = false;\r\n        forEach(stats, function (stat, value) {\r\n            if (value > 0 && contains(_this.statsToReport_, stat)) {\r\n                reportedStats[stat] = value;\r\n                haveStatsToReport = true;\r\n            }\r\n        });\r\n        if (haveStatsToReport) {\r\n            this.server_.reportStats(reportedStats);\r\n        }\r\n        // queue our next run.\r\n        setTimeoutNonBlocking(this.reportStats_.bind(this), Math.floor(Math.random() * 2 * REPORT_STATS_INTERVAL));\r\n    };\r\n    return StatsReporter;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * The event queue serves a few purposes:\r\n * 1. It ensures we maintain event order in the face of event callbacks doing operations that result in more\r\n *    events being queued.\r\n * 2. raiseQueuedEvents() handles being called reentrantly nicely.  That is, if in the course of raising events,\r\n *    raiseQueuedEvents() is called again, the \"inner\" call will pick up raising events where the \"outer\" call\r\n *    left off, ensuring that the events are still raised synchronously and in order.\r\n * 3. You can use raiseEventsAtPath and raiseEventsForChangedPath to ensure only relevant previously-queued\r\n *    events are raised synchronously.\r\n *\r\n * NOTE: This can all go away if/when we move to async events.\r\n *\r\n * @constructor\r\n */\r\nvar EventQueue = /** @class */ (function () {\r\n    function EventQueue() {\r\n        /**\r\n         * @private\r\n         * @type {!Array.<EventList>}\r\n         */\r\n        this.eventLists_ = [];\r\n        /**\r\n         * Tracks recursion depth of raiseQueuedEvents_, for debugging purposes.\r\n         * @private\r\n         * @type {!number}\r\n         */\r\n        this.recursionDepth_ = 0;\r\n    }\r\n    /**\r\n     * @param {!Array.<Event>} eventDataList The new events to queue.\r\n     */\r\n    EventQueue.prototype.queueEvents = function (eventDataList) {\r\n        // We group events by path, storing them in a single EventList, to make it easier to skip over them quickly.\r\n        var currList = null;\r\n        for (var i = 0; i < eventDataList.length; i++) {\r\n            var eventData = eventDataList[i];\r\n            var eventPath = eventData.getPath();\r\n            if (currList !== null && !eventPath.equals(currList.getPath())) {\r\n                this.eventLists_.push(currList);\r\n                currList = null;\r\n            }\r\n            if (currList === null) {\r\n                currList = new EventList(eventPath);\r\n            }\r\n            currList.add(eventData);\r\n        }\r\n        if (currList) {\r\n            this.eventLists_.push(currList);\r\n        }\r\n    };\r\n    /**\r\n     * Queues the specified events and synchronously raises all events (including previously queued ones)\r\n     * for the specified path.\r\n     *\r\n     * It is assumed that the new events are all for the specified path.\r\n     *\r\n     * @param {!Path} path The path to raise events for.\r\n     * @param {!Array.<Event>} eventDataList The new events to raise.\r\n     */\r\n    EventQueue.prototype.raiseEventsAtPath = function (path, eventDataList) {\r\n        this.queueEvents(eventDataList);\r\n        this.raiseQueuedEventsMatchingPredicate_(function (eventPath) {\r\n            return eventPath.equals(path);\r\n        });\r\n    };\r\n    /**\r\n     * Queues the specified events and synchronously raises all events (including previously queued ones) for\r\n     * locations related to the specified change path (i.e. all ancestors and descendants).\r\n     *\r\n     * It is assumed that the new events are all related (ancestor or descendant) to the specified path.\r\n     *\r\n     * @param {!Path} changedPath The path to raise events for.\r\n     * @param {!Array.<!Event>} eventDataList The events to raise\r\n     */\r\n    EventQueue.prototype.raiseEventsForChangedPath = function (changedPath, eventDataList) {\r\n        this.queueEvents(eventDataList);\r\n        this.raiseQueuedEventsMatchingPredicate_(function (eventPath) {\r\n            return eventPath.contains(changedPath) || changedPath.contains(eventPath);\r\n        });\r\n    };\r\n    /**\r\n     * @param {!function(!Path):boolean} predicate\r\n     * @private\r\n     */\r\n    EventQueue.prototype.raiseQueuedEventsMatchingPredicate_ = function (predicate) {\r\n        this.recursionDepth_++;\r\n        var sentAll = true;\r\n        for (var i = 0; i < this.eventLists_.length; i++) {\r\n            var eventList = this.eventLists_[i];\r\n            if (eventList) {\r\n                var eventPath = eventList.getPath();\r\n                if (predicate(eventPath)) {\r\n                    this.eventLists_[i].raise();\r\n                    this.eventLists_[i] = null;\r\n                }\r\n                else {\r\n                    sentAll = false;\r\n                }\r\n            }\r\n        }\r\n        if (sentAll) {\r\n            this.eventLists_ = [];\r\n        }\r\n        this.recursionDepth_--;\r\n    };\r\n    return EventQueue;\r\n}());\r\n/**\r\n * @param {!Path} path\r\n * @constructor\r\n */\r\nvar EventList = /** @class */ (function () {\r\n    function EventList(path_) {\r\n        this.path_ = path_;\r\n        /**\r\n         * @type {!Array.<Event>}\r\n         * @private\r\n         */\r\n        this.events_ = [];\r\n    }\r\n    /**\r\n     * @param {!Event} eventData\r\n     */\r\n    EventList.prototype.add = function (eventData) {\r\n        this.events_.push(eventData);\r\n    };\r\n    /**\r\n     * Iterates through the list and raises each event\r\n     */\r\n    EventList.prototype.raise = function () {\r\n        for (var i = 0; i < this.events_.length; i++) {\r\n            var eventData = this.events_[i];\r\n            if (eventData !== null) {\r\n                this.events_[i] = null;\r\n                var eventFn = eventData.getEventRunner();\r\n                if (logger) {\r\n                    log('event: ' + eventData.toString());\r\n                }\r\n                exceptionGuard(eventFn);\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * @return {!Path}\r\n     */\r\n    EventList.prototype.getPath = function () {\r\n        return this.path_;\r\n    };\r\n    return EventList;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Base class to be used if you want to emit events. Call the constructor with\r\n * the set of allowed event names.\r\n */\r\nvar EventEmitter = /** @class */ (function () {\r\n    /**\r\n     * @param {!Array.<string>} allowedEvents_\r\n     */\r\n    function EventEmitter(allowedEvents_) {\r\n        this.allowedEvents_ = allowedEvents_;\r\n        this.listeners_ = {};\r\n        assert(Array.isArray(allowedEvents_) && allowedEvents_.length > 0, 'Requires a non-empty array');\r\n    }\r\n    /**\r\n     * To be called by derived classes to trigger events.\r\n     * @param {!string} eventType\r\n     * @param {...*} var_args\r\n     */\r\n    EventEmitter.prototype.trigger = function (eventType) {\r\n        var var_args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            var_args[_i - 1] = arguments[_i];\r\n        }\r\n        if (Array.isArray(this.listeners_[eventType])) {\r\n            // Clone the list, since callbacks could add/remove listeners.\r\n            var listeners = this.listeners_[eventType].slice();\r\n            for (var i = 0; i < listeners.length; i++) {\r\n                listeners[i].callback.apply(listeners[i].context, var_args);\r\n            }\r\n        }\r\n    };\r\n    EventEmitter.prototype.on = function (eventType, callback, context) {\r\n        this.validateEventType_(eventType);\r\n        this.listeners_[eventType] = this.listeners_[eventType] || [];\r\n        this.listeners_[eventType].push({ callback: callback, context: context });\r\n        var eventData = this.getInitialEvent(eventType);\r\n        if (eventData) {\r\n            callback.apply(context, eventData);\r\n        }\r\n    };\r\n    EventEmitter.prototype.off = function (eventType, callback, context) {\r\n        this.validateEventType_(eventType);\r\n        var listeners = this.listeners_[eventType] || [];\r\n        for (var i = 0; i < listeners.length; i++) {\r\n            if (listeners[i].callback === callback &&\r\n                (!context || context === listeners[i].context)) {\r\n                listeners.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    };\r\n    EventEmitter.prototype.validateEventType_ = function (eventType) {\r\n        assert(this.allowedEvents_.find(function (et) {\r\n            return et === eventType;\r\n        }), 'Unknown event: ' + eventType);\r\n    };\r\n    return EventEmitter;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @extends {EventEmitter}\r\n */\r\nvar VisibilityMonitor = /** @class */ (function (_super) {\r\n    __extends(VisibilityMonitor, _super);\r\n    function VisibilityMonitor() {\r\n        var _this = _super.call(this, ['visible']) || this;\r\n        var hidden;\r\n        var visibilityChange;\r\n        if (typeof document !== 'undefined' &&\r\n            typeof document.addEventListener !== 'undefined') {\r\n            if (typeof document['hidden'] !== 'undefined') {\r\n                // Opera 12.10 and Firefox 18 and later support\r\n                visibilityChange = 'visibilitychange';\r\n                hidden = 'hidden';\r\n            }\r\n            else if (typeof document['mozHidden'] !== 'undefined') {\r\n                visibilityChange = 'mozvisibilitychange';\r\n                hidden = 'mozHidden';\r\n            }\r\n            else if (typeof document['msHidden'] !== 'undefined') {\r\n                visibilityChange = 'msvisibilitychange';\r\n                hidden = 'msHidden';\r\n            }\r\n            else if (typeof document['webkitHidden'] !== 'undefined') {\r\n                visibilityChange = 'webkitvisibilitychange';\r\n                hidden = 'webkitHidden';\r\n            }\r\n        }\r\n        // Initially, we always assume we are visible. This ensures that in browsers\r\n        // without page visibility support or in cases where we are never visible\r\n        // (e.g. chrome extension), we act as if we are visible, i.e. don't delay\r\n        // reconnects\r\n        _this.visible_ = true;\r\n        if (visibilityChange) {\r\n            document.addEventListener(visibilityChange, function () {\r\n                var visible = !document[hidden];\r\n                if (visible !== _this.visible_) {\r\n                    _this.visible_ = visible;\r\n                    _this.trigger('visible', visible);\r\n                }\r\n            }, false);\r\n        }\r\n        return _this;\r\n    }\r\n    VisibilityMonitor.getInstance = function () {\r\n        return new VisibilityMonitor();\r\n    };\r\n    /**\r\n     * @param {!string} eventType\r\n     * @return {Array.<boolean>}\r\n     */\r\n    VisibilityMonitor.prototype.getInitialEvent = function (eventType) {\r\n        assert(eventType === 'visible', 'Unknown event type: ' + eventType);\r\n        return [this.visible_];\r\n    };\r\n    return VisibilityMonitor;\r\n}(EventEmitter));\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Monitors online state (as reported by window.online/offline events).\r\n *\r\n * The expectation is that this could have many false positives (thinks we are online\r\n * when we're not), but no false negatives.  So we can safely use it to determine when\r\n * we definitely cannot reach the internet.\r\n *\r\n * @extends {EventEmitter}\r\n */\r\nvar OnlineMonitor = /** @class */ (function (_super) {\r\n    __extends(OnlineMonitor, _super);\r\n    function OnlineMonitor() {\r\n        var _this = _super.call(this, ['online']) || this;\r\n        _this.online_ = true;\r\n        // We've had repeated complaints that Cordova apps can get stuck \"offline\", e.g.\r\n        // https://forum.ionicframework.com/t/firebase-connection-is-lost-and-never-come-back/43810\r\n        // It would seem that the 'online' event does not always fire consistently. So we disable it\r\n        // for Cordova.\r\n        if (typeof window !== 'undefined' &&\r\n            typeof window.addEventListener !== 'undefined' &&\r\n            !isMobileCordova()) {\r\n            window.addEventListener('online', function () {\r\n                if (!_this.online_) {\r\n                    _this.online_ = true;\r\n                    _this.trigger('online', true);\r\n                }\r\n            }, false);\r\n            window.addEventListener('offline', function () {\r\n                if (_this.online_) {\r\n                    _this.online_ = false;\r\n                    _this.trigger('online', false);\r\n                }\r\n            }, false);\r\n        }\r\n        return _this;\r\n    }\r\n    OnlineMonitor.getInstance = function () {\r\n        return new OnlineMonitor();\r\n    };\r\n    /**\r\n     * @param {!string} eventType\r\n     * @return {Array.<boolean>}\r\n     */\r\n    OnlineMonitor.prototype.getInitialEvent = function (eventType) {\r\n        assert(eventType === 'online', 'Unknown event type: ' + eventType);\r\n        return [this.online_];\r\n    };\r\n    /**\r\n     * @return {boolean}\r\n     */\r\n    OnlineMonitor.prototype.currentlyOnline = function () {\r\n        return this.online_;\r\n    };\r\n    return OnlineMonitor;\r\n}(EventEmitter));\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * This class ensures the packets from the server arrive in order\r\n * This class takes data from the server and ensures it gets passed into the callbacks in order.\r\n * @constructor\r\n */\r\nvar PacketReceiver = /** @class */ (function () {\r\n    /**\r\n     * @param onMessage_\r\n     */\r\n    function PacketReceiver(onMessage_) {\r\n        this.onMessage_ = onMessage_;\r\n        this.pendingResponses = [];\r\n        this.currentResponseNum = 0;\r\n        this.closeAfterResponse = -1;\r\n        this.onClose = null;\r\n    }\r\n    PacketReceiver.prototype.closeAfter = function (responseNum, callback) {\r\n        this.closeAfterResponse = responseNum;\r\n        this.onClose = callback;\r\n        if (this.closeAfterResponse < this.currentResponseNum) {\r\n            this.onClose();\r\n            this.onClose = null;\r\n        }\r\n    };\r\n    /**\r\n     * Each message from the server comes with a response number, and an array of data. The responseNumber\r\n     * allows us to ensure that we process them in the right order, since we can't be guaranteed that all\r\n     * browsers will respond in the same order as the requests we sent\r\n     * @param {number} requestNum\r\n     * @param {Array} data\r\n     */\r\n    PacketReceiver.prototype.handleResponse = function (requestNum, data) {\r\n        var _this = this;\r\n        this.pendingResponses[requestNum] = data;\r\n        var _loop_1 = function () {\r\n            var toProcess = this_1.pendingResponses[this_1.currentResponseNum];\r\n            delete this_1.pendingResponses[this_1.currentResponseNum];\r\n            var _loop_2 = function (i) {\r\n                if (toProcess[i]) {\r\n                    exceptionGuard(function () {\r\n                        _this.onMessage_(toProcess[i]);\r\n                    });\r\n                }\r\n            };\r\n            for (var i = 0; i < toProcess.length; ++i) {\r\n                _loop_2(i);\r\n            }\r\n            if (this_1.currentResponseNum === this_1.closeAfterResponse) {\r\n                if (this_1.onClose) {\r\n                    this_1.onClose();\r\n                    this_1.onClose = null;\r\n                }\r\n                return \"break\";\r\n            }\r\n            this_1.currentResponseNum++;\r\n        };\r\n        var this_1 = this;\r\n        while (this.pendingResponses[this.currentResponseNum]) {\r\n            var state_1 = _loop_1();\r\n            if (state_1 === \"break\")\r\n                break;\r\n        }\r\n    };\r\n    return PacketReceiver;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// URL query parameters associated with longpolling\r\nvar FIREBASE_LONGPOLL_START_PARAM = 'start';\r\nvar FIREBASE_LONGPOLL_CLOSE_COMMAND = 'close';\r\nvar FIREBASE_LONGPOLL_COMMAND_CB_NAME = 'pLPCommand';\r\nvar FIREBASE_LONGPOLL_DATA_CB_NAME = 'pRTLPCB';\r\nvar FIREBASE_LONGPOLL_ID_PARAM = 'id';\r\nvar FIREBASE_LONGPOLL_PW_PARAM = 'pw';\r\nvar FIREBASE_LONGPOLL_SERIAL_PARAM = 'ser';\r\nvar FIREBASE_LONGPOLL_CALLBACK_ID_PARAM = 'cb';\r\nvar FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM = 'seg';\r\nvar FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET = 'ts';\r\nvar FIREBASE_LONGPOLL_DATA_PARAM = 'd';\r\nvar FIREBASE_LONGPOLL_DISCONN_FRAME_PARAM = 'disconn';\r\nvar FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM = 'dframe';\r\n//Data size constants.\r\n//TODO: Perf: the maximum length actually differs from browser to browser.\r\n// We should check what browser we're on and set accordingly.\r\nvar MAX_URL_DATA_SIZE = 1870;\r\nvar SEG_HEADER_SIZE = 30; //ie: &seg=8299234&ts=982389123&d=\r\nvar MAX_PAYLOAD_SIZE = MAX_URL_DATA_SIZE - SEG_HEADER_SIZE;\r\n/**\r\n * Keepalive period\r\n * send a fresh request at minimum every 25 seconds. Opera has a maximum request\r\n * length of 30 seconds that we can't exceed.\r\n * @const\r\n * @type {number}\r\n */\r\nvar KEEPALIVE_REQUEST_INTERVAL = 25000;\r\n/**\r\n * How long to wait before aborting a long-polling connection attempt.\r\n * @const\r\n * @type {number}\r\n */\r\nvar LP_CONNECT_TIMEOUT = 30000;\r\n/**\r\n * This class manages a single long-polling connection.\r\n *\r\n * @constructor\r\n * @implements {Transport}\r\n */\r\nvar BrowserPollConnection = /** @class */ (function () {\r\n    /**\r\n     * @param {string} connId An identifier for this connection, used for logging\r\n     * @param {RepoInfo} repoInfo The info for the endpoint to send data to.\r\n     * @param {string=} transportSessionId Optional transportSessionid if we are reconnecting for an existing\r\n     *                                         transport session\r\n     * @param {string=}  lastSessionId Optional lastSessionId if the PersistentConnection has already created a\r\n     *                                     connection previously\r\n     */\r\n    function BrowserPollConnection(connId, repoInfo, transportSessionId, lastSessionId) {\r\n        this.connId = connId;\r\n        this.repoInfo = repoInfo;\r\n        this.transportSessionId = transportSessionId;\r\n        this.lastSessionId = lastSessionId;\r\n        this.bytesSent = 0;\r\n        this.bytesReceived = 0;\r\n        this.everConnected_ = false;\r\n        this.log_ = logWrapper(connId);\r\n        this.stats_ = StatsManager.getCollection(repoInfo);\r\n        this.urlFn = function (params) {\r\n            return repoInfo.connectionURL(LONG_POLLING, params);\r\n        };\r\n    }\r\n    /**\r\n     *\r\n     * @param {function(Object)} onMessage Callback when messages arrive\r\n     * @param {function()} onDisconnect Callback with connection lost.\r\n     */\r\n    BrowserPollConnection.prototype.open = function (onMessage, onDisconnect) {\r\n        var _this = this;\r\n        this.curSegmentNum = 0;\r\n        this.onDisconnect_ = onDisconnect;\r\n        this.myPacketOrderer = new PacketReceiver(onMessage);\r\n        this.isClosed_ = false;\r\n        this.connectTimeoutTimer_ = setTimeout(function () {\r\n            _this.log_('Timed out trying to connect.');\r\n            // Make sure we clear the host cache\r\n            _this.onClosed_();\r\n            _this.connectTimeoutTimer_ = null;\r\n        }, Math.floor(LP_CONNECT_TIMEOUT));\r\n        // Ensure we delay the creation of the iframe until the DOM is loaded.\r\n        executeWhenDOMReady(function () {\r\n            if (_this.isClosed_)\r\n                return;\r\n            //Set up a callback that gets triggered once a connection is set up.\r\n            _this.scriptTagHolder = new FirebaseIFrameScriptHolder(function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                var command = args[0], arg1 = args[1], arg2 = args[2];\r\n                _this.incrementIncomingBytes_(args);\r\n                if (!_this.scriptTagHolder)\r\n                    return; // we closed the connection.\r\n                if (_this.connectTimeoutTimer_) {\r\n                    clearTimeout(_this.connectTimeoutTimer_);\r\n                    _this.connectTimeoutTimer_ = null;\r\n                }\r\n                _this.everConnected_ = true;\r\n                if (command == FIREBASE_LONGPOLL_START_PARAM) {\r\n                    _this.id = arg1;\r\n                    _this.password = arg2;\r\n                }\r\n                else if (command === FIREBASE_LONGPOLL_CLOSE_COMMAND) {\r\n                    // Don't clear the host cache. We got a response from the server, so we know it's reachable\r\n                    if (arg1) {\r\n                        // We aren't expecting any more data (other than what the server's already in the process of sending us\r\n                        // through our already open polls), so don't send any more.\r\n                        _this.scriptTagHolder.sendNewPolls = false;\r\n                        // arg1 in this case is the last response number sent by the server. We should try to receive\r\n                        // all of the responses up to this one before closing\r\n                        _this.myPacketOrderer.closeAfter(arg1, function () {\r\n                            _this.onClosed_();\r\n                        });\r\n                    }\r\n                    else {\r\n                        _this.onClosed_();\r\n                    }\r\n                }\r\n                else {\r\n                    throw new Error('Unrecognized command received: ' + command);\r\n                }\r\n            }, function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                var pN = args[0], data = args[1];\r\n                _this.incrementIncomingBytes_(args);\r\n                _this.myPacketOrderer.handleResponse(pN, data);\r\n            }, function () {\r\n                _this.onClosed_();\r\n            }, _this.urlFn);\r\n            //Send the initial request to connect. The serial number is simply to keep the browser from pulling previous results\r\n            //from cache.\r\n            var urlParams = {};\r\n            urlParams[FIREBASE_LONGPOLL_START_PARAM] = 't';\r\n            urlParams[FIREBASE_LONGPOLL_SERIAL_PARAM] = Math.floor(Math.random() * 100000000);\r\n            if (_this.scriptTagHolder.uniqueCallbackIdentifier)\r\n                urlParams[FIREBASE_LONGPOLL_CALLBACK_ID_PARAM] = _this.scriptTagHolder.uniqueCallbackIdentifier;\r\n            urlParams[VERSION_PARAM] = PROTOCOL_VERSION;\r\n            if (_this.transportSessionId) {\r\n                urlParams[TRANSPORT_SESSION_PARAM] = _this.transportSessionId;\r\n            }\r\n            if (_this.lastSessionId) {\r\n                urlParams[LAST_SESSION_PARAM] = _this.lastSessionId;\r\n            }\r\n            if (!isNodeSdk() &&\r\n                typeof location !== 'undefined' &&\r\n                location.href &&\r\n                location.href.indexOf(FORGE_DOMAIN) !== -1) {\r\n                urlParams[REFERER_PARAM] = FORGE_REF;\r\n            }\r\n            var connectURL = _this.urlFn(urlParams);\r\n            _this.log_('Connecting via long-poll to ' + connectURL);\r\n            _this.scriptTagHolder.addTag(connectURL, function () {\r\n                /* do nothing */\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Call this when a handshake has completed successfully and we want to consider the connection established\r\n     */\r\n    BrowserPollConnection.prototype.start = function () {\r\n        this.scriptTagHolder.startLongPoll(this.id, this.password);\r\n        this.addDisconnectPingFrame(this.id, this.password);\r\n    };\r\n    /**\r\n     * Forces long polling to be considered as a potential transport\r\n     */\r\n    BrowserPollConnection.forceAllow = function () {\r\n        BrowserPollConnection.forceAllow_ = true;\r\n    };\r\n    /**\r\n     * Forces longpolling to not be considered as a potential transport\r\n     */\r\n    BrowserPollConnection.forceDisallow = function () {\r\n        BrowserPollConnection.forceDisallow_ = true;\r\n    };\r\n    // Static method, use string literal so it can be accessed in a generic way\r\n    BrowserPollConnection.isAvailable = function () {\r\n        // NOTE: In React-Native there's normally no 'document', but if you debug a React-Native app in\r\n        // the Chrome debugger, 'document' is defined, but document.createElement is null (2015/06/08).\r\n        return (BrowserPollConnection.forceAllow_ ||\r\n            (!BrowserPollConnection.forceDisallow_ &&\r\n                typeof document !== 'undefined' &&\r\n                document.createElement != null &&\r\n                !isChromeExtensionContentScript() &&\r\n                !isWindowsStoreApp() &&\r\n                !isNodeSdk()));\r\n    };\r\n    /**\r\n     * No-op for polling\r\n     */\r\n    BrowserPollConnection.prototype.markConnectionHealthy = function () { };\r\n    /**\r\n     * Stops polling and cleans up the iframe\r\n     * @private\r\n     */\r\n    BrowserPollConnection.prototype.shutdown_ = function () {\r\n        this.isClosed_ = true;\r\n        if (this.scriptTagHolder) {\r\n            this.scriptTagHolder.close();\r\n            this.scriptTagHolder = null;\r\n        }\r\n        //remove the disconnect frame, which will trigger an XHR call to the server to tell it we're leaving.\r\n        if (this.myDisconnFrame) {\r\n            document.body.removeChild(this.myDisconnFrame);\r\n            this.myDisconnFrame = null;\r\n        }\r\n        if (this.connectTimeoutTimer_) {\r\n            clearTimeout(this.connectTimeoutTimer_);\r\n            this.connectTimeoutTimer_ = null;\r\n        }\r\n    };\r\n    /**\r\n     * Triggered when this transport is closed\r\n     * @private\r\n     */\r\n    BrowserPollConnection.prototype.onClosed_ = function () {\r\n        if (!this.isClosed_) {\r\n            this.log_('Longpoll is closing itself');\r\n            this.shutdown_();\r\n            if (this.onDisconnect_) {\r\n                this.onDisconnect_(this.everConnected_);\r\n                this.onDisconnect_ = null;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * External-facing close handler. RealTime has requested we shut down. Kill our connection and tell the server\r\n     * that we've left.\r\n     */\r\n    BrowserPollConnection.prototype.close = function () {\r\n        if (!this.isClosed_) {\r\n            this.log_('Longpoll is being closed.');\r\n            this.shutdown_();\r\n        }\r\n    };\r\n    /**\r\n     * Send the JSON object down to the server. It will need to be stringified, base64 encoded, and then\r\n     * broken into chunks (since URLs have a small maximum length).\r\n     * @param {!Object} data The JSON data to transmit.\r\n     */\r\n    BrowserPollConnection.prototype.send = function (data) {\r\n        var dataStr = stringify(data);\r\n        this.bytesSent += dataStr.length;\r\n        this.stats_.incrementCounter('bytes_sent', dataStr.length);\r\n        //first, lets get the base64-encoded data\r\n        var base64data = base64Encode(dataStr);\r\n        //We can only fit a certain amount in each URL, so we need to split this request\r\n        //up into multiple pieces if it doesn't fit in one request.\r\n        var dataSegs = splitStringBySize(base64data, MAX_PAYLOAD_SIZE);\r\n        //Enqueue each segment for transmission. We assign each chunk a sequential ID and a total number\r\n        //of segments so that we can reassemble the packet on the server.\r\n        for (var i = 0; i < dataSegs.length; i++) {\r\n            this.scriptTagHolder.enqueueSegment(this.curSegmentNum, dataSegs.length, dataSegs[i]);\r\n            this.curSegmentNum++;\r\n        }\r\n    };\r\n    /**\r\n     * This is how we notify the server that we're leaving.\r\n     * We aren't able to send requests with DHTML on a window close event, but we can\r\n     * trigger XHR requests in some browsers (everything but Opera basically).\r\n     * @param {!string} id\r\n     * @param {!string} pw\r\n     */\r\n    BrowserPollConnection.prototype.addDisconnectPingFrame = function (id, pw) {\r\n        if (isNodeSdk())\r\n            return;\r\n        this.myDisconnFrame = document.createElement('iframe');\r\n        var urlParams = {};\r\n        urlParams[FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM] = 't';\r\n        urlParams[FIREBASE_LONGPOLL_ID_PARAM] = id;\r\n        urlParams[FIREBASE_LONGPOLL_PW_PARAM] = pw;\r\n        this.myDisconnFrame.src = this.urlFn(urlParams);\r\n        this.myDisconnFrame.style.display = 'none';\r\n        document.body.appendChild(this.myDisconnFrame);\r\n    };\r\n    /**\r\n     * Used to track the bytes received by this client\r\n     * @param {*} args\r\n     * @private\r\n     */\r\n    BrowserPollConnection.prototype.incrementIncomingBytes_ = function (args) {\r\n        // TODO: This is an annoying perf hit just to track the number of incoming bytes.  Maybe it should be opt-in.\r\n        var bytesReceived = stringify(args).length;\r\n        this.bytesReceived += bytesReceived;\r\n        this.stats_.incrementCounter('bytes_received', bytesReceived);\r\n    };\r\n    return BrowserPollConnection;\r\n}());\r\n/*********************************************************************************************\r\n * A wrapper around an iframe that is used as a long-polling script holder.\r\n * @constructor\r\n *********************************************************************************************/\r\nvar FirebaseIFrameScriptHolder = /** @class */ (function () {\r\n    /**\r\n     * @param commandCB - The callback to be called when control commands are recevied from the server.\r\n     * @param onMessageCB - The callback to be triggered when responses arrive from the server.\r\n     * @param onDisconnect - The callback to be triggered when this tag holder is closed\r\n     * @param urlFn - A function that provides the URL of the endpoint to send data to.\r\n     */\r\n    function FirebaseIFrameScriptHolder(commandCB, onMessageCB, onDisconnect, urlFn) {\r\n        this.onDisconnect = onDisconnect;\r\n        this.urlFn = urlFn;\r\n        //We maintain a count of all of the outstanding requests, because if we have too many active at once it can cause\r\n        //problems in some browsers.\r\n        /**\r\n         * @type {CountedSet.<number, number>}\r\n         */\r\n        this.outstandingRequests = new CountedSet();\r\n        //A queue of the pending segments waiting for transmission to the server.\r\n        this.pendingSegs = [];\r\n        //A serial number. We use this for two things:\r\n        // 1) A way to ensure the browser doesn't cache responses to polls\r\n        // 2) A way to make the server aware when long-polls arrive in a different order than we started them. The\r\n        //    server needs to release both polls in this case or it will cause problems in Opera since Opera can only execute\r\n        //    JSONP code in the order it was added to the iframe.\r\n        this.currentSerial = Math.floor(Math.random() * 100000000);\r\n        // This gets set to false when we're \"closing down\" the connection (e.g. we're switching transports but there's still\r\n        // incoming data from the server that we're waiting for).\r\n        this.sendNewPolls = true;\r\n        if (!isNodeSdk()) {\r\n            //Each script holder registers a couple of uniquely named callbacks with the window. These are called from the\r\n            //iframes where we put the long-polling script tags. We have two callbacks:\r\n            //   1) Command Callback - Triggered for control issues, like starting a connection.\r\n            //   2) Message Callback - Triggered when new data arrives.\r\n            this.uniqueCallbackIdentifier = LUIDGenerator();\r\n            window[FIREBASE_LONGPOLL_COMMAND_CB_NAME + this.uniqueCallbackIdentifier] = commandCB;\r\n            window[FIREBASE_LONGPOLL_DATA_CB_NAME + this.uniqueCallbackIdentifier] = onMessageCB;\r\n            //Create an iframe for us to add script tags to.\r\n            this.myIFrame = FirebaseIFrameScriptHolder.createIFrame_();\r\n            // Set the iframe's contents.\r\n            var script = '';\r\n            // if we set a javascript url, it's IE and we need to set the document domain. The javascript url is sufficient\r\n            // for ie9, but ie8 needs to do it again in the document itself.\r\n            if (this.myIFrame.src &&\r\n                this.myIFrame.src.substr(0, 'javascript:'.length) === 'javascript:') {\r\n                var currentDomain = document.domain;\r\n                script = '<script>document.domain=\"' + currentDomain + '\";</script>';\r\n            }\r\n            var iframeContents = '<html><body>' + script + '</body></html>';\r\n            try {\r\n                this.myIFrame.doc.open();\r\n                this.myIFrame.doc.write(iframeContents);\r\n                this.myIFrame.doc.close();\r\n            }\r\n            catch (e) {\r\n                log('frame writing exception');\r\n                if (e.stack) {\r\n                    log(e.stack);\r\n                }\r\n                log(e);\r\n            }\r\n        }\r\n        else {\r\n            this.commandCB = commandCB;\r\n            this.onMessageCB = onMessageCB;\r\n        }\r\n    }\r\n    /**\r\n     * Each browser has its own funny way to handle iframes. Here we mush them all together into one object that I can\r\n     * actually use.\r\n     * @private\r\n     * @return {Element}\r\n     */\r\n    FirebaseIFrameScriptHolder.createIFrame_ = function () {\r\n        var iframe = document.createElement('iframe');\r\n        iframe.style.display = 'none';\r\n        // This is necessary in order to initialize the document inside the iframe\r\n        if (document.body) {\r\n            document.body.appendChild(iframe);\r\n            try {\r\n                // If document.domain has been modified in IE, this will throw an error, and we need to set the\r\n                // domain of the iframe's document manually. We can do this via a javascript: url as the src attribute\r\n                // Also note that we must do this *after* the iframe has been appended to the page. Otherwise it doesn't work.\r\n                var a = iframe.contentWindow.document;\r\n                if (!a) {\r\n                    // Apologies for the log-spam, I need to do something to keep closure from optimizing out the assignment above.\r\n                    log('No IE domain setting required');\r\n                }\r\n            }\r\n            catch (e) {\r\n                var domain = document.domain;\r\n                iframe.src =\r\n                    \"javascript:void((function(){document.open();document.domain='\" +\r\n                        domain +\r\n                        \"';document.close();})())\";\r\n            }\r\n        }\r\n        else {\r\n            // LongPollConnection attempts to delay initialization until the document is ready, so hopefully this\r\n            // never gets hit.\r\n            throw 'Document body has not initialized. Wait to initialize Firebase until after the document is ready.';\r\n        }\r\n        // Get the document of the iframe in a browser-specific way.\r\n        if (iframe.contentDocument) {\r\n            iframe.doc = iframe.contentDocument; // Firefox, Opera, Safari\r\n        }\r\n        else if (iframe.contentWindow) {\r\n            iframe.doc = iframe.contentWindow.document; // Internet Explorer\r\n        }\r\n        else if (iframe.document) {\r\n            iframe.doc = iframe.document; //others?\r\n        }\r\n        return iframe;\r\n    };\r\n    /**\r\n     * Cancel all outstanding queries and remove the frame.\r\n     */\r\n    FirebaseIFrameScriptHolder.prototype.close = function () {\r\n        var _this = this;\r\n        //Mark this iframe as dead, so no new requests are sent.\r\n        this.alive = false;\r\n        if (this.myIFrame) {\r\n            //We have to actually remove all of the html inside this iframe before removing it from the\r\n            //window, or IE will continue loading and executing the script tags we've already added, which\r\n            //can lead to some errors being thrown. Setting innerHTML seems to be the easiest way to do this.\r\n            this.myIFrame.doc.body.innerHTML = '';\r\n            setTimeout(function () {\r\n                if (_this.myIFrame !== null) {\r\n                    document.body.removeChild(_this.myIFrame);\r\n                    _this.myIFrame = null;\r\n                }\r\n            }, Math.floor(0));\r\n        }\r\n        if (isNodeSdk() && this.myID) {\r\n            var urlParams = {};\r\n            urlParams[FIREBASE_LONGPOLL_DISCONN_FRAME_PARAM] = 't';\r\n            urlParams[FIREBASE_LONGPOLL_ID_PARAM] = this.myID;\r\n            urlParams[FIREBASE_LONGPOLL_PW_PARAM] = this.myPW;\r\n            var theURL = this.urlFn(urlParams);\r\n            FirebaseIFrameScriptHolder.nodeRestRequest(theURL);\r\n        }\r\n        // Protect from being called recursively.\r\n        var onDisconnect = this.onDisconnect;\r\n        if (onDisconnect) {\r\n            this.onDisconnect = null;\r\n            onDisconnect();\r\n        }\r\n    };\r\n    /**\r\n     * Actually start the long-polling session by adding the first script tag(s) to the iframe.\r\n     * @param {!string} id - The ID of this connection\r\n     * @param {!string} pw - The password for this connection\r\n     */\r\n    FirebaseIFrameScriptHolder.prototype.startLongPoll = function (id, pw) {\r\n        this.myID = id;\r\n        this.myPW = pw;\r\n        this.alive = true;\r\n        //send the initial request. If there are requests queued, make sure that we transmit as many as we are currently able to.\r\n        while (this.newRequest_()) { }\r\n    };\r\n    /**\r\n     * This is called any time someone might want a script tag to be added. It adds a script tag when there aren't\r\n     * too many outstanding requests and we are still alive.\r\n     *\r\n     * If there are outstanding packet segments to send, it sends one. If there aren't, it sends a long-poll anyways if\r\n     * needed.\r\n     */\r\n    FirebaseIFrameScriptHolder.prototype.newRequest_ = function () {\r\n        // We keep one outstanding request open all the time to receive data, but if we need to send data\r\n        // (pendingSegs.length > 0) then we create a new request to send the data.  The server will automatically\r\n        // close the old request.\r\n        if (this.alive &&\r\n            this.sendNewPolls &&\r\n            this.outstandingRequests.count() < (this.pendingSegs.length > 0 ? 2 : 1)) {\r\n            //construct our url\r\n            this.currentSerial++;\r\n            var urlParams = {};\r\n            urlParams[FIREBASE_LONGPOLL_ID_PARAM] = this.myID;\r\n            urlParams[FIREBASE_LONGPOLL_PW_PARAM] = this.myPW;\r\n            urlParams[FIREBASE_LONGPOLL_SERIAL_PARAM] = this.currentSerial;\r\n            var theURL = this.urlFn(urlParams);\r\n            //Now add as much data as we can.\r\n            var curDataString = '';\r\n            var i = 0;\r\n            while (this.pendingSegs.length > 0) {\r\n                //first, lets see if the next segment will fit.\r\n                var nextSeg = this.pendingSegs[0];\r\n                if (nextSeg.d.length + SEG_HEADER_SIZE + curDataString.length <=\r\n                    MAX_URL_DATA_SIZE) {\r\n                    //great, the segment will fit. Lets append it.\r\n                    var theSeg = this.pendingSegs.shift();\r\n                    curDataString =\r\n                        curDataString +\r\n                            '&' +\r\n                            FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM +\r\n                            i +\r\n                            '=' +\r\n                            theSeg.seg +\r\n                            '&' +\r\n                            FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET +\r\n                            i +\r\n                            '=' +\r\n                            theSeg.ts +\r\n                            '&' +\r\n                            FIREBASE_LONGPOLL_DATA_PARAM +\r\n                            i +\r\n                            '=' +\r\n                            theSeg.d;\r\n                    i++;\r\n                }\r\n                else {\r\n                    break;\r\n                }\r\n            }\r\n            theURL = theURL + curDataString;\r\n            this.addLongPollTag_(theURL, this.currentSerial);\r\n            return true;\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    };\r\n    /**\r\n     * Queue a packet for transmission to the server.\r\n     * @param segnum - A sequential id for this packet segment used for reassembly\r\n     * @param totalsegs - The total number of segments in this packet\r\n     * @param data - The data for this segment.\r\n     */\r\n    FirebaseIFrameScriptHolder.prototype.enqueueSegment = function (segnum, totalsegs, data) {\r\n        //add this to the queue of segments to send.\r\n        this.pendingSegs.push({ seg: segnum, ts: totalsegs, d: data });\r\n        //send the data immediately if there isn't already data being transmitted, unless\r\n        //startLongPoll hasn't been called yet.\r\n        if (this.alive) {\r\n            this.newRequest_();\r\n        }\r\n    };\r\n    /**\r\n     * Add a script tag for a regular long-poll request.\r\n     * @param {!string} url - The URL of the script tag.\r\n     * @param {!number} serial - The serial number of the request.\r\n     * @private\r\n     */\r\n    FirebaseIFrameScriptHolder.prototype.addLongPollTag_ = function (url, serial) {\r\n        var _this = this;\r\n        //remember that we sent this request.\r\n        this.outstandingRequests.add(serial, 1);\r\n        var doNewRequest = function () {\r\n            _this.outstandingRequests.remove(serial);\r\n            _this.newRequest_();\r\n        };\r\n        // If this request doesn't return on its own accord (by the server sending us some data), we'll\r\n        // create a new one after the KEEPALIVE interval to make sure we always keep a fresh request open.\r\n        var keepaliveTimeout = setTimeout(doNewRequest, Math.floor(KEEPALIVE_REQUEST_INTERVAL));\r\n        var readyStateCB = function () {\r\n            // Request completed.  Cancel the keepalive.\r\n            clearTimeout(keepaliveTimeout);\r\n            // Trigger a new request so we can continue receiving data.\r\n            doNewRequest();\r\n        };\r\n        this.addTag(url, readyStateCB);\r\n    };\r\n    /**\r\n     * Add an arbitrary script tag to the iframe.\r\n     * @param {!string} url - The URL for the script tag source.\r\n     * @param {!function()} loadCB - A callback to be triggered once the script has loaded.\r\n     */\r\n    FirebaseIFrameScriptHolder.prototype.addTag = function (url, loadCB) {\r\n        var _this = this;\r\n        if (isNodeSdk()) {\r\n            this.doNodeLongPoll(url, loadCB);\r\n        }\r\n        else {\r\n            setTimeout(function () {\r\n                try {\r\n                    // if we're already closed, don't add this poll\r\n                    if (!_this.sendNewPolls)\r\n                        return;\r\n                    var newScript_1 = _this.myIFrame.doc.createElement('script');\r\n                    newScript_1.type = 'text/javascript';\r\n                    newScript_1.async = true;\r\n                    newScript_1.src = url;\r\n                    newScript_1.onload = newScript_1.onreadystatechange = function () {\r\n                        var rstate = newScript_1.readyState;\r\n                        if (!rstate || rstate === 'loaded' || rstate === 'complete') {\r\n                            newScript_1.onload = newScript_1.onreadystatechange = null;\r\n                            if (newScript_1.parentNode) {\r\n                                newScript_1.parentNode.removeChild(newScript_1);\r\n                            }\r\n                            loadCB();\r\n                        }\r\n                    };\r\n                    newScript_1.onerror = function () {\r\n                        log('Long-poll script failed to load: ' + url);\r\n                        _this.sendNewPolls = false;\r\n                        _this.close();\r\n                    };\r\n                    _this.myIFrame.doc.body.appendChild(newScript_1);\r\n                }\r\n                catch (e) {\r\n                    // TODO: we should make this error visible somehow\r\n                }\r\n            }, Math.floor(1));\r\n        }\r\n    };\r\n    return FirebaseIFrameScriptHolder;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar WEBSOCKET_MAX_FRAME_SIZE = 16384;\r\nvar WEBSOCKET_KEEPALIVE_INTERVAL = 45000;\r\nvar WebSocketImpl = null;\r\nif (typeof MozWebSocket !== 'undefined') {\r\n    WebSocketImpl = MozWebSocket;\r\n}\r\nelse if (typeof WebSocket !== 'undefined') {\r\n    WebSocketImpl = WebSocket;\r\n}\r\n/**\r\n * Create a new websocket connection with the given callbacks.\r\n * @constructor\r\n * @implements {Transport}\r\n */\r\nvar WebSocketConnection = /** @class */ (function () {\r\n    /**\r\n     * @param {string} connId identifier for this transport\r\n     * @param {RepoInfo} repoInfo The info for the websocket endpoint.\r\n     * @param {string=} transportSessionId Optional transportSessionId if this is connecting to an existing transport\r\n     *                                         session\r\n     * @param {string=} lastSessionId Optional lastSessionId if there was a previous connection\r\n     */\r\n    function WebSocketConnection(connId, repoInfo, transportSessionId, lastSessionId) {\r\n        this.connId = connId;\r\n        this.keepaliveTimer = null;\r\n        this.frames = null;\r\n        this.totalFrames = 0;\r\n        this.bytesSent = 0;\r\n        this.bytesReceived = 0;\r\n        this.log_ = logWrapper(this.connId);\r\n        this.stats_ = StatsManager.getCollection(repoInfo);\r\n        this.connURL = WebSocketConnection.connectionURL_(repoInfo, transportSessionId, lastSessionId);\r\n    }\r\n    /**\r\n     * @param {RepoInfo} repoInfo The info for the websocket endpoint.\r\n     * @param {string=} transportSessionId Optional transportSessionId if this is connecting to an existing transport\r\n     *                                         session\r\n     * @param {string=} lastSessionId Optional lastSessionId if there was a previous connection\r\n     * @return {string} connection url\r\n     * @private\r\n     */\r\n    WebSocketConnection.connectionURL_ = function (repoInfo, transportSessionId, lastSessionId) {\r\n        var urlParams = {};\r\n        urlParams[VERSION_PARAM] = PROTOCOL_VERSION;\r\n        if (!isNodeSdk() &&\r\n            typeof location !== 'undefined' &&\r\n            location.href &&\r\n            location.href.indexOf(FORGE_DOMAIN) !== -1) {\r\n            urlParams[REFERER_PARAM] = FORGE_REF;\r\n        }\r\n        if (transportSessionId) {\r\n            urlParams[TRANSPORT_SESSION_PARAM] = transportSessionId;\r\n        }\r\n        if (lastSessionId) {\r\n            urlParams[LAST_SESSION_PARAM] = lastSessionId;\r\n        }\r\n        return repoInfo.connectionURL(WEBSOCKET, urlParams);\r\n    };\r\n    /**\r\n     *\r\n     * @param onMessage Callback when messages arrive\r\n     * @param onDisconnect Callback with connection lost.\r\n     */\r\n    WebSocketConnection.prototype.open = function (onMessage, onDisconnect) {\r\n        var _this = this;\r\n        this.onDisconnect = onDisconnect;\r\n        this.onMessage = onMessage;\r\n        this.log_('Websocket connecting to ' + this.connURL);\r\n        this.everConnected_ = false;\r\n        // Assume failure until proven otherwise.\r\n        PersistentStorage.set('previous_websocket_failure', true);\r\n        try {\r\n            if (isNodeSdk()) {\r\n                var device = CONSTANTS.NODE_ADMIN ? 'AdminNode' : 'Node';\r\n                // UA Format: Firebase/<wire_protocol>/<sdk_version>/<platform>/<device>\r\n                var options = {\r\n                    headers: {\r\n                        'User-Agent': \"Firebase/\" + PROTOCOL_VERSION + \"/\" + firebase.SDK_VERSION + \"/\" + process.platform + \"/\" + device\r\n                    }\r\n                };\r\n                // Plumb appropriate http_proxy environment variable into faye-websocket if it exists.\r\n                var env = process['env'];\r\n                var proxy = this.connURL.indexOf('wss://') == 0\r\n                    ? env['HTTPS_PROXY'] || env['https_proxy']\r\n                    : env['HTTP_PROXY'] || env['http_proxy'];\r\n                if (proxy) {\r\n                    options['proxy'] = { origin: proxy };\r\n                }\r\n                this.mySock = new WebSocketImpl(this.connURL, [], options);\r\n            }\r\n            else {\r\n                this.mySock = new WebSocketImpl(this.connURL);\r\n            }\r\n        }\r\n        catch (e) {\r\n            this.log_('Error instantiating WebSocket.');\r\n            var error$$1 = e.message || e.data;\r\n            if (error$$1) {\r\n                this.log_(error$$1);\r\n            }\r\n            this.onClosed_();\r\n            return;\r\n        }\r\n        this.mySock.onopen = function () {\r\n            _this.log_('Websocket connected.');\r\n            _this.everConnected_ = true;\r\n        };\r\n        this.mySock.onclose = function () {\r\n            _this.log_('Websocket connection was disconnected.');\r\n            _this.mySock = null;\r\n            _this.onClosed_();\r\n        };\r\n        this.mySock.onmessage = function (m) {\r\n            _this.handleIncomingFrame(m);\r\n        };\r\n        this.mySock.onerror = function (e) {\r\n            _this.log_('WebSocket error.  Closing connection.');\r\n            var error$$1 = e.message || e.data;\r\n            if (error$$1) {\r\n                _this.log_(error$$1);\r\n            }\r\n            _this.onClosed_();\r\n        };\r\n    };\r\n    /**\r\n     * No-op for websockets, we don't need to do anything once the connection is confirmed as open\r\n     */\r\n    WebSocketConnection.prototype.start = function () { };\r\n    WebSocketConnection.forceDisallow = function () {\r\n        WebSocketConnection.forceDisallow_ = true;\r\n    };\r\n    WebSocketConnection.isAvailable = function () {\r\n        var isOldAndroid = false;\r\n        if (typeof navigator !== 'undefined' && navigator.userAgent) {\r\n            var oldAndroidRegex = /Android ([0-9]{0,}\\.[0-9]{0,})/;\r\n            var oldAndroidMatch = navigator.userAgent.match(oldAndroidRegex);\r\n            if (oldAndroidMatch && oldAndroidMatch.length > 1) {\r\n                if (parseFloat(oldAndroidMatch[1]) < 4.4) {\r\n                    isOldAndroid = true;\r\n                }\r\n            }\r\n        }\r\n        return (!isOldAndroid &&\r\n            WebSocketImpl !== null &&\r\n            !WebSocketConnection.forceDisallow_);\r\n    };\r\n    /**\r\n     * Returns true if we previously failed to connect with this transport.\r\n     * @return {boolean}\r\n     */\r\n    WebSocketConnection.previouslyFailed = function () {\r\n        // If our persistent storage is actually only in-memory storage,\r\n        // we default to assuming that it previously failed to be safe.\r\n        return (PersistentStorage.isInMemoryStorage ||\r\n            PersistentStorage.get('previous_websocket_failure') === true);\r\n    };\r\n    WebSocketConnection.prototype.markConnectionHealthy = function () {\r\n        PersistentStorage.remove('previous_websocket_failure');\r\n    };\r\n    WebSocketConnection.prototype.appendFrame_ = function (data) {\r\n        this.frames.push(data);\r\n        if (this.frames.length == this.totalFrames) {\r\n            var fullMess = this.frames.join('');\r\n            this.frames = null;\r\n            var jsonMess = jsonEval(fullMess);\r\n            //handle the message\r\n            this.onMessage(jsonMess);\r\n        }\r\n    };\r\n    /**\r\n     * @param {number} frameCount The number of frames we are expecting from the server\r\n     * @private\r\n     */\r\n    WebSocketConnection.prototype.handleNewFrameCount_ = function (frameCount) {\r\n        this.totalFrames = frameCount;\r\n        this.frames = [];\r\n    };\r\n    /**\r\n     * Attempts to parse a frame count out of some text. If it can't, assumes a value of 1\r\n     * @param {!String} data\r\n     * @return {?String} Any remaining data to be process, or null if there is none\r\n     * @private\r\n     */\r\n    WebSocketConnection.prototype.extractFrameCount_ = function (data) {\r\n        assert(this.frames === null, 'We already have a frame buffer');\r\n        // TODO: The server is only supposed to send up to 9999 frames (i.e. length <= 4), but that isn't being enforced\r\n        // currently.  So allowing larger frame counts (length <= 6).  See https://app.asana.com/0/search/8688598998380/8237608042508\r\n        if (data.length <= 6) {\r\n            var frameCount = Number(data);\r\n            if (!isNaN(frameCount)) {\r\n                this.handleNewFrameCount_(frameCount);\r\n                return null;\r\n            }\r\n        }\r\n        this.handleNewFrameCount_(1);\r\n        return data;\r\n    };\r\n    /**\r\n     * Process a websocket frame that has arrived from the server.\r\n     * @param mess The frame data\r\n     */\r\n    WebSocketConnection.prototype.handleIncomingFrame = function (mess) {\r\n        if (this.mySock === null)\r\n            return; // Chrome apparently delivers incoming packets even after we .close() the connection sometimes.\r\n        var data = mess['data'];\r\n        this.bytesReceived += data.length;\r\n        this.stats_.incrementCounter('bytes_received', data.length);\r\n        this.resetKeepAlive();\r\n        if (this.frames !== null) {\r\n            // we're buffering\r\n            this.appendFrame_(data);\r\n        }\r\n        else {\r\n            // try to parse out a frame count, otherwise, assume 1 and process it\r\n            var remainingData = this.extractFrameCount_(data);\r\n            if (remainingData !== null) {\r\n                this.appendFrame_(remainingData);\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Send a message to the server\r\n     * @param {Object} data The JSON object to transmit\r\n     */\r\n    WebSocketConnection.prototype.send = function (data) {\r\n        this.resetKeepAlive();\r\n        var dataStr = stringify(data);\r\n        this.bytesSent += dataStr.length;\r\n        this.stats_.incrementCounter('bytes_sent', dataStr.length);\r\n        //We can only fit a certain amount in each websocket frame, so we need to split this request\r\n        //up into multiple pieces if it doesn't fit in one request.\r\n        var dataSegs = splitStringBySize(dataStr, WEBSOCKET_MAX_FRAME_SIZE);\r\n        //Send the length header\r\n        if (dataSegs.length > 1) {\r\n            this.sendString_(String(dataSegs.length));\r\n        }\r\n        //Send the actual data in segments.\r\n        for (var i = 0; i < dataSegs.length; i++) {\r\n            this.sendString_(dataSegs[i]);\r\n        }\r\n    };\r\n    WebSocketConnection.prototype.shutdown_ = function () {\r\n        this.isClosed_ = true;\r\n        if (this.keepaliveTimer) {\r\n            clearInterval(this.keepaliveTimer);\r\n            this.keepaliveTimer = null;\r\n        }\r\n        if (this.mySock) {\r\n            this.mySock.close();\r\n            this.mySock = null;\r\n        }\r\n    };\r\n    WebSocketConnection.prototype.onClosed_ = function () {\r\n        if (!this.isClosed_) {\r\n            this.log_('WebSocket is closing itself');\r\n            this.shutdown_();\r\n            // since this is an internal close, trigger the close listener\r\n            if (this.onDisconnect) {\r\n                this.onDisconnect(this.everConnected_);\r\n                this.onDisconnect = null;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * External-facing close handler.\r\n     * Close the websocket and kill the connection.\r\n     */\r\n    WebSocketConnection.prototype.close = function () {\r\n        if (!this.isClosed_) {\r\n            this.log_('WebSocket is being closed');\r\n            this.shutdown_();\r\n        }\r\n    };\r\n    /**\r\n     * Kill the current keepalive timer and start a new one, to ensure that it always fires N seconds after\r\n     * the last activity.\r\n     */\r\n    WebSocketConnection.prototype.resetKeepAlive = function () {\r\n        var _this = this;\r\n        clearInterval(this.keepaliveTimer);\r\n        this.keepaliveTimer = setInterval(function () {\r\n            //If there has been no websocket activity for a while, send a no-op\r\n            if (_this.mySock) {\r\n                _this.sendString_('0');\r\n            }\r\n            _this.resetKeepAlive();\r\n        }, Math.floor(WEBSOCKET_KEEPALIVE_INTERVAL));\r\n    };\r\n    /**\r\n     * Send a string over the websocket.\r\n     *\r\n     * @param {string} str String to send.\r\n     * @private\r\n     */\r\n    WebSocketConnection.prototype.sendString_ = function (str) {\r\n        // Firefox seems to sometimes throw exceptions (NS_ERROR_UNEXPECTED) from websocket .send()\r\n        // calls for some unknown reason.  We treat these as an error and disconnect.\r\n        // See https://app.asana.com/0/58926111402292/68021340250410\r\n        try {\r\n            this.mySock.send(str);\r\n        }\r\n        catch (e) {\r\n            this.log_('Exception thrown from WebSocket.send():', e.message || e.data, 'Closing connection.');\r\n            setTimeout(this.onClosed_.bind(this), 0);\r\n        }\r\n    };\r\n    /**\r\n     * Number of response before we consider the connection \"healthy.\"\r\n     * @type {number}\r\n     */\r\n    WebSocketConnection.responsesRequiredToBeHealthy = 2;\r\n    /**\r\n     * Time to wait for the connection te become healthy before giving up.\r\n     * @type {number}\r\n     */\r\n    WebSocketConnection.healthyTimeout = 30000;\r\n    return WebSocketConnection;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Currently simplistic, this class manages what transport a Connection should use at various stages of its\r\n * lifecycle.\r\n *\r\n * It starts with longpolling in a browser, and httppolling on node. It then upgrades to websockets if\r\n * they are available.\r\n * @constructor\r\n */\r\nvar TransportManager = /** @class */ (function () {\r\n    /**\r\n     * @param {!RepoInfo} repoInfo Metadata around the namespace we're connecting to\r\n     */\r\n    function TransportManager(repoInfo) {\r\n        this.initTransports_(repoInfo);\r\n    }\r\n    Object.defineProperty(TransportManager, \"ALL_TRANSPORTS\", {\r\n        /**\r\n         * @const\r\n         * @type {!Array.<function(new:Transport, string, RepoInfo, string=)>}\r\n         */\r\n        get: function () {\r\n            return [BrowserPollConnection, WebSocketConnection];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * @param {!RepoInfo} repoInfo\r\n     * @private\r\n     */\r\n    TransportManager.prototype.initTransports_ = function (repoInfo) {\r\n        var isWebSocketsAvailable = WebSocketConnection && WebSocketConnection['isAvailable']();\r\n        var isSkipPollConnection = isWebSocketsAvailable && !WebSocketConnection.previouslyFailed();\r\n        if (repoInfo.webSocketOnly) {\r\n            if (!isWebSocketsAvailable)\r\n                warn(\"wss:// URL used, but browser isn't known to support websockets.  Trying anyway.\");\r\n            isSkipPollConnection = true;\r\n        }\r\n        if (isSkipPollConnection) {\r\n            this.transports_ = [WebSocketConnection];\r\n        }\r\n        else {\r\n            var transports_1 = (this.transports_ = []);\r\n            each(TransportManager.ALL_TRANSPORTS, function (i, transport) {\r\n                if (transport && transport['isAvailable']()) {\r\n                    transports_1.push(transport);\r\n                }\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * @return {function(new:Transport, !string, !RepoInfo, string=, string=)} The constructor for the\r\n     * initial transport to use\r\n     */\r\n    TransportManager.prototype.initialTransport = function () {\r\n        if (this.transports_.length > 0) {\r\n            return this.transports_[0];\r\n        }\r\n        else {\r\n            throw new Error('No transports available');\r\n        }\r\n    };\r\n    /**\r\n     * @return {?function(new:Transport, function(),function(), string=)} The constructor for the next\r\n     * transport, or null\r\n     */\r\n    TransportManager.prototype.upgradeTransport = function () {\r\n        if (this.transports_.length > 1) {\r\n            return this.transports_[1];\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    };\r\n    return TransportManager;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Abort upgrade attempt if it takes longer than 60s.\r\nvar UPGRADE_TIMEOUT = 60000;\r\n// For some transports (WebSockets), we need to \"validate\" the transport by exchanging a few requests and responses.\r\n// If we haven't sent enough requests within 5s, we'll start sending noop ping requests.\r\nvar DELAY_BEFORE_SENDING_EXTRA_REQUESTS = 5000;\r\n// If the initial data sent triggers a lot of bandwidth (i.e. it's a large put or a listen for a large amount of data)\r\n// then we may not be able to exchange our ping/pong requests within the healthy timeout.  So if we reach the timeout\r\n// but we've sent/received enough bytes, we don't cancel the connection.\r\nvar BYTES_SENT_HEALTHY_OVERRIDE = 10 * 1024;\r\nvar BYTES_RECEIVED_HEALTHY_OVERRIDE = 100 * 1024;\r\nvar MESSAGE_TYPE = 't';\r\nvar MESSAGE_DATA = 'd';\r\nvar CONTROL_SHUTDOWN = 's';\r\nvar CONTROL_RESET = 'r';\r\nvar CONTROL_ERROR = 'e';\r\nvar CONTROL_PONG = 'o';\r\nvar SWITCH_ACK = 'a';\r\nvar END_TRANSMISSION = 'n';\r\nvar PING = 'p';\r\nvar SERVER_HELLO = 'h';\r\n/**\r\n * Creates a new real-time connection to the server using whichever method works\r\n * best in the current browser.\r\n *\r\n * @constructor\r\n */\r\nvar Connection = /** @class */ (function () {\r\n    /**\r\n     * @param {!string} id - an id for this connection\r\n     * @param {!RepoInfo} repoInfo_ - the info for the endpoint to connect to\r\n     * @param {function(Object)} onMessage_ - the callback to be triggered when a server-push message arrives\r\n     * @param {function(number, string)} onReady_ - the callback to be triggered when this connection is ready to send messages.\r\n     * @param {function()} onDisconnect_ - the callback to be triggered when a connection was lost\r\n     * @param {function(string)} onKill_ - the callback to be triggered when this connection has permanently shut down.\r\n     * @param {string=} lastSessionId - last session id in persistent connection. is used to clean up old session in real-time server\r\n     */\r\n    function Connection(id, repoInfo_, onMessage_, onReady_, onDisconnect_, onKill_, lastSessionId) {\r\n        this.id = id;\r\n        this.repoInfo_ = repoInfo_;\r\n        this.onMessage_ = onMessage_;\r\n        this.onReady_ = onReady_;\r\n        this.onDisconnect_ = onDisconnect_;\r\n        this.onKill_ = onKill_;\r\n        this.lastSessionId = lastSessionId;\r\n        this.connectionCount = 0;\r\n        this.pendingDataMessages = [];\r\n        this.state_ = 0 /* CONNECTING */;\r\n        this.log_ = logWrapper('c:' + this.id + ':');\r\n        this.transportManager_ = new TransportManager(repoInfo_);\r\n        this.log_('Connection created');\r\n        this.start_();\r\n    }\r\n    /**\r\n     * Starts a connection attempt\r\n     * @private\r\n     */\r\n    Connection.prototype.start_ = function () {\r\n        var _this = this;\r\n        var conn = this.transportManager_.initialTransport();\r\n        this.conn_ = new conn(this.nextTransportId_(), this.repoInfo_, undefined, this.lastSessionId);\r\n        // For certain transports (WebSockets), we need to send and receive several messages back and forth before we\r\n        // can consider the transport healthy.\r\n        this.primaryResponsesRequired_ = conn['responsesRequiredToBeHealthy'] || 0;\r\n        var onMessageReceived = this.connReceiver_(this.conn_);\r\n        var onConnectionLost = this.disconnReceiver_(this.conn_);\r\n        this.tx_ = this.conn_;\r\n        this.rx_ = this.conn_;\r\n        this.secondaryConn_ = null;\r\n        this.isHealthy_ = false;\r\n        /*\r\n         * Firefox doesn't like when code from one iframe tries to create another iframe by way of the parent frame.\r\n         * This can occur in the case of a redirect, i.e. we guessed wrong on what server to connect to and received a reset.\r\n         * Somehow, setTimeout seems to make this ok. That doesn't make sense from a security perspective, since you should\r\n         * still have the context of your originating frame.\r\n         */\r\n        setTimeout(function () {\r\n            // this.conn_ gets set to null in some of the tests. Check to make sure it still exists before using it\r\n            _this.conn_ && _this.conn_.open(onMessageReceived, onConnectionLost);\r\n        }, Math.floor(0));\r\n        var healthyTimeout_ms = conn['healthyTimeout'] || 0;\r\n        if (healthyTimeout_ms > 0) {\r\n            this.healthyTimeout_ = setTimeoutNonBlocking(function () {\r\n                _this.healthyTimeout_ = null;\r\n                if (!_this.isHealthy_) {\r\n                    if (_this.conn_ &&\r\n                        _this.conn_.bytesReceived > BYTES_RECEIVED_HEALTHY_OVERRIDE) {\r\n                        _this.log_('Connection exceeded healthy timeout but has received ' +\r\n                            _this.conn_.bytesReceived +\r\n                            ' bytes.  Marking connection healthy.');\r\n                        _this.isHealthy_ = true;\r\n                        _this.conn_.markConnectionHealthy();\r\n                    }\r\n                    else if (_this.conn_ &&\r\n                        _this.conn_.bytesSent > BYTES_SENT_HEALTHY_OVERRIDE) {\r\n                        _this.log_('Connection exceeded healthy timeout but has sent ' +\r\n                            _this.conn_.bytesSent +\r\n                            ' bytes.  Leaving connection alive.');\r\n                        // NOTE: We don't want to mark it healthy, since we have no guarantee that the bytes have made it to\r\n                        // the server.\r\n                    }\r\n                    else {\r\n                        _this.log_('Closing unhealthy connection after timeout.');\r\n                        _this.close();\r\n                    }\r\n                }\r\n            }, Math.floor(healthyTimeout_ms));\r\n        }\r\n    };\r\n    /**\r\n     * @return {!string}\r\n     * @private\r\n     */\r\n    Connection.prototype.nextTransportId_ = function () {\r\n        return 'c:' + this.id + ':' + this.connectionCount++;\r\n    };\r\n    Connection.prototype.disconnReceiver_ = function (conn) {\r\n        var _this = this;\r\n        return function (everConnected) {\r\n            if (conn === _this.conn_) {\r\n                _this.onConnectionLost_(everConnected);\r\n            }\r\n            else if (conn === _this.secondaryConn_) {\r\n                _this.log_('Secondary connection lost.');\r\n                _this.onSecondaryConnectionLost_();\r\n            }\r\n            else {\r\n                _this.log_('closing an old connection');\r\n            }\r\n        };\r\n    };\r\n    Connection.prototype.connReceiver_ = function (conn) {\r\n        var _this = this;\r\n        return function (message) {\r\n            if (_this.state_ != 2 /* DISCONNECTED */) {\r\n                if (conn === _this.rx_) {\r\n                    _this.onPrimaryMessageReceived_(message);\r\n                }\r\n                else if (conn === _this.secondaryConn_) {\r\n                    _this.onSecondaryMessageReceived_(message);\r\n                }\r\n                else {\r\n                    _this.log_('message on old connection');\r\n                }\r\n            }\r\n        };\r\n    };\r\n    /**\r\n     *\r\n     * @param {Object} dataMsg An arbitrary data message to be sent to the server\r\n     */\r\n    Connection.prototype.sendRequest = function (dataMsg) {\r\n        // wrap in a data message envelope and send it on\r\n        var msg = { t: 'd', d: dataMsg };\r\n        this.sendData_(msg);\r\n    };\r\n    Connection.prototype.tryCleanupConnection = function () {\r\n        if (this.tx_ === this.secondaryConn_ && this.rx_ === this.secondaryConn_) {\r\n            this.log_('cleaning up and promoting a connection: ' + this.secondaryConn_.connId);\r\n            this.conn_ = this.secondaryConn_;\r\n            this.secondaryConn_ = null;\r\n            // the server will shutdown the old connection\r\n        }\r\n    };\r\n    Connection.prototype.onSecondaryControl_ = function (controlData) {\r\n        if (MESSAGE_TYPE in controlData) {\r\n            var cmd = controlData[MESSAGE_TYPE];\r\n            if (cmd === SWITCH_ACK) {\r\n                this.upgradeIfSecondaryHealthy_();\r\n            }\r\n            else if (cmd === CONTROL_RESET) {\r\n                // Most likely the session wasn't valid. Abandon the switch attempt\r\n                this.log_('Got a reset on secondary, closing it');\r\n                this.secondaryConn_.close();\r\n                // If we were already using this connection for something, than we need to fully close\r\n                if (this.tx_ === this.secondaryConn_ ||\r\n                    this.rx_ === this.secondaryConn_) {\r\n                    this.close();\r\n                }\r\n            }\r\n            else if (cmd === CONTROL_PONG) {\r\n                this.log_('got pong on secondary.');\r\n                this.secondaryResponsesRequired_--;\r\n                this.upgradeIfSecondaryHealthy_();\r\n            }\r\n        }\r\n    };\r\n    Connection.prototype.onSecondaryMessageReceived_ = function (parsedData) {\r\n        var layer = requireKey('t', parsedData);\r\n        var data = requireKey('d', parsedData);\r\n        if (layer == 'c') {\r\n            this.onSecondaryControl_(data);\r\n        }\r\n        else if (layer == 'd') {\r\n            // got a data message, but we're still second connection. Need to buffer it up\r\n            this.pendingDataMessages.push(data);\r\n        }\r\n        else {\r\n            throw new Error('Unknown protocol layer: ' + layer);\r\n        }\r\n    };\r\n    Connection.prototype.upgradeIfSecondaryHealthy_ = function () {\r\n        if (this.secondaryResponsesRequired_ <= 0) {\r\n            this.log_('Secondary connection is healthy.');\r\n            this.isHealthy_ = true;\r\n            this.secondaryConn_.markConnectionHealthy();\r\n            this.proceedWithUpgrade_();\r\n        }\r\n        else {\r\n            // Send a ping to make sure the connection is healthy.\r\n            this.log_('sending ping on secondary.');\r\n            this.secondaryConn_.send({ t: 'c', d: { t: PING, d: {} } });\r\n        }\r\n    };\r\n    Connection.prototype.proceedWithUpgrade_ = function () {\r\n        // tell this connection to consider itself open\r\n        this.secondaryConn_.start();\r\n        // send ack\r\n        this.log_('sending client ack on secondary');\r\n        this.secondaryConn_.send({ t: 'c', d: { t: SWITCH_ACK, d: {} } });\r\n        // send end packet on primary transport, switch to sending on this one\r\n        // can receive on this one, buffer responses until end received on primary transport\r\n        this.log_('Ending transmission on primary');\r\n        this.conn_.send({ t: 'c', d: { t: END_TRANSMISSION, d: {} } });\r\n        this.tx_ = this.secondaryConn_;\r\n        this.tryCleanupConnection();\r\n    };\r\n    Connection.prototype.onPrimaryMessageReceived_ = function (parsedData) {\r\n        // Must refer to parsedData properties in quotes, so closure doesn't touch them.\r\n        var layer = requireKey('t', parsedData);\r\n        var data = requireKey('d', parsedData);\r\n        if (layer == 'c') {\r\n            this.onControl_(data);\r\n        }\r\n        else if (layer == 'd') {\r\n            this.onDataMessage_(data);\r\n        }\r\n    };\r\n    Connection.prototype.onDataMessage_ = function (message) {\r\n        this.onPrimaryResponse_();\r\n        // We don't do anything with data messages, just kick them up a level\r\n        this.onMessage_(message);\r\n    };\r\n    Connection.prototype.onPrimaryResponse_ = function () {\r\n        if (!this.isHealthy_) {\r\n            this.primaryResponsesRequired_--;\r\n            if (this.primaryResponsesRequired_ <= 0) {\r\n                this.log_('Primary connection is healthy.');\r\n                this.isHealthy_ = true;\r\n                this.conn_.markConnectionHealthy();\r\n            }\r\n        }\r\n    };\r\n    Connection.prototype.onControl_ = function (controlData) {\r\n        var cmd = requireKey(MESSAGE_TYPE, controlData);\r\n        if (MESSAGE_DATA in controlData) {\r\n            var payload = controlData[MESSAGE_DATA];\r\n            if (cmd === SERVER_HELLO) {\r\n                this.onHandshake_(payload);\r\n            }\r\n            else if (cmd === END_TRANSMISSION) {\r\n                this.log_('recvd end transmission on primary');\r\n                this.rx_ = this.secondaryConn_;\r\n                for (var i = 0; i < this.pendingDataMessages.length; ++i) {\r\n                    this.onDataMessage_(this.pendingDataMessages[i]);\r\n                }\r\n                this.pendingDataMessages = [];\r\n                this.tryCleanupConnection();\r\n            }\r\n            else if (cmd === CONTROL_SHUTDOWN) {\r\n                // This was previously the 'onKill' callback passed to the lower-level connection\r\n                // payload in this case is the reason for the shutdown. Generally a human-readable error\r\n                this.onConnectionShutdown_(payload);\r\n            }\r\n            else if (cmd === CONTROL_RESET) {\r\n                // payload in this case is the host we should contact\r\n                this.onReset_(payload);\r\n            }\r\n            else if (cmd === CONTROL_ERROR) {\r\n                error('Server Error: ' + payload);\r\n            }\r\n            else if (cmd === CONTROL_PONG) {\r\n                this.log_('got pong on primary.');\r\n                this.onPrimaryResponse_();\r\n                this.sendPingOnPrimaryIfNecessary_();\r\n            }\r\n            else {\r\n                error('Unknown control packet command: ' + cmd);\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     *\r\n     * @param {Object} handshake The handshake data returned from the server\r\n     * @private\r\n     */\r\n    Connection.prototype.onHandshake_ = function (handshake) {\r\n        var timestamp = handshake.ts;\r\n        var version = handshake.v;\r\n        var host = handshake.h;\r\n        this.sessionId = handshake.s;\r\n        this.repoInfo_.updateHost(host);\r\n        // if we've already closed the connection, then don't bother trying to progress further\r\n        if (this.state_ == 0 /* CONNECTING */) {\r\n            this.conn_.start();\r\n            this.onConnectionEstablished_(this.conn_, timestamp);\r\n            if (PROTOCOL_VERSION !== version) {\r\n                warn('Protocol version mismatch detected');\r\n            }\r\n            // TODO: do we want to upgrade? when? maybe a delay?\r\n            this.tryStartUpgrade_();\r\n        }\r\n    };\r\n    Connection.prototype.tryStartUpgrade_ = function () {\r\n        var conn = this.transportManager_.upgradeTransport();\r\n        if (conn) {\r\n            this.startUpgrade_(conn);\r\n        }\r\n    };\r\n    Connection.prototype.startUpgrade_ = function (conn) {\r\n        var _this = this;\r\n        this.secondaryConn_ = new conn(this.nextTransportId_(), this.repoInfo_, this.sessionId);\r\n        // For certain transports (WebSockets), we need to send and receive several messages back and forth before we\r\n        // can consider the transport healthy.\r\n        this.secondaryResponsesRequired_ =\r\n            conn['responsesRequiredToBeHealthy'] || 0;\r\n        var onMessage = this.connReceiver_(this.secondaryConn_);\r\n        var onDisconnect = this.disconnReceiver_(this.secondaryConn_);\r\n        this.secondaryConn_.open(onMessage, onDisconnect);\r\n        // If we haven't successfully upgraded after UPGRADE_TIMEOUT, give up and kill the secondary.\r\n        setTimeoutNonBlocking(function () {\r\n            if (_this.secondaryConn_) {\r\n                _this.log_('Timed out trying to upgrade.');\r\n                _this.secondaryConn_.close();\r\n            }\r\n        }, Math.floor(UPGRADE_TIMEOUT));\r\n    };\r\n    Connection.prototype.onReset_ = function (host) {\r\n        this.log_('Reset packet received.  New host: ' + host);\r\n        this.repoInfo_.updateHost(host);\r\n        // TODO: if we're already \"connected\", we need to trigger a disconnect at the next layer up.\r\n        // We don't currently support resets after the connection has already been established\r\n        if (this.state_ === 1 /* CONNECTED */) {\r\n            this.close();\r\n        }\r\n        else {\r\n            // Close whatever connections we have open and start again.\r\n            this.closeConnections_();\r\n            this.start_();\r\n        }\r\n    };\r\n    Connection.prototype.onConnectionEstablished_ = function (conn, timestamp) {\r\n        var _this = this;\r\n        this.log_('Realtime connection established.');\r\n        this.conn_ = conn;\r\n        this.state_ = 1 /* CONNECTED */;\r\n        if (this.onReady_) {\r\n            this.onReady_(timestamp, this.sessionId);\r\n            this.onReady_ = null;\r\n        }\r\n        // If after 5 seconds we haven't sent enough requests to the server to get the connection healthy,\r\n        // send some pings.\r\n        if (this.primaryResponsesRequired_ === 0) {\r\n            this.log_('Primary connection is healthy.');\r\n            this.isHealthy_ = true;\r\n        }\r\n        else {\r\n            setTimeoutNonBlocking(function () {\r\n                _this.sendPingOnPrimaryIfNecessary_();\r\n            }, Math.floor(DELAY_BEFORE_SENDING_EXTRA_REQUESTS));\r\n        }\r\n    };\r\n    Connection.prototype.sendPingOnPrimaryIfNecessary_ = function () {\r\n        // If the connection isn't considered healthy yet, we'll send a noop ping packet request.\r\n        if (!this.isHealthy_ && this.state_ === 1 /* CONNECTED */) {\r\n            this.log_('sending ping on primary.');\r\n            this.sendData_({ t: 'c', d: { t: PING, d: {} } });\r\n        }\r\n    };\r\n    Connection.prototype.onSecondaryConnectionLost_ = function () {\r\n        var conn = this.secondaryConn_;\r\n        this.secondaryConn_ = null;\r\n        if (this.tx_ === conn || this.rx_ === conn) {\r\n            // we are relying on this connection already in some capacity. Therefore, a failure is real\r\n            this.close();\r\n        }\r\n    };\r\n    /**\r\n     *\r\n     * @param {boolean} everConnected Whether or not the connection ever reached a server. Used to determine if\r\n     * we should flush the host cache\r\n     * @private\r\n     */\r\n    Connection.prototype.onConnectionLost_ = function (everConnected) {\r\n        this.conn_ = null;\r\n        // NOTE: IF you're seeing a Firefox error for this line, I think it might be because it's getting\r\n        // called on window close and RealtimeState.CONNECTING is no longer defined.  Just a guess.\r\n        if (!everConnected && this.state_ === 0 /* CONNECTING */) {\r\n            this.log_('Realtime connection failed.');\r\n            // Since we failed to connect at all, clear any cached entry for this namespace in case the machine went away\r\n            if (this.repoInfo_.isCacheableHost()) {\r\n                PersistentStorage.remove('host:' + this.repoInfo_.host);\r\n                // reset the internal host to what we would show the user, i.e. <ns>.firebaseio.com\r\n                this.repoInfo_.internalHost = this.repoInfo_.host;\r\n            }\r\n        }\r\n        else if (this.state_ === 1 /* CONNECTED */) {\r\n            this.log_('Realtime connection lost.');\r\n        }\r\n        this.close();\r\n    };\r\n    /**\r\n     *\r\n     * @param {string} reason\r\n     * @private\r\n     */\r\n    Connection.prototype.onConnectionShutdown_ = function (reason) {\r\n        this.log_('Connection shutdown command received. Shutting down...');\r\n        if (this.onKill_) {\r\n            this.onKill_(reason);\r\n            this.onKill_ = null;\r\n        }\r\n        // We intentionally don't want to fire onDisconnect (kill is a different case),\r\n        // so clear the callback.\r\n        this.onDisconnect_ = null;\r\n        this.close();\r\n    };\r\n    Connection.prototype.sendData_ = function (data) {\r\n        if (this.state_ !== 1 /* CONNECTED */) {\r\n            throw 'Connection is not connected';\r\n        }\r\n        else {\r\n            this.tx_.send(data);\r\n        }\r\n    };\r\n    /**\r\n     * Cleans up this connection, calling the appropriate callbacks\r\n     */\r\n    Connection.prototype.close = function () {\r\n        if (this.state_ !== 2 /* DISCONNECTED */) {\r\n            this.log_('Closing realtime connection.');\r\n            this.state_ = 2 /* DISCONNECTED */;\r\n            this.closeConnections_();\r\n            if (this.onDisconnect_) {\r\n                this.onDisconnect_();\r\n                this.onDisconnect_ = null;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     *\r\n     * @private\r\n     */\r\n    Connection.prototype.closeConnections_ = function () {\r\n        this.log_('Shutting down all connections');\r\n        if (this.conn_) {\r\n            this.conn_.close();\r\n            this.conn_ = null;\r\n        }\r\n        if (this.secondaryConn_) {\r\n            this.secondaryConn_.close();\r\n            this.secondaryConn_ = null;\r\n        }\r\n        if (this.healthyTimeout_) {\r\n            clearTimeout(this.healthyTimeout_);\r\n            this.healthyTimeout_ = null;\r\n        }\r\n    };\r\n    return Connection;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Interface defining the set of actions that can be performed against the Firebase server\r\n * (basically corresponds to our wire protocol).\r\n *\r\n * @interface\r\n */\r\nvar ServerActions = /** @class */ (function () {\r\n    function ServerActions() {\r\n    }\r\n    /**\r\n     * @param {string} pathString\r\n     * @param {*} data\r\n     * @param {function(string, string)=} onComplete\r\n     * @param {string=} hash\r\n     */\r\n    ServerActions.prototype.put = function (pathString, data, onComplete, hash) { };\r\n    /**\r\n     * @param {string} pathString\r\n     * @param {*} data\r\n     * @param {function(string, ?string)} onComplete\r\n     * @param {string=} hash\r\n     */\r\n    ServerActions.prototype.merge = function (pathString, data, onComplete, hash) { };\r\n    /**\r\n     * Refreshes the auth token for the current connection.\r\n     * @param {string} token The authentication token\r\n     */\r\n    ServerActions.prototype.refreshAuthToken = function (token) { };\r\n    /**\r\n     * @param {string} pathString\r\n     * @param {*} data\r\n     * @param {function(string, string)=} onComplete\r\n     */\r\n    ServerActions.prototype.onDisconnectPut = function (pathString, data, onComplete) { };\r\n    /**\r\n     * @param {string} pathString\r\n     * @param {*} data\r\n     * @param {function(string, string)=} onComplete\r\n     */\r\n    ServerActions.prototype.onDisconnectMerge = function (pathString, data, onComplete) { };\r\n    /**\r\n     * @param {string} pathString\r\n     * @param {function(string, string)=} onComplete\r\n     */\r\n    ServerActions.prototype.onDisconnectCancel = function (pathString, onComplete) { };\r\n    /**\r\n     * @param {Object.<string, *>} stats\r\n     */\r\n    ServerActions.prototype.reportStats = function (stats) { };\r\n    return ServerActions;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar RECONNECT_MIN_DELAY = 1000;\r\nvar RECONNECT_MAX_DELAY_DEFAULT = 60 * 5 * 1000; // 5 minutes in milliseconds (Case: 1858)\r\nvar RECONNECT_MAX_DELAY_FOR_ADMINS = 30 * 1000; // 30 seconds for admin clients (likely to be a backend server)\r\nvar RECONNECT_DELAY_MULTIPLIER = 1.3;\r\nvar RECONNECT_DELAY_RESET_TIMEOUT = 30000; // Reset delay back to MIN_DELAY after being connected for 30sec.\r\nvar SERVER_KILL_INTERRUPT_REASON = 'server_kill';\r\n// If auth fails repeatedly, we'll assume something is wrong and log a warning / back off.\r\nvar INVALID_AUTH_TOKEN_THRESHOLD = 3;\r\n/**\r\n * Firebase connection.  Abstracts wire protocol and handles reconnecting.\r\n *\r\n * NOTE: All JSON objects sent to the realtime connection must have property names enclosed\r\n * in quotes to make sure the closure compiler does not minify them.\r\n */\r\nvar PersistentConnection = /** @class */ (function (_super) {\r\n    __extends(PersistentConnection, _super);\r\n    /**\r\n     * @implements {ServerActions}\r\n     * @param {!RepoInfo} repoInfo_ Data about the namespace we are connecting to\r\n     * @param {function(string, *, boolean, ?number)} onDataUpdate_ A callback for new data from the server\r\n     * @param onConnectStatus_\r\n     * @param onServerInfoUpdate_\r\n     * @param authTokenProvider_\r\n     * @param authOverride_\r\n     */\r\n    function PersistentConnection(repoInfo_, onDataUpdate_, onConnectStatus_, onServerInfoUpdate_, authTokenProvider_, authOverride_) {\r\n        var _this = _super.call(this) || this;\r\n        _this.repoInfo_ = repoInfo_;\r\n        _this.onDataUpdate_ = onDataUpdate_;\r\n        _this.onConnectStatus_ = onConnectStatus_;\r\n        _this.onServerInfoUpdate_ = onServerInfoUpdate_;\r\n        _this.authTokenProvider_ = authTokenProvider_;\r\n        _this.authOverride_ = authOverride_;\r\n        // Used for diagnostic logging.\r\n        _this.id = PersistentConnection.nextPersistentConnectionId_++;\r\n        _this.log_ = logWrapper('p:' + _this.id + ':');\r\n        /** @private {Object} */\r\n        _this.interruptReasons_ = {};\r\n        _this.listens_ = {};\r\n        _this.outstandingPuts_ = [];\r\n        _this.outstandingPutCount_ = 0;\r\n        _this.onDisconnectRequestQueue_ = [];\r\n        _this.connected_ = false;\r\n        _this.reconnectDelay_ = RECONNECT_MIN_DELAY;\r\n        _this.maxReconnectDelay_ = RECONNECT_MAX_DELAY_DEFAULT;\r\n        _this.securityDebugCallback_ = null;\r\n        _this.lastSessionId = null;\r\n        /** @private {number|null} */\r\n        _this.establishConnectionTimer_ = null;\r\n        /** @private {boolean} */\r\n        _this.visible_ = false;\r\n        // Before we get connected, we keep a queue of pending messages to send.\r\n        _this.requestCBHash_ = {};\r\n        _this.requestNumber_ = 0;\r\n        /** @private {?{\r\n         *   sendRequest(Object),\r\n         *   close()\r\n         * }} */\r\n        _this.realtime_ = null;\r\n        /** @private {string|null} */\r\n        _this.authToken_ = null;\r\n        _this.forceTokenRefresh_ = false;\r\n        _this.invalidAuthTokenCount_ = 0;\r\n        _this.firstConnection_ = true;\r\n        _this.lastConnectionAttemptTime_ = null;\r\n        _this.lastConnectionEstablishedTime_ = null;\r\n        if (authOverride_ && !isNodeSdk()) {\r\n            throw new Error('Auth override specified in options, but not supported on non Node.js platforms');\r\n        }\r\n        _this.scheduleConnect_(0);\r\n        VisibilityMonitor.getInstance().on('visible', _this.onVisible_, _this);\r\n        if (repoInfo_.host.indexOf('fblocal') === -1) {\r\n            OnlineMonitor.getInstance().on('online', _this.onOnline_, _this);\r\n        }\r\n        return _this;\r\n    }\r\n    /**\r\n     * @param {!string} action\r\n     * @param {*} body\r\n     * @param {function(*)=} onResponse\r\n     * @protected\r\n     */\r\n    PersistentConnection.prototype.sendRequest = function (action, body, onResponse) {\r\n        var curReqNum = ++this.requestNumber_;\r\n        var msg = { r: curReqNum, a: action, b: body };\r\n        this.log_(stringify(msg));\r\n        assert(this.connected_, \"sendRequest call when we're not connected not allowed.\");\r\n        this.realtime_.sendRequest(msg);\r\n        if (onResponse) {\r\n            this.requestCBHash_[curReqNum] = onResponse;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PersistentConnection.prototype.listen = function (query, currentHashFn, tag, onComplete) {\r\n        var queryId = query.queryIdentifier();\r\n        var pathString = query.path.toString();\r\n        this.log_('Listen called for ' + pathString + ' ' + queryId);\r\n        this.listens_[pathString] = this.listens_[pathString] || {};\r\n        assert(query.getQueryParams().isDefault() ||\r\n            !query.getQueryParams().loadsAllData(), 'listen() called for non-default but complete query');\r\n        assert(!this.listens_[pathString][queryId], 'listen() called twice for same path/queryId.');\r\n        var listenSpec = {\r\n            onComplete: onComplete,\r\n            hashFn: currentHashFn,\r\n            query: query,\r\n            tag: tag\r\n        };\r\n        this.listens_[pathString][queryId] = listenSpec;\r\n        if (this.connected_) {\r\n            this.sendListen_(listenSpec);\r\n        }\r\n    };\r\n    /**\r\n     * @param {!{onComplete(),\r\n     *           hashFn():!string,\r\n     *           query: !Query,\r\n     *           tag: ?number}} listenSpec\r\n     * @private\r\n     */\r\n    PersistentConnection.prototype.sendListen_ = function (listenSpec) {\r\n        var _this = this;\r\n        var query = listenSpec.query;\r\n        var pathString = query.path.toString();\r\n        var queryId = query.queryIdentifier();\r\n        this.log_('Listen on ' + pathString + ' for ' + queryId);\r\n        var req = { /*path*/ p: pathString };\r\n        var action = 'q';\r\n        // Only bother to send query if it's non-default.\r\n        if (listenSpec.tag) {\r\n            req['q'] = query.queryObject();\r\n            req['t'] = listenSpec.tag;\r\n        }\r\n        req[ /*hash*/'h'] = listenSpec.hashFn();\r\n        this.sendRequest(action, req, function (message) {\r\n            var payload = message[ /*data*/'d'];\r\n            var status = message[ /*status*/'s'];\r\n            // print warnings in any case...\r\n            PersistentConnection.warnOnListenWarnings_(payload, query);\r\n            var currentListenSpec = _this.listens_[pathString] && _this.listens_[pathString][queryId];\r\n            // only trigger actions if the listen hasn't been removed and readded\r\n            if (currentListenSpec === listenSpec) {\r\n                _this.log_('listen response', message);\r\n                if (status !== 'ok') {\r\n                    _this.removeListen_(pathString, queryId);\r\n                }\r\n                if (listenSpec.onComplete) {\r\n                    listenSpec.onComplete(status, payload);\r\n                }\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * @param {*} payload\r\n     * @param {!Query} query\r\n     * @private\r\n     */\r\n    PersistentConnection.warnOnListenWarnings_ = function (payload, query) {\r\n        if (payload && typeof payload === 'object' && contains(payload, 'w')) {\r\n            var warnings = safeGet(payload, 'w');\r\n            if (Array.isArray(warnings) && ~warnings.indexOf('no_index')) {\r\n                var indexSpec = '\".indexOn\": \"' +\r\n                    query\r\n                        .getQueryParams()\r\n                        .getIndex()\r\n                        .toString() +\r\n                    '\"';\r\n                var indexPath = query.path.toString();\r\n                warn(\"Using an unspecified index. Your data will be downloaded and \" +\r\n                    (\"filtered on the client. Consider adding \" + indexSpec + \" at \") +\r\n                    (indexPath + \" to your security rules for better performance.\"));\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PersistentConnection.prototype.refreshAuthToken = function (token) {\r\n        this.authToken_ = token;\r\n        this.log_('Auth token refreshed');\r\n        if (this.authToken_) {\r\n            this.tryAuth();\r\n        }\r\n        else {\r\n            //If we're connected we want to let the server know to unauthenticate us. If we're not connected, simply delete\r\n            //the credential so we dont become authenticated next time we connect.\r\n            if (this.connected_) {\r\n                this.sendRequest('unauth', {}, function () { });\r\n            }\r\n        }\r\n        this.reduceReconnectDelayIfAdminCredential_(token);\r\n    };\r\n    /**\r\n     * @param {!string} credential\r\n     * @private\r\n     */\r\n    PersistentConnection.prototype.reduceReconnectDelayIfAdminCredential_ = function (credential) {\r\n        // NOTE: This isn't intended to be bulletproof (a malicious developer can always just modify the client).\r\n        // Additionally, we don't bother resetting the max delay back to the default if auth fails / expires.\r\n        var isFirebaseSecret = credential && credential.length === 40;\r\n        if (isFirebaseSecret || isAdmin(credential)) {\r\n            this.log_('Admin auth credential detected.  Reducing max reconnect time.');\r\n            this.maxReconnectDelay_ = RECONNECT_MAX_DELAY_FOR_ADMINS;\r\n        }\r\n    };\r\n    /**\r\n     * Attempts to authenticate with the given credentials. If the authentication attempt fails, it's triggered like\r\n     * a auth revoked (the connection is closed).\r\n     */\r\n    PersistentConnection.prototype.tryAuth = function () {\r\n        var _this = this;\r\n        if (this.connected_ && this.authToken_) {\r\n            var token_1 = this.authToken_;\r\n            var authMethod = isValidFormat(token_1) ? 'auth' : 'gauth';\r\n            var requestData = { cred: token_1 };\r\n            if (this.authOverride_ === null) {\r\n                requestData['noauth'] = true;\r\n            }\r\n            else if (typeof this.authOverride_ === 'object') {\r\n                requestData['authvar'] = this.authOverride_;\r\n            }\r\n            this.sendRequest(authMethod, requestData, function (res) {\r\n                var status = res[ /*status*/'s'];\r\n                var data = res[ /*data*/'d'] || 'error';\r\n                if (_this.authToken_ === token_1) {\r\n                    if (status === 'ok') {\r\n                        _this.invalidAuthTokenCount_ = 0;\r\n                    }\r\n                    else {\r\n                        // Triggers reconnect and force refresh for auth token\r\n                        _this.onAuthRevoked_(status, data);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PersistentConnection.prototype.unlisten = function (query, tag) {\r\n        var pathString = query.path.toString();\r\n        var queryId = query.queryIdentifier();\r\n        this.log_('Unlisten called for ' + pathString + ' ' + queryId);\r\n        assert(query.getQueryParams().isDefault() ||\r\n            !query.getQueryParams().loadsAllData(), 'unlisten() called for non-default but complete query');\r\n        var listen = this.removeListen_(pathString, queryId);\r\n        if (listen && this.connected_) {\r\n            this.sendUnlisten_(pathString, queryId, query.queryObject(), tag);\r\n        }\r\n    };\r\n    PersistentConnection.prototype.sendUnlisten_ = function (pathString, queryId, queryObj, tag) {\r\n        this.log_('Unlisten on ' + pathString + ' for ' + queryId);\r\n        var req = { /*path*/ p: pathString };\r\n        var action = 'n';\r\n        // Only bother sending queryId if it's non-default.\r\n        if (tag) {\r\n            req['q'] = queryObj;\r\n            req['t'] = tag;\r\n        }\r\n        this.sendRequest(action, req);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PersistentConnection.prototype.onDisconnectPut = function (pathString, data, onComplete) {\r\n        if (this.connected_) {\r\n            this.sendOnDisconnect_('o', pathString, data, onComplete);\r\n        }\r\n        else {\r\n            this.onDisconnectRequestQueue_.push({\r\n                pathString: pathString,\r\n                action: 'o',\r\n                data: data,\r\n                onComplete: onComplete\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PersistentConnection.prototype.onDisconnectMerge = function (pathString, data, onComplete) {\r\n        if (this.connected_) {\r\n            this.sendOnDisconnect_('om', pathString, data, onComplete);\r\n        }\r\n        else {\r\n            this.onDisconnectRequestQueue_.push({\r\n                pathString: pathString,\r\n                action: 'om',\r\n                data: data,\r\n                onComplete: onComplete\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PersistentConnection.prototype.onDisconnectCancel = function (pathString, onComplete) {\r\n        if (this.connected_) {\r\n            this.sendOnDisconnect_('oc', pathString, null, onComplete);\r\n        }\r\n        else {\r\n            this.onDisconnectRequestQueue_.push({\r\n                pathString: pathString,\r\n                action: 'oc',\r\n                data: null,\r\n                onComplete: onComplete\r\n            });\r\n        }\r\n    };\r\n    PersistentConnection.prototype.sendOnDisconnect_ = function (action, pathString, data, onComplete) {\r\n        var request = { /*path*/ p: pathString, /*data*/ d: data };\r\n        this.log_('onDisconnect ' + action, request);\r\n        this.sendRequest(action, request, function (response) {\r\n            if (onComplete) {\r\n                setTimeout(function () {\r\n                    onComplete(response[ /*status*/'s'], response[ /* data */'d']);\r\n                }, Math.floor(0));\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PersistentConnection.prototype.put = function (pathString, data, onComplete, hash) {\r\n        this.putInternal('p', pathString, data, onComplete, hash);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PersistentConnection.prototype.merge = function (pathString, data, onComplete, hash) {\r\n        this.putInternal('m', pathString, data, onComplete, hash);\r\n    };\r\n    PersistentConnection.prototype.putInternal = function (action, pathString, data, onComplete, hash) {\r\n        var request = {\r\n            /*path*/ p: pathString,\r\n            /*data*/ d: data\r\n        };\r\n        if (hash !== undefined)\r\n            request[ /*hash*/'h'] = hash;\r\n        // TODO: Only keep track of the most recent put for a given path?\r\n        this.outstandingPuts_.push({\r\n            action: action,\r\n            request: request,\r\n            onComplete: onComplete\r\n        });\r\n        this.outstandingPutCount_++;\r\n        var index = this.outstandingPuts_.length - 1;\r\n        if (this.connected_) {\r\n            this.sendPut_(index);\r\n        }\r\n        else {\r\n            this.log_('Buffering put: ' + pathString);\r\n        }\r\n    };\r\n    PersistentConnection.prototype.sendPut_ = function (index) {\r\n        var _this = this;\r\n        var action = this.outstandingPuts_[index].action;\r\n        var request = this.outstandingPuts_[index].request;\r\n        var onComplete = this.outstandingPuts_[index].onComplete;\r\n        this.outstandingPuts_[index].queued = this.connected_;\r\n        this.sendRequest(action, request, function (message) {\r\n            _this.log_(action + ' response', message);\r\n            delete _this.outstandingPuts_[index];\r\n            _this.outstandingPutCount_--;\r\n            // Clean up array occasionally.\r\n            if (_this.outstandingPutCount_ === 0) {\r\n                _this.outstandingPuts_ = [];\r\n            }\r\n            if (onComplete)\r\n                onComplete(message[ /*status*/'s'], message[ /* data */'d']);\r\n        });\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PersistentConnection.prototype.reportStats = function (stats) {\r\n        var _this = this;\r\n        // If we're not connected, we just drop the stats.\r\n        if (this.connected_) {\r\n            var request = { /*counters*/ c: stats };\r\n            this.log_('reportStats', request);\r\n            this.sendRequest(/*stats*/ 's', request, function (result) {\r\n                var status = result[ /*status*/'s'];\r\n                if (status !== 'ok') {\r\n                    var errorReason = result[ /* data */'d'];\r\n                    _this.log_('reportStats', 'Error sending stats: ' + errorReason);\r\n                }\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * @param {*} message\r\n     * @private\r\n     */\r\n    PersistentConnection.prototype.onDataMessage_ = function (message) {\r\n        if ('r' in message) {\r\n            // this is a response\r\n            this.log_('from server: ' + stringify(message));\r\n            var reqNum = message['r'];\r\n            var onResponse = this.requestCBHash_[reqNum];\r\n            if (onResponse) {\r\n                delete this.requestCBHash_[reqNum];\r\n                onResponse(message[ /*body*/'b']);\r\n            }\r\n        }\r\n        else if ('error' in message) {\r\n            throw 'A server-side error has occurred: ' + message['error'];\r\n        }\r\n        else if ('a' in message) {\r\n            // a and b are action and body, respectively\r\n            this.onDataPush_(message['a'], message['b']);\r\n        }\r\n    };\r\n    PersistentConnection.prototype.onDataPush_ = function (action, body) {\r\n        this.log_('handleServerMessage', action, body);\r\n        if (action === 'd')\r\n            this.onDataUpdate_(body[ /*path*/'p'], body[ /*data*/'d'], \r\n            /*isMerge*/ false, body['t']);\r\n        else if (action === 'm')\r\n            this.onDataUpdate_(body[ /*path*/'p'], body[ /*data*/'d'], \r\n            /*isMerge=*/ true, body['t']);\r\n        else if (action === 'c')\r\n            this.onListenRevoked_(body[ /*path*/'p'], body[ /*query*/'q']);\r\n        else if (action === 'ac')\r\n            this.onAuthRevoked_(body[ /*status code*/'s'], body[ /* explanation */'d']);\r\n        else if (action === 'sd')\r\n            this.onSecurityDebugPacket_(body);\r\n        else\r\n            error('Unrecognized action received from server: ' +\r\n                stringify(action) +\r\n                '\\nAre you using the latest client?');\r\n    };\r\n    PersistentConnection.prototype.onReady_ = function (timestamp, sessionId) {\r\n        this.log_('connection ready');\r\n        this.connected_ = true;\r\n        this.lastConnectionEstablishedTime_ = new Date().getTime();\r\n        this.handleTimestamp_(timestamp);\r\n        this.lastSessionId = sessionId;\r\n        if (this.firstConnection_) {\r\n            this.sendConnectStats_();\r\n        }\r\n        this.restoreState_();\r\n        this.firstConnection_ = false;\r\n        this.onConnectStatus_(true);\r\n    };\r\n    PersistentConnection.prototype.scheduleConnect_ = function (timeout) {\r\n        var _this = this;\r\n        assert(!this.realtime_, \"Scheduling a connect when we're already connected/ing?\");\r\n        if (this.establishConnectionTimer_) {\r\n            clearTimeout(this.establishConnectionTimer_);\r\n        }\r\n        // NOTE: Even when timeout is 0, it's important to do a setTimeout to work around an infuriating \"Security Error\" in\r\n        // Firefox when trying to write to our long-polling iframe in some scenarios (e.g. Forge or our unit tests).\r\n        this.establishConnectionTimer_ = setTimeout(function () {\r\n            _this.establishConnectionTimer_ = null;\r\n            _this.establishConnection_();\r\n        }, Math.floor(timeout));\r\n    };\r\n    /**\r\n     * @param {boolean} visible\r\n     * @private\r\n     */\r\n    PersistentConnection.prototype.onVisible_ = function (visible) {\r\n        // NOTE: Tabbing away and back to a window will defeat our reconnect backoff, but I think that's fine.\r\n        if (visible &&\r\n            !this.visible_ &&\r\n            this.reconnectDelay_ === this.maxReconnectDelay_) {\r\n            this.log_('Window became visible.  Reducing delay.');\r\n            this.reconnectDelay_ = RECONNECT_MIN_DELAY;\r\n            if (!this.realtime_) {\r\n                this.scheduleConnect_(0);\r\n            }\r\n        }\r\n        this.visible_ = visible;\r\n    };\r\n    PersistentConnection.prototype.onOnline_ = function (online) {\r\n        if (online) {\r\n            this.log_('Browser went online.');\r\n            this.reconnectDelay_ = RECONNECT_MIN_DELAY;\r\n            if (!this.realtime_) {\r\n                this.scheduleConnect_(0);\r\n            }\r\n        }\r\n        else {\r\n            this.log_('Browser went offline.  Killing connection.');\r\n            if (this.realtime_) {\r\n                this.realtime_.close();\r\n            }\r\n        }\r\n    };\r\n    PersistentConnection.prototype.onRealtimeDisconnect_ = function () {\r\n        this.log_('data client disconnected');\r\n        this.connected_ = false;\r\n        this.realtime_ = null;\r\n        // Since we don't know if our sent transactions succeeded or not, we need to cancel them.\r\n        this.cancelSentTransactions_();\r\n        // Clear out the pending requests.\r\n        this.requestCBHash_ = {};\r\n        if (this.shouldReconnect_()) {\r\n            if (!this.visible_) {\r\n                this.log_(\"Window isn't visible.  Delaying reconnect.\");\r\n                this.reconnectDelay_ = this.maxReconnectDelay_;\r\n                this.lastConnectionAttemptTime_ = new Date().getTime();\r\n            }\r\n            else if (this.lastConnectionEstablishedTime_) {\r\n                // If we've been connected long enough, reset reconnect delay to minimum.\r\n                var timeSinceLastConnectSucceeded = new Date().getTime() - this.lastConnectionEstablishedTime_;\r\n                if (timeSinceLastConnectSucceeded > RECONNECT_DELAY_RESET_TIMEOUT)\r\n                    this.reconnectDelay_ = RECONNECT_MIN_DELAY;\r\n                this.lastConnectionEstablishedTime_ = null;\r\n            }\r\n            var timeSinceLastConnectAttempt = new Date().getTime() - this.lastConnectionAttemptTime_;\r\n            var reconnectDelay = Math.max(0, this.reconnectDelay_ - timeSinceLastConnectAttempt);\r\n            reconnectDelay = Math.random() * reconnectDelay;\r\n            this.log_('Trying to reconnect in ' + reconnectDelay + 'ms');\r\n            this.scheduleConnect_(reconnectDelay);\r\n            // Adjust reconnect delay for next time.\r\n            this.reconnectDelay_ = Math.min(this.maxReconnectDelay_, this.reconnectDelay_ * RECONNECT_DELAY_MULTIPLIER);\r\n        }\r\n        this.onConnectStatus_(false);\r\n    };\r\n    PersistentConnection.prototype.establishConnection_ = function () {\r\n        if (this.shouldReconnect_()) {\r\n            this.log_('Making a connection attempt');\r\n            this.lastConnectionAttemptTime_ = new Date().getTime();\r\n            this.lastConnectionEstablishedTime_ = null;\r\n            var onDataMessage_1 = this.onDataMessage_.bind(this);\r\n            var onReady_1 = this.onReady_.bind(this);\r\n            var onDisconnect_1 = this.onRealtimeDisconnect_.bind(this);\r\n            var connId_1 = this.id + ':' + PersistentConnection.nextConnectionId_++;\r\n            var self_1 = this;\r\n            var lastSessionId_1 = this.lastSessionId;\r\n            var canceled_1 = false;\r\n            var connection_1 = null;\r\n            var closeFn_1 = function () {\r\n                if (connection_1) {\r\n                    connection_1.close();\r\n                }\r\n                else {\r\n                    canceled_1 = true;\r\n                    onDisconnect_1();\r\n                }\r\n            };\r\n            var sendRequestFn = function (msg) {\r\n                assert(connection_1, \"sendRequest call when we're not connected not allowed.\");\r\n                connection_1.sendRequest(msg);\r\n            };\r\n            this.realtime_ = {\r\n                close: closeFn_1,\r\n                sendRequest: sendRequestFn\r\n            };\r\n            var forceRefresh = this.forceTokenRefresh_;\r\n            this.forceTokenRefresh_ = false;\r\n            // First fetch auth token, and establish connection after fetching the token was successful\r\n            this.authTokenProvider_\r\n                .getToken(forceRefresh)\r\n                .then(function (result) {\r\n                if (!canceled_1) {\r\n                    log('getToken() completed. Creating connection.');\r\n                    self_1.authToken_ = result && result.accessToken;\r\n                    connection_1 = new Connection(connId_1, self_1.repoInfo_, onDataMessage_1, onReady_1, onDisconnect_1, \r\n                    /* onKill= */ function (reason) {\r\n                        warn(reason + ' (' + self_1.repoInfo_.toString() + ')');\r\n                        self_1.interrupt(SERVER_KILL_INTERRUPT_REASON);\r\n                    }, lastSessionId_1);\r\n                }\r\n                else {\r\n                    log('getToken() completed but was canceled');\r\n                }\r\n            })\r\n                .then(null, function (error$$1) {\r\n                self_1.log_('Failed to get token: ' + error$$1);\r\n                if (!canceled_1) {\r\n                    if (CONSTANTS.NODE_ADMIN) {\r\n                        // This may be a critical error for the Admin Node.js SDK, so log a warning.\r\n                        // But getToken() may also just have temporarily failed, so we still want to\r\n                        // continue retrying.\r\n                        warn(error$$1);\r\n                    }\r\n                    closeFn_1();\r\n                }\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * @param {string} reason\r\n     */\r\n    PersistentConnection.prototype.interrupt = function (reason) {\r\n        log('Interrupting connection for reason: ' + reason);\r\n        this.interruptReasons_[reason] = true;\r\n        if (this.realtime_) {\r\n            this.realtime_.close();\r\n        }\r\n        else {\r\n            if (this.establishConnectionTimer_) {\r\n                clearTimeout(this.establishConnectionTimer_);\r\n                this.establishConnectionTimer_ = null;\r\n            }\r\n            if (this.connected_) {\r\n                this.onRealtimeDisconnect_();\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * @param {string} reason\r\n     */\r\n    PersistentConnection.prototype.resume = function (reason) {\r\n        log('Resuming connection for reason: ' + reason);\r\n        delete this.interruptReasons_[reason];\r\n        if (isEmpty(this.interruptReasons_)) {\r\n            this.reconnectDelay_ = RECONNECT_MIN_DELAY;\r\n            if (!this.realtime_) {\r\n                this.scheduleConnect_(0);\r\n            }\r\n        }\r\n    };\r\n    PersistentConnection.prototype.handleTimestamp_ = function (timestamp) {\r\n        var delta = timestamp - new Date().getTime();\r\n        this.onServerInfoUpdate_({ serverTimeOffset: delta });\r\n    };\r\n    PersistentConnection.prototype.cancelSentTransactions_ = function () {\r\n        for (var i = 0; i < this.outstandingPuts_.length; i++) {\r\n            var put = this.outstandingPuts_[i];\r\n            if (put && /*hash*/ 'h' in put.request && put.queued) {\r\n                if (put.onComplete)\r\n                    put.onComplete('disconnect');\r\n                delete this.outstandingPuts_[i];\r\n                this.outstandingPutCount_--;\r\n            }\r\n        }\r\n        // Clean up array occasionally.\r\n        if (this.outstandingPutCount_ === 0)\r\n            this.outstandingPuts_ = [];\r\n    };\r\n    /**\r\n     * @param {!string} pathString\r\n     * @param {Array.<*>=} query\r\n     * @private\r\n     */\r\n    PersistentConnection.prototype.onListenRevoked_ = function (pathString, query) {\r\n        // Remove the listen and manufacture a \"permission_denied\" error for the failed listen.\r\n        var queryId;\r\n        if (!query) {\r\n            queryId = 'default';\r\n        }\r\n        else {\r\n            queryId = query.map(function (q) { return ObjectToUniqueKey(q); }).join('$');\r\n        }\r\n        var listen = this.removeListen_(pathString, queryId);\r\n        if (listen && listen.onComplete)\r\n            listen.onComplete('permission_denied');\r\n    };\r\n    /**\r\n     * @param {!string} pathString\r\n     * @param {!string} queryId\r\n     * @return {{queries:Array.<Query>, onComplete:function(string)}}\r\n     * @private\r\n     */\r\n    PersistentConnection.prototype.removeListen_ = function (pathString, queryId) {\r\n        var normalizedPathString = new Path(pathString).toString(); // normalize path.\r\n        var listen;\r\n        if (this.listens_[normalizedPathString] !== undefined) {\r\n            listen = this.listens_[normalizedPathString][queryId];\r\n            delete this.listens_[normalizedPathString][queryId];\r\n            if (getCount(this.listens_[normalizedPathString]) === 0) {\r\n                delete this.listens_[normalizedPathString];\r\n            }\r\n        }\r\n        else {\r\n            // all listens for this path has already been removed\r\n            listen = undefined;\r\n        }\r\n        return listen;\r\n    };\r\n    PersistentConnection.prototype.onAuthRevoked_ = function (statusCode, explanation) {\r\n        log('Auth token revoked: ' + statusCode + '/' + explanation);\r\n        this.authToken_ = null;\r\n        this.forceTokenRefresh_ = true;\r\n        this.realtime_.close();\r\n        if (statusCode === 'invalid_token' || statusCode === 'permission_denied') {\r\n            // We'll wait a couple times before logging the warning / increasing the\r\n            // retry period since oauth tokens will report as \"invalid\" if they're\r\n            // just expired. Plus there may be transient issues that resolve themselves.\r\n            this.invalidAuthTokenCount_++;\r\n            if (this.invalidAuthTokenCount_ >= INVALID_AUTH_TOKEN_THRESHOLD) {\r\n                // Set a long reconnect delay because recovery is unlikely\r\n                this.reconnectDelay_ = RECONNECT_MAX_DELAY_FOR_ADMINS;\r\n                // Notify the auth token provider that the token is invalid, which will log\r\n                // a warning\r\n                this.authTokenProvider_.notifyForInvalidToken();\r\n            }\r\n        }\r\n    };\r\n    PersistentConnection.prototype.onSecurityDebugPacket_ = function (body) {\r\n        if (this.securityDebugCallback_) {\r\n            this.securityDebugCallback_(body);\r\n        }\r\n        else {\r\n            if ('msg' in body) {\r\n                console.log('FIREBASE: ' + body['msg'].replace('\\n', '\\nFIREBASE: '));\r\n            }\r\n        }\r\n    };\r\n    PersistentConnection.prototype.restoreState_ = function () {\r\n        var _this = this;\r\n        //Re-authenticate ourselves if we have a credential stored.\r\n        this.tryAuth();\r\n        // Puts depend on having received the corresponding data update from the server before they complete, so we must\r\n        // make sure to send listens before puts.\r\n        forEach(this.listens_, function (pathString, queries) {\r\n            forEach(queries, function (key, listenSpec) {\r\n                _this.sendListen_(listenSpec);\r\n            });\r\n        });\r\n        for (var i = 0; i < this.outstandingPuts_.length; i++) {\r\n            if (this.outstandingPuts_[i])\r\n                this.sendPut_(i);\r\n        }\r\n        while (this.onDisconnectRequestQueue_.length) {\r\n            var request = this.onDisconnectRequestQueue_.shift();\r\n            this.sendOnDisconnect_(request.action, request.pathString, request.data, request.onComplete);\r\n        }\r\n    };\r\n    /**\r\n     * Sends client stats for first connection\r\n     * @private\r\n     */\r\n    PersistentConnection.prototype.sendConnectStats_ = function () {\r\n        var stats = {};\r\n        var clientName = 'js';\r\n        if (CONSTANTS.NODE_ADMIN) {\r\n            clientName = 'admin_node';\r\n        }\r\n        else if (CONSTANTS.NODE_CLIENT) {\r\n            clientName = 'node';\r\n        }\r\n        stats['sdk.' + clientName + '.' + firebase.SDK_VERSION.replace(/\\./g, '-')] = 1;\r\n        if (isMobileCordova()) {\r\n            stats['framework.cordova'] = 1;\r\n        }\r\n        else if (isReactNative()) {\r\n            stats['framework.reactnative'] = 1;\r\n        }\r\n        this.reportStats(stats);\r\n    };\r\n    /**\r\n     * @return {boolean}\r\n     * @private\r\n     */\r\n    PersistentConnection.prototype.shouldReconnect_ = function () {\r\n        var online = OnlineMonitor.getInstance().currentlyOnline();\r\n        return isEmpty(this.interruptReasons_) && online;\r\n    };\r\n    /**\r\n     * @private\r\n     */\r\n    PersistentConnection.nextPersistentConnectionId_ = 0;\r\n    /**\r\n     * Counter for number of connections created. Mainly used for tagging in the logs\r\n     * @type {number}\r\n     * @private\r\n     */\r\n    PersistentConnection.nextConnectionId_ = 0;\r\n    return PersistentConnection;\r\n}(ServerActions));\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * An implementation of ServerActions that communicates with the server via REST requests.\r\n * This is mostly useful for compatibility with crawlers, where we don't want to spin up a full\r\n * persistent connection (using WebSockets or long-polling)\r\n */\r\nvar ReadonlyRestClient = /** @class */ (function (_super) {\r\n    __extends(ReadonlyRestClient, _super);\r\n    /**\r\n     * @param {!RepoInfo} repoInfo_ Data about the namespace we are connecting to\r\n     * @param {function(string, *, boolean, ?number)} onDataUpdate_ A callback for new data from the server\r\n     * @param {AuthTokenProvider} authTokenProvider_\r\n     * @implements {ServerActions}\r\n     */\r\n    function ReadonlyRestClient(repoInfo_, onDataUpdate_, authTokenProvider_) {\r\n        var _this = _super.call(this) || this;\r\n        _this.repoInfo_ = repoInfo_;\r\n        _this.onDataUpdate_ = onDataUpdate_;\r\n        _this.authTokenProvider_ = authTokenProvider_;\r\n        /** @private {function(...[*])} */\r\n        _this.log_ = logWrapper('p:rest:');\r\n        /**\r\n         * We don't actually need to track listens, except to prevent us calling an onComplete for a listen\r\n         * that's been removed. :-/\r\n         *\r\n         * @private {!Object.<string, !Object>}\r\n         */\r\n        _this.listens_ = {};\r\n        return _this;\r\n    }\r\n    ReadonlyRestClient.prototype.reportStats = function (stats) {\r\n        throw new Error('Method not implemented.');\r\n    };\r\n    /**\r\n     * @param {!Query} query\r\n     * @param {?number=} tag\r\n     * @return {string}\r\n     * @private\r\n     */\r\n    ReadonlyRestClient.getListenId_ = function (query, tag) {\r\n        if (tag !== undefined) {\r\n            return 'tag$' + tag;\r\n        }\r\n        else {\r\n            assert(query.getQueryParams().isDefault(), \"should have a tag if it's not a default query.\");\r\n            return query.path.toString();\r\n        }\r\n    };\r\n    /** @inheritDoc */\r\n    ReadonlyRestClient.prototype.listen = function (query, currentHashFn, tag, onComplete) {\r\n        var _this = this;\r\n        var pathString = query.path.toString();\r\n        this.log_('Listen called for ' + pathString + ' ' + query.queryIdentifier());\r\n        // Mark this listener so we can tell if it's removed.\r\n        var listenId = ReadonlyRestClient.getListenId_(query, tag);\r\n        var thisListen = {};\r\n        this.listens_[listenId] = thisListen;\r\n        var queryStringParameters = query\r\n            .getQueryParams()\r\n            .toRestQueryStringParameters();\r\n        this.restRequest_(pathString + '.json', queryStringParameters, function (error$$1, result) {\r\n            var data = result;\r\n            if (error$$1 === 404) {\r\n                data = null;\r\n                error$$1 = null;\r\n            }\r\n            if (error$$1 === null) {\r\n                _this.onDataUpdate_(pathString, data, /*isMerge=*/ false, tag);\r\n            }\r\n            if (safeGet(_this.listens_, listenId) === thisListen) {\r\n                var status_1;\r\n                if (!error$$1) {\r\n                    status_1 = 'ok';\r\n                }\r\n                else if (error$$1 == 401) {\r\n                    status_1 = 'permission_denied';\r\n                }\r\n                else {\r\n                    status_1 = 'rest_error:' + error$$1;\r\n                }\r\n                onComplete(status_1, null);\r\n            }\r\n        });\r\n    };\r\n    /** @inheritDoc */\r\n    ReadonlyRestClient.prototype.unlisten = function (query, tag) {\r\n        var listenId = ReadonlyRestClient.getListenId_(query, tag);\r\n        delete this.listens_[listenId];\r\n    };\r\n    /** @inheritDoc */\r\n    ReadonlyRestClient.prototype.refreshAuthToken = function (token) {\r\n        // no-op since we just always call getToken.\r\n    };\r\n    /**\r\n     * Performs a REST request to the given path, with the provided query string parameters,\r\n     * and any auth credentials we have.\r\n     *\r\n     * @param {!string} pathString\r\n     * @param {!Object.<string, *>} queryStringParameters\r\n     * @param {?function(?number, *=)} callback\r\n     * @private\r\n     */\r\n    ReadonlyRestClient.prototype.restRequest_ = function (pathString, queryStringParameters, callback) {\r\n        var _this = this;\r\n        if (queryStringParameters === void 0) { queryStringParameters = {}; }\r\n        queryStringParameters['format'] = 'export';\r\n        this.authTokenProvider_\r\n            .getToken(/*forceRefresh=*/ false)\r\n            .then(function (authTokenData) {\r\n            var authToken = authTokenData && authTokenData.accessToken;\r\n            if (authToken) {\r\n                queryStringParameters['auth'] = authToken;\r\n            }\r\n            var url = (_this.repoInfo_.secure ? 'https://' : 'http://') +\r\n                _this.repoInfo_.host +\r\n                pathString +\r\n                '?' +\r\n                'ns=' +\r\n                _this.repoInfo_.namespace +\r\n                querystring(queryStringParameters);\r\n            _this.log_('Sending REST request for ' + url);\r\n            var xhr = new XMLHttpRequest();\r\n            xhr.onreadystatechange = function () {\r\n                if (callback && xhr.readyState === 4) {\r\n                    _this.log_('REST Response for ' + url + ' received. status:', xhr.status, 'response:', xhr.responseText);\r\n                    var res = null;\r\n                    if (xhr.status >= 200 && xhr.status < 300) {\r\n                        try {\r\n                            res = jsonEval(xhr.responseText);\r\n                        }\r\n                        catch (e) {\r\n                            warn('Failed to parse JSON response for ' +\r\n                                url +\r\n                                ': ' +\r\n                                xhr.responseText);\r\n                        }\r\n                        callback(null, res);\r\n                    }\r\n                    else {\r\n                        // 401 and 404 are expected.\r\n                        if (xhr.status !== 401 && xhr.status !== 404) {\r\n                            warn('Got unsuccessful REST response for ' +\r\n                                url +\r\n                                ' Status: ' +\r\n                                xhr.status);\r\n                        }\r\n                        callback(xhr.status);\r\n                    }\r\n                    callback = null;\r\n                }\r\n            };\r\n            xhr.open('GET', url, /*asynchronous=*/ true);\r\n            xhr.send();\r\n        });\r\n    };\r\n    return ReadonlyRestClient;\r\n}(ServerActions));\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar INTERRUPT_REASON = 'repo_interrupt';\r\n/**\r\n * A connection to a single data repository.\r\n */\r\nvar Repo = /** @class */ (function () {\r\n    /**\r\n     * @param {!RepoInfo} repoInfo_\r\n     * @param {boolean} forceRestClient\r\n     * @param {!FirebaseApp} app\r\n     */\r\n    function Repo(repoInfo_, forceRestClient, app) {\r\n        var _this = this;\r\n        this.repoInfo_ = repoInfo_;\r\n        this.app = app;\r\n        this.dataUpdateCount = 0;\r\n        this.statsListener_ = null;\r\n        this.eventQueue_ = new EventQueue();\r\n        this.nextWriteId_ = 1;\r\n        this.interceptServerDataCallback_ = null;\r\n        // A list of data pieces and paths to be set when this client disconnects.\r\n        this.onDisconnect_ = new SparseSnapshotTree();\r\n        /**\r\n         * TODO: This should be @private but it's used by test_access.js and internal.js\r\n         * @type {?PersistentConnection}\r\n         */\r\n        this.persistentConnection_ = null;\r\n        /** @type {!AuthTokenProvider} */\r\n        var authTokenProvider = new AuthTokenProvider(app);\r\n        this.stats_ = StatsManager.getCollection(repoInfo_);\r\n        if (forceRestClient || beingCrawled()) {\r\n            this.server_ = new ReadonlyRestClient(this.repoInfo_, this.onDataUpdate_.bind(this), authTokenProvider);\r\n            // Minor hack: Fire onConnect immediately, since there's no actual connection.\r\n            setTimeout(this.onConnectStatus_.bind(this, true), 0);\r\n        }\r\n        else {\r\n            var authOverride = app.options['databaseAuthVariableOverride'];\r\n            // Validate authOverride\r\n            if (typeof authOverride !== 'undefined' && authOverride !== null) {\r\n                if (typeof authOverride !== 'object') {\r\n                    throw new Error('Only objects are supported for option databaseAuthVariableOverride');\r\n                }\r\n                try {\r\n                    stringify(authOverride);\r\n                }\r\n                catch (e) {\r\n                    throw new Error('Invalid authOverride provided: ' + e);\r\n                }\r\n            }\r\n            this.persistentConnection_ = new PersistentConnection(this.repoInfo_, this.onDataUpdate_.bind(this), this.onConnectStatus_.bind(this), this.onServerInfoUpdate_.bind(this), authTokenProvider, authOverride);\r\n            this.server_ = this.persistentConnection_;\r\n        }\r\n        authTokenProvider.addTokenChangeListener(function (token) {\r\n            _this.server_.refreshAuthToken(token);\r\n        });\r\n        // In the case of multiple Repos for the same repoInfo (i.e. there are multiple Firebase.Contexts being used),\r\n        // we only want to create one StatsReporter.  As such, we'll report stats over the first Repo created.\r\n        this.statsReporter_ = StatsManager.getOrCreateReporter(repoInfo_, function () { return new StatsReporter(_this.stats_, _this.server_); });\r\n        this.transactions_init_();\r\n        // Used for .info.\r\n        this.infoData_ = new SnapshotHolder();\r\n        this.infoSyncTree_ = new SyncTree({\r\n            startListening: function (query, tag, currentHashFn, onComplete) {\r\n                var infoEvents = [];\r\n                var node = _this.infoData_.getNode(query.path);\r\n                // This is possibly a hack, but we have different semantics for .info endpoints. We don't raise null events\r\n                // on initial data...\r\n                if (!node.isEmpty()) {\r\n                    infoEvents = _this.infoSyncTree_.applyServerOverwrite(query.path, node);\r\n                    setTimeout(function () {\r\n                        onComplete('ok');\r\n                    }, 0);\r\n                }\r\n                return infoEvents;\r\n            },\r\n            stopListening: function () { }\r\n        });\r\n        this.updateInfo_('connected', false);\r\n        this.serverSyncTree_ = new SyncTree({\r\n            startListening: function (query, tag, currentHashFn, onComplete) {\r\n                _this.server_.listen(query, currentHashFn, tag, function (status, data) {\r\n                    var events = onComplete(status, data);\r\n                    _this.eventQueue_.raiseEventsForChangedPath(query.path, events);\r\n                });\r\n                // No synchronous events for network-backed sync trees\r\n                return [];\r\n            },\r\n            stopListening: function (query, tag) {\r\n                _this.server_.unlisten(query, tag);\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * @return {string}  The URL corresponding to the root of this Firebase.\r\n     */\r\n    Repo.prototype.toString = function () {\r\n        return ((this.repoInfo_.secure ? 'https://' : 'http://') + this.repoInfo_.host);\r\n    };\r\n    /**\r\n     * @return {!string} The namespace represented by the repo.\r\n     */\r\n    Repo.prototype.name = function () {\r\n        return this.repoInfo_.namespace;\r\n    };\r\n    /**\r\n     * @return {!number} The time in milliseconds, taking the server offset into account if we have one.\r\n     */\r\n    Repo.prototype.serverTime = function () {\r\n        var offsetNode = this.infoData_.getNode(new Path('.info/serverTimeOffset'));\r\n        var offset = offsetNode.val() || 0;\r\n        return new Date().getTime() + offset;\r\n    };\r\n    /**\r\n     * Generate ServerValues using some variables from the repo object.\r\n     * @return {!Object}\r\n     */\r\n    Repo.prototype.generateServerValues = function () {\r\n        return generateWithValues({\r\n            timestamp: this.serverTime()\r\n        });\r\n    };\r\n    /**\r\n     * Called by realtime when we get new messages from the server.\r\n     *\r\n     * @private\r\n     * @param {string} pathString\r\n     * @param {*} data\r\n     * @param {boolean} isMerge\r\n     * @param {?number} tag\r\n     */\r\n    Repo.prototype.onDataUpdate_ = function (pathString, data, isMerge, tag) {\r\n        // For testing.\r\n        this.dataUpdateCount++;\r\n        var path = new Path(pathString);\r\n        data = this.interceptServerDataCallback_\r\n            ? this.interceptServerDataCallback_(pathString, data)\r\n            : data;\r\n        var events = [];\r\n        if (tag) {\r\n            if (isMerge) {\r\n                var taggedChildren = map(data, function (raw) {\r\n                    return nodeFromJSON$1(raw);\r\n                });\r\n                events = this.serverSyncTree_.applyTaggedQueryMerge(path, taggedChildren, tag);\r\n            }\r\n            else {\r\n                var taggedSnap = nodeFromJSON$1(data);\r\n                events = this.serverSyncTree_.applyTaggedQueryOverwrite(path, taggedSnap, tag);\r\n            }\r\n        }\r\n        else if (isMerge) {\r\n            var changedChildren = map(data, function (raw) {\r\n                return nodeFromJSON$1(raw);\r\n            });\r\n            events = this.serverSyncTree_.applyServerMerge(path, changedChildren);\r\n        }\r\n        else {\r\n            var snap = nodeFromJSON$1(data);\r\n            events = this.serverSyncTree_.applyServerOverwrite(path, snap);\r\n        }\r\n        var affectedPath = path;\r\n        if (events.length > 0) {\r\n            // Since we have a listener outstanding for each transaction, receiving any events\r\n            // is a proxy for some change having occurred.\r\n            affectedPath = this.rerunTransactions_(path);\r\n        }\r\n        this.eventQueue_.raiseEventsForChangedPath(affectedPath, events);\r\n    };\r\n    /**\r\n     * TODO: This should be @private but it's used by test_access.js and internal.js\r\n     * @param {?function(!string, *):*} callback\r\n     * @private\r\n     */\r\n    Repo.prototype.interceptServerData_ = function (callback) {\r\n        this.interceptServerDataCallback_ = callback;\r\n    };\r\n    /**\r\n     * @param {!boolean} connectStatus\r\n     * @private\r\n     */\r\n    Repo.prototype.onConnectStatus_ = function (connectStatus) {\r\n        this.updateInfo_('connected', connectStatus);\r\n        if (connectStatus === false) {\r\n            this.runOnDisconnectEvents_();\r\n        }\r\n    };\r\n    /**\r\n     * @param {!Object} updates\r\n     * @private\r\n     */\r\n    Repo.prototype.onServerInfoUpdate_ = function (updates) {\r\n        var _this = this;\r\n        each(updates, function (value, key) {\r\n            _this.updateInfo_(key, value);\r\n        });\r\n    };\r\n    /**\r\n     *\r\n     * @param {!string} pathString\r\n     * @param {*} value\r\n     * @private\r\n     */\r\n    Repo.prototype.updateInfo_ = function (pathString, value) {\r\n        var path = new Path('/.info/' + pathString);\r\n        var newNode = nodeFromJSON$1(value);\r\n        this.infoData_.updateSnapshot(path, newNode);\r\n        var events = this.infoSyncTree_.applyServerOverwrite(path, newNode);\r\n        this.eventQueue_.raiseEventsForChangedPath(path, events);\r\n    };\r\n    /**\r\n     * @return {!number}\r\n     * @private\r\n     */\r\n    Repo.prototype.getNextWriteId_ = function () {\r\n        return this.nextWriteId_++;\r\n    };\r\n    /**\r\n     * @param {!Path} path\r\n     * @param {*} newVal\r\n     * @param {number|string|null} newPriority\r\n     * @param {?function(?Error, *=)} onComplete\r\n     */\r\n    Repo.prototype.setWithPriority = function (path, newVal, newPriority, onComplete) {\r\n        var _this = this;\r\n        this.log_('set', {\r\n            path: path.toString(),\r\n            value: newVal,\r\n            priority: newPriority\r\n        });\r\n        // TODO: Optimize this behavior to either (a) store flag to skip resolving where possible and / or\r\n        // (b) store unresolved paths on JSON parse\r\n        var serverValues = this.generateServerValues();\r\n        var newNodeUnresolved = nodeFromJSON$1(newVal, newPriority);\r\n        var newNode = resolveDeferredValueSnapshot(newNodeUnresolved, serverValues);\r\n        var writeId = this.getNextWriteId_();\r\n        var events = this.serverSyncTree_.applyUserOverwrite(path, newNode, writeId, true);\r\n        this.eventQueue_.queueEvents(events);\r\n        this.server_.put(path.toString(), newNodeUnresolved.val(/*export=*/ true), function (status, errorReason) {\r\n            var success = status === 'ok';\r\n            if (!success) {\r\n                warn('set at ' + path + ' failed: ' + status);\r\n            }\r\n            var clearEvents = _this.serverSyncTree_.ackUserWrite(writeId, !success);\r\n            _this.eventQueue_.raiseEventsForChangedPath(path, clearEvents);\r\n            _this.callOnCompleteCallback(onComplete, status, errorReason);\r\n        });\r\n        var affectedPath = this.abortTransactions_(path);\r\n        this.rerunTransactions_(affectedPath);\r\n        // We queued the events above, so just flush the queue here\r\n        this.eventQueue_.raiseEventsForChangedPath(affectedPath, []);\r\n    };\r\n    /**\r\n     * @param {!Path} path\r\n     * @param {!Object} childrenToMerge\r\n     * @param {?function(?Error, *=)} onComplete\r\n     */\r\n    Repo.prototype.update = function (path, childrenToMerge, onComplete) {\r\n        var _this = this;\r\n        this.log_('update', { path: path.toString(), value: childrenToMerge });\r\n        // Start with our existing data and merge each child into it.\r\n        var empty = true;\r\n        var serverValues = this.generateServerValues();\r\n        var changedChildren = {};\r\n        forEach(childrenToMerge, function (changedKey, changedValue) {\r\n            empty = false;\r\n            var newNodeUnresolved = nodeFromJSON$1(changedValue);\r\n            changedChildren[changedKey] = resolveDeferredValueSnapshot(newNodeUnresolved, serverValues);\r\n        });\r\n        if (!empty) {\r\n            var writeId_1 = this.getNextWriteId_();\r\n            var events = this.serverSyncTree_.applyUserMerge(path, changedChildren, writeId_1);\r\n            this.eventQueue_.queueEvents(events);\r\n            this.server_.merge(path.toString(), childrenToMerge, function (status, errorReason) {\r\n                var success = status === 'ok';\r\n                if (!success) {\r\n                    warn('update at ' + path + ' failed: ' + status);\r\n                }\r\n                var clearEvents = _this.serverSyncTree_.ackUserWrite(writeId_1, !success);\r\n                var affectedPath = clearEvents.length > 0 ? _this.rerunTransactions_(path) : path;\r\n                _this.eventQueue_.raiseEventsForChangedPath(affectedPath, clearEvents);\r\n                _this.callOnCompleteCallback(onComplete, status, errorReason);\r\n            });\r\n            forEach(childrenToMerge, function (changedPath) {\r\n                var affectedPath = _this.abortTransactions_(path.child(changedPath));\r\n                _this.rerunTransactions_(affectedPath);\r\n            });\r\n            // We queued the events above, so just flush the queue here\r\n            this.eventQueue_.raiseEventsForChangedPath(path, []);\r\n        }\r\n        else {\r\n            log(\"update() called with empty data.  Don't do anything.\");\r\n            this.callOnCompleteCallback(onComplete, 'ok');\r\n        }\r\n    };\r\n    /**\r\n     * Applies all of the changes stored up in the onDisconnect_ tree.\r\n     * @private\r\n     */\r\n    Repo.prototype.runOnDisconnectEvents_ = function () {\r\n        var _this = this;\r\n        this.log_('onDisconnectEvents');\r\n        var serverValues = this.generateServerValues();\r\n        var resolvedOnDisconnectTree = resolveDeferredValueTree(this.onDisconnect_, serverValues);\r\n        var events = [];\r\n        resolvedOnDisconnectTree.forEachTree(Path.Empty, function (path, snap) {\r\n            events = events.concat(_this.serverSyncTree_.applyServerOverwrite(path, snap));\r\n            var affectedPath = _this.abortTransactions_(path);\r\n            _this.rerunTransactions_(affectedPath);\r\n        });\r\n        this.onDisconnect_ = new SparseSnapshotTree();\r\n        this.eventQueue_.raiseEventsForChangedPath(Path.Empty, events);\r\n    };\r\n    /**\r\n     * @param {!Path} path\r\n     * @param {?function(?Error, *=)} onComplete\r\n     */\r\n    Repo.prototype.onDisconnectCancel = function (path, onComplete) {\r\n        var _this = this;\r\n        this.server_.onDisconnectCancel(path.toString(), function (status, errorReason) {\r\n            if (status === 'ok') {\r\n                _this.onDisconnect_.forget(path);\r\n            }\r\n            _this.callOnCompleteCallback(onComplete, status, errorReason);\r\n        });\r\n    };\r\n    /**\r\n     * @param {!Path} path\r\n     * @param {*} value\r\n     * @param {?function(?Error, *=)} onComplete\r\n     */\r\n    Repo.prototype.onDisconnectSet = function (path, value, onComplete) {\r\n        var _this = this;\r\n        var newNode = nodeFromJSON$1(value);\r\n        this.server_.onDisconnectPut(path.toString(), newNode.val(/*export=*/ true), function (status, errorReason) {\r\n            if (status === 'ok') {\r\n                _this.onDisconnect_.remember(path, newNode);\r\n            }\r\n            _this.callOnCompleteCallback(onComplete, status, errorReason);\r\n        });\r\n    };\r\n    /**\r\n     * @param {!Path} path\r\n     * @param {*} value\r\n     * @param {*} priority\r\n     * @param {?function(?Error, *=)} onComplete\r\n     */\r\n    Repo.prototype.onDisconnectSetWithPriority = function (path, value, priority, onComplete) {\r\n        var _this = this;\r\n        var newNode = nodeFromJSON$1(value, priority);\r\n        this.server_.onDisconnectPut(path.toString(), newNode.val(/*export=*/ true), function (status, errorReason) {\r\n            if (status === 'ok') {\r\n                _this.onDisconnect_.remember(path, newNode);\r\n            }\r\n            _this.callOnCompleteCallback(onComplete, status, errorReason);\r\n        });\r\n    };\r\n    /**\r\n     * @param {!Path} path\r\n     * @param {*} childrenToMerge\r\n     * @param {?function(?Error, *=)} onComplete\r\n     */\r\n    Repo.prototype.onDisconnectUpdate = function (path, childrenToMerge, onComplete) {\r\n        var _this = this;\r\n        if (isEmpty(childrenToMerge)) {\r\n            log(\"onDisconnect().update() called with empty data.  Don't do anything.\");\r\n            this.callOnCompleteCallback(onComplete, 'ok');\r\n            return;\r\n        }\r\n        this.server_.onDisconnectMerge(path.toString(), childrenToMerge, function (status, errorReason) {\r\n            if (status === 'ok') {\r\n                forEach(childrenToMerge, function (childName, childNode) {\r\n                    var newChildNode = nodeFromJSON$1(childNode);\r\n                    _this.onDisconnect_.remember(path.child(childName), newChildNode);\r\n                });\r\n            }\r\n            _this.callOnCompleteCallback(onComplete, status, errorReason);\r\n        });\r\n    };\r\n    /**\r\n     * @param {!Query} query\r\n     * @param {!EventRegistration} eventRegistration\r\n     */\r\n    Repo.prototype.addEventCallbackForQuery = function (query, eventRegistration) {\r\n        var events;\r\n        if (query.path.getFront() === '.info') {\r\n            events = this.infoSyncTree_.addEventRegistration(query, eventRegistration);\r\n        }\r\n        else {\r\n            events = this.serverSyncTree_.addEventRegistration(query, eventRegistration);\r\n        }\r\n        this.eventQueue_.raiseEventsAtPath(query.path, events);\r\n    };\r\n    /**\r\n     * @param {!Query} query\r\n     * @param {?EventRegistration} eventRegistration\r\n     */\r\n    Repo.prototype.removeEventCallbackForQuery = function (query, eventRegistration) {\r\n        // These are guaranteed not to raise events, since we're not passing in a cancelError. However, we can future-proof\r\n        // a little bit by handling the return values anyways.\r\n        var events;\r\n        if (query.path.getFront() === '.info') {\r\n            events = this.infoSyncTree_.removeEventRegistration(query, eventRegistration);\r\n        }\r\n        else {\r\n            events = this.serverSyncTree_.removeEventRegistration(query, eventRegistration);\r\n        }\r\n        this.eventQueue_.raiseEventsAtPath(query.path, events);\r\n    };\r\n    Repo.prototype.interrupt = function () {\r\n        if (this.persistentConnection_) {\r\n            this.persistentConnection_.interrupt(INTERRUPT_REASON);\r\n        }\r\n    };\r\n    Repo.prototype.resume = function () {\r\n        if (this.persistentConnection_) {\r\n            this.persistentConnection_.resume(INTERRUPT_REASON);\r\n        }\r\n    };\r\n    Repo.prototype.stats = function (showDelta) {\r\n        if (showDelta === void 0) { showDelta = false; }\r\n        if (typeof console === 'undefined')\r\n            return;\r\n        var stats;\r\n        if (showDelta) {\r\n            if (!this.statsListener_)\r\n                this.statsListener_ = new StatsListener(this.stats_);\r\n            stats = this.statsListener_.get();\r\n        }\r\n        else {\r\n            stats = this.stats_.get();\r\n        }\r\n        var longestName = Object.keys(stats).reduce(function (previousValue, currentValue) {\r\n            return Math.max(currentValue.length, previousValue);\r\n        }, 0);\r\n        forEach(stats, function (stat, value) {\r\n            // pad stat names to be the same length (plus 2 extra spaces).\r\n            for (var i = stat.length; i < longestName + 2; i++)\r\n                stat += ' ';\r\n            console.log(stat + value);\r\n        });\r\n    };\r\n    Repo.prototype.statsIncrementCounter = function (metric) {\r\n        this.stats_.incrementCounter(metric);\r\n        this.statsReporter_.includeStat(metric);\r\n    };\r\n    /**\r\n     * @param {...*} var_args\r\n     * @private\r\n     */\r\n    Repo.prototype.log_ = function () {\r\n        var var_args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            var_args[_i] = arguments[_i];\r\n        }\r\n        var prefix = '';\r\n        if (this.persistentConnection_) {\r\n            prefix = this.persistentConnection_.id + ':';\r\n        }\r\n        log.apply(void 0, [prefix].concat(var_args));\r\n    };\r\n    /**\r\n     * @param {?function(?Error, *=)} callback\r\n     * @param {!string} status\r\n     * @param {?string=} errorReason\r\n     */\r\n    Repo.prototype.callOnCompleteCallback = function (callback, status, errorReason) {\r\n        if (callback) {\r\n            exceptionGuard(function () {\r\n                if (status == 'ok') {\r\n                    callback(null);\r\n                }\r\n                else {\r\n                    var code = (status || 'error').toUpperCase();\r\n                    var message = code;\r\n                    if (errorReason)\r\n                        message += ': ' + errorReason;\r\n                    var error$$1 = new Error(message);\r\n                    error$$1.code = code;\r\n                    callback(error$$1);\r\n                }\r\n            });\r\n        }\r\n    };\r\n    Object.defineProperty(Repo.prototype, \"database\", {\r\n        get: function () {\r\n            return this.__database || (this.__database = new Database(this));\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return Repo;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Filters nodes by range and uses an IndexFilter to track any changes after filtering the node\r\n *\r\n * @constructor\r\n * @implements {NodeFilter}\r\n */\r\nvar RangedFilter = /** @class */ (function () {\r\n    /**\r\n     * @param {!QueryParams} params\r\n     */\r\n    function RangedFilter(params) {\r\n        this.indexedFilter_ = new IndexedFilter(params.getIndex());\r\n        this.index_ = params.getIndex();\r\n        this.startPost_ = RangedFilter.getStartPost_(params);\r\n        this.endPost_ = RangedFilter.getEndPost_(params);\r\n    }\r\n    /**\r\n     * @return {!NamedNode}\r\n     */\r\n    RangedFilter.prototype.getStartPost = function () {\r\n        return this.startPost_;\r\n    };\r\n    /**\r\n     * @return {!NamedNode}\r\n     */\r\n    RangedFilter.prototype.getEndPost = function () {\r\n        return this.endPost_;\r\n    };\r\n    /**\r\n     * @param {!NamedNode} node\r\n     * @return {boolean}\r\n     */\r\n    RangedFilter.prototype.matches = function (node) {\r\n        return (this.index_.compare(this.getStartPost(), node) <= 0 &&\r\n            this.index_.compare(node, this.getEndPost()) <= 0);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    RangedFilter.prototype.updateChild = function (snap, key, newChild, affectedPath, source, optChangeAccumulator) {\r\n        if (!this.matches(new NamedNode(key, newChild))) {\r\n            newChild = ChildrenNode.EMPTY_NODE;\r\n        }\r\n        return this.indexedFilter_.updateChild(snap, key, newChild, affectedPath, source, optChangeAccumulator);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    RangedFilter.prototype.updateFullNode = function (oldSnap, newSnap, optChangeAccumulator) {\r\n        if (newSnap.isLeafNode()) {\r\n            // Make sure we have a children node with the correct index, not a leaf node;\r\n            newSnap = ChildrenNode.EMPTY_NODE;\r\n        }\r\n        var filtered = newSnap.withIndex(this.index_);\r\n        // Don't support priorities on queries\r\n        filtered = filtered.updatePriority(ChildrenNode.EMPTY_NODE);\r\n        var self = this;\r\n        newSnap.forEachChild(PRIORITY_INDEX, function (key, childNode) {\r\n            if (!self.matches(new NamedNode(key, childNode))) {\r\n                filtered = filtered.updateImmediateChild(key, ChildrenNode.EMPTY_NODE);\r\n            }\r\n        });\r\n        return this.indexedFilter_.updateFullNode(oldSnap, filtered, optChangeAccumulator);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    RangedFilter.prototype.updatePriority = function (oldSnap, newPriority) {\r\n        // Don't support priorities on queries\r\n        return oldSnap;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    RangedFilter.prototype.filtersNodes = function () {\r\n        return true;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    RangedFilter.prototype.getIndexedFilter = function () {\r\n        return this.indexedFilter_;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    RangedFilter.prototype.getIndex = function () {\r\n        return this.index_;\r\n    };\r\n    /**\r\n     * @param {!QueryParams} params\r\n     * @return {!NamedNode}\r\n     * @private\r\n     */\r\n    RangedFilter.getStartPost_ = function (params) {\r\n        if (params.hasStart()) {\r\n            var startName = params.getIndexStartName();\r\n            return params.getIndex().makePost(params.getIndexStartValue(), startName);\r\n        }\r\n        else {\r\n            return params.getIndex().minPost();\r\n        }\r\n    };\r\n    /**\r\n     * @param {!QueryParams} params\r\n     * @return {!NamedNode}\r\n     * @private\r\n     */\r\n    RangedFilter.getEndPost_ = function (params) {\r\n        if (params.hasEnd()) {\r\n            var endName = params.getIndexEndName();\r\n            return params.getIndex().makePost(params.getIndexEndValue(), endName);\r\n        }\r\n        else {\r\n            return params.getIndex().maxPost();\r\n        }\r\n    };\r\n    return RangedFilter;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Applies a limit and a range to a node and uses RangedFilter to do the heavy lifting where possible\r\n *\r\n * @constructor\r\n * @implements {NodeFilter}\r\n */\r\nvar LimitedFilter = /** @class */ (function () {\r\n    /**\r\n     * @param {!QueryParams} params\r\n     */\r\n    function LimitedFilter(params) {\r\n        this.rangedFilter_ = new RangedFilter(params);\r\n        this.index_ = params.getIndex();\r\n        this.limit_ = params.getLimit();\r\n        this.reverse_ = !params.isViewFromLeft();\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LimitedFilter.prototype.updateChild = function (snap, key, newChild, affectedPath, source, optChangeAccumulator) {\r\n        if (!this.rangedFilter_.matches(new NamedNode(key, newChild))) {\r\n            newChild = ChildrenNode.EMPTY_NODE;\r\n        }\r\n        if (snap.getImmediateChild(key).equals(newChild)) {\r\n            // No change\r\n            return snap;\r\n        }\r\n        else if (snap.numChildren() < this.limit_) {\r\n            return this.rangedFilter_\r\n                .getIndexedFilter()\r\n                .updateChild(snap, key, newChild, affectedPath, source, optChangeAccumulator);\r\n        }\r\n        else {\r\n            return this.fullLimitUpdateChild_(snap, key, newChild, source, optChangeAccumulator);\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LimitedFilter.prototype.updateFullNode = function (oldSnap, newSnap, optChangeAccumulator) {\r\n        var filtered;\r\n        if (newSnap.isLeafNode() || newSnap.isEmpty()) {\r\n            // Make sure we have a children node with the correct index, not a leaf node;\r\n            filtered = ChildrenNode.EMPTY_NODE.withIndex(this.index_);\r\n        }\r\n        else {\r\n            if (this.limit_ * 2 < newSnap.numChildren() &&\r\n                newSnap.isIndexed(this.index_)) {\r\n                // Easier to build up a snapshot, since what we're given has more than twice the elements we want\r\n                filtered = ChildrenNode.EMPTY_NODE.withIndex(this.index_);\r\n                // anchor to the startPost, endPost, or last element as appropriate\r\n                var iterator = void 0;\r\n                if (this.reverse_) {\r\n                    iterator = newSnap.getReverseIteratorFrom(this.rangedFilter_.getEndPost(), this.index_);\r\n                }\r\n                else {\r\n                    iterator = newSnap.getIteratorFrom(this.rangedFilter_.getStartPost(), this.index_);\r\n                }\r\n                var count = 0;\r\n                while (iterator.hasNext() && count < this.limit_) {\r\n                    var next = iterator.getNext();\r\n                    var inRange = void 0;\r\n                    if (this.reverse_) {\r\n                        inRange =\r\n                            this.index_.compare(this.rangedFilter_.getStartPost(), next) <= 0;\r\n                    }\r\n                    else {\r\n                        inRange =\r\n                            this.index_.compare(next, this.rangedFilter_.getEndPost()) <= 0;\r\n                    }\r\n                    if (inRange) {\r\n                        filtered = filtered.updateImmediateChild(next.name, next.node);\r\n                        count++;\r\n                    }\r\n                    else {\r\n                        // if we have reached the end post, we cannot keep adding elemments\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                // The snap contains less than twice the limit. Faster to delete from the snap than build up a new one\r\n                filtered = newSnap.withIndex(this.index_);\r\n                // Don't support priorities on queries\r\n                filtered = filtered.updatePriority(ChildrenNode.EMPTY_NODE);\r\n                var startPost = void 0;\r\n                var endPost = void 0;\r\n                var cmp = void 0;\r\n                var iterator = void 0;\r\n                if (this.reverse_) {\r\n                    iterator = filtered.getReverseIterator(this.index_);\r\n                    startPost = this.rangedFilter_.getEndPost();\r\n                    endPost = this.rangedFilter_.getStartPost();\r\n                    var indexCompare_1 = this.index_.getCompare();\r\n                    cmp = function (a, b) { return indexCompare_1(b, a); };\r\n                }\r\n                else {\r\n                    iterator = filtered.getIterator(this.index_);\r\n                    startPost = this.rangedFilter_.getStartPost();\r\n                    endPost = this.rangedFilter_.getEndPost();\r\n                    cmp = this.index_.getCompare();\r\n                }\r\n                var count = 0;\r\n                var foundStartPost = false;\r\n                while (iterator.hasNext()) {\r\n                    var next = iterator.getNext();\r\n                    if (!foundStartPost && cmp(startPost, next) <= 0) {\r\n                        // start adding\r\n                        foundStartPost = true;\r\n                    }\r\n                    var inRange = foundStartPost && count < this.limit_ && cmp(next, endPost) <= 0;\r\n                    if (inRange) {\r\n                        count++;\r\n                    }\r\n                    else {\r\n                        filtered = filtered.updateImmediateChild(next.name, ChildrenNode.EMPTY_NODE);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return this.rangedFilter_\r\n            .getIndexedFilter()\r\n            .updateFullNode(oldSnap, filtered, optChangeAccumulator);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LimitedFilter.prototype.updatePriority = function (oldSnap, newPriority) {\r\n        // Don't support priorities on queries\r\n        return oldSnap;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LimitedFilter.prototype.filtersNodes = function () {\r\n        return true;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LimitedFilter.prototype.getIndexedFilter = function () {\r\n        return this.rangedFilter_.getIndexedFilter();\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LimitedFilter.prototype.getIndex = function () {\r\n        return this.index_;\r\n    };\r\n    /**\r\n     * @param {!Node} snap\r\n     * @param {string} childKey\r\n     * @param {!Node} childSnap\r\n     * @param {!CompleteChildSource} source\r\n     * @param {?ChildChangeAccumulator} changeAccumulator\r\n     * @return {!Node}\r\n     * @private\r\n     */\r\n    LimitedFilter.prototype.fullLimitUpdateChild_ = function (snap, childKey, childSnap, source, changeAccumulator) {\r\n        // TODO: rename all cache stuff etc to general snap terminology\r\n        var cmp;\r\n        if (this.reverse_) {\r\n            var indexCmp_1 = this.index_.getCompare();\r\n            cmp = function (a, b) { return indexCmp_1(b, a); };\r\n        }\r\n        else {\r\n            cmp = this.index_.getCompare();\r\n        }\r\n        var oldEventCache = snap;\r\n        assert(oldEventCache.numChildren() == this.limit_, '');\r\n        var newChildNamedNode = new NamedNode(childKey, childSnap);\r\n        var windowBoundary = this.reverse_\r\n            ? oldEventCache.getFirstChild(this.index_)\r\n            : oldEventCache.getLastChild(this.index_);\r\n        var inRange = this.rangedFilter_.matches(newChildNamedNode);\r\n        if (oldEventCache.hasChild(childKey)) {\r\n            var oldChildSnap = oldEventCache.getImmediateChild(childKey);\r\n            var nextChild = source.getChildAfterChild(this.index_, windowBoundary, this.reverse_);\r\n            while (nextChild != null &&\r\n                (nextChild.name == childKey || oldEventCache.hasChild(nextChild.name))) {\r\n                // There is a weird edge case where a node is updated as part of a merge in the write tree, but hasn't\r\n                // been applied to the limited filter yet. Ignore this next child which will be updated later in\r\n                // the limited filter...\r\n                nextChild = source.getChildAfterChild(this.index_, nextChild, this.reverse_);\r\n            }\r\n            var compareNext = nextChild == null ? 1 : cmp(nextChild, newChildNamedNode);\r\n            var remainsInWindow = inRange && !childSnap.isEmpty() && compareNext >= 0;\r\n            if (remainsInWindow) {\r\n                if (changeAccumulator != null) {\r\n                    changeAccumulator.trackChildChange(Change.childChangedChange(childKey, childSnap, oldChildSnap));\r\n                }\r\n                return oldEventCache.updateImmediateChild(childKey, childSnap);\r\n            }\r\n            else {\r\n                if (changeAccumulator != null) {\r\n                    changeAccumulator.trackChildChange(Change.childRemovedChange(childKey, oldChildSnap));\r\n                }\r\n                var newEventCache = oldEventCache.updateImmediateChild(childKey, ChildrenNode.EMPTY_NODE);\r\n                var nextChildInRange = nextChild != null && this.rangedFilter_.matches(nextChild);\r\n                if (nextChildInRange) {\r\n                    if (changeAccumulator != null) {\r\n                        changeAccumulator.trackChildChange(Change.childAddedChange(nextChild.name, nextChild.node));\r\n                    }\r\n                    return newEventCache.updateImmediateChild(nextChild.name, nextChild.node);\r\n                }\r\n                else {\r\n                    return newEventCache;\r\n                }\r\n            }\r\n        }\r\n        else if (childSnap.isEmpty()) {\r\n            // we're deleting a node, but it was not in the window, so ignore it\r\n            return snap;\r\n        }\r\n        else if (inRange) {\r\n            if (cmp(windowBoundary, newChildNamedNode) >= 0) {\r\n                if (changeAccumulator != null) {\r\n                    changeAccumulator.trackChildChange(Change.childRemovedChange(windowBoundary.name, windowBoundary.node));\r\n                    changeAccumulator.trackChildChange(Change.childAddedChange(childKey, childSnap));\r\n                }\r\n                return oldEventCache\r\n                    .updateImmediateChild(childKey, childSnap)\r\n                    .updateImmediateChild(windowBoundary.name, ChildrenNode.EMPTY_NODE);\r\n            }\r\n            else {\r\n                return snap;\r\n            }\r\n        }\r\n        else {\r\n            return snap;\r\n        }\r\n    };\r\n    return LimitedFilter;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * This class is an immutable-from-the-public-api struct containing a set of query parameters defining a\r\n * range to be returned for a particular location. It is assumed that validation of parameters is done at the\r\n * user-facing API level, so it is not done here.\r\n * @constructor\r\n */\r\nvar QueryParams = /** @class */ (function () {\r\n    function QueryParams() {\r\n        this.limitSet_ = false;\r\n        this.startSet_ = false;\r\n        this.startNameSet_ = false;\r\n        this.endSet_ = false;\r\n        this.endNameSet_ = false;\r\n        this.limit_ = 0;\r\n        this.viewFrom_ = '';\r\n        this.indexStartValue_ = null;\r\n        this.indexStartName_ = '';\r\n        this.indexEndValue_ = null;\r\n        this.indexEndName_ = '';\r\n        this.index_ = PRIORITY_INDEX;\r\n    }\r\n    /**\r\n     * @return {boolean}\r\n     */\r\n    QueryParams.prototype.hasStart = function () {\r\n        return this.startSet_;\r\n    };\r\n    /**\r\n     * @return {boolean} True if it would return from left.\r\n     */\r\n    QueryParams.prototype.isViewFromLeft = function () {\r\n        if (this.viewFrom_ === '') {\r\n            // limit(), rather than limitToFirst or limitToLast was called.\r\n            // This means that only one of startSet_ and endSet_ is true. Use them\r\n            // to calculate which side of the view to anchor to. If neither is set,\r\n            // anchor to the end.\r\n            return this.startSet_;\r\n        }\r\n        else {\r\n            return (this.viewFrom_ === QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT);\r\n        }\r\n    };\r\n    /**\r\n     * Only valid to call if hasStart() returns true\r\n     * @return {*}\r\n     */\r\n    QueryParams.prototype.getIndexStartValue = function () {\r\n        assert(this.startSet_, 'Only valid if start has been set');\r\n        return this.indexStartValue_;\r\n    };\r\n    /**\r\n     * Only valid to call if hasStart() returns true.\r\n     * Returns the starting key name for the range defined by these query parameters\r\n     * @return {!string}\r\n     */\r\n    QueryParams.prototype.getIndexStartName = function () {\r\n        assert(this.startSet_, 'Only valid if start has been set');\r\n        if (this.startNameSet_) {\r\n            return this.indexStartName_;\r\n        }\r\n        else {\r\n            return MIN_NAME;\r\n        }\r\n    };\r\n    /**\r\n     * @return {boolean}\r\n     */\r\n    QueryParams.prototype.hasEnd = function () {\r\n        return this.endSet_;\r\n    };\r\n    /**\r\n     * Only valid to call if hasEnd() returns true.\r\n     * @return {*}\r\n     */\r\n    QueryParams.prototype.getIndexEndValue = function () {\r\n        assert(this.endSet_, 'Only valid if end has been set');\r\n        return this.indexEndValue_;\r\n    };\r\n    /**\r\n     * Only valid to call if hasEnd() returns true.\r\n     * Returns the end key name for the range defined by these query parameters\r\n     * @return {!string}\r\n     */\r\n    QueryParams.prototype.getIndexEndName = function () {\r\n        assert(this.endSet_, 'Only valid if end has been set');\r\n        if (this.endNameSet_) {\r\n            return this.indexEndName_;\r\n        }\r\n        else {\r\n            return MAX_NAME;\r\n        }\r\n    };\r\n    /**\r\n     * @return {boolean}\r\n     */\r\n    QueryParams.prototype.hasLimit = function () {\r\n        return this.limitSet_;\r\n    };\r\n    /**\r\n     * @return {boolean} True if a limit has been set and it has been explicitly anchored\r\n     */\r\n    QueryParams.prototype.hasAnchoredLimit = function () {\r\n        return this.limitSet_ && this.viewFrom_ !== '';\r\n    };\r\n    /**\r\n     * Only valid to call if hasLimit() returns true\r\n     * @return {!number}\r\n     */\r\n    QueryParams.prototype.getLimit = function () {\r\n        assert(this.limitSet_, 'Only valid if limit has been set');\r\n        return this.limit_;\r\n    };\r\n    /**\r\n     * @return {!Index}\r\n     */\r\n    QueryParams.prototype.getIndex = function () {\r\n        return this.index_;\r\n    };\r\n    /**\r\n     * @return {!QueryParams}\r\n     * @private\r\n     */\r\n    QueryParams.prototype.copy_ = function () {\r\n        var copy = new QueryParams();\r\n        copy.limitSet_ = this.limitSet_;\r\n        copy.limit_ = this.limit_;\r\n        copy.startSet_ = this.startSet_;\r\n        copy.indexStartValue_ = this.indexStartValue_;\r\n        copy.startNameSet_ = this.startNameSet_;\r\n        copy.indexStartName_ = this.indexStartName_;\r\n        copy.endSet_ = this.endSet_;\r\n        copy.indexEndValue_ = this.indexEndValue_;\r\n        copy.endNameSet_ = this.endNameSet_;\r\n        copy.indexEndName_ = this.indexEndName_;\r\n        copy.index_ = this.index_;\r\n        copy.viewFrom_ = this.viewFrom_;\r\n        return copy;\r\n    };\r\n    /**\r\n     * @param {!number} newLimit\r\n     * @return {!QueryParams}\r\n     */\r\n    QueryParams.prototype.limit = function (newLimit) {\r\n        var newParams = this.copy_();\r\n        newParams.limitSet_ = true;\r\n        newParams.limit_ = newLimit;\r\n        newParams.viewFrom_ = '';\r\n        return newParams;\r\n    };\r\n    /**\r\n     * @param {!number} newLimit\r\n     * @return {!QueryParams}\r\n     */\r\n    QueryParams.prototype.limitToFirst = function (newLimit) {\r\n        var newParams = this.copy_();\r\n        newParams.limitSet_ = true;\r\n        newParams.limit_ = newLimit;\r\n        newParams.viewFrom_ = QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT;\r\n        return newParams;\r\n    };\r\n    /**\r\n     * @param {!number} newLimit\r\n     * @return {!QueryParams}\r\n     */\r\n    QueryParams.prototype.limitToLast = function (newLimit) {\r\n        var newParams = this.copy_();\r\n        newParams.limitSet_ = true;\r\n        newParams.limit_ = newLimit;\r\n        newParams.viewFrom_ = QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT;\r\n        return newParams;\r\n    };\r\n    /**\r\n     * @param {*} indexValue\r\n     * @param {?string=} key\r\n     * @return {!QueryParams}\r\n     */\r\n    QueryParams.prototype.startAt = function (indexValue, key) {\r\n        var newParams = this.copy_();\r\n        newParams.startSet_ = true;\r\n        if (!(indexValue !== undefined)) {\r\n            indexValue = null;\r\n        }\r\n        newParams.indexStartValue_ = indexValue;\r\n        if (key != null) {\r\n            newParams.startNameSet_ = true;\r\n            newParams.indexStartName_ = key;\r\n        }\r\n        else {\r\n            newParams.startNameSet_ = false;\r\n            newParams.indexStartName_ = '';\r\n        }\r\n        return newParams;\r\n    };\r\n    /**\r\n     * @param {*} indexValue\r\n     * @param {?string=} key\r\n     * @return {!QueryParams}\r\n     */\r\n    QueryParams.prototype.endAt = function (indexValue, key) {\r\n        var newParams = this.copy_();\r\n        newParams.endSet_ = true;\r\n        if (!(indexValue !== undefined)) {\r\n            indexValue = null;\r\n        }\r\n        newParams.indexEndValue_ = indexValue;\r\n        if (key !== undefined) {\r\n            newParams.endNameSet_ = true;\r\n            newParams.indexEndName_ = key;\r\n        }\r\n        else {\r\n            newParams.endNameSet_ = false;\r\n            newParams.indexEndName_ = '';\r\n        }\r\n        return newParams;\r\n    };\r\n    /**\r\n     * @param {!Index} index\r\n     * @return {!QueryParams}\r\n     */\r\n    QueryParams.prototype.orderBy = function (index) {\r\n        var newParams = this.copy_();\r\n        newParams.index_ = index;\r\n        return newParams;\r\n    };\r\n    /**\r\n     * @return {!Object}\r\n     */\r\n    QueryParams.prototype.getQueryObject = function () {\r\n        var WIRE_PROTOCOL_CONSTANTS = QueryParams.WIRE_PROTOCOL_CONSTANTS_;\r\n        var obj = {};\r\n        if (this.startSet_) {\r\n            obj[WIRE_PROTOCOL_CONSTANTS.INDEX_START_VALUE] = this.indexStartValue_;\r\n            if (this.startNameSet_) {\r\n                obj[WIRE_PROTOCOL_CONSTANTS.INDEX_START_NAME] = this.indexStartName_;\r\n            }\r\n        }\r\n        if (this.endSet_) {\r\n            obj[WIRE_PROTOCOL_CONSTANTS.INDEX_END_VALUE] = this.indexEndValue_;\r\n            if (this.endNameSet_) {\r\n                obj[WIRE_PROTOCOL_CONSTANTS.INDEX_END_NAME] = this.indexEndName_;\r\n            }\r\n        }\r\n        if (this.limitSet_) {\r\n            obj[WIRE_PROTOCOL_CONSTANTS.LIMIT] = this.limit_;\r\n            var viewFrom = this.viewFrom_;\r\n            if (viewFrom === '') {\r\n                if (this.isViewFromLeft()) {\r\n                    viewFrom = WIRE_PROTOCOL_CONSTANTS.VIEW_FROM_LEFT;\r\n                }\r\n                else {\r\n                    viewFrom = WIRE_PROTOCOL_CONSTANTS.VIEW_FROM_RIGHT;\r\n                }\r\n            }\r\n            obj[WIRE_PROTOCOL_CONSTANTS.VIEW_FROM] = viewFrom;\r\n        }\r\n        // For now, priority index is the default, so we only specify if it's some other index\r\n        if (this.index_ !== PRIORITY_INDEX) {\r\n            obj[WIRE_PROTOCOL_CONSTANTS.INDEX] = this.index_.toString();\r\n        }\r\n        return obj;\r\n    };\r\n    /**\r\n     * @return {boolean}\r\n     */\r\n    QueryParams.prototype.loadsAllData = function () {\r\n        return !(this.startSet_ || this.endSet_ || this.limitSet_);\r\n    };\r\n    /**\r\n     * @return {boolean}\r\n     */\r\n    QueryParams.prototype.isDefault = function () {\r\n        return this.loadsAllData() && this.index_ == PRIORITY_INDEX;\r\n    };\r\n    /**\r\n     * @return {!NodeFilter}\r\n     */\r\n    QueryParams.prototype.getNodeFilter = function () {\r\n        if (this.loadsAllData()) {\r\n            return new IndexedFilter(this.getIndex());\r\n        }\r\n        else if (this.hasLimit()) {\r\n            return new LimitedFilter(this);\r\n        }\r\n        else {\r\n            return new RangedFilter(this);\r\n        }\r\n    };\r\n    /**\r\n     * Returns a set of REST query string parameters representing this query.\r\n     *\r\n     * @return {!Object.<string,*>} query string parameters\r\n     */\r\n    QueryParams.prototype.toRestQueryStringParameters = function () {\r\n        var REST_CONSTANTS = QueryParams.REST_QUERY_CONSTANTS_;\r\n        var qs = {};\r\n        if (this.isDefault()) {\r\n            return qs;\r\n        }\r\n        var orderBy;\r\n        if (this.index_ === PRIORITY_INDEX) {\r\n            orderBy = REST_CONSTANTS.PRIORITY_INDEX;\r\n        }\r\n        else if (this.index_ === VALUE_INDEX) {\r\n            orderBy = REST_CONSTANTS.VALUE_INDEX;\r\n        }\r\n        else if (this.index_ === KEY_INDEX) {\r\n            orderBy = REST_CONSTANTS.KEY_INDEX;\r\n        }\r\n        else {\r\n            assert(this.index_ instanceof PathIndex, 'Unrecognized index type!');\r\n            orderBy = this.index_.toString();\r\n        }\r\n        qs[REST_CONSTANTS.ORDER_BY] = stringify(orderBy);\r\n        if (this.startSet_) {\r\n            qs[REST_CONSTANTS.START_AT] = stringify(this.indexStartValue_);\r\n            if (this.startNameSet_) {\r\n                qs[REST_CONSTANTS.START_AT] += ',' + stringify(this.indexStartName_);\r\n            }\r\n        }\r\n        if (this.endSet_) {\r\n            qs[REST_CONSTANTS.END_AT] = stringify(this.indexEndValue_);\r\n            if (this.endNameSet_) {\r\n                qs[REST_CONSTANTS.END_AT] += ',' + stringify(this.indexEndName_);\r\n            }\r\n        }\r\n        if (this.limitSet_) {\r\n            if (this.isViewFromLeft()) {\r\n                qs[REST_CONSTANTS.LIMIT_TO_FIRST] = this.limit_;\r\n            }\r\n            else {\r\n                qs[REST_CONSTANTS.LIMIT_TO_LAST] = this.limit_;\r\n            }\r\n        }\r\n        return qs;\r\n    };\r\n    /**\r\n     * Wire Protocol Constants\r\n     * @const\r\n     * @enum {string}\r\n     * @private\r\n     */\r\n    QueryParams.WIRE_PROTOCOL_CONSTANTS_ = {\r\n        INDEX_START_VALUE: 'sp',\r\n        INDEX_START_NAME: 'sn',\r\n        INDEX_END_VALUE: 'ep',\r\n        INDEX_END_NAME: 'en',\r\n        LIMIT: 'l',\r\n        VIEW_FROM: 'vf',\r\n        VIEW_FROM_LEFT: 'l',\r\n        VIEW_FROM_RIGHT: 'r',\r\n        INDEX: 'i'\r\n    };\r\n    /**\r\n     * REST Query Constants\r\n     * @const\r\n     * @enum {string}\r\n     * @private\r\n     */\r\n    QueryParams.REST_QUERY_CONSTANTS_ = {\r\n        ORDER_BY: 'orderBy',\r\n        PRIORITY_INDEX: '$priority',\r\n        VALUE_INDEX: '$value',\r\n        KEY_INDEX: '$key',\r\n        START_AT: 'startAt',\r\n        END_AT: 'endAt',\r\n        LIMIT_TO_FIRST: 'limitToFirst',\r\n        LIMIT_TO_LAST: 'limitToLast'\r\n    };\r\n    /**\r\n     * Default, empty query parameters\r\n     * @type {!QueryParams}\r\n     * @const\r\n     */\r\n    QueryParams.DEFAULT = new QueryParams();\r\n    return QueryParams;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar Reference = /** @class */ (function (_super) {\r\n    __extends(Reference, _super);\r\n    /**\r\n     * Call options:\r\n     *   new Reference(Repo, Path) or\r\n     *   new Reference(url: string, string|RepoManager)\r\n     *\r\n     * Externally - this is the firebase.database.Reference type.\r\n     *\r\n     * @param {!Repo} repo\r\n     * @param {(!Path)} path\r\n     * @extends {Query}\r\n     */\r\n    function Reference(repo, path) {\r\n        var _this = this;\r\n        if (!(repo instanceof Repo)) {\r\n            throw new Error('new Reference() no longer supported - use app.database().');\r\n        }\r\n        // call Query's constructor, passing in the repo and path.\r\n        _this = _super.call(this, repo, path, QueryParams.DEFAULT, false) || this;\r\n        return _this;\r\n    }\r\n    /** @return {?string} */\r\n    Reference.prototype.getKey = function () {\r\n        validateArgCount('Reference.key', 0, 0, arguments.length);\r\n        if (this.path.isEmpty())\r\n            return null;\r\n        else\r\n            return this.path.getBack();\r\n    };\r\n    /**\r\n     * @param {!(string|Path)} pathString\r\n     * @return {!Reference}\r\n     */\r\n    Reference.prototype.child = function (pathString) {\r\n        validateArgCount('Reference.child', 1, 1, arguments.length);\r\n        if (typeof pathString === 'number') {\r\n            pathString = String(pathString);\r\n        }\r\n        else if (!(pathString instanceof Path)) {\r\n            if (this.path.getFront() === null)\r\n                validateRootPathString('Reference.child', 1, pathString, false);\r\n            else\r\n                validatePathString('Reference.child', 1, pathString, false);\r\n        }\r\n        return new Reference(this.repo, this.path.child(pathString));\r\n    };\r\n    /** @return {?Reference} */\r\n    Reference.prototype.getParent = function () {\r\n        validateArgCount('Reference.parent', 0, 0, arguments.length);\r\n        var parentPath = this.path.parent();\r\n        return parentPath === null ? null : new Reference(this.repo, parentPath);\r\n    };\r\n    /** @return {!Reference} */\r\n    Reference.prototype.getRoot = function () {\r\n        validateArgCount('Reference.root', 0, 0, arguments.length);\r\n        var ref = this;\r\n        while (ref.getParent() !== null) {\r\n            ref = ref.getParent();\r\n        }\r\n        return ref;\r\n    };\r\n    /** @return {!Database} */\r\n    Reference.prototype.databaseProp = function () {\r\n        return this.repo.database;\r\n    };\r\n    /**\r\n     * @param {*} newVal\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!Promise}\r\n     */\r\n    Reference.prototype.set = function (newVal, onComplete) {\r\n        validateArgCount('Reference.set', 1, 2, arguments.length);\r\n        validateWritablePath('Reference.set', this.path);\r\n        validateFirebaseDataArg('Reference.set', 1, newVal, this.path, false);\r\n        validateCallback('Reference.set', 2, onComplete, true);\r\n        var deferred = new Deferred();\r\n        this.repo.setWithPriority(this.path, newVal, \r\n        /*priority=*/ null, deferred.wrapCallback(onComplete));\r\n        return deferred.promise;\r\n    };\r\n    /**\r\n     * @param {!Object} objectToMerge\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!Promise}\r\n     */\r\n    Reference.prototype.update = function (objectToMerge, onComplete) {\r\n        validateArgCount('Reference.update', 1, 2, arguments.length);\r\n        validateWritablePath('Reference.update', this.path);\r\n        if (Array.isArray(objectToMerge)) {\r\n            var newObjectToMerge = {};\r\n            for (var i = 0; i < objectToMerge.length; ++i) {\r\n                newObjectToMerge['' + i] = objectToMerge[i];\r\n            }\r\n            objectToMerge = newObjectToMerge;\r\n            warn('Passing an Array to Firebase.update() is deprecated. ' +\r\n                'Use set() if you want to overwrite the existing data, or ' +\r\n                'an Object with integer keys if you really do want to ' +\r\n                'only update some of the children.');\r\n        }\r\n        validateFirebaseMergeDataArg('Reference.update', 1, objectToMerge, this.path, false);\r\n        validateCallback('Reference.update', 2, onComplete, true);\r\n        var deferred = new Deferred();\r\n        this.repo.update(this.path, objectToMerge, deferred.wrapCallback(onComplete));\r\n        return deferred.promise;\r\n    };\r\n    /**\r\n     * @param {*} newVal\r\n     * @param {string|number|null} newPriority\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!Promise}\r\n     */\r\n    Reference.prototype.setWithPriority = function (newVal, newPriority, onComplete) {\r\n        validateArgCount('Reference.setWithPriority', 2, 3, arguments.length);\r\n        validateWritablePath('Reference.setWithPriority', this.path);\r\n        validateFirebaseDataArg('Reference.setWithPriority', 1, newVal, this.path, false);\r\n        validatePriority('Reference.setWithPriority', 2, newPriority, false);\r\n        validateCallback('Reference.setWithPriority', 3, onComplete, true);\r\n        if (this.getKey() === '.length' || this.getKey() === '.keys')\r\n            throw 'Reference.setWithPriority failed: ' +\r\n                this.getKey() +\r\n                ' is a read-only object.';\r\n        var deferred = new Deferred();\r\n        this.repo.setWithPriority(this.path, newVal, newPriority, deferred.wrapCallback(onComplete));\r\n        return deferred.promise;\r\n    };\r\n    /**\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!Promise}\r\n     */\r\n    Reference.prototype.remove = function (onComplete) {\r\n        validateArgCount('Reference.remove', 0, 1, arguments.length);\r\n        validateWritablePath('Reference.remove', this.path);\r\n        validateCallback('Reference.remove', 1, onComplete, true);\r\n        return this.set(null, onComplete);\r\n    };\r\n    /**\r\n     * @param {function(*):*} transactionUpdate\r\n     * @param {(function(?Error, boolean, ?DataSnapshot))=} onComplete\r\n     * @param {boolean=} applyLocally\r\n     * @return {!Promise}\r\n     */\r\n    Reference.prototype.transaction = function (transactionUpdate, onComplete, applyLocally) {\r\n        validateArgCount('Reference.transaction', 1, 3, arguments.length);\r\n        validateWritablePath('Reference.transaction', this.path);\r\n        validateCallback('Reference.transaction', 1, transactionUpdate, false);\r\n        validateCallback('Reference.transaction', 2, onComplete, true);\r\n        // NOTE: applyLocally is an internal-only option for now.  We need to decide if we want to keep it and how\r\n        // to expose it.\r\n        validateBoolean('Reference.transaction', 3, applyLocally, true);\r\n        if (this.getKey() === '.length' || this.getKey() === '.keys')\r\n            throw 'Reference.transaction failed: ' +\r\n                this.getKey() +\r\n                ' is a read-only object.';\r\n        if (applyLocally === undefined)\r\n            applyLocally = true;\r\n        var deferred = new Deferred();\r\n        if (typeof onComplete === 'function') {\r\n            deferred.promise.catch(function () { });\r\n        }\r\n        var promiseComplete = function (error$$1, committed, snapshot) {\r\n            if (error$$1) {\r\n                deferred.reject(error$$1);\r\n            }\r\n            else {\r\n                deferred.resolve(new TransactionResult(committed, snapshot));\r\n            }\r\n            if (typeof onComplete === 'function') {\r\n                onComplete(error$$1, committed, snapshot);\r\n            }\r\n        };\r\n        this.repo.startTransaction(this.path, transactionUpdate, promiseComplete, applyLocally);\r\n        return deferred.promise;\r\n    };\r\n    /**\r\n     * @param {string|number|null} priority\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!Promise}\r\n     */\r\n    Reference.prototype.setPriority = function (priority, onComplete) {\r\n        validateArgCount('Reference.setPriority', 1, 2, arguments.length);\r\n        validateWritablePath('Reference.setPriority', this.path);\r\n        validatePriority('Reference.setPriority', 1, priority, false);\r\n        validateCallback('Reference.setPriority', 2, onComplete, true);\r\n        var deferred = new Deferred();\r\n        this.repo.setWithPriority(this.path.child('.priority'), priority, null, deferred.wrapCallback(onComplete));\r\n        return deferred.promise;\r\n    };\r\n    /**\r\n     * @param {*=} value\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!Reference}\r\n     */\r\n    Reference.prototype.push = function (value, onComplete) {\r\n        validateArgCount('Reference.push', 0, 2, arguments.length);\r\n        validateWritablePath('Reference.push', this.path);\r\n        validateFirebaseDataArg('Reference.push', 1, value, this.path, true);\r\n        validateCallback('Reference.push', 2, onComplete, true);\r\n        var now = this.repo.serverTime();\r\n        var name = nextPushId(now);\r\n        // push() returns a ThennableReference whose promise is fulfilled with a regular Reference.\r\n        // We use child() to create handles to two different references. The first is turned into a\r\n        // ThennableReference below by adding then() and catch() methods and is used as the\r\n        // return value of push(). The second remains a regular Reference and is used as the fulfilled\r\n        // value of the first ThennableReference.\r\n        var thennablePushRef = this.child(name);\r\n        var pushRef = this.child(name);\r\n        var promise;\r\n        if (value != null) {\r\n            promise = thennablePushRef.set(value, onComplete).then(function () { return pushRef; });\r\n        }\r\n        else {\r\n            promise = Promise.resolve(pushRef);\r\n        }\r\n        thennablePushRef.then = promise.then.bind(promise);\r\n        thennablePushRef.catch = promise.then.bind(promise, undefined);\r\n        if (typeof onComplete === 'function') {\r\n            promise.catch(function () { });\r\n        }\r\n        return thennablePushRef;\r\n    };\r\n    /**\r\n     * @return {!OnDisconnect}\r\n     */\r\n    Reference.prototype.onDisconnect = function () {\r\n        validateWritablePath('Reference.onDisconnect', this.path);\r\n        return new OnDisconnect(this.repo, this.path);\r\n    };\r\n    Object.defineProperty(Reference.prototype, \"database\", {\r\n        get: function () {\r\n            return this.databaseProp();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"key\", {\r\n        get: function () {\r\n            return this.getKey();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"parent\", {\r\n        get: function () {\r\n            return this.getParent();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"root\", {\r\n        get: function () {\r\n            return this.getRoot();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return Reference;\r\n}(Query));\r\n/**\r\n * Define reference constructor in various modules\r\n *\r\n * We are doing this here to avoid several circular\r\n * dependency issues\r\n */\r\nQuery.__referenceConstructor = Reference;\r\nSyncPoint.__referenceConstructor = Reference;\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Node in a Tree.\r\n */\r\nvar TreeNode = /** @class */ (function () {\r\n    function TreeNode() {\r\n        // TODO: Consider making accessors that create children and value lazily or\r\n        // separate Internal / Leaf 'types'.\r\n        this.children = {};\r\n        this.childCount = 0;\r\n        this.value = null;\r\n    }\r\n    return TreeNode;\r\n}());\r\n/**\r\n * A light-weight tree, traversable by path.  Nodes can have both values and children.\r\n * Nodes are not enumerated (by forEachChild) unless they have a value or non-empty\r\n * children.\r\n */\r\nvar Tree = /** @class */ (function () {\r\n    /**\r\n     * @template T\r\n     * @param {string=} name_ Optional name of the node.\r\n     * @param {Tree=} parent_ Optional parent node.\r\n     * @param {TreeNode=} node_ Optional node to wrap.\r\n     */\r\n    function Tree(name_, parent_, node_) {\r\n        if (name_ === void 0) { name_ = ''; }\r\n        if (parent_ === void 0) { parent_ = null; }\r\n        if (node_ === void 0) { node_ = new TreeNode(); }\r\n        this.name_ = name_;\r\n        this.parent_ = parent_;\r\n        this.node_ = node_;\r\n    }\r\n    /**\r\n     * Returns a sub-Tree for the given path.\r\n     *\r\n     * @param {!(string|Path)} pathObj Path to look up.\r\n     * @return {!Tree.<T>} Tree for path.\r\n     */\r\n    Tree.prototype.subTree = function (pathObj) {\r\n        // TODO: Require pathObj to be Path?\r\n        var path = pathObj instanceof Path ? pathObj : new Path(pathObj);\r\n        var child = this, next;\r\n        while ((next = path.getFront()) !== null) {\r\n            var childNode = safeGet(child.node_.children, next) || new TreeNode();\r\n            child = new Tree(next, child, childNode);\r\n            path = path.popFront();\r\n        }\r\n        return child;\r\n    };\r\n    /**\r\n     * Returns the data associated with this tree node.\r\n     *\r\n     * @return {?T} The data or null if no data exists.\r\n     */\r\n    Tree.prototype.getValue = function () {\r\n        return this.node_.value;\r\n    };\r\n    /**\r\n     * Sets data to this tree node.\r\n     *\r\n     * @param {!T} value Value to set.\r\n     */\r\n    Tree.prototype.setValue = function (value) {\r\n        assert(typeof value !== 'undefined', 'Cannot set value to undefined');\r\n        this.node_.value = value;\r\n        this.updateParents_();\r\n    };\r\n    /**\r\n     * Clears the contents of the tree node (its value and all children).\r\n     */\r\n    Tree.prototype.clear = function () {\r\n        this.node_.value = null;\r\n        this.node_.children = {};\r\n        this.node_.childCount = 0;\r\n        this.updateParents_();\r\n    };\r\n    /**\r\n     * @return {boolean} Whether the tree has any children.\r\n     */\r\n    Tree.prototype.hasChildren = function () {\r\n        return this.node_.childCount > 0;\r\n    };\r\n    /**\r\n     * @return {boolean} Whether the tree is empty (no value or children).\r\n     */\r\n    Tree.prototype.isEmpty = function () {\r\n        return this.getValue() === null && !this.hasChildren();\r\n    };\r\n    /**\r\n     * Calls action for each child of this tree node.\r\n     *\r\n     * @param {function(!Tree.<T>)} action Action to be called for each child.\r\n     */\r\n    Tree.prototype.forEachChild = function (action) {\r\n        var _this = this;\r\n        forEach(this.node_.children, function (child, childTree) {\r\n            action(new Tree(child, _this, childTree));\r\n        });\r\n    };\r\n    /**\r\n     * Does a depth-first traversal of this node's descendants, calling action for each one.\r\n     *\r\n     * @param {function(!Tree.<T>)} action Action to be called for each child.\r\n     * @param {boolean=} includeSelf Whether to call action on this node as well. Defaults to\r\n     *   false.\r\n     * @param {boolean=} childrenFirst Whether to call action on children before calling it on\r\n     *   parent.\r\n     */\r\n    Tree.prototype.forEachDescendant = function (action, includeSelf, childrenFirst) {\r\n        if (includeSelf && !childrenFirst)\r\n            action(this);\r\n        this.forEachChild(function (child) {\r\n            child.forEachDescendant(action, /*includeSelf=*/ true, childrenFirst);\r\n        });\r\n        if (includeSelf && childrenFirst)\r\n            action(this);\r\n    };\r\n    /**\r\n     * Calls action on each ancestor node.\r\n     *\r\n     * @param {function(!Tree.<T>)} action Action to be called on each parent; return\r\n     *   true to abort.\r\n     * @param {boolean=} includeSelf Whether to call action on this node as well.\r\n     * @return {boolean} true if the action callback returned true.\r\n     */\r\n    Tree.prototype.forEachAncestor = function (action, includeSelf) {\r\n        var node = includeSelf ? this : this.parent();\r\n        while (node !== null) {\r\n            if (action(node)) {\r\n                return true;\r\n            }\r\n            node = node.parent();\r\n        }\r\n        return false;\r\n    };\r\n    /**\r\n     * Does a depth-first traversal of this node's descendants.  When a descendant with a value\r\n     * is found, action is called on it and traversal does not continue inside the node.\r\n     * Action is *not* called on this node.\r\n     *\r\n     * @param {function(!Tree.<T>)} action Action to be called for each child.\r\n     */\r\n    Tree.prototype.forEachImmediateDescendantWithValue = function (action) {\r\n        this.forEachChild(function (child) {\r\n            if (child.getValue() !== null)\r\n                action(child);\r\n            else\r\n                child.forEachImmediateDescendantWithValue(action);\r\n        });\r\n    };\r\n    /**\r\n     * @return {!Path} The path of this tree node, as a Path.\r\n     */\r\n    Tree.prototype.path = function () {\r\n        return new Path(this.parent_ === null\r\n            ? this.name_\r\n            : this.parent_.path() + '/' + this.name_);\r\n    };\r\n    /**\r\n     * @return {string} The name of the tree node.\r\n     */\r\n    Tree.prototype.name = function () {\r\n        return this.name_;\r\n    };\r\n    /**\r\n     * @return {?Tree} The parent tree node, or null if this is the root of the tree.\r\n     */\r\n    Tree.prototype.parent = function () {\r\n        return this.parent_;\r\n    };\r\n    /**\r\n     * Adds or removes this child from its parent based on whether it's empty or not.\r\n     *\r\n     * @private\r\n     */\r\n    Tree.prototype.updateParents_ = function () {\r\n        if (this.parent_ !== null)\r\n            this.parent_.updateChild_(this.name_, this);\r\n    };\r\n    /**\r\n     * Adds or removes the passed child to this tree node, depending on whether it's empty.\r\n     *\r\n     * @param {string} childName The name of the child to update.\r\n     * @param {!Tree.<T>} child The child to update.\r\n     * @private\r\n     */\r\n    Tree.prototype.updateChild_ = function (childName, child) {\r\n        var childEmpty = child.isEmpty();\r\n        var childExists = contains(this.node_.children, childName);\r\n        if (childEmpty && childExists) {\r\n            delete this.node_.children[childName];\r\n            this.node_.childCount--;\r\n            this.updateParents_();\r\n        }\r\n        else if (!childEmpty && !childExists) {\r\n            this.node_.children[childName] = child.node_;\r\n            this.node_.childCount++;\r\n            this.updateParents_();\r\n        }\r\n    };\r\n    return Tree;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// TODO: This is pretty messy.  Ideally, a lot of this would move into FirebaseData, or a transaction-specific\r\n// component used by FirebaseData, but it has ties to user callbacks (transaction update and onComplete) as well\r\n// as the realtime connection (to send transactions to the server).  So that all needs to be decoupled first.\r\n// For now it's part of Repo, but in its own file.\r\n/**\r\n * @enum {number}\r\n */\r\nvar TransactionStatus;\r\n(function (TransactionStatus) {\r\n    // We've run the transaction and updated transactionResultData_ with the result, but it isn't currently sent to the\r\n    // server. A transaction will go from RUN -> SENT -> RUN if it comes back from the server as rejected due to\r\n    // mismatched hash.\r\n    TransactionStatus[TransactionStatus[\"RUN\"] = 0] = \"RUN\";\r\n    // We've run the transaction and sent it to the server and it's currently outstanding (hasn't come back as accepted\r\n    // or rejected yet).\r\n    TransactionStatus[TransactionStatus[\"SENT\"] = 1] = \"SENT\";\r\n    // Temporary state used to mark completed transactions (whether successful or aborted).  The transaction will be\r\n    // removed when we get a chance to prune completed ones.\r\n    TransactionStatus[TransactionStatus[\"COMPLETED\"] = 2] = \"COMPLETED\";\r\n    // Used when an already-sent transaction needs to be aborted (e.g. due to a conflicting set() call that was made).\r\n    // If it comes back as unsuccessful, we'll abort it.\r\n    TransactionStatus[TransactionStatus[\"SENT_NEEDS_ABORT\"] = 3] = \"SENT_NEEDS_ABORT\";\r\n    // Temporary state used to mark transactions that need to be aborted.\r\n    TransactionStatus[TransactionStatus[\"NEEDS_ABORT\"] = 4] = \"NEEDS_ABORT\";\r\n})(TransactionStatus || (TransactionStatus = {}));\r\n/**\r\n * If a transaction does not succeed after 25 retries, we abort it.  Among other things this ensure that if there's\r\n * ever a bug causing a mismatch between client / server hashes for some data, we won't retry indefinitely.\r\n * @type {number}\r\n * @const\r\n * @private\r\n */\r\nRepo.MAX_TRANSACTION_RETRIES_ = 25;\r\n/**\r\n * Setup the transaction data structures\r\n * @private\r\n */\r\nRepo.prototype.transactions_init_ = function () {\r\n    /**\r\n     * Stores queues of outstanding transactions for Firebase locations.\r\n     *\r\n     * @type {!Tree.<Array.<!Transaction>>}\r\n     * @private\r\n     */\r\n    this.transactionQueueTree_ = new Tree();\r\n};\r\n/**\r\n * Creates a new transaction, adds it to the transactions we're tracking, and sends it to the server if possible.\r\n *\r\n * @param {!Path} path Path at which to do transaction.\r\n * @param {function(*):*} transactionUpdate Update callback.\r\n * @param {?function(?Error, boolean, ?DataSnapshot)} onComplete Completion callback.\r\n * @param {boolean} applyLocally Whether or not to make intermediate results visible\r\n */\r\nRepo.prototype.startTransaction = function (path, transactionUpdate, onComplete, applyLocally) {\r\n    this.log_('transaction on ' + path);\r\n    // Add a watch to make sure we get server updates.\r\n    var valueCallback = function () { };\r\n    var watchRef = new Reference(this, path);\r\n    watchRef.on('value', valueCallback);\r\n    var unwatcher = function () {\r\n        watchRef.off('value', valueCallback);\r\n    };\r\n    // Initialize transaction.\r\n    var transaction = {\r\n        path: path,\r\n        update: transactionUpdate,\r\n        onComplete: onComplete,\r\n        // One of TransactionStatus enums.\r\n        status: null,\r\n        // Used when combining transactions at different locations to figure out which one goes first.\r\n        order: LUIDGenerator(),\r\n        // Whether to raise local events for this transaction.\r\n        applyLocally: applyLocally,\r\n        // Count of how many times we've retried the transaction.\r\n        retryCount: 0,\r\n        // Function to call to clean up our .on() listener.\r\n        unwatcher: unwatcher,\r\n        // Stores why a transaction was aborted.\r\n        abortReason: null,\r\n        currentWriteId: null,\r\n        currentInputSnapshot: null,\r\n        currentOutputSnapshotRaw: null,\r\n        currentOutputSnapshotResolved: null\r\n    };\r\n    // Run transaction initially.\r\n    var currentState = this.getLatestState_(path);\r\n    transaction.currentInputSnapshot = currentState;\r\n    var newVal = transaction.update(currentState.val());\r\n    if (newVal === undefined) {\r\n        // Abort transaction.\r\n        transaction.unwatcher();\r\n        transaction.currentOutputSnapshotRaw = null;\r\n        transaction.currentOutputSnapshotResolved = null;\r\n        if (transaction.onComplete) {\r\n            // We just set the input snapshot, so this cast should be safe\r\n            var snapshot = new DataSnapshot(transaction.currentInputSnapshot, new Reference(this, transaction.path), PRIORITY_INDEX);\r\n            transaction.onComplete(null, false, snapshot);\r\n        }\r\n    }\r\n    else {\r\n        validateFirebaseData('transaction failed: Data returned ', newVal, transaction.path);\r\n        // Mark as run and add to our queue.\r\n        transaction.status = TransactionStatus.RUN;\r\n        var queueNode = this.transactionQueueTree_.subTree(path);\r\n        var nodeQueue = queueNode.getValue() || [];\r\n        nodeQueue.push(transaction);\r\n        queueNode.setValue(nodeQueue);\r\n        // Update visibleData and raise events\r\n        // Note: We intentionally raise events after updating all of our transaction state, since the user could\r\n        // start new transactions from the event callbacks.\r\n        var priorityForNode = void 0;\r\n        if (typeof newVal === 'object' &&\r\n            newVal !== null &&\r\n            contains(newVal, '.priority')) {\r\n            priorityForNode = safeGet(newVal, '.priority');\r\n            assert(isValidPriority(priorityForNode), 'Invalid priority returned by transaction. ' +\r\n                'Priority must be a valid string, finite number, server value, or null.');\r\n        }\r\n        else {\r\n            var currentNode = this.serverSyncTree_.calcCompleteEventCache(path) ||\r\n                ChildrenNode.EMPTY_NODE;\r\n            priorityForNode = currentNode.getPriority().val();\r\n        }\r\n        priorityForNode /** @type {null|number|string} */ = priorityForNode;\r\n        var serverValues = this.generateServerValues();\r\n        var newNodeUnresolved = nodeFromJSON$1(newVal, priorityForNode);\r\n        var newNode = resolveDeferredValueSnapshot(newNodeUnresolved, serverValues);\r\n        transaction.currentOutputSnapshotRaw = newNodeUnresolved;\r\n        transaction.currentOutputSnapshotResolved = newNode;\r\n        transaction.currentWriteId = this.getNextWriteId_();\r\n        var events = this.serverSyncTree_.applyUserOverwrite(path, newNode, transaction.currentWriteId, transaction.applyLocally);\r\n        this.eventQueue_.raiseEventsForChangedPath(path, events);\r\n        this.sendReadyTransactions_();\r\n    }\r\n};\r\n/**\r\n * @param {!Path} path\r\n * @param {Array.<number>=} excludeSets A specific set to exclude\r\n * @return {Node}\r\n * @private\r\n */\r\nRepo.prototype.getLatestState_ = function (path, excludeSets) {\r\n    return (this.serverSyncTree_.calcCompleteEventCache(path, excludeSets) ||\r\n        ChildrenNode.EMPTY_NODE);\r\n};\r\n/**\r\n * Sends any already-run transactions that aren't waiting for outstanding transactions to\r\n * complete.\r\n *\r\n * Externally it's called with no arguments, but it calls itself recursively with a particular\r\n * transactionQueueTree node to recurse through the tree.\r\n *\r\n * @param {Tree.<Array.<Transaction>>=} node  transactionQueueTree node to start at.\r\n * @private\r\n */\r\nRepo.prototype.sendReadyTransactions_ = function (node) {\r\n    var _this = this;\r\n    if (node === void 0) { node = this.transactionQueueTree_; }\r\n    // Before recursing, make sure any completed transactions are removed.\r\n    if (!node) {\r\n        this.pruneCompletedTransactionsBelowNode_(node);\r\n    }\r\n    if (node.getValue() !== null) {\r\n        var queue = this.buildTransactionQueue_(node);\r\n        assert(queue.length > 0, 'Sending zero length transaction queue');\r\n        var allRun = queue.every(function (transaction) { return transaction.status === TransactionStatus.RUN; });\r\n        // If they're all run (and not sent), we can send them.  Else, we must wait.\r\n        if (allRun) {\r\n            this.sendTransactionQueue_(node.path(), queue);\r\n        }\r\n    }\r\n    else if (node.hasChildren()) {\r\n        node.forEachChild(function (childNode) {\r\n            _this.sendReadyTransactions_(childNode);\r\n        });\r\n    }\r\n};\r\n/**\r\n * Given a list of run transactions, send them to the server and then handle the result (success or failure).\r\n *\r\n * @param {!Path} path The location of the queue.\r\n * @param {!Array.<Transaction>} queue Queue of transactions under the specified location.\r\n * @private\r\n */\r\nRepo.prototype.sendTransactionQueue_ = function (path, queue) {\r\n    var _this = this;\r\n    // Mark transactions as sent and increment retry count!\r\n    var setsToIgnore = queue.map(function (txn) {\r\n        return txn.currentWriteId;\r\n    });\r\n    var latestState = this.getLatestState_(path, setsToIgnore);\r\n    var snapToSend = latestState;\r\n    var latestHash = latestState.hash();\r\n    for (var i = 0; i < queue.length; i++) {\r\n        var txn = queue[i];\r\n        assert(txn.status === TransactionStatus.RUN, 'tryToSendTransactionQueue_: items in queue should all be run.');\r\n        txn.status = TransactionStatus.SENT;\r\n        txn.retryCount++;\r\n        var relativePath = Path.relativePath(path, txn.path);\r\n        // If we've gotten to this point, the output snapshot must be defined.\r\n        snapToSend = snapToSend.updateChild(relativePath /**@type {!Node} */, txn.currentOutputSnapshotRaw);\r\n    }\r\n    var dataToSend = snapToSend.val(true);\r\n    var pathToSend = path;\r\n    // Send the put.\r\n    this.server_.put(pathToSend.toString(), dataToSend, function (status) {\r\n        _this.log_('transaction put response', {\r\n            path: pathToSend.toString(),\r\n            status: status\r\n        });\r\n        var events = [];\r\n        if (status === 'ok') {\r\n            // Queue up the callbacks and fire them after cleaning up all of our transaction state, since\r\n            // the callback could trigger more transactions or sets.\r\n            var callbacks = [];\r\n            for (var i = 0; i < queue.length; i++) {\r\n                queue[i].status = TransactionStatus.COMPLETED;\r\n                events = events.concat(_this.serverSyncTree_.ackUserWrite(queue[i].currentWriteId));\r\n                if (queue[i].onComplete) {\r\n                    // We never unset the output snapshot, and given that this transaction is complete, it should be set\r\n                    var node = queue[i].currentOutputSnapshotResolved;\r\n                    var ref = new Reference(_this, queue[i].path);\r\n                    var snapshot = new DataSnapshot(node, ref, PRIORITY_INDEX);\r\n                    callbacks.push(queue[i].onComplete.bind(null, null, true, snapshot));\r\n                }\r\n                queue[i].unwatcher();\r\n            }\r\n            // Now remove the completed transactions.\r\n            _this.pruneCompletedTransactionsBelowNode_(_this.transactionQueueTree_.subTree(path));\r\n            // There may be pending transactions that we can now send.\r\n            _this.sendReadyTransactions_();\r\n            _this.eventQueue_.raiseEventsForChangedPath(path, events);\r\n            // Finally, trigger onComplete callbacks.\r\n            for (var i = 0; i < callbacks.length; i++) {\r\n                exceptionGuard(callbacks[i]);\r\n            }\r\n        }\r\n        else {\r\n            // transactions are no longer sent.  Update their status appropriately.\r\n            if (status === 'datastale') {\r\n                for (var i = 0; i < queue.length; i++) {\r\n                    if (queue[i].status === TransactionStatus.SENT_NEEDS_ABORT)\r\n                        queue[i].status = TransactionStatus.NEEDS_ABORT;\r\n                    else\r\n                        queue[i].status = TransactionStatus.RUN;\r\n                }\r\n            }\r\n            else {\r\n                warn('transaction at ' + pathToSend.toString() + ' failed: ' + status);\r\n                for (var i = 0; i < queue.length; i++) {\r\n                    queue[i].status = TransactionStatus.NEEDS_ABORT;\r\n                    queue[i].abortReason = status;\r\n                }\r\n            }\r\n            _this.rerunTransactions_(path);\r\n        }\r\n    }, latestHash);\r\n};\r\n/**\r\n * Finds all transactions dependent on the data at changedPath and reruns them.\r\n *\r\n * Should be called any time cached data changes.\r\n *\r\n * Return the highest path that was affected by rerunning transactions.  This is the path at which events need to\r\n * be raised for.\r\n *\r\n * @param {!Path} changedPath The path in mergedData that changed.\r\n * @return {!Path} The rootmost path that was affected by rerunning transactions.\r\n * @private\r\n */\r\nRepo.prototype.rerunTransactions_ = function (changedPath) {\r\n    var rootMostTransactionNode = this.getAncestorTransactionNode_(changedPath);\r\n    var path = rootMostTransactionNode.path();\r\n    var queue = this.buildTransactionQueue_(rootMostTransactionNode);\r\n    this.rerunTransactionQueue_(queue, path);\r\n    return path;\r\n};\r\n/**\r\n * Does all the work of rerunning transactions (as well as cleans up aborted transactions and whatnot).\r\n *\r\n * @param {Array.<Transaction>} queue The queue of transactions to run.\r\n * @param {!Path} path The path the queue is for.\r\n * @private\r\n */\r\nRepo.prototype.rerunTransactionQueue_ = function (queue, path) {\r\n    if (queue.length === 0) {\r\n        return; // Nothing to do!\r\n    }\r\n    // Queue up the callbacks and fire them after cleaning up all of our transaction state, since\r\n    // the callback could trigger more transactions or sets.\r\n    var callbacks = [];\r\n    var events = [];\r\n    // Ignore all of the sets we're going to re-run.\r\n    var txnsToRerun = queue.filter(function (q) {\r\n        return q.status === TransactionStatus.RUN;\r\n    });\r\n    var setsToIgnore = txnsToRerun.map(function (q) {\r\n        return q.currentWriteId;\r\n    });\r\n    for (var i = 0; i < queue.length; i++) {\r\n        var transaction = queue[i];\r\n        var relativePath = Path.relativePath(path, transaction.path);\r\n        var abortTransaction = false, abortReason = void 0;\r\n        assert(relativePath !== null, 'rerunTransactionsUnderNode_: relativePath should not be null.');\r\n        if (transaction.status === TransactionStatus.NEEDS_ABORT) {\r\n            abortTransaction = true;\r\n            abortReason = transaction.abortReason;\r\n            events = events.concat(this.serverSyncTree_.ackUserWrite(transaction.currentWriteId, true));\r\n        }\r\n        else if (transaction.status === TransactionStatus.RUN) {\r\n            if (transaction.retryCount >= Repo.MAX_TRANSACTION_RETRIES_) {\r\n                abortTransaction = true;\r\n                abortReason = 'maxretry';\r\n                events = events.concat(this.serverSyncTree_.ackUserWrite(transaction.currentWriteId, true));\r\n            }\r\n            else {\r\n                // This code reruns a transaction\r\n                var currentNode = this.getLatestState_(transaction.path, setsToIgnore);\r\n                transaction.currentInputSnapshot = currentNode;\r\n                var newData = queue[i].update(currentNode.val());\r\n                if (newData !== undefined) {\r\n                    validateFirebaseData('transaction failed: Data returned ', newData, transaction.path);\r\n                    var newDataNode = nodeFromJSON$1(newData);\r\n                    var hasExplicitPriority = typeof newData === 'object' &&\r\n                        newData != null &&\r\n                        contains(newData, '.priority');\r\n                    if (!hasExplicitPriority) {\r\n                        // Keep the old priority if there wasn't a priority explicitly specified.\r\n                        newDataNode = newDataNode.updatePriority(currentNode.getPriority());\r\n                    }\r\n                    var oldWriteId = transaction.currentWriteId;\r\n                    var serverValues = this.generateServerValues();\r\n                    var newNodeResolved = resolveDeferredValueSnapshot(newDataNode, serverValues);\r\n                    transaction.currentOutputSnapshotRaw = newDataNode;\r\n                    transaction.currentOutputSnapshotResolved = newNodeResolved;\r\n                    transaction.currentWriteId = this.getNextWriteId_();\r\n                    // Mutates setsToIgnore in place\r\n                    setsToIgnore.splice(setsToIgnore.indexOf(oldWriteId), 1);\r\n                    events = events.concat(this.serverSyncTree_.applyUserOverwrite(transaction.path, newNodeResolved, transaction.currentWriteId, transaction.applyLocally));\r\n                    events = events.concat(this.serverSyncTree_.ackUserWrite(oldWriteId, true));\r\n                }\r\n                else {\r\n                    abortTransaction = true;\r\n                    abortReason = 'nodata';\r\n                    events = events.concat(this.serverSyncTree_.ackUserWrite(transaction.currentWriteId, true));\r\n                }\r\n            }\r\n        }\r\n        this.eventQueue_.raiseEventsForChangedPath(path, events);\r\n        events = [];\r\n        if (abortTransaction) {\r\n            // Abort.\r\n            queue[i].status = TransactionStatus.COMPLETED;\r\n            // Removing a listener can trigger pruning which can muck with mergedData/visibleData (as it prunes data).\r\n            // So defer the unwatcher until we're done.\r\n            (function (unwatcher) {\r\n                setTimeout(unwatcher, Math.floor(0));\r\n            })(queue[i].unwatcher);\r\n            if (queue[i].onComplete) {\r\n                if (abortReason === 'nodata') {\r\n                    var ref = new Reference(this, queue[i].path);\r\n                    // We set this field immediately, so it's safe to cast to an actual snapshot\r\n                    var lastInput /** @type {!Node} */ = queue[i].currentInputSnapshot;\r\n                    var snapshot = new DataSnapshot(lastInput, ref, PRIORITY_INDEX);\r\n                    callbacks.push(queue[i].onComplete.bind(null, null, false, snapshot));\r\n                }\r\n                else {\r\n                    callbacks.push(queue[i].onComplete.bind(null, new Error(abortReason), false, null));\r\n                }\r\n            }\r\n        }\r\n    }\r\n    // Clean up completed transactions.\r\n    this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);\r\n    // Now fire callbacks, now that we're in a good, known state.\r\n    for (var i = 0; i < callbacks.length; i++) {\r\n        exceptionGuard(callbacks[i]);\r\n    }\r\n    // Try to send the transaction result to the server.\r\n    this.sendReadyTransactions_();\r\n};\r\n/**\r\n * Returns the rootmost ancestor node of the specified path that has a pending transaction on it, or just returns\r\n * the node for the given path if there are no pending transactions on any ancestor.\r\n *\r\n * @param {!Path} path The location to start at.\r\n * @return {!Tree.<Array.<!Transaction>>} The rootmost node with a transaction.\r\n * @private\r\n */\r\nRepo.prototype.getAncestorTransactionNode_ = function (path) {\r\n    var front;\r\n    // Start at the root and walk deeper into the tree towards path until we find a node with pending transactions.\r\n    var transactionNode = this.transactionQueueTree_;\r\n    while ((front = path.getFront()) !== null &&\r\n        transactionNode.getValue() === null) {\r\n        transactionNode = transactionNode.subTree(front);\r\n        path = path.popFront();\r\n    }\r\n    return transactionNode;\r\n};\r\n/**\r\n * Builds the queue of all transactions at or below the specified transactionNode.\r\n *\r\n * @param {!Tree.<Array.<Transaction>>} transactionNode\r\n * @return {Array.<Transaction>} The generated queue.\r\n * @private\r\n */\r\nRepo.prototype.buildTransactionQueue_ = function (transactionNode) {\r\n    // Walk any child transaction queues and aggregate them into a single queue.\r\n    var transactionQueue = [];\r\n    this.aggregateTransactionQueuesForNode_(transactionNode, transactionQueue);\r\n    // Sort them by the order the transactions were created.\r\n    transactionQueue.sort(function (a, b) {\r\n        return a.order - b.order;\r\n    });\r\n    return transactionQueue;\r\n};\r\n/**\r\n * @param {!Tree.<Array.<Transaction>>} node\r\n * @param {Array.<Transaction>} queue\r\n * @private\r\n */\r\nRepo.prototype.aggregateTransactionQueuesForNode_ = function (node, queue) {\r\n    var _this = this;\r\n    var nodeQueue = node.getValue();\r\n    if (nodeQueue !== null) {\r\n        for (var i = 0; i < nodeQueue.length; i++) {\r\n            queue.push(nodeQueue[i]);\r\n        }\r\n    }\r\n    node.forEachChild(function (child) {\r\n        _this.aggregateTransactionQueuesForNode_(child, queue);\r\n    });\r\n};\r\n/**\r\n * Remove COMPLETED transactions at or below this node in the transactionQueueTree_.\r\n *\r\n * @param {!Tree.<Array.<!Transaction>>} node\r\n * @private\r\n */\r\nRepo.prototype.pruneCompletedTransactionsBelowNode_ = function (node) {\r\n    var _this = this;\r\n    var queue = node.getValue();\r\n    if (queue) {\r\n        var to = 0;\r\n        for (var from = 0; from < queue.length; from++) {\r\n            if (queue[from].status !== TransactionStatus.COMPLETED) {\r\n                queue[to] = queue[from];\r\n                to++;\r\n            }\r\n        }\r\n        queue.length = to;\r\n        node.setValue(queue.length > 0 ? queue : null);\r\n    }\r\n    node.forEachChild(function (childNode) {\r\n        _this.pruneCompletedTransactionsBelowNode_(childNode);\r\n    });\r\n};\r\n/**\r\n * Aborts all transactions on ancestors or descendants of the specified path.  Called when doing a set() or update()\r\n * since we consider them incompatible with transactions.\r\n *\r\n * @param {!Path} path Path for which we want to abort related transactions.\r\n * @return {!Path}\r\n * @private\r\n */\r\nRepo.prototype.abortTransactions_ = function (path) {\r\n    var _this = this;\r\n    var affectedPath = this.getAncestorTransactionNode_(path).path();\r\n    var transactionNode = this.transactionQueueTree_.subTree(path);\r\n    transactionNode.forEachAncestor(function (node) {\r\n        _this.abortTransactionsOnNode_(node);\r\n    });\r\n    this.abortTransactionsOnNode_(transactionNode);\r\n    transactionNode.forEachDescendant(function (node) {\r\n        _this.abortTransactionsOnNode_(node);\r\n    });\r\n    return affectedPath;\r\n};\r\n/**\r\n * Abort transactions stored in this transaction queue node.\r\n *\r\n * @param {!Tree.<Array.<Transaction>>} node Node to abort transactions for.\r\n * @private\r\n */\r\nRepo.prototype.abortTransactionsOnNode_ = function (node) {\r\n    var queue = node.getValue();\r\n    if (queue !== null) {\r\n        // Queue up the callbacks and fire them after cleaning up all of our transaction state, since\r\n        // the callback could trigger more transactions or sets.\r\n        var callbacks = [];\r\n        // Go through queue.  Any already-sent transactions must be marked for abort, while the unsent ones\r\n        // can be immediately aborted and removed.\r\n        var events = [];\r\n        var lastSent = -1;\r\n        for (var i = 0; i < queue.length; i++) {\r\n            if (queue[i].status === TransactionStatus.SENT_NEEDS_ABORT) {\r\n                // Already marked.  No action needed.\r\n            }\r\n            else if (queue[i].status === TransactionStatus.SENT) {\r\n                assert(lastSent === i - 1, 'All SENT items should be at beginning of queue.');\r\n                lastSent = i;\r\n                // Mark transaction for abort when it comes back.\r\n                queue[i].status = TransactionStatus.SENT_NEEDS_ABORT;\r\n                queue[i].abortReason = 'set';\r\n            }\r\n            else {\r\n                assert(queue[i].status === TransactionStatus.RUN, 'Unexpected transaction status in abort');\r\n                // We can abort it immediately.\r\n                queue[i].unwatcher();\r\n                events = events.concat(this.serverSyncTree_.ackUserWrite(queue[i].currentWriteId, true));\r\n                if (queue[i].onComplete) {\r\n                    var snapshot = null;\r\n                    callbacks.push(queue[i].onComplete.bind(null, new Error('set'), false, snapshot));\r\n                }\r\n            }\r\n        }\r\n        if (lastSent === -1) {\r\n            // We're not waiting for any sent transactions.  We can clear the queue.\r\n            node.setValue(null);\r\n        }\r\n        else {\r\n            // Remove the transactions we aborted.\r\n            queue.length = lastSent + 1;\r\n        }\r\n        // Now fire the callbacks.\r\n        this.eventQueue_.raiseEventsForChangedPath(node.path(), events);\r\n        for (var i = 0; i < callbacks.length; i++) {\r\n            exceptionGuard(callbacks[i]);\r\n        }\r\n    }\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** @const {string} */\r\nvar DATABASE_URL_OPTION = 'databaseURL';\r\nvar _staticInstance;\r\n/**\r\n * Creates and caches Repo instances.\r\n */\r\nvar RepoManager = /** @class */ (function () {\r\n    function RepoManager() {\r\n        /**\r\n         * @private {!Object.<string, Object<string, !fb.core.Repo>>}\r\n         */\r\n        this.repos_ = {};\r\n        /**\r\n         * If true, new Repos will be created to use ReadonlyRestClient (for testing purposes).\r\n         * @private {boolean}\r\n         */\r\n        this.useRestClient_ = false;\r\n    }\r\n    RepoManager.getInstance = function () {\r\n        if (!_staticInstance) {\r\n            _staticInstance = new RepoManager();\r\n        }\r\n        return _staticInstance;\r\n    };\r\n    // TODO(koss): Remove these functions unless used in tests?\r\n    RepoManager.prototype.interrupt = function () {\r\n        for (var appName in this.repos_) {\r\n            for (var dbUrl in this.repos_[appName]) {\r\n                this.repos_[appName][dbUrl].interrupt();\r\n            }\r\n        }\r\n    };\r\n    RepoManager.prototype.resume = function () {\r\n        for (var appName in this.repos_) {\r\n            for (var dbUrl in this.repos_[appName]) {\r\n                this.repos_[appName][dbUrl].resume();\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * This function should only ever be called to CREATE a new database instance.\r\n     *\r\n     * @param {!FirebaseApp} app\r\n     * @return {!Database}\r\n     */\r\n    RepoManager.prototype.databaseFromApp = function (app, url) {\r\n        var dbUrl = url || app.options[DATABASE_URL_OPTION];\r\n        if (dbUrl === undefined) {\r\n            fatal(\"Can't determine Firebase Database URL.  Be sure to include \" +\r\n                DATABASE_URL_OPTION +\r\n                ' option when calling firebase.initializeApp().');\r\n        }\r\n        var parsedUrl = parseRepoInfo(dbUrl);\r\n        var repoInfo = parsedUrl.repoInfo;\r\n        validateUrl('Invalid Firebase Database URL', 1, parsedUrl);\r\n        if (!parsedUrl.path.isEmpty()) {\r\n            fatal('Database URL must point to the root of a Firebase Database ' +\r\n                '(not including a child path).');\r\n        }\r\n        var repo = this.createRepo(repoInfo, app);\r\n        return repo.database;\r\n    };\r\n    /**\r\n     * Remove the repo and make sure it is disconnected.\r\n     *\r\n     * @param {!Repo} repo\r\n     */\r\n    RepoManager.prototype.deleteRepo = function (repo) {\r\n        var appRepos = safeGet(this.repos_, repo.app.name);\r\n        // This should never happen...\r\n        if (!appRepos || safeGet(appRepos, repo.repoInfo_.toURLString()) !== repo) {\r\n            fatal(\"Database \" + repo.app.name + \"(\" + repo.repoInfo_ + \") has already been deleted.\");\r\n        }\r\n        repo.interrupt();\r\n        delete appRepos[repo.repoInfo_.toURLString()];\r\n    };\r\n    /**\r\n     * Ensures a repo doesn't already exist and then creates one using the\r\n     * provided app.\r\n     *\r\n     * @param {!RepoInfo} repoInfo The metadata about the Repo\r\n     * @param {!FirebaseApp} app\r\n     * @return {!Repo} The Repo object for the specified server / repoName.\r\n     */\r\n    RepoManager.prototype.createRepo = function (repoInfo, app) {\r\n        var appRepos = safeGet(this.repos_, app.name);\r\n        if (!appRepos) {\r\n            appRepos = {};\r\n            this.repos_[app.name] = appRepos;\r\n        }\r\n        var repo = safeGet(appRepos, repoInfo.toURLString());\r\n        if (repo) {\r\n            fatal('Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.');\r\n        }\r\n        repo = new Repo(repoInfo, this.useRestClient_, app);\r\n        appRepos[repoInfo.toURLString()] = repo;\r\n        return repo;\r\n    };\r\n    /**\r\n     * Forces us to use ReadonlyRestClient instead of PersistentConnection for new Repos.\r\n     * @param {boolean} forceRestClient\r\n     */\r\n    RepoManager.prototype.forceRestClient = function (forceRestClient) {\r\n        this.useRestClient_ = forceRestClient;\r\n    };\r\n    return RepoManager;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Class representing a firebase database.\r\n * @implements {FirebaseService}\r\n */\r\nvar Database = /** @class */ (function () {\r\n    /**\r\n     * The constructor should not be called by users of our public API.\r\n     * @param {!Repo} repo_\r\n     */\r\n    function Database(repo_) {\r\n        this.repo_ = repo_;\r\n        if (!(repo_ instanceof Repo)) {\r\n            fatal(\"Don't call new Database() directly - please use firebase.database().\");\r\n        }\r\n        /** @type {Reference} */\r\n        this.root_ = new Reference(repo_, Path.Empty);\r\n        this.INTERNAL = new DatabaseInternals(this);\r\n    }\r\n    Object.defineProperty(Database.prototype, \"app\", {\r\n        get: function () {\r\n            return this.repo_.app;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Database.prototype.ref = function (path) {\r\n        this.checkDeleted_('ref');\r\n        validateArgCount('database.ref', 0, 1, arguments.length);\r\n        if (path instanceof Reference) {\r\n            return this.refFromURL(path.toString());\r\n        }\r\n        return path !== undefined ? this.root_.child(path) : this.root_;\r\n    };\r\n    /**\r\n     * Returns a reference to the root or the path specified in url.\r\n     * We throw a exception if the url is not in the same domain as the\r\n     * current repo.\r\n     * @param {string} url\r\n     * @return {!Reference} Firebase reference.\r\n     */\r\n    Database.prototype.refFromURL = function (url) {\r\n        /** @const {string} */\r\n        var apiName = 'database.refFromURL';\r\n        this.checkDeleted_(apiName);\r\n        validateArgCount(apiName, 1, 1, arguments.length);\r\n        var parsedURL = parseRepoInfo(url);\r\n        validateUrl(apiName, 1, parsedURL);\r\n        var repoInfo = parsedURL.repoInfo;\r\n        if (repoInfo.host !== this.repo_.repoInfo_.host) {\r\n            fatal(apiName +\r\n                ': Host name does not match the current database: ' +\r\n                '(found ' +\r\n                repoInfo.host +\r\n                ' but expected ' +\r\n                this.repo_.repoInfo_.host +\r\n                ')');\r\n        }\r\n        return this.ref(parsedURL.path.toString());\r\n    };\r\n    /**\r\n     * @param {string} apiName\r\n     */\r\n    Database.prototype.checkDeleted_ = function (apiName) {\r\n        if (this.repo_ === null) {\r\n            fatal('Cannot call ' + apiName + ' on a deleted database.');\r\n        }\r\n    };\r\n    // Make individual repo go offline.\r\n    Database.prototype.goOffline = function () {\r\n        validateArgCount('database.goOffline', 0, 0, arguments.length);\r\n        this.checkDeleted_('goOffline');\r\n        this.repo_.interrupt();\r\n    };\r\n    Database.prototype.goOnline = function () {\r\n        validateArgCount('database.goOnline', 0, 0, arguments.length);\r\n        this.checkDeleted_('goOnline');\r\n        this.repo_.resume();\r\n    };\r\n    Database.ServerValue = {\r\n        TIMESTAMP: {\r\n            '.sv': 'timestamp'\r\n        }\r\n    };\r\n    return Database;\r\n}());\r\nvar DatabaseInternals = /** @class */ (function () {\r\n    /** @param {!Database} database */\r\n    function DatabaseInternals(database) {\r\n        this.database = database;\r\n    }\r\n    /** @return {Promise<void>} */\r\n    DatabaseInternals.prototype.delete = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                this.database.checkDeleted_('delete');\r\n                RepoManager.getInstance().deleteRepo(this.database.repo_);\r\n                this.database.repo_ = null;\r\n                this.database.root_ = null;\r\n                this.database.INTERNAL = null;\r\n                this.database = null;\r\n                return [2 /*return*/];\r\n            });\r\n        });\r\n    };\r\n    return DatabaseInternals;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * INTERNAL methods for internal-use only (tests, etc.).\r\n *\r\n * Customers shouldn't use these or else should be aware that they could break at any time.\r\n *\r\n * @const\r\n */\r\nvar forceLongPolling = function () {\r\n    WebSocketConnection.forceDisallow();\r\n    BrowserPollConnection.forceAllow();\r\n};\r\nvar forceWebSockets = function () {\r\n    BrowserPollConnection.forceDisallow();\r\n};\r\n/* Used by App Manager */\r\nvar isWebSocketsAvailable = function () {\r\n    return WebSocketConnection['isAvailable']();\r\n};\r\nvar setSecurityDebugCallback = function (ref, callback) {\r\n    ref.repo.persistentConnection_.securityDebugCallback_ = callback;\r\n};\r\nvar stats = function (ref, showDelta) {\r\n    ref.repo.stats(showDelta);\r\n};\r\nvar statsIncrementCounter = function (ref, metric) {\r\n    ref.repo.statsIncrementCounter(metric);\r\n};\r\nvar dataUpdateCount = function (ref) {\r\n    return ref.repo.dataUpdateCount;\r\n};\r\nvar interceptServerData = function (ref, callback) {\r\n    return ref.repo.interceptServerData_(callback);\r\n};\n\nvar INTERNAL = /*#__PURE__*/Object.freeze({\n  forceLongPolling: forceLongPolling,\n  forceWebSockets: forceWebSockets,\n  isWebSocketsAvailable: isWebSocketsAvailable,\n  setSecurityDebugCallback: setSecurityDebugCallback,\n  stats: stats,\n  statsIncrementCounter: statsIncrementCounter,\n  dataUpdateCount: dataUpdateCount,\n  interceptServerData: interceptServerData\n});\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DataConnection = PersistentConnection;\r\n/**\r\n * @param {!string} pathString\r\n * @param {function(*)} onComplete\r\n */\r\nPersistentConnection.prototype.simpleListen = function (pathString, onComplete) {\r\n    this.sendRequest('q', { p: pathString }, onComplete);\r\n};\r\n/**\r\n * @param {*} data\r\n * @param {function(*)} onEcho\r\n */\r\nPersistentConnection.prototype.echo = function (data, onEcho) {\r\n    this.sendRequest('echo', { d: data }, onEcho);\r\n};\r\n// RealTimeConnection properties that we use in tests.\r\nvar RealTimeConnection = Connection;\r\n/**\r\n * @param {function(): string} newHash\r\n * @return {function()}\r\n */\r\nvar hijackHash = function (newHash) {\r\n    var oldPut = PersistentConnection.prototype.put;\r\n    PersistentConnection.prototype.put = function (pathString, data, opt_onComplete, opt_hash) {\r\n        if (opt_hash !== undefined) {\r\n            opt_hash = newHash();\r\n        }\r\n        oldPut.call(this, pathString, data, opt_onComplete, opt_hash);\r\n    };\r\n    return function () {\r\n        PersistentConnection.prototype.put = oldPut;\r\n    };\r\n};\r\n/**\r\n * @type {function(new:RepoInfo, !string, boolean, !string, boolean): undefined}\r\n */\r\nvar ConnectionTarget = RepoInfo;\r\n/**\r\n * @param {!Query} query\r\n * @return {!string}\r\n */\r\nvar queryIdentifier = function (query) {\r\n    return query.queryIdentifier();\r\n};\r\n/**\r\n * @param {!Query} firebaseRef\r\n * @return {!Object}\r\n */\r\nvar listens = function (firebaseRef) {\r\n    return firebaseRef.repo.persistentConnection_.listens_;\r\n};\r\n/**\r\n * Forces the RepoManager to create Repos that use ReadonlyRestClient instead of PersistentConnection.\r\n *\r\n * @param {boolean} forceRestClient\r\n */\r\nvar forceRestClient = function (forceRestClient) {\r\n    RepoManager.getInstance().forceRestClient(forceRestClient);\r\n};\n\nvar TEST_ACCESS = /*#__PURE__*/Object.freeze({\n  DataConnection: DataConnection,\n  RealTimeConnection: RealTimeConnection,\n  hijackHash: hijackHash,\n  ConnectionTarget: ConnectionTarget,\n  queryIdentifier: queryIdentifier,\n  listens: listens,\n  forceRestClient: forceRestClient\n});\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar ServerValue = Database.ServerValue;\r\nfunction registerDatabase(instance) {\r\n    // Register the Database Service with the 'firebase' namespace.\r\n    var namespace = instance.INTERNAL.registerService('database', function (app, unused, url) { return RepoManager.getInstance().databaseFromApp(app, url); }, \r\n    // firebase.database namespace properties\r\n    {\r\n        Reference: Reference,\r\n        Query: Query,\r\n        Database: Database,\r\n        enableLogging: enableLogging,\r\n        INTERNAL: INTERNAL,\r\n        ServerValue: ServerValue,\r\n        TEST_ACCESS: TEST_ACCESS\r\n    }, null, true);\r\n    if (isNodeSdk()) {\r\n        module.exports = namespace;\r\n    }\r\n}\r\nregisterDatabase(firebase);\n\nexport { registerDatabase, Database, Query, Reference, enableLogging, ServerValue, DataSnapshot, OnDisconnect };\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/@firebase/database/dist/index.esm.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./assets/style.css\n// module id = cbDw\n// module chunks = 0","module.exports = function(originalModule) {\r\n\tif(!originalModule.webpackPolyfill) {\r\n\t\tvar module = Object.create(originalModule);\r\n\t\t// module.parent = undefined by default\r\n\t\tif(!module.children) module.children = [];\r\n\t\tObject.defineProperty(module, \"loaded\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.l;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(module, \"id\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.i;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(module, \"exports\", {\r\n\t\t\tenumerable: true,\r\n\t\t});\r\n\t\tmodule.webpackPolyfill = 1;\r\n\t}\r\n\treturn module;\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// (webpack)/buildin/harmony-module.js","/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * A container for all of the Logger instances\r\n */\r\nvar instances = [];\r\n/**\r\n * The JS SDK supports 5 log levels and also allows a user the ability to\r\n * silence the logs altogether.\r\n *\r\n * The order is a follows:\r\n * DEBUG < VERBOSE < INFO < WARN < ERROR\r\n *\r\n * All of the log types above the current log level will be captured (i.e. if\r\n * you set the log level to `INFO`, errors will still be logged, but `DEBUG` and\r\n * `VERBOSE` logs will not)\r\n */\r\nvar LogLevel;\r\n(function (LogLevel) {\r\n    LogLevel[LogLevel[\"DEBUG\"] = 0] = \"DEBUG\";\r\n    LogLevel[LogLevel[\"VERBOSE\"] = 1] = \"VERBOSE\";\r\n    LogLevel[LogLevel[\"INFO\"] = 2] = \"INFO\";\r\n    LogLevel[LogLevel[\"WARN\"] = 3] = \"WARN\";\r\n    LogLevel[LogLevel[\"ERROR\"] = 4] = \"ERROR\";\r\n    LogLevel[LogLevel[\"SILENT\"] = 5] = \"SILENT\";\r\n})(LogLevel || (LogLevel = {}));\r\n/**\r\n * The default log level\r\n */\r\nvar defaultLogLevel = LogLevel.INFO;\r\n/**\r\n * The default log handler will forward DEBUG, VERBOSE, INFO, WARN, and ERROR\r\n * messages on to their corresponding console counterparts (if the log method\r\n * is supported by the current log level)\r\n */\r\nvar defaultLogHandler = function (instance, logType) {\r\n    var args = [];\r\n    for (var _i = 2; _i < arguments.length; _i++) {\r\n        args[_i - 2] = arguments[_i];\r\n    }\r\n    if (logType < instance.logLevel)\r\n        return;\r\n    var now = new Date().toISOString();\r\n    switch (logType) {\r\n        /**\r\n         * By default, `console.debug` is not displayed in the developer console (in\r\n         * chrome). To avoid forcing users to have to opt-in to these logs twice\r\n         * (i.e. once for firebase, and once in the console), we are sending `DEBUG`\r\n         * logs to the `console.log` function.\r\n         */\r\n        case LogLevel.DEBUG:\r\n            console.log.apply(console, [\"[\" + now + \"]  \" + instance.name + \":\"].concat(args));\r\n            break;\r\n        case LogLevel.VERBOSE:\r\n            console.log.apply(console, [\"[\" + now + \"]  \" + instance.name + \":\"].concat(args));\r\n            break;\r\n        case LogLevel.INFO:\r\n            console.info.apply(console, [\"[\" + now + \"]  \" + instance.name + \":\"].concat(args));\r\n            break;\r\n        case LogLevel.WARN:\r\n            console.warn.apply(console, [\"[\" + now + \"]  \" + instance.name + \":\"].concat(args));\r\n            break;\r\n        case LogLevel.ERROR:\r\n            console.error.apply(console, [\"[\" + now + \"]  \" + instance.name + \":\"].concat(args));\r\n            break;\r\n        default:\r\n            throw new Error(\"Attempted to log a message with an invalid logType (value: \" + logType + \")\");\r\n    }\r\n};\r\nvar Logger = /** @class */ (function () {\r\n    /**\r\n     * Gives you an instance of a Logger to capture messages according to\r\n     * Firebase's logging scheme.\r\n     *\r\n     * @param name The name that the logs will be associated with\r\n     */\r\n    function Logger(name) {\r\n        this.name = name;\r\n        /**\r\n         * The log level of the given Logger instance.\r\n         */\r\n        this._logLevel = defaultLogLevel;\r\n        /**\r\n         * The log handler for the Logger instance.\r\n         */\r\n        this._logHandler = defaultLogHandler;\r\n        /**\r\n         * Capture the current instance for later use\r\n         */\r\n        instances.push(this);\r\n    }\r\n    Object.defineProperty(Logger.prototype, \"logLevel\", {\r\n        get: function () {\r\n            return this._logLevel;\r\n        },\r\n        set: function (val) {\r\n            if (!(val in LogLevel)) {\r\n                throw new TypeError('Invalid value assigned to `logLevel`');\r\n            }\r\n            this._logLevel = val;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Logger.prototype, \"logHandler\", {\r\n        get: function () {\r\n            return this._logHandler;\r\n        },\r\n        set: function (val) {\r\n            if (typeof val !== 'function') {\r\n                throw new TypeError('Value assigned to `logHandler` must be a function');\r\n            }\r\n            this._logHandler = val;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * The functions below are all based on the `console` interface\r\n     */\r\n    Logger.prototype.debug = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._logHandler.apply(this, [this, LogLevel.DEBUG].concat(args));\r\n    };\r\n    Logger.prototype.log = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._logHandler.apply(this, [this, LogLevel.VERBOSE].concat(args));\r\n    };\r\n    Logger.prototype.info = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._logHandler.apply(this, [this, LogLevel.INFO].concat(args));\r\n    };\r\n    Logger.prototype.warn = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._logHandler.apply(this, [this, LogLevel.WARN].concat(args));\r\n    };\r\n    Logger.prototype.error = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._logHandler.apply(this, [this, LogLevel.ERROR].concat(args));\r\n    };\r\n    return Logger;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction setLogLevel(level) {\r\n    instances.forEach(function (inst) {\r\n        inst.logLevel = level;\r\n    });\r\n}\n\nexport { setLogLevel, Logger, LogLevel };\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/@firebase/logger/dist/index.esm.js","(function(self) {\n  'use strict';\n\n  if (self.fetch) {\n    return\n  }\n\n  var support = {\n    searchParams: 'URLSearchParams' in self,\n    iterable: 'Symbol' in self && 'iterator' in Symbol,\n    blob: 'FileReader' in self && 'Blob' in self && (function() {\n      try {\n        new Blob()\n        return true\n      } catch(e) {\n        return false\n      }\n    })(),\n    formData: 'FormData' in self,\n    arrayBuffer: 'ArrayBuffer' in self\n  }\n\n  if (support.arrayBuffer) {\n    var viewClasses = [\n      '[object Int8Array]',\n      '[object Uint8Array]',\n      '[object Uint8ClampedArray]',\n      '[object Int16Array]',\n      '[object Uint16Array]',\n      '[object Int32Array]',\n      '[object Uint32Array]',\n      '[object Float32Array]',\n      '[object Float64Array]'\n    ]\n\n    var isDataView = function(obj) {\n      return obj && DataView.prototype.isPrototypeOf(obj)\n    }\n\n    var isArrayBufferView = ArrayBuffer.isView || function(obj) {\n      return obj && viewClasses.indexOf(Object.prototype.toString.call(obj)) > -1\n    }\n  }\n\n  function normalizeName(name) {\n    if (typeof name !== 'string') {\n      name = String(name)\n    }\n    if (/[^a-z0-9\\-#$%&'*+.\\^_`|~]/i.test(name)) {\n      throw new TypeError('Invalid character in header field name')\n    }\n    return name.toLowerCase()\n  }\n\n  function normalizeValue(value) {\n    if (typeof value !== 'string') {\n      value = String(value)\n    }\n    return value\n  }\n\n  // Build a destructive iterator for the value list\n  function iteratorFor(items) {\n    var iterator = {\n      next: function() {\n        var value = items.shift()\n        return {done: value === undefined, value: value}\n      }\n    }\n\n    if (support.iterable) {\n      iterator[Symbol.iterator] = function() {\n        return iterator\n      }\n    }\n\n    return iterator\n  }\n\n  function Headers(headers) {\n    this.map = {}\n\n    if (headers instanceof Headers) {\n      headers.forEach(function(value, name) {\n        this.append(name, value)\n      }, this)\n    } else if (Array.isArray(headers)) {\n      headers.forEach(function(header) {\n        this.append(header[0], header[1])\n      }, this)\n    } else if (headers) {\n      Object.getOwnPropertyNames(headers).forEach(function(name) {\n        this.append(name, headers[name])\n      }, this)\n    }\n  }\n\n  Headers.prototype.append = function(name, value) {\n    name = normalizeName(name)\n    value = normalizeValue(value)\n    var oldValue = this.map[name]\n    this.map[name] = oldValue ? oldValue+','+value : value\n  }\n\n  Headers.prototype['delete'] = function(name) {\n    delete this.map[normalizeName(name)]\n  }\n\n  Headers.prototype.get = function(name) {\n    name = normalizeName(name)\n    return this.has(name) ? this.map[name] : null\n  }\n\n  Headers.prototype.has = function(name) {\n    return this.map.hasOwnProperty(normalizeName(name))\n  }\n\n  Headers.prototype.set = function(name, value) {\n    this.map[normalizeName(name)] = normalizeValue(value)\n  }\n\n  Headers.prototype.forEach = function(callback, thisArg) {\n    for (var name in this.map) {\n      if (this.map.hasOwnProperty(name)) {\n        callback.call(thisArg, this.map[name], name, this)\n      }\n    }\n  }\n\n  Headers.prototype.keys = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push(name) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.values = function() {\n    var items = []\n    this.forEach(function(value) { items.push(value) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.entries = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push([name, value]) })\n    return iteratorFor(items)\n  }\n\n  if (support.iterable) {\n    Headers.prototype[Symbol.iterator] = Headers.prototype.entries\n  }\n\n  function consumed(body) {\n    if (body.bodyUsed) {\n      return Promise.reject(new TypeError('Already read'))\n    }\n    body.bodyUsed = true\n  }\n\n  function fileReaderReady(reader) {\n    return new Promise(function(resolve, reject) {\n      reader.onload = function() {\n        resolve(reader.result)\n      }\n      reader.onerror = function() {\n        reject(reader.error)\n      }\n    })\n  }\n\n  function readBlobAsArrayBuffer(blob) {\n    var reader = new FileReader()\n    var promise = fileReaderReady(reader)\n    reader.readAsArrayBuffer(blob)\n    return promise\n  }\n\n  function readBlobAsText(blob) {\n    var reader = new FileReader()\n    var promise = fileReaderReady(reader)\n    reader.readAsText(blob)\n    return promise\n  }\n\n  function readArrayBufferAsText(buf) {\n    var view = new Uint8Array(buf)\n    var chars = new Array(view.length)\n\n    for (var i = 0; i < view.length; i++) {\n      chars[i] = String.fromCharCode(view[i])\n    }\n    return chars.join('')\n  }\n\n  function bufferClone(buf) {\n    if (buf.slice) {\n      return buf.slice(0)\n    } else {\n      var view = new Uint8Array(buf.byteLength)\n      view.set(new Uint8Array(buf))\n      return view.buffer\n    }\n  }\n\n  function Body() {\n    this.bodyUsed = false\n\n    this._initBody = function(body) {\n      this._bodyInit = body\n      if (!body) {\n        this._bodyText = ''\n      } else if (typeof body === 'string') {\n        this._bodyText = body\n      } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n        this._bodyBlob = body\n      } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n        this._bodyFormData = body\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this._bodyText = body.toString()\n      } else if (support.arrayBuffer && support.blob && isDataView(body)) {\n        this._bodyArrayBuffer = bufferClone(body.buffer)\n        // IE 10-11 can't handle a DataView body.\n        this._bodyInit = new Blob([this._bodyArrayBuffer])\n      } else if (support.arrayBuffer && (ArrayBuffer.prototype.isPrototypeOf(body) || isArrayBufferView(body))) {\n        this._bodyArrayBuffer = bufferClone(body)\n      } else {\n        throw new Error('unsupported BodyInit type')\n      }\n\n      if (!this.headers.get('content-type')) {\n        if (typeof body === 'string') {\n          this.headers.set('content-type', 'text/plain;charset=UTF-8')\n        } else if (this._bodyBlob && this._bodyBlob.type) {\n          this.headers.set('content-type', this._bodyBlob.type)\n        } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n          this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8')\n        }\n      }\n    }\n\n    if (support.blob) {\n      this.blob = function() {\n        var rejected = consumed(this)\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return Promise.resolve(this._bodyBlob)\n        } else if (this._bodyArrayBuffer) {\n          return Promise.resolve(new Blob([this._bodyArrayBuffer]))\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as blob')\n        } else {\n          return Promise.resolve(new Blob([this._bodyText]))\n        }\n      }\n\n      this.arrayBuffer = function() {\n        if (this._bodyArrayBuffer) {\n          return consumed(this) || Promise.resolve(this._bodyArrayBuffer)\n        } else {\n          return this.blob().then(readBlobAsArrayBuffer)\n        }\n      }\n    }\n\n    this.text = function() {\n      var rejected = consumed(this)\n      if (rejected) {\n        return rejected\n      }\n\n      if (this._bodyBlob) {\n        return readBlobAsText(this._bodyBlob)\n      } else if (this._bodyArrayBuffer) {\n        return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))\n      } else if (this._bodyFormData) {\n        throw new Error('could not read FormData body as text')\n      } else {\n        return Promise.resolve(this._bodyText)\n      }\n    }\n\n    if (support.formData) {\n      this.formData = function() {\n        return this.text().then(decode)\n      }\n    }\n\n    this.json = function() {\n      return this.text().then(JSON.parse)\n    }\n\n    return this\n  }\n\n  // HTTP methods whose capitalization should be normalized\n  var methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT']\n\n  function normalizeMethod(method) {\n    var upcased = method.toUpperCase()\n    return (methods.indexOf(upcased) > -1) ? upcased : method\n  }\n\n  function Request(input, options) {\n    options = options || {}\n    var body = options.body\n\n    if (input instanceof Request) {\n      if (input.bodyUsed) {\n        throw new TypeError('Already read')\n      }\n      this.url = input.url\n      this.credentials = input.credentials\n      if (!options.headers) {\n        this.headers = new Headers(input.headers)\n      }\n      this.method = input.method\n      this.mode = input.mode\n      if (!body && input._bodyInit != null) {\n        body = input._bodyInit\n        input.bodyUsed = true\n      }\n    } else {\n      this.url = String(input)\n    }\n\n    this.credentials = options.credentials || this.credentials || 'omit'\n    if (options.headers || !this.headers) {\n      this.headers = new Headers(options.headers)\n    }\n    this.method = normalizeMethod(options.method || this.method || 'GET')\n    this.mode = options.mode || this.mode || null\n    this.referrer = null\n\n    if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n      throw new TypeError('Body not allowed for GET or HEAD requests')\n    }\n    this._initBody(body)\n  }\n\n  Request.prototype.clone = function() {\n    return new Request(this, { body: this._bodyInit })\n  }\n\n  function decode(body) {\n    var form = new FormData()\n    body.trim().split('&').forEach(function(bytes) {\n      if (bytes) {\n        var split = bytes.split('=')\n        var name = split.shift().replace(/\\+/g, ' ')\n        var value = split.join('=').replace(/\\+/g, ' ')\n        form.append(decodeURIComponent(name), decodeURIComponent(value))\n      }\n    })\n    return form\n  }\n\n  function parseHeaders(rawHeaders) {\n    var headers = new Headers()\n    // Replace instances of \\r\\n and \\n followed by at least one space or horizontal tab with a space\n    // https://tools.ietf.org/html/rfc7230#section-3.2\n    var preProcessedHeaders = rawHeaders.replace(/\\r?\\n[\\t ]+/g, ' ')\n    preProcessedHeaders.split(/\\r?\\n/).forEach(function(line) {\n      var parts = line.split(':')\n      var key = parts.shift().trim()\n      if (key) {\n        var value = parts.join(':').trim()\n        headers.append(key, value)\n      }\n    })\n    return headers\n  }\n\n  Body.call(Request.prototype)\n\n  function Response(bodyInit, options) {\n    if (!options) {\n      options = {}\n    }\n\n    this.type = 'default'\n    this.status = options.status === undefined ? 200 : options.status\n    this.ok = this.status >= 200 && this.status < 300\n    this.statusText = 'statusText' in options ? options.statusText : 'OK'\n    this.headers = new Headers(options.headers)\n    this.url = options.url || ''\n    this._initBody(bodyInit)\n  }\n\n  Body.call(Response.prototype)\n\n  Response.prototype.clone = function() {\n    return new Response(this._bodyInit, {\n      status: this.status,\n      statusText: this.statusText,\n      headers: new Headers(this.headers),\n      url: this.url\n    })\n  }\n\n  Response.error = function() {\n    var response = new Response(null, {status: 0, statusText: ''})\n    response.type = 'error'\n    return response\n  }\n\n  var redirectStatuses = [301, 302, 303, 307, 308]\n\n  Response.redirect = function(url, status) {\n    if (redirectStatuses.indexOf(status) === -1) {\n      throw new RangeError('Invalid status code')\n    }\n\n    return new Response(null, {status: status, headers: {location: url}})\n  }\n\n  self.Headers = Headers\n  self.Request = Request\n  self.Response = Response\n\n  self.fetch = function(input, init) {\n    return new Promise(function(resolve, reject) {\n      var request = new Request(input, init)\n      var xhr = new XMLHttpRequest()\n\n      xhr.onload = function() {\n        var options = {\n          status: xhr.status,\n          statusText: xhr.statusText,\n          headers: parseHeaders(xhr.getAllResponseHeaders() || '')\n        }\n        options.url = 'responseURL' in xhr ? xhr.responseURL : options.headers.get('X-Request-URL')\n        var body = 'response' in xhr ? xhr.response : xhr.responseText\n        resolve(new Response(body, options))\n      }\n\n      xhr.onerror = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.ontimeout = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.open(request.method, request.url, true)\n\n      if (request.credentials === 'include') {\n        xhr.withCredentials = true\n      } else if (request.credentials === 'omit') {\n        xhr.withCredentials = false\n      }\n\n      if ('responseType' in xhr && support.blob) {\n        xhr.responseType = 'blob'\n      }\n\n      request.headers.forEach(function(value, name) {\n        xhr.setRequestHeader(name, value)\n      })\n\n      xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit)\n    })\n  }\n  self.fetch.polyfill = true\n})(typeof self !== 'undefined' ? self : this);\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/whatwg-fetch/fetch.js","import { __extends } from 'tslib';\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @fileoverview Firebase constants.  Some of these (@defines) can be overridden at compile-time.\r\n */\r\nvar CONSTANTS = {\r\n    /**\r\n     * @define {boolean} Whether this is the client Node.js SDK.\r\n     */\r\n    NODE_CLIENT: false,\r\n    /**\r\n     * @define {boolean} Whether this is the Admin Node.js SDK.\r\n     */\r\n    NODE_ADMIN: false,\r\n    /**\r\n     * Firebase SDK Version\r\n     */\r\n    SDK_VERSION: '${JSCORE_VERSION}'\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Throws an error if the provided assertion is falsy\r\n * @param {*} assertion The assertion to be tested for falsiness\r\n * @param {!string} message The message to display if the check fails\r\n */\r\nvar assert = function (assertion, message) {\r\n    if (!assertion) {\r\n        throw assertionError(message);\r\n    }\r\n};\r\n/**\r\n * Returns an Error object suitable for throwing.\r\n * @param {string} message\r\n * @return {!Error}\r\n */\r\nvar assertionError = function (message) {\r\n    return new Error('Firebase Database (' +\r\n        CONSTANTS.SDK_VERSION +\r\n        ') INTERNAL ASSERT FAILED: ' +\r\n        message);\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar stringToByteArray = function (str) {\r\n    // TODO(user): Use native implementations if/when available\r\n    var out = [], p = 0;\r\n    for (var i = 0; i < str.length; i++) {\r\n        var c = str.charCodeAt(i);\r\n        if (c < 128) {\r\n            out[p++] = c;\r\n        }\r\n        else if (c < 2048) {\r\n            out[p++] = (c >> 6) | 192;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else if ((c & 0xfc00) == 0xd800 &&\r\n            i + 1 < str.length &&\r\n            (str.charCodeAt(i + 1) & 0xfc00) == 0xdc00) {\r\n            // Surrogate Pair\r\n            c = 0x10000 + ((c & 0x03ff) << 10) + (str.charCodeAt(++i) & 0x03ff);\r\n            out[p++] = (c >> 18) | 240;\r\n            out[p++] = ((c >> 12) & 63) | 128;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else {\r\n            out[p++] = (c >> 12) | 224;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n    }\r\n    return out;\r\n};\r\n/**\r\n * Turns an array of numbers into the string given by the concatenation of the\r\n * characters to which the numbers correspond.\r\n * @param {Array<number>} bytes Array of numbers representing characters.\r\n * @return {string} Stringification of the array.\r\n */\r\nvar byteArrayToString = function (bytes) {\r\n    // TODO(user): Use native implementations if/when available\r\n    var out = [], pos = 0, c = 0;\r\n    while (pos < bytes.length) {\r\n        var c1 = bytes[pos++];\r\n        if (c1 < 128) {\r\n            out[c++] = String.fromCharCode(c1);\r\n        }\r\n        else if (c1 > 191 && c1 < 224) {\r\n            var c2 = bytes[pos++];\r\n            out[c++] = String.fromCharCode(((c1 & 31) << 6) | (c2 & 63));\r\n        }\r\n        else if (c1 > 239 && c1 < 365) {\r\n            // Surrogate Pair\r\n            var c2 = bytes[pos++];\r\n            var c3 = bytes[pos++];\r\n            var c4 = bytes[pos++];\r\n            var u = (((c1 & 7) << 18) | ((c2 & 63) << 12) | ((c3 & 63) << 6) | (c4 & 63)) -\r\n                0x10000;\r\n            out[c++] = String.fromCharCode(0xd800 + (u >> 10));\r\n            out[c++] = String.fromCharCode(0xdc00 + (u & 1023));\r\n        }\r\n        else {\r\n            var c2 = bytes[pos++];\r\n            var c3 = bytes[pos++];\r\n            out[c++] = String.fromCharCode(((c1 & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\r\n        }\r\n    }\r\n    return out.join('');\r\n};\r\n// Static lookup maps, lazily populated by init_()\r\nvar base64 = {\r\n    /**\r\n     * Maps bytes to characters.\r\n     * @type {Object}\r\n     * @private\r\n     */\r\n    byteToCharMap_: null,\r\n    /**\r\n     * Maps characters to bytes.\r\n     * @type {Object}\r\n     * @private\r\n     */\r\n    charToByteMap_: null,\r\n    /**\r\n     * Maps bytes to websafe characters.\r\n     * @type {Object}\r\n     * @private\r\n     */\r\n    byteToCharMapWebSafe_: null,\r\n    /**\r\n     * Maps websafe characters to bytes.\r\n     * @type {Object}\r\n     * @private\r\n     */\r\n    charToByteMapWebSafe_: null,\r\n    /**\r\n     * Our default alphabet, shared between\r\n     * ENCODED_VALS and ENCODED_VALS_WEBSAFE\r\n     * @type {string}\r\n     */\r\n    ENCODED_VALS_BASE: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' + 'abcdefghijklmnopqrstuvwxyz' + '0123456789',\r\n    /**\r\n     * Our default alphabet. Value 64 (=) is special; it means \"nothing.\"\r\n     * @type {string}\r\n     */\r\n    get ENCODED_VALS() {\r\n        return this.ENCODED_VALS_BASE + '+/=';\r\n    },\r\n    /**\r\n     * Our websafe alphabet.\r\n     * @type {string}\r\n     */\r\n    get ENCODED_VALS_WEBSAFE() {\r\n        return this.ENCODED_VALS_BASE + '-_.';\r\n    },\r\n    /**\r\n     * Whether this browser supports the atob and btoa functions. This extension\r\n     * started at Mozilla but is now implemented by many browsers. We use the\r\n     * ASSUME_* variables to avoid pulling in the full useragent detection library\r\n     * but still allowing the standard per-browser compilations.\r\n     *\r\n     * @type {boolean}\r\n     */\r\n    HAS_NATIVE_SUPPORT: typeof atob === 'function',\r\n    /**\r\n     * Base64-encode an array of bytes.\r\n     *\r\n     * @param {Array<number>|Uint8Array} input An array of bytes (numbers with\r\n     *     value in [0, 255]) to encode.\r\n     * @param {boolean=} opt_webSafe Boolean indicating we should use the\r\n     *     alternative alphabet.\r\n     * @return {string} The base64 encoded string.\r\n     */\r\n    encodeByteArray: function (input, opt_webSafe) {\r\n        if (!Array.isArray(input)) {\r\n            throw Error('encodeByteArray takes an array as a parameter');\r\n        }\r\n        this.init_();\r\n        var byteToCharMap = opt_webSafe\r\n            ? this.byteToCharMapWebSafe_\r\n            : this.byteToCharMap_;\r\n        var output = [];\r\n        for (var i = 0; i < input.length; i += 3) {\r\n            var byte1 = input[i];\r\n            var haveByte2 = i + 1 < input.length;\r\n            var byte2 = haveByte2 ? input[i + 1] : 0;\r\n            var haveByte3 = i + 2 < input.length;\r\n            var byte3 = haveByte3 ? input[i + 2] : 0;\r\n            var outByte1 = byte1 >> 2;\r\n            var outByte2 = ((byte1 & 0x03) << 4) | (byte2 >> 4);\r\n            var outByte3 = ((byte2 & 0x0f) << 2) | (byte3 >> 6);\r\n            var outByte4 = byte3 & 0x3f;\r\n            if (!haveByte3) {\r\n                outByte4 = 64;\r\n                if (!haveByte2) {\r\n                    outByte3 = 64;\r\n                }\r\n            }\r\n            output.push(byteToCharMap[outByte1], byteToCharMap[outByte2], byteToCharMap[outByte3], byteToCharMap[outByte4]);\r\n        }\r\n        return output.join('');\r\n    },\r\n    /**\r\n     * Base64-encode a string.\r\n     *\r\n     * @param {string} input A string to encode.\r\n     * @param {boolean=} opt_webSafe If true, we should use the\r\n     *     alternative alphabet.\r\n     * @return {string} The base64 encoded string.\r\n     */\r\n    encodeString: function (input, opt_webSafe) {\r\n        // Shortcut for Mozilla browsers that implement\r\n        // a native base64 encoder in the form of \"btoa/atob\"\r\n        if (this.HAS_NATIVE_SUPPORT && !opt_webSafe) {\r\n            return btoa(input);\r\n        }\r\n        return this.encodeByteArray(stringToByteArray(input), opt_webSafe);\r\n    },\r\n    /**\r\n     * Base64-decode a string.\r\n     *\r\n     * @param {string} input to decode.\r\n     * @param {boolean=} opt_webSafe True if we should use the\r\n     *     alternative alphabet.\r\n     * @return {string} string representing the decoded value.\r\n     */\r\n    decodeString: function (input, opt_webSafe) {\r\n        // Shortcut for Mozilla browsers that implement\r\n        // a native base64 encoder in the form of \"btoa/atob\"\r\n        if (this.HAS_NATIVE_SUPPORT && !opt_webSafe) {\r\n            return atob(input);\r\n        }\r\n        return byteArrayToString(this.decodeStringToByteArray(input, opt_webSafe));\r\n    },\r\n    /**\r\n     * Base64-decode a string.\r\n     *\r\n     * In base-64 decoding, groups of four characters are converted into three\r\n     * bytes.  If the encoder did not apply padding, the input length may not\r\n     * be a multiple of 4.\r\n     *\r\n     * In this case, the last group will have fewer than 4 characters, and\r\n     * padding will be inferred.  If the group has one or two characters, it decodes\r\n     * to one byte.  If the group has three characters, it decodes to two bytes.\r\n     *\r\n     * @param {string} input Input to decode.\r\n     * @param {boolean=} opt_webSafe True if we should use the web-safe alphabet.\r\n     * @return {!Array<number>} bytes representing the decoded value.\r\n     */\r\n    decodeStringToByteArray: function (input, opt_webSafe) {\r\n        this.init_();\r\n        var charToByteMap = opt_webSafe\r\n            ? this.charToByteMapWebSafe_\r\n            : this.charToByteMap_;\r\n        var output = [];\r\n        for (var i = 0; i < input.length;) {\r\n            var byte1 = charToByteMap[input.charAt(i++)];\r\n            var haveByte2 = i < input.length;\r\n            var byte2 = haveByte2 ? charToByteMap[input.charAt(i)] : 0;\r\n            ++i;\r\n            var haveByte3 = i < input.length;\r\n            var byte3 = haveByte3 ? charToByteMap[input.charAt(i)] : 64;\r\n            ++i;\r\n            var haveByte4 = i < input.length;\r\n            var byte4 = haveByte4 ? charToByteMap[input.charAt(i)] : 64;\r\n            ++i;\r\n            if (byte1 == null || byte2 == null || byte3 == null || byte4 == null) {\r\n                throw Error();\r\n            }\r\n            var outByte1 = (byte1 << 2) | (byte2 >> 4);\r\n            output.push(outByte1);\r\n            if (byte3 != 64) {\r\n                var outByte2 = ((byte2 << 4) & 0xf0) | (byte3 >> 2);\r\n                output.push(outByte2);\r\n                if (byte4 != 64) {\r\n                    var outByte3 = ((byte3 << 6) & 0xc0) | byte4;\r\n                    output.push(outByte3);\r\n                }\r\n            }\r\n        }\r\n        return output;\r\n    },\r\n    /**\r\n     * Lazy static initialization function. Called before\r\n     * accessing any of the static map variables.\r\n     * @private\r\n     */\r\n    init_: function () {\r\n        if (!this.byteToCharMap_) {\r\n            this.byteToCharMap_ = {};\r\n            this.charToByteMap_ = {};\r\n            this.byteToCharMapWebSafe_ = {};\r\n            this.charToByteMapWebSafe_ = {};\r\n            // We want quick mappings back and forth, so we precompute two maps.\r\n            for (var i = 0; i < this.ENCODED_VALS.length; i++) {\r\n                this.byteToCharMap_[i] = this.ENCODED_VALS.charAt(i);\r\n                this.charToByteMap_[this.byteToCharMap_[i]] = i;\r\n                this.byteToCharMapWebSafe_[i] = this.ENCODED_VALS_WEBSAFE.charAt(i);\r\n                this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]] = i;\r\n                // Be forgiving when decoding and correctly decode both encodings.\r\n                if (i >= this.ENCODED_VALS_BASE.length) {\r\n                    this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)] = i;\r\n                    this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)] = i;\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n/**\r\n * URL-safe base64 encoding\r\n * @param {!string} str\r\n * @return {!string}\r\n */\r\nvar base64Encode = function (str) {\r\n    var utf8Bytes = stringToByteArray(str);\r\n    return base64.encodeByteArray(utf8Bytes, true);\r\n};\r\n/**\r\n * URL-safe base64 decoding\r\n *\r\n * NOTE: DO NOT use the global atob() function - it does NOT support the\r\n * base64Url variant encoding.\r\n *\r\n * @param {string} str To be decoded\r\n * @return {?string} Decoded result, if possible\r\n */\r\nvar base64Decode = function (str) {\r\n    try {\r\n        return base64.decodeString(str, true);\r\n    }\r\n    catch (e) {\r\n        console.error('base64Decode failed: ', e);\r\n    }\r\n    return null;\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Do a deep-copy of basic JavaScript Objects or Arrays.\r\n */\r\nfunction deepCopy(value) {\r\n    return deepExtend(undefined, value);\r\n}\r\n/**\r\n * Copy properties from source to target (recursively allows extension\r\n * of Objects and Arrays).  Scalar values in the target are over-written.\r\n * If target is undefined, an object of the appropriate type will be created\r\n * (and returned).\r\n *\r\n * We recursively copy all child properties of plain Objects in the source- so\r\n * that namespace- like dictionaries are merged.\r\n *\r\n * Note that the target can be a function, in which case the properties in\r\n * the source Object are copied onto it as static properties of the Function.\r\n */\r\nfunction deepExtend(target, source) {\r\n    if (!(source instanceof Object)) {\r\n        return source;\r\n    }\r\n    switch (source.constructor) {\r\n        case Date:\r\n            // Treat Dates like scalars; if the target date object had any child\r\n            // properties - they will be lost!\r\n            var dateValue = source;\r\n            return new Date(dateValue.getTime());\r\n        case Object:\r\n            if (target === undefined) {\r\n                target = {};\r\n            }\r\n            break;\r\n        case Array:\r\n            // Always copy the array source and overwrite the target.\r\n            target = [];\r\n            break;\r\n        default:\r\n            // Not a plain Object - treat it as a scalar.\r\n            return source;\r\n    }\r\n    for (var prop in source) {\r\n        if (!source.hasOwnProperty(prop)) {\r\n            continue;\r\n        }\r\n        target[prop] = deepExtend(target[prop], source[prop]);\r\n    }\r\n    return target;\r\n}\r\n// TODO: Really needed (for JSCompiler type checking)?\r\nfunction patchProperty(obj, prop, value) {\r\n    obj[prop] = value;\r\n}\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar Deferred = /** @class */ (function () {\r\n    function Deferred() {\r\n        var _this = this;\r\n        this.promise = new Promise(function (resolve, reject) {\r\n            _this.resolve = resolve;\r\n            _this.reject = reject;\r\n        });\r\n    }\r\n    /**\r\n     * Our API internals are not promiseified and cannot because our callback APIs have subtle expectations around\r\n     * invoking promises inline, which Promises are forbidden to do. This method accepts an optional node-style callback\r\n     * and returns a node-style callback which will resolve or reject the Deferred's promise.\r\n     * @param {((?function(?(Error)): (?|undefined))| (?function(?(Error),?=): (?|undefined)))=} callback\r\n     * @return {!function(?(Error), ?=)}\r\n     */\r\n    Deferred.prototype.wrapCallback = function (callback) {\r\n        var _this = this;\r\n        return function (error, value) {\r\n            if (error) {\r\n                _this.reject(error);\r\n            }\r\n            else {\r\n                _this.resolve(value);\r\n            }\r\n            if (typeof callback === 'function') {\r\n                // Attaching noop handler just in case developer wasn't expecting\r\n                // promises\r\n                _this.promise.catch(function () { });\r\n                // Some of our callbacks don't expect a value and our own tests\r\n                // assert that the parameter length is 1\r\n                if (callback.length === 1) {\r\n                    callback(error);\r\n                }\r\n                else {\r\n                    callback(error, value);\r\n                }\r\n            }\r\n        };\r\n    };\r\n    return Deferred;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns navigator.userAgent string or '' if it's not defined.\r\n * @return {string} user agent string\r\n */\r\nvar getUA = function () {\r\n    if (typeof navigator !== 'undefined' &&\r\n        typeof navigator['userAgent'] === 'string') {\r\n        return navigator['userAgent'];\r\n    }\r\n    else {\r\n        return '';\r\n    }\r\n};\r\n/**\r\n * Detect Cordova / PhoneGap / Ionic frameworks on a mobile device.\r\n *\r\n * Deliberately does not rely on checking `file://` URLs (as this fails PhoneGap in the Ripple emulator) nor\r\n * Cordova `onDeviceReady`, which would normally wait for a callback.\r\n *\r\n * @return {boolean} isMobileCordova\r\n */\r\nvar isMobileCordova = function () {\r\n    return (typeof window !== 'undefined' &&\r\n        !!(window['cordova'] || window['phonegap'] || window['PhoneGap']) &&\r\n        /ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA()));\r\n};\r\n/**\r\n * Detect React Native.\r\n *\r\n * @return {boolean} True if ReactNative environment is detected.\r\n */\r\nvar isReactNative = function () {\r\n    return (typeof navigator === 'object' && navigator['product'] === 'ReactNative');\r\n};\r\n/**\r\n * Detect Node.js.\r\n *\r\n * @return {boolean} True if Node.js environment is detected.\r\n */\r\nvar isNodeSdk = function () {\r\n    return CONSTANTS.NODE_CLIENT === true || CONSTANTS.NODE_ADMIN === true;\r\n};\n\nvar ERROR_NAME = 'FirebaseError';\r\nvar captureStackTrace = Error\r\n    .captureStackTrace;\r\n// Export for faking in tests\r\nfunction patchCapture(captureFake) {\r\n    var result = captureStackTrace;\r\n    captureStackTrace = captureFake;\r\n    return result;\r\n}\r\nvar FirebaseError = /** @class */ (function () {\r\n    function FirebaseError(code, message) {\r\n        this.code = code;\r\n        this.message = message;\r\n        // We want the stack value, if implemented by Error\r\n        if (captureStackTrace) {\r\n            // Patches this.stack, omitted calls above ErrorFactory#create\r\n            captureStackTrace(this, ErrorFactory.prototype.create);\r\n        }\r\n        else {\r\n            try {\r\n                // In case of IE11, stack will be set only after error is raised.\r\n                // https://docs.microsoft.com/en-us/scripting/javascript/reference/stack-property-error-javascript\r\n                throw Error.apply(this, arguments);\r\n            }\r\n            catch (err) {\r\n                this.name = ERROR_NAME;\r\n                // Make non-enumerable getter for the property.\r\n                Object.defineProperty(this, 'stack', {\r\n                    get: function () {\r\n                        return err.stack;\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n    return FirebaseError;\r\n}());\r\n// Back-door inheritance\r\nFirebaseError.prototype = Object.create(Error.prototype);\r\nFirebaseError.prototype.constructor = FirebaseError;\r\nFirebaseError.prototype.name = ERROR_NAME;\r\nvar ErrorFactory = /** @class */ (function () {\r\n    function ErrorFactory(service, serviceName, errors) {\r\n        this.service = service;\r\n        this.serviceName = serviceName;\r\n        this.errors = errors;\r\n        // Matches {$name}, by default.\r\n        this.pattern = /\\{\\$([^}]+)}/g;\r\n        // empty\r\n    }\r\n    ErrorFactory.prototype.create = function (code, data) {\r\n        if (data === undefined) {\r\n            data = {};\r\n        }\r\n        var template = this.errors[code];\r\n        var fullCode = this.service + '/' + code;\r\n        var message;\r\n        if (template === undefined) {\r\n            message = 'Error';\r\n        }\r\n        else {\r\n            message = template.replace(this.pattern, function (match, key) {\r\n                var value = data[key];\r\n                return value !== undefined ? value.toString() : '<' + key + '?>';\r\n            });\r\n        }\r\n        // Service: Error message (service/code).\r\n        message = this.serviceName + ': ' + message + ' (' + fullCode + ').';\r\n        var err = new FirebaseError(fullCode, message);\r\n        // Populate the Error object with message parts for programmatic\r\n        // accesses (e.g., e.file).\r\n        for (var prop in data) {\r\n            if (!data.hasOwnProperty(prop) || prop.slice(-1) === '_') {\r\n                continue;\r\n            }\r\n            err[prop] = data[prop];\r\n        }\r\n        return err;\r\n    };\r\n    return ErrorFactory;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Evaluates a JSON string into a javascript object.\r\n *\r\n * @param {string} str A string containing JSON.\r\n * @return {*} The javascript object representing the specified JSON.\r\n */\r\nfunction jsonEval(str) {\r\n    return JSON.parse(str);\r\n}\r\n/**\r\n * Returns JSON representing a javascript object.\r\n * @param {*} data Javascript object to be stringified.\r\n * @return {string} The JSON contents of the object.\r\n */\r\nfunction stringify(data) {\r\n    return JSON.stringify(data);\r\n}\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Decodes a Firebase auth. token into constituent parts.\r\n *\r\n * Notes:\r\n * - May return with invalid / incomplete claims if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n *\r\n * @param {?string} token\r\n * @return {{header: *, claims: *, data: *, signature: string}}\r\n */\r\nvar decode = function (token) {\r\n    var header = {}, claims = {}, data = {}, signature = '';\r\n    try {\r\n        var parts = token.split('.');\r\n        header = jsonEval(base64Decode(parts[0]) || '');\r\n        claims = jsonEval(base64Decode(parts[1]) || '');\r\n        signature = parts[2];\r\n        data = claims['d'] || {};\r\n        delete claims['d'];\r\n    }\r\n    catch (e) { }\r\n    return {\r\n        header: header,\r\n        claims: claims,\r\n        data: data,\r\n        signature: signature\r\n    };\r\n};\r\n/**\r\n * Decodes a Firebase auth. token and checks the validity of its time-based claims. Will return true if the\r\n * token is within the time window authorized by the 'nbf' (not-before) and 'iat' (issued-at) claims.\r\n *\r\n * Notes:\r\n * - May return a false negative if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n *\r\n * @param {?string} token\r\n * @return {boolean}\r\n */\r\nvar isValidTimestamp = function (token) {\r\n    var claims = decode(token).claims, now = Math.floor(new Date().getTime() / 1000), validSince, validUntil;\r\n    if (typeof claims === 'object') {\r\n        if (claims.hasOwnProperty('nbf')) {\r\n            validSince = claims['nbf'];\r\n        }\r\n        else if (claims.hasOwnProperty('iat')) {\r\n            validSince = claims['iat'];\r\n        }\r\n        if (claims.hasOwnProperty('exp')) {\r\n            validUntil = claims['exp'];\r\n        }\r\n        else {\r\n            // token will expire after 24h by default\r\n            validUntil = validSince + 86400;\r\n        }\r\n    }\r\n    return (now && validSince && validUntil && now >= validSince && now <= validUntil);\r\n};\r\n/**\r\n * Decodes a Firebase auth. token and returns its issued at time if valid, null otherwise.\r\n *\r\n * Notes:\r\n * - May return null if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n *\r\n * @param {?string} token\r\n * @return {?number}\r\n */\r\nvar issuedAtTime = function (token) {\r\n    var claims = decode(token).claims;\r\n    if (typeof claims === 'object' && claims.hasOwnProperty('iat')) {\r\n        return claims['iat'];\r\n    }\r\n    return null;\r\n};\r\n/**\r\n * Decodes a Firebase auth. token and checks the validity of its format. Expects a valid issued-at time.\r\n *\r\n * Notes:\r\n * - May return a false negative if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n *\r\n * @param {?string} token\r\n * @return {boolean}\r\n */\r\nvar isValidFormat = function (token) {\r\n    var decoded = decode(token), claims = decoded.claims;\r\n    return !!claims && typeof claims === 'object' && claims.hasOwnProperty('iat');\r\n};\r\n/**\r\n * Attempts to peer into an auth token and determine if it's an admin auth token by looking at the claims portion.\r\n *\r\n * Notes:\r\n * - May return a false negative if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n *\r\n * @param {?string} token\r\n * @return {boolean}\r\n */\r\nvar isAdmin = function (token) {\r\n    var claims = decode(token).claims;\r\n    return typeof claims === 'object' && claims['admin'] === true;\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// See http://www.devthought.com/2012/01/18/an-object-is-not-a-hash/\r\nvar contains = function (obj, key) {\r\n    return Object.prototype.hasOwnProperty.call(obj, key);\r\n};\r\nvar safeGet = function (obj, key) {\r\n    if (Object.prototype.hasOwnProperty.call(obj, key))\r\n        return obj[key];\r\n    // else return undefined.\r\n};\r\n/**\r\n * Enumerates the keys/values in an object, excluding keys defined on the prototype.\r\n *\r\n * @param {?Object.<K,V>} obj Object to enumerate.\r\n * @param {!function(K, V)} fn Function to call for each key and value.\r\n * @template K,V\r\n */\r\nvar forEach = function (obj, fn) {\r\n    for (var key in obj) {\r\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n            fn(key, obj[key]);\r\n        }\r\n    }\r\n};\r\n/**\r\n * Copies all the (own) properties from one object to another.\r\n * @param {!Object} objTo\r\n * @param {!Object} objFrom\r\n * @return {!Object} objTo\r\n */\r\nvar extend = function (objTo, objFrom) {\r\n    forEach(objFrom, function (key, value) {\r\n        objTo[key] = value;\r\n    });\r\n    return objTo;\r\n};\r\n/**\r\n * Returns a clone of the specified object.\r\n * @param {!Object} obj\r\n * @return {!Object} cloned obj.\r\n */\r\nvar clone = function (obj) {\r\n    return extend({}, obj);\r\n};\r\n/**\r\n * Returns true if obj has typeof \"object\" and is not null.  Unlike goog.isObject(), does not return true\r\n * for functions.\r\n *\r\n * @param obj {*} A potential object.\r\n * @returns {boolean} True if it's an object.\r\n */\r\nvar isNonNullObject = function (obj) {\r\n    return typeof obj === 'object' && obj !== null;\r\n};\r\nvar isEmpty = function (obj) {\r\n    for (var key in obj) {\r\n        return false;\r\n    }\r\n    return true;\r\n};\r\nvar getCount = function (obj) {\r\n    var rv = 0;\r\n    for (var key in obj) {\r\n        rv++;\r\n    }\r\n    return rv;\r\n};\r\nvar map = function (obj, f, opt_obj) {\r\n    var res = {};\r\n    for (var key in obj) {\r\n        res[key] = f.call(opt_obj, obj[key], key, obj);\r\n    }\r\n    return res;\r\n};\r\nvar findKey = function (obj, fn, opt_this) {\r\n    for (var key in obj) {\r\n        if (fn.call(opt_this, obj[key], key, obj)) {\r\n            return key;\r\n        }\r\n    }\r\n    return undefined;\r\n};\r\nvar findValue = function (obj, fn, opt_this) {\r\n    var key = findKey(obj, fn, opt_this);\r\n    return key && obj[key];\r\n};\r\nvar getAnyKey = function (obj) {\r\n    for (var key in obj) {\r\n        return key;\r\n    }\r\n};\r\nvar getValues = function (obj) {\r\n    var res = [];\r\n    var i = 0;\r\n    for (var key in obj) {\r\n        res[i++] = obj[key];\r\n    }\r\n    return res;\r\n};\r\n/**\r\n * Tests whether every key/value pair in an object pass the test implemented\r\n * by the provided function\r\n *\r\n * @param {?Object.<K,V>} obj Object to test.\r\n * @param {!function(K, V)} fn Function to call for each key and value.\r\n * @template K,V\r\n */\r\nvar every = function (obj, fn) {\r\n    for (var key in obj) {\r\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n            if (!fn(key, obj[key])) {\r\n                return false;\r\n            }\r\n        }\r\n    }\r\n    return true;\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a querystring-formatted string (e.g. &arg=val&arg2=val2) from a params\r\n * object (e.g. {arg: 'val', arg2: 'val2'})\r\n * Note: You must prepend it with ? when adding it to a URL.\r\n *\r\n * @param {!Object} querystringParams\r\n * @return {string}\r\n */\r\nvar querystring = function (querystringParams) {\r\n    var params = [];\r\n    forEach(querystringParams, function (key, value) {\r\n        if (Array.isArray(value)) {\r\n            value.forEach(function (arrayVal) {\r\n                params.push(encodeURIComponent(key) + '=' + encodeURIComponent(arrayVal));\r\n            });\r\n        }\r\n        else {\r\n            params.push(encodeURIComponent(key) + '=' + encodeURIComponent(value));\r\n        }\r\n    });\r\n    return params.length ? '&' + params.join('&') : '';\r\n};\r\n/**\r\n * Decodes a querystring (e.g. ?arg=val&arg2=val2) into a params object (e.g. {arg: 'val', arg2: 'val2'})\r\n *\r\n * @param {string} querystring\r\n * @return {!Object}\r\n */\r\nvar querystringDecode = function (querystring) {\r\n    var obj = {};\r\n    var tokens = querystring.replace(/^\\?/, '').split('&');\r\n    tokens.forEach(function (token) {\r\n        if (token) {\r\n            var key = token.split('=');\r\n            obj[key[0]] = key[1];\r\n        }\r\n    });\r\n    return obj;\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Copyright 2011 The Closure Library Authors. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//      http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n/**\r\n * @fileoverview Abstract cryptographic hash interface.\r\n *\r\n * See Sha1 and Md5 for sample implementations.\r\n *\r\n */\r\n/**\r\n * Create a cryptographic hash instance.\r\n *\r\n * @constructor\r\n * @struct\r\n */\r\nvar Hash = /** @class */ (function () {\r\n    function Hash() {\r\n        /**\r\n         * The block size for the hasher.\r\n         * @type {number}\r\n         */\r\n        this.blockSize = -1;\r\n    }\r\n    return Hash;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @fileoverview SHA-1 cryptographic hash.\r\n * Variable names follow the notation in FIPS PUB 180-3:\r\n * http://csrc.nist.gov/publications/fips/fips180-3/fips180-3_final.pdf.\r\n *\r\n * Usage:\r\n *   var sha1 = new sha1();\r\n *   sha1.update(bytes);\r\n *   var hash = sha1.digest();\r\n *\r\n * Performance:\r\n *   Chrome 23:   ~400 Mbit/s\r\n *   Firefox 16:  ~250 Mbit/s\r\n *\r\n */\r\n/**\r\n * SHA-1 cryptographic hash constructor.\r\n *\r\n * The properties declared here are discussed in the above algorithm document.\r\n * @constructor\r\n * @extends {Hash}\r\n * @final\r\n * @struct\r\n */\r\nvar Sha1 = /** @class */ (function (_super) {\r\n    __extends(Sha1, _super);\r\n    function Sha1() {\r\n        var _this = _super.call(this) || this;\r\n        /**\r\n         * Holds the previous values of accumulated variables a-e in the compress_\r\n         * function.\r\n         * @type {!Array<number>}\r\n         * @private\r\n         */\r\n        _this.chain_ = [];\r\n        /**\r\n         * A buffer holding the partially computed hash result.\r\n         * @type {!Array<number>}\r\n         * @private\r\n         */\r\n        _this.buf_ = [];\r\n        /**\r\n         * An array of 80 bytes, each a part of the message to be hashed.  Referred to\r\n         * as the message schedule in the docs.\r\n         * @type {!Array<number>}\r\n         * @private\r\n         */\r\n        _this.W_ = [];\r\n        /**\r\n         * Contains data needed to pad messages less than 64 bytes.\r\n         * @type {!Array<number>}\r\n         * @private\r\n         */\r\n        _this.pad_ = [];\r\n        /**\r\n         * @private {number}\r\n         */\r\n        _this.inbuf_ = 0;\r\n        /**\r\n         * @private {number}\r\n         */\r\n        _this.total_ = 0;\r\n        _this.blockSize = 512 / 8;\r\n        _this.pad_[0] = 128;\r\n        for (var i = 1; i < _this.blockSize; ++i) {\r\n            _this.pad_[i] = 0;\r\n        }\r\n        _this.reset();\r\n        return _this;\r\n    }\r\n    Sha1.prototype.reset = function () {\r\n        this.chain_[0] = 0x67452301;\r\n        this.chain_[1] = 0xefcdab89;\r\n        this.chain_[2] = 0x98badcfe;\r\n        this.chain_[3] = 0x10325476;\r\n        this.chain_[4] = 0xc3d2e1f0;\r\n        this.inbuf_ = 0;\r\n        this.total_ = 0;\r\n    };\r\n    /**\r\n     * Internal compress helper function.\r\n     * @param {!Array<number>|!Uint8Array|string} buf Block to compress.\r\n     * @param {number=} opt_offset Offset of the block in the buffer.\r\n     * @private\r\n     */\r\n    Sha1.prototype.compress_ = function (buf, opt_offset) {\r\n        if (!opt_offset) {\r\n            opt_offset = 0;\r\n        }\r\n        var W = this.W_;\r\n        // get 16 big endian words\r\n        if (typeof buf === 'string') {\r\n            for (var i = 0; i < 16; i++) {\r\n                // TODO(user): [bug 8140122] Recent versions of Safari for Mac OS and iOS\r\n                // have a bug that turns the post-increment ++ operator into pre-increment\r\n                // during JIT compilation.  We have code that depends heavily on SHA-1 for\r\n                // correctness and which is affected by this bug, so I've removed all uses\r\n                // of post-increment ++ in which the result value is used.  We can revert\r\n                // this change once the Safari bug\r\n                // (https://bugs.webkit.org/show_bug.cgi?id=109036) has been fixed and\r\n                // most clients have been updated.\r\n                W[i] =\r\n                    (buf.charCodeAt(opt_offset) << 24) |\r\n                        (buf.charCodeAt(opt_offset + 1) << 16) |\r\n                        (buf.charCodeAt(opt_offset + 2) << 8) |\r\n                        buf.charCodeAt(opt_offset + 3);\r\n                opt_offset += 4;\r\n            }\r\n        }\r\n        else {\r\n            for (var i = 0; i < 16; i++) {\r\n                W[i] =\r\n                    (buf[opt_offset] << 24) |\r\n                        (buf[opt_offset + 1] << 16) |\r\n                        (buf[opt_offset + 2] << 8) |\r\n                        buf[opt_offset + 3];\r\n                opt_offset += 4;\r\n            }\r\n        }\r\n        // expand to 80 words\r\n        for (var i = 16; i < 80; i++) {\r\n            var t = W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16];\r\n            W[i] = ((t << 1) | (t >>> 31)) & 0xffffffff;\r\n        }\r\n        var a = this.chain_[0];\r\n        var b = this.chain_[1];\r\n        var c = this.chain_[2];\r\n        var d = this.chain_[3];\r\n        var e = this.chain_[4];\r\n        var f, k;\r\n        // TODO(user): Try to unroll this loop to speed up the computation.\r\n        for (var i = 0; i < 80; i++) {\r\n            if (i < 40) {\r\n                if (i < 20) {\r\n                    f = d ^ (b & (c ^ d));\r\n                    k = 0x5a827999;\r\n                }\r\n                else {\r\n                    f = b ^ c ^ d;\r\n                    k = 0x6ed9eba1;\r\n                }\r\n            }\r\n            else {\r\n                if (i < 60) {\r\n                    f = (b & c) | (d & (b | c));\r\n                    k = 0x8f1bbcdc;\r\n                }\r\n                else {\r\n                    f = b ^ c ^ d;\r\n                    k = 0xca62c1d6;\r\n                }\r\n            }\r\n            var t = (((a << 5) | (a >>> 27)) + f + e + k + W[i]) & 0xffffffff;\r\n            e = d;\r\n            d = c;\r\n            c = ((b << 30) | (b >>> 2)) & 0xffffffff;\r\n            b = a;\r\n            a = t;\r\n        }\r\n        this.chain_[0] = (this.chain_[0] + a) & 0xffffffff;\r\n        this.chain_[1] = (this.chain_[1] + b) & 0xffffffff;\r\n        this.chain_[2] = (this.chain_[2] + c) & 0xffffffff;\r\n        this.chain_[3] = (this.chain_[3] + d) & 0xffffffff;\r\n        this.chain_[4] = (this.chain_[4] + e) & 0xffffffff;\r\n    };\r\n    Sha1.prototype.update = function (bytes, opt_length) {\r\n        // TODO(johnlenz): tighten the function signature and remove this check\r\n        if (bytes == null) {\r\n            return;\r\n        }\r\n        if (opt_length === undefined) {\r\n            opt_length = bytes.length;\r\n        }\r\n        var lengthMinusBlock = opt_length - this.blockSize;\r\n        var n = 0;\r\n        // Using local instead of member variables gives ~5% speedup on Firefox 16.\r\n        var buf = this.buf_;\r\n        var inbuf = this.inbuf_;\r\n        // The outer while loop should execute at most twice.\r\n        while (n < opt_length) {\r\n            // When we have no data in the block to top up, we can directly process the\r\n            // input buffer (assuming it contains sufficient data). This gives ~25%\r\n            // speedup on Chrome 23 and ~15% speedup on Firefox 16, but requires that\r\n            // the data is provided in large chunks (or in multiples of 64 bytes).\r\n            if (inbuf == 0) {\r\n                while (n <= lengthMinusBlock) {\r\n                    this.compress_(bytes, n);\r\n                    n += this.blockSize;\r\n                }\r\n            }\r\n            if (typeof bytes === 'string') {\r\n                while (n < opt_length) {\r\n                    buf[inbuf] = bytes.charCodeAt(n);\r\n                    ++inbuf;\r\n                    ++n;\r\n                    if (inbuf == this.blockSize) {\r\n                        this.compress_(buf);\r\n                        inbuf = 0;\r\n                        // Jump to the outer loop so we use the full-block optimization.\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                while (n < opt_length) {\r\n                    buf[inbuf] = bytes[n];\r\n                    ++inbuf;\r\n                    ++n;\r\n                    if (inbuf == this.blockSize) {\r\n                        this.compress_(buf);\r\n                        inbuf = 0;\r\n                        // Jump to the outer loop so we use the full-block optimization.\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this.inbuf_ = inbuf;\r\n        this.total_ += opt_length;\r\n    };\r\n    /** @override */\r\n    Sha1.prototype.digest = function () {\r\n        var digest = [];\r\n        var totalBits = this.total_ * 8;\r\n        // Add pad 0x80 0x00*.\r\n        if (this.inbuf_ < 56) {\r\n            this.update(this.pad_, 56 - this.inbuf_);\r\n        }\r\n        else {\r\n            this.update(this.pad_, this.blockSize - (this.inbuf_ - 56));\r\n        }\r\n        // Add # bits.\r\n        for (var i = this.blockSize - 1; i >= 56; i--) {\r\n            this.buf_[i] = totalBits & 255;\r\n            totalBits /= 256; // Don't use bit-shifting here!\r\n        }\r\n        this.compress_(this.buf_);\r\n        var n = 0;\r\n        for (var i = 0; i < 5; i++) {\r\n            for (var j = 24; j >= 0; j -= 8) {\r\n                digest[n] = (this.chain_[i] >> j) & 255;\r\n                ++n;\r\n            }\r\n        }\r\n        return digest;\r\n    };\r\n    return Sha1;\r\n}(Hash));\n\n/**\r\n * Helper to make a Subscribe function (just like Promise helps make a\r\n * Thenable).\r\n *\r\n * @param executor Function which can make calls to a single Observer\r\n *     as a proxy.\r\n * @param onNoObservers Callback when count of Observers goes to zero.\r\n */\r\nfunction createSubscribe(executor, onNoObservers) {\r\n    var proxy = new ObserverProxy(executor, onNoObservers);\r\n    return proxy.subscribe.bind(proxy);\r\n}\r\n/**\r\n * Implement fan-out for any number of Observers attached via a subscribe\r\n * function.\r\n */\r\nvar ObserverProxy = /** @class */ (function () {\r\n    /**\r\n     * @param executor Function which can make calls to a single Observer\r\n     *     as a proxy.\r\n     * @param onNoObservers Callback when count of Observers goes to zero.\r\n     */\r\n    function ObserverProxy(executor, onNoObservers) {\r\n        var _this = this;\r\n        this.observers = [];\r\n        this.unsubscribes = [];\r\n        this.observerCount = 0;\r\n        // Micro-task scheduling by calling task.then().\r\n        this.task = Promise.resolve();\r\n        this.finalized = false;\r\n        this.onNoObservers = onNoObservers;\r\n        // Call the executor asynchronously so subscribers that are called\r\n        // synchronously after the creation of the subscribe function\r\n        // can still receive the very first value generated in the executor.\r\n        this.task\r\n            .then(function () {\r\n            executor(_this);\r\n        })\r\n            .catch(function (e) {\r\n            _this.error(e);\r\n        });\r\n    }\r\n    ObserverProxy.prototype.next = function (value) {\r\n        this.forEachObserver(function (observer) {\r\n            observer.next(value);\r\n        });\r\n    };\r\n    ObserverProxy.prototype.error = function (error) {\r\n        this.forEachObserver(function (observer) {\r\n            observer.error(error);\r\n        });\r\n        this.close(error);\r\n    };\r\n    ObserverProxy.prototype.complete = function () {\r\n        this.forEachObserver(function (observer) {\r\n            observer.complete();\r\n        });\r\n        this.close();\r\n    };\r\n    /**\r\n     * Subscribe function that can be used to add an Observer to the fan-out list.\r\n     *\r\n     * - We require that no event is sent to a subscriber sychronously to their\r\n     *   call to subscribe().\r\n     */\r\n    ObserverProxy.prototype.subscribe = function (nextOrObserver, error, complete) {\r\n        var _this = this;\r\n        var observer;\r\n        if (nextOrObserver === undefined &&\r\n            error === undefined &&\r\n            complete === undefined) {\r\n            throw new Error('Missing Observer.');\r\n        }\r\n        // Assemble an Observer object when passed as callback functions.\r\n        if (implementsAnyMethods(nextOrObserver, ['next', 'error', 'complete'])) {\r\n            observer = nextOrObserver;\r\n        }\r\n        else {\r\n            observer = {\r\n                next: nextOrObserver,\r\n                error: error,\r\n                complete: complete\r\n            };\r\n        }\r\n        if (observer.next === undefined) {\r\n            observer.next = noop;\r\n        }\r\n        if (observer.error === undefined) {\r\n            observer.error = noop;\r\n        }\r\n        if (observer.complete === undefined) {\r\n            observer.complete = noop;\r\n        }\r\n        var unsub = this.unsubscribeOne.bind(this, this.observers.length);\r\n        // Attempt to subscribe to a terminated Observable - we\r\n        // just respond to the Observer with the final error or complete\r\n        // event.\r\n        if (this.finalized) {\r\n            this.task.then(function () {\r\n                try {\r\n                    if (_this.finalError) {\r\n                        observer.error(_this.finalError);\r\n                    }\r\n                    else {\r\n                        observer.complete();\r\n                    }\r\n                }\r\n                catch (e) {\r\n                    // nothing\r\n                }\r\n                return;\r\n            });\r\n        }\r\n        this.observers.push(observer);\r\n        return unsub;\r\n    };\r\n    // Unsubscribe is synchronous - we guarantee that no events are sent to\r\n    // any unsubscribed Observer.\r\n    ObserverProxy.prototype.unsubscribeOne = function (i) {\r\n        if (this.observers === undefined || this.observers[i] === undefined) {\r\n            return;\r\n        }\r\n        delete this.observers[i];\r\n        this.observerCount -= 1;\r\n        if (this.observerCount === 0 && this.onNoObservers !== undefined) {\r\n            this.onNoObservers(this);\r\n        }\r\n    };\r\n    ObserverProxy.prototype.forEachObserver = function (fn) {\r\n        if (this.finalized) {\r\n            // Already closed by previous event....just eat the additional values.\r\n            return;\r\n        }\r\n        // Since sendOne calls asynchronously - there is no chance that\r\n        // this.observers will become undefined.\r\n        for (var i = 0; i < this.observers.length; i++) {\r\n            this.sendOne(i, fn);\r\n        }\r\n    };\r\n    // Call the Observer via one of it's callback function. We are careful to\r\n    // confirm that the observe has not been unsubscribed since this asynchronous\r\n    // function had been queued.\r\n    ObserverProxy.prototype.sendOne = function (i, fn) {\r\n        var _this = this;\r\n        // Execute the callback asynchronously\r\n        this.task.then(function () {\r\n            if (_this.observers !== undefined && _this.observers[i] !== undefined) {\r\n                try {\r\n                    fn(_this.observers[i]);\r\n                }\r\n                catch (e) {\r\n                    // Ignore exceptions raised in Observers or missing methods of an\r\n                    // Observer.\r\n                    // Log error to console. b/31404806\r\n                    if (typeof console !== 'undefined' && console.error) {\r\n                        console.error(e);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    };\r\n    ObserverProxy.prototype.close = function (err) {\r\n        var _this = this;\r\n        if (this.finalized) {\r\n            return;\r\n        }\r\n        this.finalized = true;\r\n        if (err !== undefined) {\r\n            this.finalError = err;\r\n        }\r\n        // Proxy is no longer needed - garbage collect references\r\n        this.task.then(function () {\r\n            _this.observers = undefined;\r\n            _this.onNoObservers = undefined;\r\n        });\r\n    };\r\n    return ObserverProxy;\r\n}());\r\n/** Turn synchronous function into one called asynchronously. */\r\nfunction async(fn, onError) {\r\n    return function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        Promise.resolve(true)\r\n            .then(function () {\r\n            fn.apply(void 0, args);\r\n        })\r\n            .catch(function (error) {\r\n            if (onError) {\r\n                onError(error);\r\n            }\r\n        });\r\n    };\r\n}\r\n/**\r\n * Return true if the object passed in implements any of the named methods.\r\n */\r\nfunction implementsAnyMethods(obj, methods) {\r\n    if (typeof obj !== 'object' || obj === null) {\r\n        return false;\r\n    }\r\n    for (var _i = 0, methods_1 = methods; _i < methods_1.length; _i++) {\r\n        var method = methods_1[_i];\r\n        if (method in obj && typeof obj[method] === 'function') {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\nfunction noop() {\r\n    // do nothing\r\n}\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Check to make sure the appropriate number of arguments are provided for a public function.\r\n * Throws an error if it fails.\r\n *\r\n * @param {!string} fnName The function name\r\n * @param {!number} minCount The minimum number of arguments to allow for the function call\r\n * @param {!number} maxCount The maximum number of argument to allow for the function call\r\n * @param {!number} argCount The actual number of arguments provided.\r\n */\r\nvar validateArgCount = function (fnName, minCount, maxCount, argCount) {\r\n    var argError;\r\n    if (argCount < minCount) {\r\n        argError = 'at least ' + minCount;\r\n    }\r\n    else if (argCount > maxCount) {\r\n        argError = maxCount === 0 ? 'none' : 'no more than ' + maxCount;\r\n    }\r\n    if (argError) {\r\n        var error = fnName +\r\n            ' failed: Was called with ' +\r\n            argCount +\r\n            (argCount === 1 ? ' argument.' : ' arguments.') +\r\n            ' Expects ' +\r\n            argError +\r\n            '.';\r\n        throw new Error(error);\r\n    }\r\n};\r\n/**\r\n * Generates a string to prefix an error message about failed argument validation\r\n *\r\n * @param {!string} fnName The function name\r\n * @param {!number} argumentNumber The index of the argument\r\n * @param {boolean} optional Whether or not the argument is optional\r\n * @return {!string} The prefix to add to the error thrown for validation.\r\n */\r\nfunction errorPrefix(fnName, argumentNumber, optional) {\r\n    var argName = '';\r\n    switch (argumentNumber) {\r\n        case 1:\r\n            argName = optional ? 'first' : 'First';\r\n            break;\r\n        case 2:\r\n            argName = optional ? 'second' : 'Second';\r\n            break;\r\n        case 3:\r\n            argName = optional ? 'third' : 'Third';\r\n            break;\r\n        case 4:\r\n            argName = optional ? 'fourth' : 'Fourth';\r\n            break;\r\n        default:\r\n            throw new Error('errorPrefix called with argumentNumber > 4.  Need to update it?');\r\n    }\r\n    var error = fnName + ' failed: ';\r\n    error += argName + ' argument ';\r\n    return error;\r\n}\r\n/**\r\n * @param {!string} fnName\r\n * @param {!number} argumentNumber\r\n * @param {!string} namespace\r\n * @param {boolean} optional\r\n */\r\nfunction validateNamespace(fnName, argumentNumber, namespace, optional) {\r\n    if (optional && !namespace)\r\n        return;\r\n    if (typeof namespace !== 'string') {\r\n        //TODO: I should do more validation here. We only allow certain chars in namespaces.\r\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) +\r\n            'must be a valid firebase namespace.');\r\n    }\r\n}\r\nfunction validateCallback(fnName, argumentNumber, callback, optional) {\r\n    if (optional && !callback)\r\n        return;\r\n    if (typeof callback !== 'function')\r\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) +\r\n            'must be a valid function.');\r\n}\r\nfunction validateContextObject(fnName, argumentNumber, context, optional) {\r\n    if (optional && !context)\r\n        return;\r\n    if (typeof context !== 'object' || context === null)\r\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) +\r\n            'must be a valid context object.');\r\n}\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Code originally came from goog.crypt.stringToUtf8ByteArray, but for some reason they\r\n// automatically replaced '\\r\\n' with '\\n', and they didn't handle surrogate pairs,\r\n// so it's been modified.\r\n// Note that not all Unicode characters appear as single characters in JavaScript strings.\r\n// fromCharCode returns the UTF-16 encoding of a character - so some Unicode characters\r\n// use 2 characters in Javascript.  All 4-byte UTF-8 characters begin with a first\r\n// character in the range 0xD800 - 0xDBFF (the first character of a so-called surrogate\r\n// pair).\r\n// See http://www.ecma-international.org/ecma-262/5.1/#sec-15.1.3\r\n/**\r\n * @param {string} str\r\n * @return {Array}\r\n */\r\nvar stringToByteArray$1 = function (str) {\r\n    var out = [], p = 0;\r\n    for (var i = 0; i < str.length; i++) {\r\n        var c = str.charCodeAt(i);\r\n        // Is this the lead surrogate in a surrogate pair?\r\n        if (c >= 0xd800 && c <= 0xdbff) {\r\n            var high = c - 0xd800; // the high 10 bits.\r\n            i++;\r\n            assert(i < str.length, 'Surrogate pair missing trail surrogate.');\r\n            var low = str.charCodeAt(i) - 0xdc00; // the low 10 bits.\r\n            c = 0x10000 + (high << 10) + low;\r\n        }\r\n        if (c < 128) {\r\n            out[p++] = c;\r\n        }\r\n        else if (c < 2048) {\r\n            out[p++] = (c >> 6) | 192;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else if (c < 65536) {\r\n            out[p++] = (c >> 12) | 224;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else {\r\n            out[p++] = (c >> 18) | 240;\r\n            out[p++] = ((c >> 12) & 63) | 128;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n    }\r\n    return out;\r\n};\r\n/**\r\n * Calculate length without actually converting; useful for doing cheaper validation.\r\n * @param {string} str\r\n * @return {number}\r\n */\r\nvar stringLength = function (str) {\r\n    var p = 0;\r\n    for (var i = 0; i < str.length; i++) {\r\n        var c = str.charCodeAt(i);\r\n        if (c < 128) {\r\n            p++;\r\n        }\r\n        else if (c < 2048) {\r\n            p += 2;\r\n        }\r\n        else if (c >= 0xd800 && c <= 0xdbff) {\r\n            // Lead surrogate of a surrogate pair.  The pair together will take 4 bytes to represent.\r\n            p += 4;\r\n            i++; // skip trail surrogate.\r\n        }\r\n        else {\r\n            p += 3;\r\n        }\r\n    }\r\n    return p;\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nexport { assert, assertionError, base64, base64Decode, base64Encode, CONSTANTS, deepCopy, deepExtend, patchProperty, Deferred, getUA, isMobileCordova, isNodeSdk, isReactNative, ErrorFactory, FirebaseError, patchCapture, jsonEval, stringify, decode, isAdmin, issuedAtTime, isValidFormat, isValidTimestamp, clone, contains, every, extend, findKey, findValue, forEach, getAnyKey, getCount, getValues, isEmpty, isNonNullObject, map, safeGet, querystring, querystringDecode, Sha1, async, createSubscribe, errorPrefix, validateArgCount, validateCallback, validateContextObject, validateNamespace, stringLength, stringToByteArray$1 as stringToByteArray };\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/@firebase/util/dist/index.esm.js"],"sourceRoot":""}