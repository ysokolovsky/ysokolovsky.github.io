{"version":3,"sources":["webpack:///webpack/bootstrap b3987093a60818b3fff9","webpack:///./node_modules/preact/dist/preact.min.js","webpack:///./style.css?b85c","webpack:///./node_modules/classnames/index.js","webpack:///./node_modules/@firebase/polyfill/dist/index.esm.js","webpack:///./node_modules/firebase/app/dist/index.esm.js","webpack:///./node_modules/firebase/database/dist/index.esm.js","webpack:///./firebase.js","webpack:///./index.js","webpack:///./node_modules/@firebase/app/dist/index.esm.js","webpack:///./node_modules/tslib/tslib.es6.js","webpack:///./node_modules/@firebase/database/dist/index.esm.js","webpack:///./assets/style.css?a85e","webpack:///(webpack)/buildin/harmony-module.js","webpack:///./node_modules/@firebase/logger/dist/index.esm.js","webpack:///./node_modules/whatwg-fetch/fetch.js","webpack:///./node_modules/@firebase/util/dist/index.esm.js"],"names":["e","t","n","o","r","i","l","W","arguments","length","P","push","children","pop","a","T","nodeName","attributes","key","M","vnode","current","slice","call","__d","V","debounceRendering","D","x","splitText","_componentConstructor","__n","toLowerCase","u","defaultProps","c","document","createElementNS","createElement","p","parentNode","removeChild","s","style","cssText","E","test","innerHTML","__html","replace","substring","addEventListener","_","removeEventListener","__l","removeAttribute","removeAttributeNS","setAttributeNS","setAttribute","className","type","event","f","A","shift","afterMount","componentDidMount","d","H","R","ownerSVGElement","B","h","appendChild","_component","nodeValue","createTextNode","replaceChild","v","__preactattr_","N","firstChild","name","value","nextSibling","m","dangerouslySetInnerHTML","y","childNodes","b","g","w","C","k","__k","trim","insertBefore","ref","lastChild","previousSibling","F","prototype","render","U","constructor","__b","splice","__x","__r","getDerivedStateFromProps","base","componentWillMount","componentWillReceiveProps","context","__c","__p","props","syncComponentUpdates","state","__s","S","shouldComponentUpdate","componentWillUpdate","getChildContext","getSnapshotBeforeUpdate","L","__u","componentDidUpdate","afterUpdate","__h","beforeUnmount","componentWillUnmount","Promise","resolve","then","bind","setTimeout","setState","forceUpdate","j","cloneElement","createRef","Component","rerender","options","module","exports","self","preact","hasOwn","hasOwnProperty","classNames","classes","arg","argType","Array","isArray","inner","apply","join","default","define","window","setTimeoutFunc","noop","fn","thisArg","TypeError","_state","_handled","_value","undefined","_deferreds","doResolve","handle","deferred","_immediateFn","cb","onFulfilled","onRejected","reject","promise","ret","newValue","finale","_unhandledRejectionFn","len","Handler","done","reason","ex","prom","callback","all","arr","args","remaining","res","val","race","values","setImmediate","err","console","warn","globalNS","global","Error","createCommonjsModule","_global","Math","Function","__g","_core","core","version","__e","_core_1","_isObject","it","_anObject","_fails","exec","_descriptors","Object","defineProperty","get","is","_domCreate","_ie8DomDefine","_toPrimitive","toString","valueOf","dP","O","Attributes","_objectDp","_propertyDesc","bitmap","enumerable","configurable","writable","_hide","object","_has","id","px","random","_uid","concat","_redefine","SRC","TO_STRING","$toString","TPL","split","inspectSource","safe","isFunction","String","_aFunction","_ctx","that","PROTOTYPE","$export","source","IS_FORCED","IS_GLOBAL","G","IS_STATIC","IS_PROTO","IS_BIND","target","expProto","own","out","exp","_export","_cof","_iobject","propertyIsEnumerable","_defined","_toObject","ceil","floor","_toInteger","isNaN","min","_toLength","_isArray","SHARED","store","_shared","_wks","Symbol","USE_SYMBOL","$exports","SPECIES","_arraySpeciesConstructor","original","_arraySpeciesCreate","_arrayMethods","TYPE","$create","IS_MAP","IS_FILTER","IS_SOME","IS_EVERY","IS_FIND_INDEX","NO_HOLES","create","$this","callbackfn","index","result","UNSCOPABLES","ArrayProto","_addToUnscopables","$find","KEY","forced","find","$find$1","KEY$1","forced$1","findIndex","_toIobject","max","min$1","_toAbsoluteIndex","_arrayIncludes","IS_INCLUDES","el","fromIndex","shared","_sharedKey","arrayIndexOf","IE_PROTO","_objectKeysInternal","names","_enumBugKeys","_objectKeys","keys","f$1","getOwnPropertySymbols","_objectGops","f$2","_objectPie","$assign","assign","_objectAssign","K","forEach","aLen","getSymbols","isEnum","MATCH","_isRegexp","isRegExp","_stringContext","searchString","NAME","MATCH$1","_failsIsRegexp","re","STARTS_WITH","$startsWith","startsWith","search","_stringRepeat","repeat","count","str","Infinity","RangeError","_meta","META","setDesc","isExtensible","FREEZE","preventExtensions","setMeta","fastKey","getWeak","onFreeze","meta","NEED","_meta_1","_meta_2","_meta_3","_meta_4","_meta_5","def","TAG","_setToStringTag","tag","stat","f$3","_wksExt","_library","_wksDefine","$Symbol","charAt","_enumKeys","symbols","_objectDps","defineProperties","Properties","document$1","_html","documentElement","IE_PROTO$1","Empty","PROTOTYPE$1","createDict","iframe","lt","gt","iframeDocument","display","src","contentWindow","open","write","close","_objectCreate","hiddenKeys","f$4","getOwnPropertyNames","_objectGopn","gOPN","toString$1","windowNames","getWindowNames","f$5","_objectGopnExt","gOPD","getOwnPropertyDescriptor","f$6","_objectGopd","gOPD$1","dP$1","gOPN$1","$JSON","JSON","_stringify","stringify","PROTOTYPE$2","HIDDEN","TO_PRIMITIVE","SymbolRegistry","AllSymbols","OPSymbols","ObjectProto","USE_NATIVE","QObject","setter","findChild","setSymbolDesc","protoDesc","wrap","sym","_k","isSymbol","iterator","$defineProperty","$defineProperties","$propertyIsEnumerable","$getOwnPropertyDescriptor","$getOwnPropertyNames","$getOwnPropertySymbols","IS_OP","$set","set","es6Symbols","wellKnownSymbols","keyFor","useSetter","useSimple","replacer","$replacer","TAG$1","ARG","tryGet","_classof","callee","symbol","_stringAt","pos","charCodeAt","_iterators","IteratorPrototype","_iterCreate","Constructor","next","IE_PROTO$2","ObjectProto$1","_objectGpo","getPrototypeOf","ITERATOR","BUGGY","FF_ITERATOR","KEYS","VALUES","returnThis","_iterDefine","Base","DEFAULT","IS_SET","FORCED","getMethod","kind","proto","entries","DEF_VALUES","VALUES_BUG","$native","$default","$entries","$anyNative","methods","$at","iterated","_t","_i","point","_iterStep","es6_array_iterator","Arguments","ITERATOR$1","TO_STRING_TAG","ArrayValues","DOMIterables","CSSRuleList","CSSStyleDeclaration","CSSValueList","ClientRectList","DOMRectList","DOMStringList","DOMTokenList","DataTransferItemList","FileList","HTMLAllCollection","HTMLCollection","HTMLFormElement","HTMLSelectElement","MediaList","MimeTypeArray","NamedNodeMap","NodeList","PaintRequestList","Plugin","PluginArray","SVGLengthList","SVGNumberList","SVGPathSegList","SVGPointList","SVGStringList","SVGTransformList","SourceBufferList","StyleSheetList","TextTrackCueList","TextTrackList","TouchList","collections","explicit","Collection","firebase","config","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","initializeApp","App","word","translation","translations","addWord","addTranslation","showStartPage","showAddNewWord","showWordAdded","isShowAddNewBlock","handleChange","checkWord","handleAddWordChange","handleAddTranslationChange","obj","translationsRef","database","item","populate","map","showAddNew","showAddNewText","hideAddNew","toggleAddNewWord","hideStartPage","on","snapshot","newState","onclick","require","addNewClass","contains","DEFAULT_ENTRY_NAME","tokenListeners","FirebaseAppImpl","firebase_","isDeleted_","services_","name_","_automaticDataCollectionEnabled","automaticDataCollectionEnabled","options_","deepCopy","INTERNAL","getUid","getToken","addAuthTokenListener","removeAuthTokenListener","filter","listener","checkDestroyed_","delete","_this","removeApp","services","serviceKey","instanceKey","service","_getService","instanceIdentifier","instanceSpecifier","factories","extendApp","deepExtend","error","log","createFirebaseNamespace","apps_","appHooks","namespace","__esModule","app","apps","SDK_VERSION","registerService","extendNamespace","createSubscribe","ErrorFactory","useAsService","patchProperty","getApps","callAppHooks","rawConfig","name_1","createService","serviceProperties","appHook","allowMultipleInstances","serviceNamespace","appArg","serviceFxn","eventName","serviceName","factoryName","useService","code","appErrors","errors","extendStatics","setPrototypeOf","__proto__","__extends","__","__assign","__rest","indexOf","__decorate","decorators","desc","Reflect","decorate","__param","paramIndex","decorator","__metadata","metadataKey","metadataValue","metadata","__awaiter","_arguments","generator","fulfilled","step","rejected","__generator","body","label","sent","trys","ops","verb","op","__exportStar","__values","__read","ar","__spread","__await","__asyncGenerator","asyncIterator","q","resume","settle","fulfill","__asyncDelegator","__asyncValues","__makeTemplateObject","cooked","raw","__importStar","mod","__importDefault","DOMStorageWrapper","domStorage_","prefix_","removeItem","prefixedName_","setItem","storedVal","getItem","jsonEval","remove","MemoryStorage","cache_","isInMemoryStorage","createStoragefor","domStorageName","domStorage","PersistentStorage","SessionStorage","logClient","Logger","LUIDGenerator","sha1","utf8Bytes","stringToByteArray","Sha1","update","sha1Bytes","digest","base64","encodeByteArray","buildLogMessage_","var_args","message","logger","firstLog_","enableLogging","logger_","persistent","assert","logLevel","LogLevel","VERBOSE","logWrapper","prefix","fatal","warnIfPageIsSecure","location","protocol","isInvalidJSONNumber","data","Number","POSITIVE_INFINITY","NEGATIVE_INFINITY","executeWhenDOMReady","isNodeSdk","readyState","called_1","wrappedFn_1","attachEvent","MIN_NAME","MAX_NAME","nameCompare","aAsInt","tryParseInt","bAsInt","stringCompare","requireKey","ObjectToUniqueKey","sort","splitStringBySize","segsize","dataSegs","each","doubleToIEEE754String","ebits","fbits","bias","ln","bits","abs","pow","LN2","round","reverse","hexByteString","hexByte","parseInt","substr","isChromeExtensionContentScript","href","isWindowsStoreApp","Windows","UI","errorForServerCode","query","path","toUpperCase","INTEGER_REGEXP_","RegExp","intVal","exceptionGuard","stack","beingCrawled","userAgent","setTimeoutNonBlocking","time","timeout","Path","pathOrString","pieceNum","pieces_","copyTo","pieceNum_","getFront","getLength","popFront","getBack","pathString","toUrlEncodedString","encodeURIComponent","begin","parent","pieces","child","childPathObj","childPieces","isEmpty","relativePath","outerPath","innerPath","outer","comparePaths","left","right","leftKeys","rightKeys","cmp","equals","other","ValidationPath","errorPrefix_","parts_","byteLength_","stringLength","checkValid_","last","MAX_PATH_LENGTH_BYTES","MAX_PATH_DEPTH","toErrorString","PROTOCOL_VERSION","VERSION_PARAM","TRANSPORT_SESSION_PARAM","REFERER_PARAM","FORGE_REF","FORGE_DOMAIN","LAST_SESSION_PARAM","WEBSOCKET","LONG_POLLING","RepoInfo","host","secure","webSocketOnly","persistenceKey","domain","internalHost","needsQueryParam","isCustomHost","isCacheableHost","isDemoHost","updateHost","newHost","connectionURL","params","connURL","pairs","toURLString","decodePath","pathStringDecoded","piece","decodeURIComponent","decodeQuery","queryString","results","_a","segment","kv","parseRepoInfo","dataURL","parsedUrl","parseURL","subdomain","scheme","repoInfo","port","colonInd","slashInd","questionMarkInd","queryParams","parts","INVALID_KEY_REGEX_","INVALID_PATH_REGEX_","MAX_LEAF_SIZE_","isValidKey","isValidPathString","isValidRootPathString","isValidPriority","priority","validateFirebaseDataArg","fnName","argumentNumber","optional","validateFirebaseData","errorPrefix","errorPrefix$$1","path_","hasDotValue_1","hasActualChild_1","validateFirebaseMergePaths","mergePaths","curPath","prevPath","validateFirebaseMergeDataArg","validatePriority","validateEventType","eventType","validateKey","validatePathString","validateRootPathString","validateWritablePath","validateUrl","validateBoolean","bool","OnDisconnect","repo_","cancel","onComplete","validateArgCount","validateCallback","Deferred","onDisconnectCancel","wrapCallback","onDisconnectSet","setWithPriority","onDisconnectSetWithPriority","objectToMerge","newObjectToMerge","onDisconnectUpdate","TransactionResult","committed","toJSON","nextPushId","PUSH_CHARS","lastPushTime","lastRandChars","now","duplicateTime","timeStampChars","NamedNode","node","Wrap","Index","getCompare","compare","indexedValueChanged","oldNode","newNode","oldWrapped","newWrapped","minPost","MIN","__EMPTY_NODE","KeyIndex","_super","isDefinedOn","assertionError","maxPost","makePost","indexValue","KEY_INDEX","MAX_NODE","setMaxNode","priorityHashText","validatePriorityNode","priorityNode","isLeafNode","getPriority","__childrenNodeConstructor","LeafNode","value_","priorityNode_","EMPTY_NODE","lazyHash_","updatePriority","newPriorityNode","getImmediateChild","childName","getChild","hasChild","getPredecessorChildName","childNode","updateImmediateChild","newChildNode","updateChild","front","numChildren","forEachChild","action","exportFormat","getValue","hash","toHash","compareTo","compareToLeafNode_","otherLeaf","otherLeafType","thisLeafType","otherIndex","VALUE_TYPE_ORDER","thisIndex","withIndex","isIndexed","nodeFromJSON","MAX_NODE$1","setNodeFromJSON","setMaxNode$1","PriorityIndex","aPriority","bPriority","indexCmp","PRIORITY_INDEX","SortedMapIterator","startKey","comparator","isReverse_","resultGenerator_","nodeStack_","getNext","hasNext","peek","LLRBNode","color","RED","SortedMap","copy","inorderTraversal","reverseTraversal","min_","minKey","maxKey","insert","fixUp_","removeMin_","isRed_","moveRedLeft_","smallest","rotateRight_","moveRedRight_","rotateLeft_","colorFlip_","nl","nr","checkMaxDepth_","blackDepth","check_","BLACK","LLRBEmptyNode","comparator_","root_","getPredecessorKey","rightParent","getIterator","resultGenerator","getIteratorFrom","getReverseIteratorFrom","getReverseIterator","LOG_2","Base12Num","logBase2","num","bitMask","current_","mask","bits_","nextBitIsOne","buildChildSet","childList","keyFn","mapSortFn","buildBalancedTree","low","high","namedNode","middle","buildFrom12Array","base12","root","buildPennant","chunkSize","childTree","attachPennant","pennant","isOne","_defaultIndexMap","fallbackObject","IndexMap","indexes_","indexSet_","indexKey","sortedMap","safeGet","hasIndex","indexDefinition","addIndex","existingChildren","sawIndexedValue","iter","newIndex","indexName","newIndexSet","clone","newIndexes","addToIndexes","indexedChildren","existingSnap","newChildren","removeFromIndexes","NAME_ONLY_COMPARATOR","NAME_COMPARATOR","ChildrenNode","children_","indexMap_","Default","newIndexMap","newPriority","newImmediateChild","numKeys","allIntegerKeys","array","toHash_1","childHash","idx","resolveIndex_","predecessor","getFirstChildName","getFirstChild","getLastChildName","getLastChild","wrappedNode","startPost","endPost","MAX_NODE$2","otherChildrenNode","thisIter","otherIter","thisCurrent","otherCurrent","MaxNode","MAX","USE_HINZE","nodeFromJSON$1","json","jsonLeaf","children_1","childrenHavePriority_1","hinzeJsonObj_1","childSet","sortedChildSet","node_1","jsonObj_1","childData","ValueIndex","valueNode","VALUE_INDEX","PathIndex","indexPath_","extractChild","snap","aChild","bChild","DataSnapshot","node_","ref_","index_","exportVal","exists","childPathString","childPath","childRef","childrenNode","hasChildren","getKey","getRef","DataEvent","eventRegistration","prevName","getPath","getParent","getEventType","getEventRunner","CancelEvent","ValueEventRegistration","callback_","cancelCallback_","context_","respondsTo","createEvent","change","getQueryParams","getIndex","snapshotNode","eventData","ctx","cancelCB_1","cb_1","createCancelEvent","matches","hasAnyCallback","ChildEventRegistration","callbacks_","eventToCheck","cancelCB_2","cb_2","otherCount","getCount","thisCount","otherKey","getAnyKey","thisKey","every","__referenceConstructor","Query","repo","queryParams_","orderByCalled_","validateQueryEndpoints_","startNode","endNode","hasStart","getIndexStartValue","hasEnd","getIndexEndValue","tooManyArgsError","wrongArgTypeError","startName","getIndexStartName","endName","getIndexEndName","validateLimit_","hasLimit","hasAnchoredLimit","validateNoPreviousOrderByCall_","cancelCallbackOrContext","getCancelAndContextArgs_","onValueEvent","callbacks","onChildEvent","cancelCallback","container","addEventCallbackForQuery","off","validateContextObject","valueCallback","removeEventCallbackForQuery","once","userCallback","cancelOrContext","firstCall","catch","onceCallback","limitToFirst","limit","limitToLast","orderByChild","parsedPath","newParams","orderBy","orderByKey","orderByPriority","orderByValue","startAt","endAt","equalTo","queryObject","getQueryObject","queryIdentifier","isEqual","error$$1","sameRepo","samePath","sameQueryIdentifier","CountedSet","add","clear","SparseSnapshotTree","childKey","remember","forget","self_1","tree","safeToRemove","forEachTree","prefixPath","func","generateWithValues","Date","getTime","resolveDeferredValue","serverValues","resolveDeferredValueTree","resolvedTree","resolveDeferredValueSnapshot","rawPri","leafNode","OperationType","OperationSource","fromUser","fromServer","queryId","tagged","User","Server","forServerTaggedQuery","AckUserWrite","affectedTree","revert","ACK_USER_WRITE","operationForChild","subtree","emptyChildrenSingleton","EmptyChildren","ImmutableTree","fromObject","childSnap","findRootMostMatchingPathAndValue","predicate","childExistingPathAndValue","fullPath","findRootMostValueAndPath","toSet","newChild","setTree","newTree","fold","fold_","pathSoFar","accum","findOnPath","findOnPath_","pathToFollow","nextChild","foreachOnPath","foreachOnPath_","currentRelativePath","foreach","foreach_","foreachChild","ListenComplete","LISTEN_COMPLETE","Overwrite","OVERWRITE","Merge","MERGE","CacheNode","fullyInitialized_","filtered_","isFullyInitialized","isFiltered","isCompleteForPath","isCompleteForChild","getNode","ViewCache","eventCache_","serverCache_","updateEventSnap","eventSnap","complete","filtered","updateServerSnap","serverSnap","getEventCache","getCompleteEventSnap","getServerCache","getCompleteServerSnap","Change","oldSnap","valueChange","VALUE","childAddedChange","CHILD_ADDED","childRemovedChange","CHILD_REMOVED","childChangedChange","newSnapshot","oldSnapshot","CHILD_CHANGED","childMovedChange","CHILD_MOVED","IndexedFilter","affectedPath","optChangeAccumulator","oldChild","trackChildChange","updateFullNode","newSnap","filtersNodes","getIndexedFilter","ChildChangeAccumulator","changeMap_","oldChange","oldType","getChanges","getValues","NoCompleteChildSource_","getCompleteChild","getChildAfterChild","NO_COMPLETE_CHILD_SOURCE","WriteTreeCompleteChildSource","writes_","viewCache_","optCompleteServerCache_","serverNode","calcCompleteChild","completeServerData","nodes","calcIndexedSlice","ProcessorResult","viewCache","changes","ViewProcessor","filter_","assertIndexed","applyOperation","oldViewCache","operation","writesCache","completeCache","accumulator","newViewCache","filterServerNode","overwrite","applyUserOverwrite_","applyServerOverwrite_","merge","applyUserMerge_","applyServerMerge_","ackUserWrite","ackUserWrite_","revertUserWrite_","listenComplete_","maybeAddValueEvent_","isLeafOrEmpty","oldCompleteSnap","generateEventCacheAfterServerEvent_","changePath","oldEventSnap","shadowingWrite","newEventCache","serverCache","completeChildren","completeEventChildren","calcCompleteEventChildren","completeNode","calcCompleteEventCache","oldEventNode","updatedPriority","calcEventCacheAfterServerOverwrite","childChangePath","newEventChild","eventChildUpdate","changedSnap","oldServerSnap","newServerCache","serverFilter","newServerNode","newEventSnap","cacheHasChild_","changedChildren","curViewCache","writePath","applyMerge_","viewMergeTree","serverChild","childMergeTree","isUnknownDeepMerge","ackPath","changedChildren_1","changedChildren_2","mergePath","serverCachePath","oldServerNode","completeServerCache","oldEventCache","serverChildren","EventGenerator","query_","generateEventsForChanges","eventCache","eventRegistrations","events","moves","generateEventsForType_","registrations","filteredChanges","compareChanges_","materializedChange","materializeSingleChange_","registration","aWrapped","bWrapped","View","initialViewCache","eventRegistrations_","indexFilter","getNodeFilter","processor_","initialServerCache","initialEventCache","eventGenerator_","getQuery","getCompleteServerCache","cache","loadsAllData","addEventRegistration","removeEventRegistration","cancelError","cancelEvents","path_1","maybeEvent","existing","generateEventsForChanges_","getInitialEvents","initialChanges","eventNode","__referenceConstructor$1","SyncPoint","views_","optCompleteServerCache","view","events_1","serverCacheComplete","eventCacheComplete","removed","hadCompleteView","hasCompleteView","viewQueryId","getQueryViews","viewForQuery","getCompleteView","viewExistsForQuery","completeView","findValue","CompoundWrite","writeTree_","addWrite","rootmost","rootMostPath","newWriteTree","addWrites","updates","newWrite","removeWrite","hasCompleteWrite","getCompleteNode","getCompleteChildren","childCompoundWrite","shadowingNode","applySubtreeWrite_","writeTree","priorityWrite_1","WriteTree","visibleWrites_","allWrites_","lastWriteId_","childWrites","WriteTreeRef","addOverwrite","writeId","visible","addMerge","getWrite","record","writeToRemove","removedWriteWasVisible","removedWriteOverlapsWithOtherWrites","currentWrite","recordContainsPath_","resetTree_","getCompleteWriteData","treePath","writeIdsToExclude","includeHiddenWrites","subMerge","layeredCache","mergeAtPath","layerTree_","completeServerChildren","topLevelSet","merge_1","existingEventSnap","existingServerSnap","childMerge","toIterate","writeRecord","findKey","DefaultFilter_","writes","treeRoot","compoundWrite","deepNode","treePath_","existingServerCache","SyncTree","listenProvider_","syncPointTree_","pendingWriteTree_","tagToQueryMap_","queryToTagMap_","applyUserOverwrite","newData","applyOperationToSyncPoints_","applyUserMerge","changeTree","needToReevaluate","affectedTree_1","applyServerOverwrite","applyServerMerge","applyListenComplete","applyTaggedQueryOverwrite","queryKey","queryKeyForTag_","parseQueryKey_","queryPath","applyTaggedOperation_","applyTaggedQueryMerge","applyTaggedListenComplete","foundAncestorDefaultView","pathToSyncPoint","sp","syncPoint","childSyncPoint","viewAlreadyExists","makeQueryKey_","getNextQueryTag_","setupListener_","maybeSyncPoint","removedAndEvents","removingDefault","covered","parentSyncPoint","newViews","collectDistinctViewsForSubTree_","newQuery","createListenerForView_","startListening","queryForListening_","tagForQuery_","hashFn","defaultTag","stopListening","queryToRemove","tagToRemove","removeTags_","includeHiddenSets","maybeChildSyncPoint","childMap","views_1","childViews","queries","removedQuery","removedQueryKey","removedQueryTag","isDefault","queriesToStop","queries_1","childQueries","queryToStop","status","splitIndex","nextQueryTag_","applyOperationHelper_","syncPointTree","applyOperationDescendantsHelper_","childOperation","childServerCache","childWritesCache","SnapshotHolder","rootNode_","updateSnapshot","newSnapshotNode","AuthTokenProvider","app_","forceRefresh","addTokenChangeListener","removeTokenChangeListener","notifyForInvalidToken","errorMessage","StatsCollection","counters_","incrementCounter","amount","StatsManager","getCollection","hashString","collections_","getOrCreateReporter","creatorFunction","reporters_","StatsListener","collection_","last_","newStats","delta","FIRST_STATS_MIN_TIME","FIRST_STATS_MAX_TIME","REPORT_STATS_INTERVAL","StatsReporter","collection","server_","statsToReport_","statsListener_","reportStats_","includeStat","stats","reportedStats","haveStatsToReport","reportStats","EventQueue","eventLists_","recursionDepth_","queueEvents","eventDataList","currList","eventPath","EventList","raiseEventsAtPath","raiseQueuedEventsMatchingPredicate_","raiseEventsForChangedPath","changedPath","sentAll","eventList","raise","events_","eventFn","EventEmitter","allowedEvents_","listeners_","trigger","listeners","validateEventType_","getInitialEvent","et","VisibilityMonitor","hidden","visibilityChange","visible_","getInstance","OnlineMonitor","online_","isMobileCordova","currentlyOnline","PacketReceiver","onMessage_","pendingResponses","currentResponseNum","closeAfterResponse","onClose","closeAfter","responseNum","handleResponse","requestNum","_loop_1","toProcess","this_1","_loop_2","state_1","FIREBASE_LONGPOLL_START_PARAM","FIREBASE_LONGPOLL_CLOSE_COMMAND","FIREBASE_LONGPOLL_COMMAND_CB_NAME","FIREBASE_LONGPOLL_DATA_CB_NAME","FIREBASE_LONGPOLL_ID_PARAM","FIREBASE_LONGPOLL_PW_PARAM","FIREBASE_LONGPOLL_SERIAL_PARAM","FIREBASE_LONGPOLL_CALLBACK_ID_PARAM","FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM","FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET","FIREBASE_LONGPOLL_DATA_PARAM","FIREBASE_LONGPOLL_DISCONN_FRAME_PARAM","FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM","MAX_URL_DATA_SIZE","SEG_HEADER_SIZE","MAX_PAYLOAD_SIZE","KEEPALIVE_REQUEST_INTERVAL","LP_CONNECT_TIMEOUT","BrowserPollConnection","connId","transportSessionId","lastSessionId","bytesSent","bytesReceived","everConnected_","log_","stats_","urlFn","onMessage","onDisconnect","curSegmentNum","onDisconnect_","myPacketOrderer","isClosed_","connectTimeoutTimer_","onClosed_","scriptTagHolder","FirebaseIFrameScriptHolder","command","arg1","arg2","incrementIncomingBytes_","clearTimeout","password","sendNewPolls","pN","urlParams","uniqueCallbackIdentifier","connectURL","addTag","start","startLongPoll","addDisconnectPingFrame","forceAllow","forceAllow_","forceDisallow","forceDisallow_","isAvailable","markConnectionHealthy","shutdown_","myDisconnFrame","send","dataStr","base64data","base64Encode","enqueueSegment","pw","commandCB","onMessageCB","outstandingRequests","pendingSegs","currentSerial","myIFrame","createIFrame_","script","currentDomain","iframeContents","doc","contentDocument","alive","myID","myPW","theURL","nodeRestRequest","newRequest_","curDataString","nextSeg","theSeg","seg","ts","addLongPollTag_","segnum","totalsegs","url","serial","doNewRequest","keepaliveTimeout","readyStateCB","loadCB","doNodeLongPoll","newScript_1","async","onload","onreadystatechange","rstate","onerror","WEBSOCKET_MAX_FRAME_SIZE","WEBSOCKET_KEEPALIVE_INTERVAL","WebSocketImpl","MozWebSocket","WebSocket","WebSocketConnection","keepaliveTimer","frames","totalFrames","connectionURL_","device","CONSTANTS","NODE_ADMIN","headers","process","platform","env","proxy","origin","mySock","onopen","onclose","onmessage","handleIncomingFrame","isOldAndroid","navigator","oldAndroidRegex","oldAndroidMatch","match","parseFloat","previouslyFailed","appendFrame_","fullMess","jsonMess","handleNewFrameCount_","frameCount","extractFrameCount_","mess","resetKeepAlive","remainingData","sendString_","clearInterval","setInterval","responsesRequiredToBeHealthy","healthyTimeout","TransportManager","initTransports_","isWebSocketsAvailable","isSkipPollConnection","transports_","transports_1","ALL_TRANSPORTS","transport","initialTransport","upgradeTransport","UPGRADE_TIMEOUT","DELAY_BEFORE_SENDING_EXTRA_REQUESTS","BYTES_SENT_HEALTHY_OVERRIDE","BYTES_RECEIVED_HEALTHY_OVERRIDE","MESSAGE_TYPE","MESSAGE_DATA","CONTROL_SHUTDOWN","CONTROL_RESET","CONTROL_ERROR","CONTROL_PONG","SWITCH_ACK","END_TRANSMISSION","PING","SERVER_HELLO","Connection","repoInfo_","onReady_","onKill_","connectionCount","pendingDataMessages","state_","transportManager_","start_","conn","conn_","nextTransportId_","primaryResponsesRequired_","onMessageReceived","connReceiver_","onConnectionLost","disconnReceiver_","tx_","rx_","secondaryConn_","isHealthy_","healthyTimeout_ms","healthyTimeout_","everConnected","onConnectionLost_","onSecondaryConnectionLost_","onPrimaryMessageReceived_","onSecondaryMessageReceived_","sendRequest","dataMsg","msg","sendData_","tryCleanupConnection","onSecondaryControl_","controlData","cmd","upgradeIfSecondaryHealthy_","secondaryResponsesRequired_","parsedData","layer","proceedWithUpgrade_","onControl_","onDataMessage_","onPrimaryResponse_","payload","onHandshake_","onConnectionShutdown_","onReset_","sendPingOnPrimaryIfNecessary_","handshake","timestamp","sessionId","onConnectionEstablished_","tryStartUpgrade_","startUpgrade_","closeConnections_","ServerActions","put","refreshAuthToken","token","onDisconnectPut","onDisconnectMerge","RECONNECT_MIN_DELAY","RECONNECT_MAX_DELAY_DEFAULT","RECONNECT_MAX_DELAY_FOR_ADMINS","RECONNECT_DELAY_MULTIPLIER","RECONNECT_DELAY_RESET_TIMEOUT","SERVER_KILL_INTERRUPT_REASON","INVALID_AUTH_TOKEN_THRESHOLD","PersistentConnection","onDataUpdate_","onConnectStatus_","onServerInfoUpdate_","authTokenProvider_","authOverride_","nextPersistentConnectionId_","interruptReasons_","listens_","outstandingPuts_","outstandingPutCount_","onDisconnectRequestQueue_","connected_","reconnectDelay_","maxReconnectDelay_","securityDebugCallback_","establishConnectionTimer_","requestCBHash_","requestNumber_","realtime_","authToken_","forceTokenRefresh_","invalidAuthTokenCount_","firstConnection_","lastConnectionAttemptTime_","lastConnectionEstablishedTime_","scheduleConnect_","onVisible_","onOnline_","onResponse","curReqNum","listen","currentHashFn","listenSpec","sendListen_","req","warnOnListenWarnings_","currentListenSpec","removeListen_","warnings","indexSpec","indexPath","tryAuth","reduceReconnectDelayIfAdminCredential_","credential","isFirebaseSecret","isAdmin","token_1","authMethod","isValidFormat","requestData","cred","onAuthRevoked_","unlisten","sendUnlisten_","queryObj","sendOnDisconnect_","request","response","putInternal","sendPut_","queued","errorReason","reqNum","onDataPush_","onListenRevoked_","onSecurityDebugPacket_","handleTimestamp_","sendConnectStats_","restoreState_","establishConnection_","online","onRealtimeDisconnect_","cancelSentTransactions_","shouldReconnect_","timeSinceLastConnectSucceeded","timeSinceLastConnectAttempt","reconnectDelay","onDataMessage_1","onReady_1","onDisconnect_1","connId_1","nextConnectionId_","lastSessionId_1","canceled_1","connection_1","closeFn_1","sendRequestFn","accessToken","interrupt","serverTimeOffset","normalizedPathString","statusCode","explanation","clientName","NODE_CLIENT","isReactNative","ReadonlyRestClient","getListenId_","listenId","thisListen","queryStringParameters","toRestQueryStringParameters","restRequest_","status_1","authTokenData","authToken","querystring","xhr","XMLHttpRequest","responseText","INTERRUPT_REASON","Repo","forceRestClient","dataUpdateCount","eventQueue_","nextWriteId_","interceptServerDataCallback_","persistentConnection_","authTokenProvider","authOverride","statsReporter_","transactions_init_","infoData_","infoSyncTree_","infoEvents","updateInfo_","serverSyncTree_","serverTime","offsetNode","offset","generateServerValues","isMerge","taggedChildren","taggedSnap","rerunTransactions_","interceptServerData_","connectStatus","runOnDisconnectEvents_","getNextWriteId_","newVal","newNodeUnresolved","success","clearEvents","callOnCompleteCallback","abortTransactions_","childrenToMerge","empty","changedKey","changedValue","writeId_1","resolvedOnDisconnectTree","showDelta","longestName","reduce","previousValue","currentValue","statsIncrementCounter","metric","__database","Database","RangedFilter","indexedFilter_","startPost_","getStartPost_","endPost_","getEndPost_","getStartPost","getEndPost","LimitedFilter","rangedFilter_","limit_","getLimit","reverse_","isViewFromLeft","fullLimitUpdateChild_","inRange","indexCompare_1","foundStartPost","changeAccumulator","indexCmp_1","newChildNamedNode","windowBoundary","oldChildSnap","compareNext","remainsInWindow","nextChildInRange","QueryParams","limitSet_","startSet_","startNameSet_","endSet_","endNameSet_","viewFrom_","indexStartValue_","indexStartName_","indexEndValue_","indexEndName_","WIRE_PROTOCOL_CONSTANTS_","VIEW_FROM_LEFT","copy_","newLimit","VIEW_FROM_RIGHT","WIRE_PROTOCOL_CONSTANTS","INDEX_START_VALUE","INDEX_START_NAME","INDEX_END_VALUE","INDEX_END_NAME","LIMIT","viewFrom","VIEW_FROM","INDEX","REST_CONSTANTS","REST_QUERY_CONSTANTS_","qs","ORDER_BY","START_AT","END_AT","LIMIT_TO_FIRST","LIMIT_TO_LAST","Reference","parentPath","getRoot","databaseProp","transaction","transactionUpdate","applyLocally","promiseComplete","startTransaction","setPriority","thennablePushRef","pushRef","TreeNode","childCount","Tree","parent_","subTree","pathObj","setValue","updateParents_","forEachDescendant","includeSelf","childrenFirst","forEachAncestor","forEachImmediateDescendantWithValue","updateChild_","childEmpty","childExists","TransactionStatus","MAX_TRANSACTION_RETRIES_","transactionQueueTree_","watchRef","unwatcher","order","retryCount","abortReason","currentWriteId","currentInputSnapshot","currentOutputSnapshotRaw","currentOutputSnapshotResolved","currentState","getLatestState_","RUN","queueNode","nodeQueue","priorityForNode","currentNode","sendReadyTransactions_","excludeSets","pruneCompletedTransactionsBelowNode_","queue","buildTransactionQueue_","allRun","sendTransactionQueue_","setsToIgnore","txn","latestState","snapToSend","latestHash","SENT","dataToSend","pathToSend","COMPLETED","SENT_NEEDS_ABORT","NEEDS_ABORT","rootMostTransactionNode","getAncestorTransactionNode_","rerunTransactionQueue_","txnsToRerun","abortTransaction","newDataNode","hasExplicitPriority","oldWriteId","newNodeResolved","lastInput","transactionNode","transactionQueue","aggregateTransactionQueuesForNode_","to","from","abortTransactionsOnNode_","lastSent","DATABASE_URL_OPTION","_staticInstance","RepoManager","repos_","useRestClient_","appName","dbUrl","databaseFromApp","createRepo","deleteRepo","appRepos","DatabaseInternals","checkDeleted_","refFromURL","apiName","parsedURL","goOffline","goOnline","ServerValue","TIMESTAMP","forceLongPolling","forceWebSockets","setSecurityDebugCallback","interceptServerData","freeze","DataConnection","simpleListen","echo","onEcho","RealTimeConnection","hijackHash","newHash","oldPut","opt_onComplete","opt_hash","ConnectionTarget","listens","firebaseRef","TEST_ACCESS","registerDatabase","instance","unused","originalModule","webpackPolyfill","instances","defaultLogLevel","INFO","defaultLogHandler","logType","toISOString","DEBUG","info","WARN","ERROR","_logLevel","_logHandler","debug","setLogLevel","level","inst","fetch","support","searchParams","iterable","blob","Blob","formData","arrayBuffer","viewClasses","isDataView","DataView","isPrototypeOf","isArrayBufferView","ArrayBuffer","isView","normalizeName","normalizeValue","iteratorFor","items","Headers","append","header","oldValue","has","consumed","bodyUsed","fileReaderReady","reader","readBlobAsArrayBuffer","FileReader","readAsArrayBuffer","readBlobAsText","readAsText","readArrayBufferAsText","buf","Uint8Array","chars","fromCharCode","bufferClone","byteLength","buffer","Body","_initBody","_bodyInit","_bodyText","_bodyBlob","FormData","_bodyFormData","URLSearchParams","_bodyArrayBuffer","text","decode","parse","normalizeMethod","method","upcased","Request","input","credentials","mode","referrer","form","bytes","parseHeaders","rawHeaders","preProcessedHeaders","line","Response","bodyInit","ok","statusText","redirectStatuses","redirect","init","getAllResponseHeaders","responseURL","ontimeout","withCredentials","responseType","setRequestHeader","polyfill","assertion","byteArrayToString","c1","c2","c3","c4","byteToCharMap_","charToByteMap_","byteToCharMapWebSafe_","charToByteMapWebSafe_","ENCODED_VALS_BASE","ENCODED_VALS","ENCODED_VALS_WEBSAFE","HAS_NATIVE_SUPPORT","atob","opt_webSafe","init_","byteToCharMap","output","byte1","haveByte2","byte2","haveByte3","byte3","outByte1","outByte2","outByte3","outByte4","encodeString","btoa","decodeString","decodeStringToByteArray","charToByteMap","haveByte4","byte4","base64Decode","dateValue","prop","getUA","ERROR_NAME","captureStackTrace","patchCapture","captureFake","FirebaseError","pattern","template","fullCode","claims","signature","isValidTimestamp","validSince","validUntil","issuedAtTime","decoded","extend","objTo","objFrom","isNonNullObject","rv","opt_obj","opt_this","querystringParams","arrayVal","querystringDecode","tokens","Hash","blockSize","chain_","buf_","W_","pad_","inbuf_","total_","reset","compress_","opt_offset","opt_length","lengthMinusBlock","inbuf","totalBits","executor","onNoObservers","ObserverProxy","subscribe","observers","unsubscribes","observerCount","task","finalized","forEachObserver","observer","nextOrObserver","implementsAnyMethods","unsub","unsubscribeOne","finalError","sendOne","onError","methods_1","minCount","maxCount","argCount","argError","argName","validateNamespace","stringToByteArray$1"],"mappings":"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","file":"ssr-bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"JkW7\");\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap b3987093a60818b3fff9","!function(){\"use strict\";function e(e,t){var n,o,r,i,l=W;for(i=arguments.length;i-- >2;)P.push(arguments[i]);t&&null!=t.children&&(P.length||P.push(t.children),delete t.children);while(P.length)if((o=P.pop())&&void 0!==o.pop)for(i=o.length;i--;)P.push(o[i]);else\"boolean\"==typeof o&&(o=null),(r=\"function\"!=typeof e)&&(null==o?o=\"\":\"number\"==typeof o?o+=\"\":\"string\"!=typeof o&&(r=!1)),r&&n?l[l.length-1]+=o:l===W?l=[o]:l.push(o),n=r;var a=new T;return a.nodeName=e,a.children=l,a.attributes=null==t?void 0:t,a.key=null==t?void 0:t.key,void 0!==M.vnode&&M.vnode(a),a}function t(e,t){for(var n in t)e[n]=t[n];return e}function n(e,t){null!=e&&(\"function\"==typeof e?e(t):e.current=t)}function o(n,o){return e(n.nodeName,t(t({},n.attributes),o),arguments.length>2?[].slice.call(arguments,2):n.children)}function r(e){!e.__d&&(e.__d=!0)&&1==V.push(e)&&(M.debounceRendering||D)(i)}function i(){var e;while(e=V.pop())e.__d&&x(e)}function l(e,t,n){return\"string\"==typeof t||\"number\"==typeof t?void 0!==e.splitText:\"string\"==typeof t.nodeName?!e._componentConstructor&&a(e,t.nodeName):n||e._componentConstructor===t.nodeName}function a(e,t){return e.__n===t||e.nodeName.toLowerCase()===t.toLowerCase()}function u(e){var n=t({},e.attributes);n.children=e.children;var o=e.nodeName.defaultProps;if(void 0!==o)for(var r in o)void 0===n[r]&&(n[r]=o[r]);return n}function c(e,t){var n=t?document.createElementNS(\"http://www.w3.org/2000/svg\",e):document.createElement(e);return n.__n=e,n}function p(e){var t=e.parentNode;t&&t.removeChild(e)}function s(e,t,o,r,i){if(\"className\"===t&&(t=\"class\"),\"key\"===t);else if(\"ref\"===t)n(o,null),n(r,e);else if(\"class\"!==t||i)if(\"style\"===t){if(r&&\"string\"!=typeof r&&\"string\"!=typeof o||(e.style.cssText=r||\"\"),r&&\"object\"==typeof r){if(\"string\"!=typeof o)for(var l in o)l in r||(e.style[l]=\"\");for(var l in r)e.style[l]=\"number\"==typeof r[l]&&!1===E.test(l)?r[l]+\"px\":r[l]}}else if(\"dangerouslySetInnerHTML\"===t)r&&(e.innerHTML=r.__html||\"\");else if(\"o\"==t[0]&&\"n\"==t[1]){var a=t!==(t=t.replace(/Capture$/,\"\"));t=t.toLowerCase().substring(2),r?o||e.addEventListener(t,_,a):e.removeEventListener(t,_,a),(e.__l||(e.__l={}))[t]=r}else if(\"list\"!==t&&\"type\"!==t&&!i&&t in e){try{e[t]=null==r?\"\":r}catch(e){}null!=r&&!1!==r||\"spellcheck\"==t||e.removeAttribute(t)}else{var u=i&&t!==(t=t.replace(/^xlink:?/,\"\"));null==r||!1===r?u?e.removeAttributeNS(\"http://www.w3.org/1999/xlink\",t.toLowerCase()):e.removeAttribute(t):\"function\"!=typeof r&&(u?e.setAttributeNS(\"http://www.w3.org/1999/xlink\",t.toLowerCase(),r):e.setAttribute(t,r))}else e.className=r||\"\"}function _(e){return this.__l[e.type](M.event&&M.event(e)||e)}function f(){var e;while(e=A.shift())M.afterMount&&M.afterMount(e),e.componentDidMount&&e.componentDidMount()}function d(e,t,n,o,r,i){H++||(R=null!=r&&void 0!==r.ownerSVGElement,B=null!=e&&!(\"__preactattr_\"in e));var l=h(e,t,n,o,i);return r&&l.parentNode!==r&&r.appendChild(l),--H||(B=!1,i||f()),l}function h(e,t,n,o,r){var i=e,l=R;if(null!=t&&\"boolean\"!=typeof t||(t=\"\"),\"string\"==typeof t||\"number\"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||r)?e.nodeValue!=t&&(e.nodeValue=t):(i=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(i,e),v(e,!0))),i.__preactattr_=!0,i;var u=t.nodeName;if(\"function\"==typeof u)return N(e,t,n,o);if(R=\"svg\"===u||\"foreignObject\"!==u&&R,u+=\"\",(!e||!a(e,u))&&(i=c(u,R),e)){while(e.firstChild)i.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(i,e),v(e,!0)}var p=i.firstChild,s=i.__preactattr_,_=t.children;if(null==s){s=i.__preactattr_={};for(var f=i.attributes,d=f.length;d--;)s[f[d].name]=f[d].value}return!B&&_&&1===_.length&&\"string\"==typeof _[0]&&null!=p&&void 0!==p.splitText&&null==p.nextSibling?p.nodeValue!=_[0]&&(p.nodeValue=_[0]):(_&&_.length||null!=p)&&m(i,_,n,o,B||null!=s.dangerouslySetInnerHTML),y(i,t.attributes,s),R=l,i}function m(e,t,n,o,r){var i,a,u,c,s,_=e.childNodes,f=[],d={},m=0,b=0,y=_.length,g=0,w=t?t.length:0;if(0!==y)for(var C=0;C<y;C++){var x=_[C],N=x.__preactattr_,k=w&&N?x._component?x._component.__k:N.key:null;null!=k?(m++,d[k]=x):(N||(void 0!==x.splitText?!r||x.nodeValue.trim():r))&&(f[g++]=x)}if(0!==w)for(var C=0;C<w;C++){c=t[C],s=null;var k=c.key;if(null!=k)m&&void 0!==d[k]&&(s=d[k],d[k]=void 0,m--);else if(b<g)for(i=b;i<g;i++)if(void 0!==f[i]&&l(a=f[i],c,r)){s=a,f[i]=void 0,i===g-1&&g--,i===b&&b++;break}s=h(s,c,n,o),u=_[C],s&&s!==e&&s!==u&&(null==u?e.appendChild(s):s===u.nextSibling?p(u):e.insertBefore(s,u))}if(m)for(var C in d)void 0!==d[C]&&v(d[C],!1);while(b<=g)void 0!==(s=f[g--])&&v(s,!1)}function v(e,t){var o=e._component;o?k(o):(null!=e.__preactattr_&&n(e.__preactattr_.ref,null),!1!==t&&null!=e.__preactattr_||p(e),b(e))}function b(e){e=e.lastChild;while(e){var t=e.previousSibling;v(e,!0),e=t}}function y(e,t,n){var o;for(o in n)t&&null!=t[o]||null==n[o]||s(e,o,n[o],n[o]=void 0,R);for(o in t)\"children\"===o||\"innerHTML\"===o||o in n&&t[o]===(\"value\"===o||\"checked\"===o?e[o]:n[o])||s(e,o,n[o],n[o]=t[o],R)}function g(e,t,n){var o,r=F.length;e.prototype&&e.prototype.render?(o=new e(t,n),U.call(o,t,n)):(o=new U(t,n),o.constructor=e,o.render=w);while(r--)if(F[r].constructor===e)return o.__b=F[r].__b,F.splice(r,1),o;return o}function w(e,t,n){return this.constructor(e,n)}function C(e,t,o,i,l){e.__x||(e.__x=!0,e.__r=t.ref,e.__k=t.key,delete t.ref,delete t.key,void 0===e.constructor.getDerivedStateFromProps&&(!e.base||l?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,i)),i&&i!==e.context&&(e.__c||(e.__c=e.context),e.context=i),e.__p||(e.__p=e.props),e.props=t,e.__x=!1,0!==o&&(1!==o&&!1===M.syncComponentUpdates&&e.base?r(e):x(e,1,l)),n(e.__r,e))}function x(e,n,o,r){if(!e.__x){var i,l,a,c=e.props,p=e.state,s=e.context,_=e.__p||c,h=e.__s||p,m=e.__c||s,b=e.base,y=e.__b,w=b||y,N=e._component,U=!1,S=m;if(e.constructor.getDerivedStateFromProps&&(p=t(t({},p),e.constructor.getDerivedStateFromProps(c,p)),e.state=p),b&&(e.props=_,e.state=h,e.context=m,2!==n&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(c,p,s)?U=!0:e.componentWillUpdate&&e.componentWillUpdate(c,p,s),e.props=c,e.state=p,e.context=s),e.__p=e.__s=e.__c=e.__b=null,e.__d=!1,!U){i=e.render(c,p,s),e.getChildContext&&(s=t(t({},s),e.getChildContext())),b&&e.getSnapshotBeforeUpdate&&(S=e.getSnapshotBeforeUpdate(_,h));var L,T,P=i&&i.nodeName;if(\"function\"==typeof P){var W=u(i);l=N,l&&l.constructor===P&&W.key==l.__k?C(l,W,1,s,!1):(L=l,e._component=l=g(P,W,s),l.__b=l.__b||y,l.__u=e,C(l,W,0,s,!1),x(l,1,o,!0)),T=l.base}else a=w,L=N,L&&(a=e._component=null),(w||1===n)&&(a&&(a._component=null),T=d(a,i,s,o||!b,w&&w.parentNode,!0));if(w&&T!==w&&l!==N){var D=w.parentNode;D&&T!==D&&(D.replaceChild(T,w),L||(w._component=null,v(w,!1)))}if(L&&k(L),e.base=T,T&&!r){var E=e,V=e;while(V=V.__u)(E=V).base=T;T._component=E,T._componentConstructor=E.constructor}}!b||o?A.push(e):U||(e.componentDidUpdate&&e.componentDidUpdate(_,h,S),M.afterUpdate&&M.afterUpdate(e));while(e.__h.length)e.__h.pop().call(e);H||r||f()}}function N(e,t,n,o){var r=e&&e._component,i=r,l=e,a=r&&e._componentConstructor===t.nodeName,c=a,p=u(t);while(r&&!c&&(r=r.__u))c=r.constructor===t.nodeName;return r&&c&&(!o||r._component)?(C(r,p,3,n,o),e=r.base):(i&&!a&&(k(i),e=l=null),r=g(t.nodeName,p,n),e&&!r.__b&&(r.__b=e,l=null),C(r,p,1,n,o),e=r.base,l&&e!==l&&(l._component=null,v(l,!1))),e}function k(e){M.beforeUnmount&&M.beforeUnmount(e);var t=e.base;e.__x=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var o=e._component;o?k(o):t&&(null!=t.__preactattr_&&n(t.__preactattr_.ref,null),e.__b=t,p(t),F.push(e),b(t)),n(e.__r,null)}function U(e,t){this.__d=!0,this.context=t,this.props=e,this.state=this.state||{},this.__h=[]}function S(e,t,n){return d(n,e,{},!1,t,!1)}function L(){return{}}var T=function(){},M={},P=[],W=[],D=\"function\"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,E=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,V=[],A=[],H=0,R=!1,B=!1,F=[];t(U.prototype,{setState:function(e,n){this.__s||(this.__s=this.state),this.state=t(t({},this.state),\"function\"==typeof e?e(this.state,this.props):e),n&&this.__h.push(n),r(this)},forceUpdate:function(e){e&&this.__h.push(e),x(this,2)},render:function(){}});var j={h:e,createElement:e,cloneElement:o,createRef:L,Component:U,render:S,rerender:i,options:M};\"undefined\"!=typeof module?module.exports=j:self.preact=j}();\n//# sourceMappingURL=preact.min.js.map\n\n\n// WEBPACK FOOTER //\n// ./node_modules/preact/dist/preact.min.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./style.css\n// module id = FWi5\n// module chunks = 0","/*!\n  Copyright (c) 2017 Jed Watson.\n  Licensed under the MIT License (MIT), see\n  http://jedwatson.github.io/classnames\n*/\n/* global define */\n\n(function () {\n\t'use strict';\n\n\tvar hasOwn = {}.hasOwnProperty;\n\n\tfunction classNames () {\n\t\tvar classes = [];\n\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tvar arg = arguments[i];\n\t\t\tif (!arg) continue;\n\n\t\t\tvar argType = typeof arg;\n\n\t\t\tif (argType === 'string' || argType === 'number') {\n\t\t\t\tclasses.push(arg);\n\t\t\t} else if (Array.isArray(arg) && arg.length) {\n\t\t\t\tvar inner = classNames.apply(null, arg);\n\t\t\t\tif (inner) {\n\t\t\t\t\tclasses.push(inner);\n\t\t\t\t}\n\t\t\t} else if (argType === 'object') {\n\t\t\t\tfor (var key in arg) {\n\t\t\t\t\tif (hasOwn.call(arg, key) && arg[key]) {\n\t\t\t\t\t\tclasses.push(key);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn classes.join(' ');\n\t}\n\n\tif (typeof module !== 'undefined' && module.exports) {\n\t\tclassNames.default = classNames;\n\t\tmodule.exports = classNames;\n\t} else if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {\n\t\t// register as 'classnames', consistent with npm package name\n\t\tdefine('classnames', [], function () {\n\t\t\treturn classNames;\n\t\t});\n\t} else {\n\t\twindow.classNames = classNames;\n\t}\n}());\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/classnames/index.js","import 'whatwg-fetch';\n\n// Store setTimeout reference so promise-polyfill will be unaffected by\n// other code modifying setTimeout (like sinon.useFakeTimers())\nvar setTimeoutFunc = setTimeout;\n\nfunction noop() {}\n\n// Polyfill for Function.prototype.bind\nfunction bind(fn, thisArg) {\n  return function() {\n    fn.apply(thisArg, arguments);\n  };\n}\n\nfunction Promise(fn) {\n  if (!(this instanceof Promise))\n    throw new TypeError('Promises must be constructed via new');\n  if (typeof fn !== 'function') throw new TypeError('not a function');\n  this._state = 0;\n  this._handled = false;\n  this._value = undefined;\n  this._deferreds = [];\n\n  doResolve(fn, this);\n}\n\nfunction handle(self, deferred) {\n  while (self._state === 3) {\n    self = self._value;\n  }\n  if (self._state === 0) {\n    self._deferreds.push(deferred);\n    return;\n  }\n  self._handled = true;\n  Promise._immediateFn(function() {\n    var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n    if (cb === null) {\n      (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n      return;\n    }\n    var ret;\n    try {\n      ret = cb(self._value);\n    } catch (e) {\n      reject(deferred.promise, e);\n      return;\n    }\n    resolve(deferred.promise, ret);\n  });\n}\n\nfunction resolve(self, newValue) {\n  try {\n    // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n    if (newValue === self)\n      throw new TypeError('A promise cannot be resolved with itself.');\n    if (\n      newValue &&\n      (typeof newValue === 'object' || typeof newValue === 'function')\n    ) {\n      var then = newValue.then;\n      if (newValue instanceof Promise) {\n        self._state = 3;\n        self._value = newValue;\n        finale(self);\n        return;\n      } else if (typeof then === 'function') {\n        doResolve(bind(then, newValue), self);\n        return;\n      }\n    }\n    self._state = 1;\n    self._value = newValue;\n    finale(self);\n  } catch (e) {\n    reject(self, e);\n  }\n}\n\nfunction reject(self, newValue) {\n  self._state = 2;\n  self._value = newValue;\n  finale(self);\n}\n\nfunction finale(self) {\n  if (self._state === 2 && self._deferreds.length === 0) {\n    Promise._immediateFn(function() {\n      if (!self._handled) {\n        Promise._unhandledRejectionFn(self._value);\n      }\n    });\n  }\n\n  for (var i = 0, len = self._deferreds.length; i < len; i++) {\n    handle(self, self._deferreds[i]);\n  }\n  self._deferreds = null;\n}\n\nfunction Handler(onFulfilled, onRejected, promise) {\n  this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n  this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n  this.promise = promise;\n}\n\n/**\n * Take a potentially misbehaving resolver function and make sure\n * onFulfilled and onRejected are only called once.\n *\n * Makes no guarantees about asynchrony.\n */\nfunction doResolve(fn, self) {\n  var done = false;\n  try {\n    fn(\n      function(value) {\n        if (done) return;\n        done = true;\n        resolve(self, value);\n      },\n      function(reason) {\n        if (done) return;\n        done = true;\n        reject(self, reason);\n      }\n    );\n  } catch (ex) {\n    if (done) return;\n    done = true;\n    reject(self, ex);\n  }\n}\n\nPromise.prototype['catch'] = function(onRejected) {\n  return this.then(null, onRejected);\n};\n\nPromise.prototype.then = function(onFulfilled, onRejected) {\n  var prom = new this.constructor(noop);\n\n  handle(this, new Handler(onFulfilled, onRejected, prom));\n  return prom;\n};\n\nPromise.prototype['finally'] = function(callback) {\n  var constructor = this.constructor;\n  return this.then(\n    function(value) {\n      return constructor.resolve(callback()).then(function() {\n        return value;\n      });\n    },\n    function(reason) {\n      return constructor.resolve(callback()).then(function() {\n        return constructor.reject(reason);\n      });\n    }\n  );\n};\n\nPromise.all = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!arr || typeof arr.length === 'undefined')\n      throw new TypeError('Promise.all accepts an array');\n    var args = Array.prototype.slice.call(arr);\n    if (args.length === 0) return resolve([]);\n    var remaining = args.length;\n\n    function res(i, val) {\n      try {\n        if (val && (typeof val === 'object' || typeof val === 'function')) {\n          var then = val.then;\n          if (typeof then === 'function') {\n            then.call(\n              val,\n              function(val) {\n                res(i, val);\n              },\n              reject\n            );\n            return;\n          }\n        }\n        args[i] = val;\n        if (--remaining === 0) {\n          resolve(args);\n        }\n      } catch (ex) {\n        reject(ex);\n      }\n    }\n\n    for (var i = 0; i < args.length; i++) {\n      res(i, args[i]);\n    }\n  });\n};\n\nPromise.resolve = function(value) {\n  if (value && typeof value === 'object' && value.constructor === Promise) {\n    return value;\n  }\n\n  return new Promise(function(resolve) {\n    resolve(value);\n  });\n};\n\nPromise.reject = function(value) {\n  return new Promise(function(resolve, reject) {\n    reject(value);\n  });\n};\n\nPromise.race = function(values) {\n  return new Promise(function(resolve, reject) {\n    for (var i = 0, len = values.length; i < len; i++) {\n      values[i].then(resolve, reject);\n    }\n  });\n};\n\n// Use polyfill for setImmediate for performance gains\nPromise._immediateFn =\n  (typeof setImmediate === 'function' &&\n    function(fn) {\n      setImmediate(fn);\n    }) ||\n  function(fn) {\n    setTimeoutFunc(fn, 0);\n  };\n\nPromise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n  if (typeof console !== 'undefined' && console) {\n    console.warn('Possible Unhandled Promise Rejection:', err); // eslint-disable-line no-console\n  }\n};\n\nvar globalNS = (function() {\n  // the only reliable means to get the global object is\n  // `Function('return this')()`\n  // However, this causes CSP violations in Chrome apps.\n  if (typeof self !== 'undefined') {\n    return self;\n  }\n  if (typeof window !== 'undefined') {\n    return window;\n  }\n  if (typeof global !== 'undefined') {\n    return global;\n  }\n  throw new Error('unable to locate global object');\n})();\n\nif (!globalNS.Promise) {\n  globalNS.Promise = Promise;\n}\n\nfunction createCommonjsModule(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\nvar _global = createCommonjsModule(function (module) {\n// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\nvar global = module.exports = typeof window != 'undefined' && window.Math == Math\n  ? window : typeof self != 'undefined' && self.Math == Math ? self\n  // eslint-disable-next-line no-new-func\n  : Function('return this')();\nif (typeof __g == 'number') __g = global; // eslint-disable-line no-undef\n});\n\nvar _core = createCommonjsModule(function (module) {\nvar core = module.exports = { version: '2.5.5' };\nif (typeof __e == 'number') __e = core; // eslint-disable-line no-undef\n});\nvar _core_1 = _core.version;\n\nvar _isObject = function (it) {\n  return typeof it === 'object' ? it !== null : typeof it === 'function';\n};\n\nvar _anObject = function (it) {\n  if (!_isObject(it)) throw TypeError(it + ' is not an object!');\n  return it;\n};\n\nvar _fails = function (exec) {\n  try {\n    return !!exec();\n  } catch (e) {\n    return true;\n  }\n};\n\n// Thank's IE8 for his funny defineProperty\nvar _descriptors = !_fails(function () {\n  return Object.defineProperty({}, 'a', { get: function () { return 7; } }).a != 7;\n});\n\nvar document = _global.document;\n// typeof document.createElement is 'object' in old IE\nvar is = _isObject(document) && _isObject(document.createElement);\nvar _domCreate = function (it) {\n  return is ? document.createElement(it) : {};\n};\n\nvar _ie8DomDefine = !_descriptors && !_fails(function () {\n  return Object.defineProperty(_domCreate('div'), 'a', { get: function () { return 7; } }).a != 7;\n});\n\n// 7.1.1 ToPrimitive(input [, PreferredType])\n\n// instead of the ES6 spec version, we didn't implement @@toPrimitive case\n// and the second argument - flag - preferred type is a string\nvar _toPrimitive = function (it, S) {\n  if (!_isObject(it)) return it;\n  var fn, val;\n  if (S && typeof (fn = it.toString) == 'function' && !_isObject(val = fn.call(it))) return val;\n  if (typeof (fn = it.valueOf) == 'function' && !_isObject(val = fn.call(it))) return val;\n  if (!S && typeof (fn = it.toString) == 'function' && !_isObject(val = fn.call(it))) return val;\n  throw TypeError(\"Can't convert object to primitive value\");\n};\n\nvar dP = Object.defineProperty;\n\nvar f = _descriptors ? Object.defineProperty : function defineProperty(O, P, Attributes) {\n  _anObject(O);\n  P = _toPrimitive(P, true);\n  _anObject(Attributes);\n  if (_ie8DomDefine) try {\n    return dP(O, P, Attributes);\n  } catch (e) { /* empty */ }\n  if ('get' in Attributes || 'set' in Attributes) throw TypeError('Accessors not supported!');\n  if ('value' in Attributes) O[P] = Attributes.value;\n  return O;\n};\n\nvar _objectDp = {\n\tf: f\n};\n\nvar _propertyDesc = function (bitmap, value) {\n  return {\n    enumerable: !(bitmap & 1),\n    configurable: !(bitmap & 2),\n    writable: !(bitmap & 4),\n    value: value\n  };\n};\n\nvar _hide = _descriptors ? function (object, key, value) {\n  return _objectDp.f(object, key, _propertyDesc(1, value));\n} : function (object, key, value) {\n  object[key] = value;\n  return object;\n};\n\nvar hasOwnProperty = {}.hasOwnProperty;\nvar _has = function (it, key) {\n  return hasOwnProperty.call(it, key);\n};\n\nvar id = 0;\nvar px = Math.random();\nvar _uid = function (key) {\n  return 'Symbol('.concat(key === undefined ? '' : key, ')_', (++id + px).toString(36));\n};\n\nvar _redefine = createCommonjsModule(function (module) {\nvar SRC = _uid('src');\nvar TO_STRING = 'toString';\nvar $toString = Function[TO_STRING];\nvar TPL = ('' + $toString).split(TO_STRING);\n\n_core.inspectSource = function (it) {\n  return $toString.call(it);\n};\n\n(module.exports = function (O, key, val, safe) {\n  var isFunction = typeof val == 'function';\n  if (isFunction) _has(val, 'name') || _hide(val, 'name', key);\n  if (O[key] === val) return;\n  if (isFunction) _has(val, SRC) || _hide(val, SRC, O[key] ? '' + O[key] : TPL.join(String(key)));\n  if (O === _global) {\n    O[key] = val;\n  } else if (!safe) {\n    delete O[key];\n    _hide(O, key, val);\n  } else if (O[key]) {\n    O[key] = val;\n  } else {\n    _hide(O, key, val);\n  }\n// add fake Function#toString for correct work wrapped methods / constructors with methods like LoDash isNative\n})(Function.prototype, TO_STRING, function toString() {\n  return typeof this == 'function' && this[SRC] || $toString.call(this);\n});\n});\n\nvar _aFunction = function (it) {\n  if (typeof it != 'function') throw TypeError(it + ' is not a function!');\n  return it;\n};\n\n// optional / simple context binding\n\nvar _ctx = function (fn, that, length) {\n  _aFunction(fn);\n  if (that === undefined) return fn;\n  switch (length) {\n    case 1: return function (a) {\n      return fn.call(that, a);\n    };\n    case 2: return function (a, b) {\n      return fn.call(that, a, b);\n    };\n    case 3: return function (a, b, c) {\n      return fn.call(that, a, b, c);\n    };\n  }\n  return function (/* ...args */) {\n    return fn.apply(that, arguments);\n  };\n};\n\nvar PROTOTYPE = 'prototype';\n\nvar $export = function (type, name, source) {\n  var IS_FORCED = type & $export.F;\n  var IS_GLOBAL = type & $export.G;\n  var IS_STATIC = type & $export.S;\n  var IS_PROTO = type & $export.P;\n  var IS_BIND = type & $export.B;\n  var target = IS_GLOBAL ? _global : IS_STATIC ? _global[name] || (_global[name] = {}) : (_global[name] || {})[PROTOTYPE];\n  var exports = IS_GLOBAL ? _core : _core[name] || (_core[name] = {});\n  var expProto = exports[PROTOTYPE] || (exports[PROTOTYPE] = {});\n  var key, own, out, exp;\n  if (IS_GLOBAL) source = name;\n  for (key in source) {\n    // contains in native\n    own = !IS_FORCED && target && target[key] !== undefined;\n    // export native or passed\n    out = (own ? target : source)[key];\n    // bind timers to global for call from export context\n    exp = IS_BIND && own ? _ctx(out, _global) : IS_PROTO && typeof out == 'function' ? _ctx(Function.call, out) : out;\n    // extend global\n    if (target) _redefine(target, key, out, type & $export.U);\n    // export\n    if (exports[key] != out) _hide(exports, key, exp);\n    if (IS_PROTO && expProto[key] != out) expProto[key] = out;\n  }\n};\n_global.core = _core;\n// type bitmap\n$export.F = 1;   // forced\n$export.G = 2;   // global\n$export.S = 4;   // static\n$export.P = 8;   // proto\n$export.B = 16;  // bind\n$export.W = 32;  // wrap\n$export.U = 64;  // safe\n$export.R = 128; // real proto method for `library`\nvar _export = $export;\n\nvar toString = {}.toString;\n\nvar _cof = function (it) {\n  return toString.call(it).slice(8, -1);\n};\n\n// fallback for non-array-like ES3 and non-enumerable old V8 strings\n\n// eslint-disable-next-line no-prototype-builtins\nvar _iobject = Object('z').propertyIsEnumerable(0) ? Object : function (it) {\n  return _cof(it) == 'String' ? it.split('') : Object(it);\n};\n\n// 7.2.1 RequireObjectCoercible(argument)\nvar _defined = function (it) {\n  if (it == undefined) throw TypeError(\"Can't call method on  \" + it);\n  return it;\n};\n\n// 7.1.13 ToObject(argument)\n\nvar _toObject = function (it) {\n  return Object(_defined(it));\n};\n\n// 7.1.4 ToInteger\nvar ceil = Math.ceil;\nvar floor = Math.floor;\nvar _toInteger = function (it) {\n  return isNaN(it = +it) ? 0 : (it > 0 ? floor : ceil)(it);\n};\n\n// 7.1.15 ToLength\n\nvar min = Math.min;\nvar _toLength = function (it) {\n  return it > 0 ? min(_toInteger(it), 0x1fffffffffffff) : 0; // pow(2, 53) - 1 == 9007199254740991\n};\n\n// 7.2.2 IsArray(argument)\n\nvar _isArray = Array.isArray || function isArray(arg) {\n  return _cof(arg) == 'Array';\n};\n\nvar SHARED = '__core-js_shared__';\nvar store = _global[SHARED] || (_global[SHARED] = {});\nvar _shared = function (key) {\n  return store[key] || (store[key] = {});\n};\n\nvar _wks = createCommonjsModule(function (module) {\nvar store = _shared('wks');\n\nvar Symbol = _global.Symbol;\nvar USE_SYMBOL = typeof Symbol == 'function';\n\nvar $exports = module.exports = function (name) {\n  return store[name] || (store[name] =\n    USE_SYMBOL && Symbol[name] || (USE_SYMBOL ? Symbol : _uid)('Symbol.' + name));\n};\n\n$exports.store = store;\n});\n\nvar SPECIES = _wks('species');\n\nvar _arraySpeciesConstructor = function (original) {\n  var C;\n  if (_isArray(original)) {\n    C = original.constructor;\n    // cross-realm fallback\n    if (typeof C == 'function' && (C === Array || _isArray(C.prototype))) C = undefined;\n    if (_isObject(C)) {\n      C = C[SPECIES];\n      if (C === null) C = undefined;\n    }\n  } return C === undefined ? Array : C;\n};\n\n// 9.4.2.3 ArraySpeciesCreate(originalArray, length)\n\n\nvar _arraySpeciesCreate = function (original, length) {\n  return new (_arraySpeciesConstructor(original))(length);\n};\n\n// 0 -> Array#forEach\n// 1 -> Array#map\n// 2 -> Array#filter\n// 3 -> Array#some\n// 4 -> Array#every\n// 5 -> Array#find\n// 6 -> Array#findIndex\n\n\n\n\n\nvar _arrayMethods = function (TYPE, $create) {\n  var IS_MAP = TYPE == 1;\n  var IS_FILTER = TYPE == 2;\n  var IS_SOME = TYPE == 3;\n  var IS_EVERY = TYPE == 4;\n  var IS_FIND_INDEX = TYPE == 6;\n  var NO_HOLES = TYPE == 5 || IS_FIND_INDEX;\n  var create = $create || _arraySpeciesCreate;\n  return function ($this, callbackfn, that) {\n    var O = _toObject($this);\n    var self = _iobject(O);\n    var f = _ctx(callbackfn, that, 3);\n    var length = _toLength(self.length);\n    var index = 0;\n    var result = IS_MAP ? create($this, length) : IS_FILTER ? create($this, 0) : undefined;\n    var val, res;\n    for (;length > index; index++) if (NO_HOLES || index in self) {\n      val = self[index];\n      res = f(val, index, O);\n      if (TYPE) {\n        if (IS_MAP) result[index] = res;   // map\n        else if (res) switch (TYPE) {\n          case 3: return true;             // some\n          case 5: return val;              // find\n          case 6: return index;            // findIndex\n          case 2: result.push(val);        // filter\n        } else if (IS_EVERY) return false; // every\n      }\n    }\n    return IS_FIND_INDEX ? -1 : IS_SOME || IS_EVERY ? IS_EVERY : result;\n  };\n};\n\n// 22.1.3.31 Array.prototype[@@unscopables]\nvar UNSCOPABLES = _wks('unscopables');\nvar ArrayProto = Array.prototype;\nif (ArrayProto[UNSCOPABLES] == undefined) _hide(ArrayProto, UNSCOPABLES, {});\nvar _addToUnscopables = function (key) {\n  ArrayProto[UNSCOPABLES][key] = true;\n};\n\n// 22.1.3.8 Array.prototype.find(predicate, thisArg = undefined)\n\nvar $find = _arrayMethods(5);\nvar KEY = 'find';\nvar forced = true;\n// Shouldn't skip holes\nif (KEY in []) Array(1)[KEY](function () { forced = false; });\n_export(_export.P + _export.F * forced, 'Array', {\n  find: function find(callbackfn /* , that = undefined */) {\n    return $find(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n_addToUnscopables(KEY);\n\nvar find = _core.Array.find;\n\n// 22.1.3.9 Array.prototype.findIndex(predicate, thisArg = undefined)\n\nvar $find$1 = _arrayMethods(6);\nvar KEY$1 = 'findIndex';\nvar forced$1 = true;\n// Shouldn't skip holes\nif (KEY$1 in []) Array(1)[KEY$1](function () { forced$1 = false; });\n_export(_export.P + _export.F * forced$1, 'Array', {\n  findIndex: function findIndex(callbackfn /* , that = undefined */) {\n    return $find$1(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n_addToUnscopables(KEY$1);\n\nvar findIndex = _core.Array.findIndex;\n\n// to indexed object, toObject with fallback for non-array-like ES3 strings\n\n\nvar _toIobject = function (it) {\n  return _iobject(_defined(it));\n};\n\nvar max = Math.max;\nvar min$1 = Math.min;\nvar _toAbsoluteIndex = function (index, length) {\n  index = _toInteger(index);\n  return index < 0 ? max(index + length, 0) : min$1(index, length);\n};\n\n// false -> Array#indexOf\n// true  -> Array#includes\n\n\n\nvar _arrayIncludes = function (IS_INCLUDES) {\n  return function ($this, el, fromIndex) {\n    var O = _toIobject($this);\n    var length = _toLength(O.length);\n    var index = _toAbsoluteIndex(fromIndex, length);\n    var value;\n    // Array#includes uses SameValueZero equality algorithm\n    // eslint-disable-next-line no-self-compare\n    if (IS_INCLUDES && el != el) while (length > index) {\n      value = O[index++];\n      // eslint-disable-next-line no-self-compare\n      if (value != value) return true;\n    // Array#indexOf ignores holes, Array#includes - not\n    } else for (;length > index; index++) if (IS_INCLUDES || index in O) {\n      if (O[index] === el) return IS_INCLUDES || index || 0;\n    } return !IS_INCLUDES && -1;\n  };\n};\n\nvar shared = _shared('keys');\n\nvar _sharedKey = function (key) {\n  return shared[key] || (shared[key] = _uid(key));\n};\n\nvar arrayIndexOf = _arrayIncludes(false);\nvar IE_PROTO = _sharedKey('IE_PROTO');\n\nvar _objectKeysInternal = function (object, names) {\n  var O = _toIobject(object);\n  var i = 0;\n  var result = [];\n  var key;\n  for (key in O) if (key != IE_PROTO) _has(O, key) && result.push(key);\n  // Don't enum bug & hidden keys\n  while (names.length > i) if (_has(O, key = names[i++])) {\n    ~arrayIndexOf(result, key) || result.push(key);\n  }\n  return result;\n};\n\n// IE 8- don't enum bug keys\nvar _enumBugKeys = (\n  'constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf'\n).split(',');\n\n// 19.1.2.14 / 15.2.3.14 Object.keys(O)\n\n\n\nvar _objectKeys = Object.keys || function keys(O) {\n  return _objectKeysInternal(O, _enumBugKeys);\n};\n\nvar f$1 = Object.getOwnPropertySymbols;\n\nvar _objectGops = {\n\tf: f$1\n};\n\nvar f$2 = {}.propertyIsEnumerable;\n\nvar _objectPie = {\n\tf: f$2\n};\n\n// 19.1.2.1 Object.assign(target, source, ...)\n\n\n\n\n\nvar $assign = Object.assign;\n\n// should work with symbols and should have deterministic property order (V8 bug)\nvar _objectAssign = !$assign || _fails(function () {\n  var A = {};\n  var B = {};\n  // eslint-disable-next-line no-undef\n  var S = Symbol();\n  var K = 'abcdefghijklmnopqrst';\n  A[S] = 7;\n  K.split('').forEach(function (k) { B[k] = k; });\n  return $assign({}, A)[S] != 7 || Object.keys($assign({}, B)).join('') != K;\n}) ? function assign(target, source) { // eslint-disable-line no-unused-vars\n  var T = _toObject(target);\n  var aLen = arguments.length;\n  var index = 1;\n  var getSymbols = _objectGops.f;\n  var isEnum = _objectPie.f;\n  while (aLen > index) {\n    var S = _iobject(arguments[index++]);\n    var keys = getSymbols ? _objectKeys(S).concat(getSymbols(S)) : _objectKeys(S);\n    var length = keys.length;\n    var j = 0;\n    var key;\n    while (length > j) if (isEnum.call(S, key = keys[j++])) T[key] = S[key];\n  } return T;\n} : $assign;\n\n// 19.1.3.1 Object.assign(target, source)\n\n\n_export(_export.S + _export.F, 'Object', { assign: _objectAssign });\n\nvar assign = _core.Object.assign;\n\n// 7.2.8 IsRegExp(argument)\n\n\nvar MATCH = _wks('match');\nvar _isRegexp = function (it) {\n  var isRegExp;\n  return _isObject(it) && ((isRegExp = it[MATCH]) !== undefined ? !!isRegExp : _cof(it) == 'RegExp');\n};\n\n// helper for String#{startsWith, endsWith, includes}\n\n\n\nvar _stringContext = function (that, searchString, NAME) {\n  if (_isRegexp(searchString)) throw TypeError('String#' + NAME + \" doesn't accept regex!\");\n  return String(_defined(that));\n};\n\nvar MATCH$1 = _wks('match');\nvar _failsIsRegexp = function (KEY) {\n  var re = /./;\n  try {\n    '/./'[KEY](re);\n  } catch (e) {\n    try {\n      re[MATCH$1] = false;\n      return !'/./'[KEY](re);\n    } catch (f) { /* empty */ }\n  } return true;\n};\n\nvar STARTS_WITH = 'startsWith';\nvar $startsWith = ''[STARTS_WITH];\n\n_export(_export.P + _export.F * _failsIsRegexp(STARTS_WITH), 'String', {\n  startsWith: function startsWith(searchString /* , position = 0 */) {\n    var that = _stringContext(this, searchString, STARTS_WITH);\n    var index = _toLength(Math.min(arguments.length > 1 ? arguments[1] : undefined, that.length));\n    var search = String(searchString);\n    return $startsWith\n      ? $startsWith.call(that, search, index)\n      : that.slice(index, index + search.length) === search;\n  }\n});\n\nvar startsWith = _core.String.startsWith;\n\nvar _stringRepeat = function repeat(count) {\n  var str = String(_defined(this));\n  var res = '';\n  var n = _toInteger(count);\n  if (n < 0 || n == Infinity) throw RangeError(\"Count can't be negative\");\n  for (;n > 0; (n >>>= 1) && (str += str)) if (n & 1) res += str;\n  return res;\n};\n\n_export(_export.P, 'String', {\n  // 21.1.3.13 String.prototype.repeat(count)\n  repeat: _stringRepeat\n});\n\nvar repeat = _core.String.repeat;\n\nvar _meta = createCommonjsModule(function (module) {\nvar META = _uid('meta');\n\n\nvar setDesc = _objectDp.f;\nvar id = 0;\nvar isExtensible = Object.isExtensible || function () {\n  return true;\n};\nvar FREEZE = !_fails(function () {\n  return isExtensible(Object.preventExtensions({}));\n});\nvar setMeta = function (it) {\n  setDesc(it, META, { value: {\n    i: 'O' + ++id, // object ID\n    w: {}          // weak collections IDs\n  } });\n};\nvar fastKey = function (it, create) {\n  // return primitive with prefix\n  if (!_isObject(it)) return typeof it == 'symbol' ? it : (typeof it == 'string' ? 'S' : 'P') + it;\n  if (!_has(it, META)) {\n    // can't set metadata to uncaught frozen object\n    if (!isExtensible(it)) return 'F';\n    // not necessary to add metadata\n    if (!create) return 'E';\n    // add missing metadata\n    setMeta(it);\n  // return object ID\n  } return it[META].i;\n};\nvar getWeak = function (it, create) {\n  if (!_has(it, META)) {\n    // can't set metadata to uncaught frozen object\n    if (!isExtensible(it)) return true;\n    // not necessary to add metadata\n    if (!create) return false;\n    // add missing metadata\n    setMeta(it);\n  // return hash weak collections IDs\n  } return it[META].w;\n};\n// add metadata on freeze-family methods calling\nvar onFreeze = function (it) {\n  if (FREEZE && meta.NEED && isExtensible(it) && !_has(it, META)) setMeta(it);\n  return it;\n};\nvar meta = module.exports = {\n  KEY: META,\n  NEED: false,\n  fastKey: fastKey,\n  getWeak: getWeak,\n  onFreeze: onFreeze\n};\n});\nvar _meta_1 = _meta.KEY;\nvar _meta_2 = _meta.NEED;\nvar _meta_3 = _meta.fastKey;\nvar _meta_4 = _meta.getWeak;\nvar _meta_5 = _meta.onFreeze;\n\nvar def = _objectDp.f;\n\nvar TAG = _wks('toStringTag');\n\nvar _setToStringTag = function (it, tag, stat) {\n  if (it && !_has(it = stat ? it : it.prototype, TAG)) def(it, TAG, { configurable: true, value: tag });\n};\n\nvar f$3 = _wks;\n\nvar _wksExt = {\n\tf: f$3\n};\n\nvar _library = false;\n\nvar defineProperty = _objectDp.f;\nvar _wksDefine = function (name) {\n  var $Symbol = _core.Symbol || (_core.Symbol = _library ? {} : _global.Symbol || {});\n  if (name.charAt(0) != '_' && !(name in $Symbol)) defineProperty($Symbol, name, { value: _wksExt.f(name) });\n};\n\n// all enumerable object keys, includes symbols\n\n\n\nvar _enumKeys = function (it) {\n  var result = _objectKeys(it);\n  var getSymbols = _objectGops.f;\n  if (getSymbols) {\n    var symbols = getSymbols(it);\n    var isEnum = _objectPie.f;\n    var i = 0;\n    var key;\n    while (symbols.length > i) if (isEnum.call(it, key = symbols[i++])) result.push(key);\n  } return result;\n};\n\nvar _objectDps = _descriptors ? Object.defineProperties : function defineProperties(O, Properties) {\n  _anObject(O);\n  var keys = _objectKeys(Properties);\n  var length = keys.length;\n  var i = 0;\n  var P;\n  while (length > i) _objectDp.f(O, P = keys[i++], Properties[P]);\n  return O;\n};\n\nvar document$1 = _global.document;\nvar _html = document$1 && document$1.documentElement;\n\n// 19.1.2.2 / 15.2.3.5 Object.create(O [, Properties])\n\n\n\nvar IE_PROTO$1 = _sharedKey('IE_PROTO');\nvar Empty = function () { /* empty */ };\nvar PROTOTYPE$1 = 'prototype';\n\n// Create object with fake `null` prototype: use iframe Object with cleared prototype\nvar createDict = function () {\n  // Thrash, waste and sodomy: IE GC bug\n  var iframe = _domCreate('iframe');\n  var i = _enumBugKeys.length;\n  var lt = '<';\n  var gt = '>';\n  var iframeDocument;\n  iframe.style.display = 'none';\n  _html.appendChild(iframe);\n  iframe.src = 'javascript:'; // eslint-disable-line no-script-url\n  // createDict = iframe.contentWindow.Object;\n  // html.removeChild(iframe);\n  iframeDocument = iframe.contentWindow.document;\n  iframeDocument.open();\n  iframeDocument.write(lt + 'script' + gt + 'document.F=Object' + lt + '/script' + gt);\n  iframeDocument.close();\n  createDict = iframeDocument.F;\n  while (i--) delete createDict[PROTOTYPE$1][_enumBugKeys[i]];\n  return createDict();\n};\n\nvar _objectCreate = Object.create || function create(O, Properties) {\n  var result;\n  if (O !== null) {\n    Empty[PROTOTYPE$1] = _anObject(O);\n    result = new Empty();\n    Empty[PROTOTYPE$1] = null;\n    // add \"__proto__\" for Object.getPrototypeOf polyfill\n    result[IE_PROTO$1] = O;\n  } else result = createDict();\n  return Properties === undefined ? result : _objectDps(result, Properties);\n};\n\n// 19.1.2.7 / 15.2.3.4 Object.getOwnPropertyNames(O)\n\nvar hiddenKeys = _enumBugKeys.concat('length', 'prototype');\n\nvar f$4 = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {\n  return _objectKeysInternal(O, hiddenKeys);\n};\n\nvar _objectGopn = {\n\tf: f$4\n};\n\n// fallback for IE11 buggy Object.getOwnPropertyNames with iframe and window\n\nvar gOPN = _objectGopn.f;\nvar toString$1 = {}.toString;\n\nvar windowNames = typeof window == 'object' && window && Object.getOwnPropertyNames\n  ? Object.getOwnPropertyNames(window) : [];\n\nvar getWindowNames = function (it) {\n  try {\n    return gOPN(it);\n  } catch (e) {\n    return windowNames.slice();\n  }\n};\n\nvar f$5 = function getOwnPropertyNames(it) {\n  return windowNames && toString$1.call(it) == '[object Window]' ? getWindowNames(it) : gOPN(_toIobject(it));\n};\n\nvar _objectGopnExt = {\n\tf: f$5\n};\n\nvar gOPD = Object.getOwnPropertyDescriptor;\n\nvar f$6 = _descriptors ? gOPD : function getOwnPropertyDescriptor(O, P) {\n  O = _toIobject(O);\n  P = _toPrimitive(P, true);\n  if (_ie8DomDefine) try {\n    return gOPD(O, P);\n  } catch (e) { /* empty */ }\n  if (_has(O, P)) return _propertyDesc(!_objectPie.f.call(O, P), O[P]);\n};\n\nvar _objectGopd = {\n\tf: f$6\n};\n\n// ECMAScript 6 symbols shim\n\n\n\n\n\nvar META = _meta.KEY;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar gOPD$1 = _objectGopd.f;\nvar dP$1 = _objectDp.f;\nvar gOPN$1 = _objectGopnExt.f;\nvar $Symbol = _global.Symbol;\nvar $JSON = _global.JSON;\nvar _stringify = $JSON && $JSON.stringify;\nvar PROTOTYPE$2 = 'prototype';\nvar HIDDEN = _wks('_hidden');\nvar TO_PRIMITIVE = _wks('toPrimitive');\nvar isEnum = {}.propertyIsEnumerable;\nvar SymbolRegistry = _shared('symbol-registry');\nvar AllSymbols = _shared('symbols');\nvar OPSymbols = _shared('op-symbols');\nvar ObjectProto = Object[PROTOTYPE$2];\nvar USE_NATIVE = typeof $Symbol == 'function';\nvar QObject = _global.QObject;\n// Don't use setters in Qt Script, https://github.com/zloirock/core-js/issues/173\nvar setter = !QObject || !QObject[PROTOTYPE$2] || !QObject[PROTOTYPE$2].findChild;\n\n// fallback for old Android, https://code.google.com/p/v8/issues/detail?id=687\nvar setSymbolDesc = _descriptors && _fails(function () {\n  return _objectCreate(dP$1({}, 'a', {\n    get: function () { return dP$1(this, 'a', { value: 7 }).a; }\n  })).a != 7;\n}) ? function (it, key, D) {\n  var protoDesc = gOPD$1(ObjectProto, key);\n  if (protoDesc) delete ObjectProto[key];\n  dP$1(it, key, D);\n  if (protoDesc && it !== ObjectProto) dP$1(ObjectProto, key, protoDesc);\n} : dP$1;\n\nvar wrap = function (tag) {\n  var sym = AllSymbols[tag] = _objectCreate($Symbol[PROTOTYPE$2]);\n  sym._k = tag;\n  return sym;\n};\n\nvar isSymbol = USE_NATIVE && typeof $Symbol.iterator == 'symbol' ? function (it) {\n  return typeof it == 'symbol';\n} : function (it) {\n  return it instanceof $Symbol;\n};\n\nvar $defineProperty = function defineProperty(it, key, D) {\n  if (it === ObjectProto) $defineProperty(OPSymbols, key, D);\n  _anObject(it);\n  key = _toPrimitive(key, true);\n  _anObject(D);\n  if (_has(AllSymbols, key)) {\n    if (!D.enumerable) {\n      if (!_has(it, HIDDEN)) dP$1(it, HIDDEN, _propertyDesc(1, {}));\n      it[HIDDEN][key] = true;\n    } else {\n      if (_has(it, HIDDEN) && it[HIDDEN][key]) it[HIDDEN][key] = false;\n      D = _objectCreate(D, { enumerable: _propertyDesc(0, false) });\n    } return setSymbolDesc(it, key, D);\n  } return dP$1(it, key, D);\n};\nvar $defineProperties = function defineProperties(it, P) {\n  _anObject(it);\n  var keys = _enumKeys(P = _toIobject(P));\n  var i = 0;\n  var l = keys.length;\n  var key;\n  while (l > i) $defineProperty(it, key = keys[i++], P[key]);\n  return it;\n};\nvar $create = function create(it, P) {\n  return P === undefined ? _objectCreate(it) : $defineProperties(_objectCreate(it), P);\n};\nvar $propertyIsEnumerable = function propertyIsEnumerable(key) {\n  var E = isEnum.call(this, key = _toPrimitive(key, true));\n  if (this === ObjectProto && _has(AllSymbols, key) && !_has(OPSymbols, key)) return false;\n  return E || !_has(this, key) || !_has(AllSymbols, key) || _has(this, HIDDEN) && this[HIDDEN][key] ? E : true;\n};\nvar $getOwnPropertyDescriptor = function getOwnPropertyDescriptor(it, key) {\n  it = _toIobject(it);\n  key = _toPrimitive(key, true);\n  if (it === ObjectProto && _has(AllSymbols, key) && !_has(OPSymbols, key)) return;\n  var D = gOPD$1(it, key);\n  if (D && _has(AllSymbols, key) && !(_has(it, HIDDEN) && it[HIDDEN][key])) D.enumerable = true;\n  return D;\n};\nvar $getOwnPropertyNames = function getOwnPropertyNames(it) {\n  var names = gOPN$1(_toIobject(it));\n  var result = [];\n  var i = 0;\n  var key;\n  while (names.length > i) {\n    if (!_has(AllSymbols, key = names[i++]) && key != HIDDEN && key != META) result.push(key);\n  } return result;\n};\nvar $getOwnPropertySymbols = function getOwnPropertySymbols(it) {\n  var IS_OP = it === ObjectProto;\n  var names = gOPN$1(IS_OP ? OPSymbols : _toIobject(it));\n  var result = [];\n  var i = 0;\n  var key;\n  while (names.length > i) {\n    if (_has(AllSymbols, key = names[i++]) && (IS_OP ? _has(ObjectProto, key) : true)) result.push(AllSymbols[key]);\n  } return result;\n};\n\n// 19.4.1.1 Symbol([description])\nif (!USE_NATIVE) {\n  $Symbol = function Symbol() {\n    if (this instanceof $Symbol) throw TypeError('Symbol is not a constructor!');\n    var tag = _uid(arguments.length > 0 ? arguments[0] : undefined);\n    var $set = function (value) {\n      if (this === ObjectProto) $set.call(OPSymbols, value);\n      if (_has(this, HIDDEN) && _has(this[HIDDEN], tag)) this[HIDDEN][tag] = false;\n      setSymbolDesc(this, tag, _propertyDesc(1, value));\n    };\n    if (_descriptors && setter) setSymbolDesc(ObjectProto, tag, { configurable: true, set: $set });\n    return wrap(tag);\n  };\n  _redefine($Symbol[PROTOTYPE$2], 'toString', function toString() {\n    return this._k;\n  });\n\n  _objectGopd.f = $getOwnPropertyDescriptor;\n  _objectDp.f = $defineProperty;\n  _objectGopn.f = _objectGopnExt.f = $getOwnPropertyNames;\n  _objectPie.f = $propertyIsEnumerable;\n  _objectGops.f = $getOwnPropertySymbols;\n\n  if (_descriptors && !_library) {\n    _redefine(ObjectProto, 'propertyIsEnumerable', $propertyIsEnumerable, true);\n  }\n\n  _wksExt.f = function (name) {\n    return wrap(_wks(name));\n  };\n}\n\n_export(_export.G + _export.W + _export.F * !USE_NATIVE, { Symbol: $Symbol });\n\nfor (var es6Symbols = (\n  // 19.4.2.2, 19.4.2.3, 19.4.2.4, 19.4.2.6, 19.4.2.8, 19.4.2.9, 19.4.2.10, 19.4.2.11, 19.4.2.12, 19.4.2.13, 19.4.2.14\n  'hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables'\n).split(','), j = 0; es6Symbols.length > j;)_wks(es6Symbols[j++]);\n\nfor (var wellKnownSymbols = _objectKeys(_wks.store), k = 0; wellKnownSymbols.length > k;) _wksDefine(wellKnownSymbols[k++]);\n\n_export(_export.S + _export.F * !USE_NATIVE, 'Symbol', {\n  // 19.4.2.1 Symbol.for(key)\n  'for': function (key) {\n    return _has(SymbolRegistry, key += '')\n      ? SymbolRegistry[key]\n      : SymbolRegistry[key] = $Symbol(key);\n  },\n  // 19.4.2.5 Symbol.keyFor(sym)\n  keyFor: function keyFor(sym) {\n    if (!isSymbol(sym)) throw TypeError(sym + ' is not a symbol!');\n    for (var key in SymbolRegistry) if (SymbolRegistry[key] === sym) return key;\n  },\n  useSetter: function () { setter = true; },\n  useSimple: function () { setter = false; }\n});\n\n_export(_export.S + _export.F * !USE_NATIVE, 'Object', {\n  // 19.1.2.2 Object.create(O [, Properties])\n  create: $create,\n  // 19.1.2.4 Object.defineProperty(O, P, Attributes)\n  defineProperty: $defineProperty,\n  // 19.1.2.3 Object.defineProperties(O, Properties)\n  defineProperties: $defineProperties,\n  // 19.1.2.6 Object.getOwnPropertyDescriptor(O, P)\n  getOwnPropertyDescriptor: $getOwnPropertyDescriptor,\n  // 19.1.2.7 Object.getOwnPropertyNames(O)\n  getOwnPropertyNames: $getOwnPropertyNames,\n  // 19.1.2.8 Object.getOwnPropertySymbols(O)\n  getOwnPropertySymbols: $getOwnPropertySymbols\n});\n\n// 24.3.2 JSON.stringify(value [, replacer [, space]])\n$JSON && _export(_export.S + _export.F * (!USE_NATIVE || _fails(function () {\n  var S = $Symbol();\n  // MS Edge converts symbol values to JSON as {}\n  // WebKit converts symbol values to JSON as null\n  // V8 throws on boxed symbols\n  return _stringify([S]) != '[null]' || _stringify({ a: S }) != '{}' || _stringify(Object(S)) != '{}';\n})), 'JSON', {\n  stringify: function stringify(it) {\n    var args = [it];\n    var i = 1;\n    var replacer, $replacer;\n    while (arguments.length > i) args.push(arguments[i++]);\n    $replacer = replacer = args[1];\n    if (!_isObject(replacer) && it === undefined || isSymbol(it)) return; // IE8 returns string on undefined\n    if (!_isArray(replacer)) replacer = function (key, value) {\n      if (typeof $replacer == 'function') value = $replacer.call(this, key, value);\n      if (!isSymbol(value)) return value;\n    };\n    args[1] = replacer;\n    return _stringify.apply($JSON, args);\n  }\n});\n\n// 19.4.3.4 Symbol.prototype[@@toPrimitive](hint)\n$Symbol[PROTOTYPE$2][TO_PRIMITIVE] || _hide($Symbol[PROTOTYPE$2], TO_PRIMITIVE, $Symbol[PROTOTYPE$2].valueOf);\n// 19.4.3.5 Symbol.prototype[@@toStringTag]\n_setToStringTag($Symbol, 'Symbol');\n// 20.2.1.9 Math[@@toStringTag]\n_setToStringTag(Math, 'Math', true);\n// 24.3.3 JSON[@@toStringTag]\n_setToStringTag(_global.JSON, 'JSON', true);\n\n// getting tag from 19.1.3.6 Object.prototype.toString()\n\nvar TAG$1 = _wks('toStringTag');\n// ES3 wrong here\nvar ARG = _cof(function () { return arguments; }()) == 'Arguments';\n\n// fallback for IE11 Script Access Denied error\nvar tryGet = function (it, key) {\n  try {\n    return it[key];\n  } catch (e) { /* empty */ }\n};\n\nvar _classof = function (it) {\n  var O, T, B;\n  return it === undefined ? 'Undefined' : it === null ? 'Null'\n    // @@toStringTag case\n    : typeof (T = tryGet(O = Object(it), TAG$1)) == 'string' ? T\n    // builtinTag case\n    : ARG ? _cof(O)\n    // ES3 arguments fallback\n    : (B = _cof(O)) == 'Object' && typeof O.callee == 'function' ? 'Arguments' : B;\n};\n\n// 19.1.3.6 Object.prototype.toString()\n\nvar test = {};\ntest[_wks('toStringTag')] = 'z';\nif (test + '' != '[object z]') {\n  _redefine(Object.prototype, 'toString', function toString() {\n    return '[object ' + _classof(this) + ']';\n  }, true);\n}\n\n_wksDefine('asyncIterator');\n\n_wksDefine('observable');\n\nvar symbol = _core.Symbol;\n\n// true  -> String#at\n// false -> String#codePointAt\nvar _stringAt = function (TO_STRING) {\n  return function (that, pos) {\n    var s = String(_defined(that));\n    var i = _toInteger(pos);\n    var l = s.length;\n    var a, b;\n    if (i < 0 || i >= l) return TO_STRING ? '' : undefined;\n    a = s.charCodeAt(i);\n    return a < 0xd800 || a > 0xdbff || i + 1 === l || (b = s.charCodeAt(i + 1)) < 0xdc00 || b > 0xdfff\n      ? TO_STRING ? s.charAt(i) : a\n      : TO_STRING ? s.slice(i, i + 2) : (a - 0xd800 << 10) + (b - 0xdc00) + 0x10000;\n  };\n};\n\nvar _iterators = {};\n\nvar IteratorPrototype = {};\n\n// 25.1.2.1.1 %IteratorPrototype%[@@iterator]()\n_hide(IteratorPrototype, _wks('iterator'), function () { return this; });\n\nvar _iterCreate = function (Constructor, NAME, next) {\n  Constructor.prototype = _objectCreate(IteratorPrototype, { next: _propertyDesc(1, next) });\n  _setToStringTag(Constructor, NAME + ' Iterator');\n};\n\n// 19.1.2.9 / 15.2.3.2 Object.getPrototypeOf(O)\n\n\nvar IE_PROTO$2 = _sharedKey('IE_PROTO');\nvar ObjectProto$1 = Object.prototype;\n\nvar _objectGpo = Object.getPrototypeOf || function (O) {\n  O = _toObject(O);\n  if (_has(O, IE_PROTO$2)) return O[IE_PROTO$2];\n  if (typeof O.constructor == 'function' && O instanceof O.constructor) {\n    return O.constructor.prototype;\n  } return O instanceof Object ? ObjectProto$1 : null;\n};\n\nvar ITERATOR = _wks('iterator');\nvar BUGGY = !([].keys && 'next' in [].keys()); // Safari has buggy iterators w/o `next`\nvar FF_ITERATOR = '@@iterator';\nvar KEYS = 'keys';\nvar VALUES = 'values';\n\nvar returnThis = function () { return this; };\n\nvar _iterDefine = function (Base, NAME, Constructor, next, DEFAULT, IS_SET, FORCED) {\n  _iterCreate(Constructor, NAME, next);\n  var getMethod = function (kind) {\n    if (!BUGGY && kind in proto) return proto[kind];\n    switch (kind) {\n      case KEYS: return function keys() { return new Constructor(this, kind); };\n      case VALUES: return function values() { return new Constructor(this, kind); };\n    } return function entries() { return new Constructor(this, kind); };\n  };\n  var TAG = NAME + ' Iterator';\n  var DEF_VALUES = DEFAULT == VALUES;\n  var VALUES_BUG = false;\n  var proto = Base.prototype;\n  var $native = proto[ITERATOR] || proto[FF_ITERATOR] || DEFAULT && proto[DEFAULT];\n  var $default = $native || getMethod(DEFAULT);\n  var $entries = DEFAULT ? !DEF_VALUES ? $default : getMethod('entries') : undefined;\n  var $anyNative = NAME == 'Array' ? proto.entries || $native : $native;\n  var methods, key, IteratorPrototype;\n  // Fix native\n  if ($anyNative) {\n    IteratorPrototype = _objectGpo($anyNative.call(new Base()));\n    if (IteratorPrototype !== Object.prototype && IteratorPrototype.next) {\n      // Set @@toStringTag to native iterators\n      _setToStringTag(IteratorPrototype, TAG, true);\n      // fix for some old engines\n      if (!_library && typeof IteratorPrototype[ITERATOR] != 'function') _hide(IteratorPrototype, ITERATOR, returnThis);\n    }\n  }\n  // fix Array#{values, @@iterator}.name in V8 / FF\n  if (DEF_VALUES && $native && $native.name !== VALUES) {\n    VALUES_BUG = true;\n    $default = function values() { return $native.call(this); };\n  }\n  // Define iterator\n  if ((!_library || FORCED) && (BUGGY || VALUES_BUG || !proto[ITERATOR])) {\n    _hide(proto, ITERATOR, $default);\n  }\n  // Plug for library\n  _iterators[NAME] = $default;\n  _iterators[TAG] = returnThis;\n  if (DEFAULT) {\n    methods = {\n      values: DEF_VALUES ? $default : getMethod(VALUES),\n      keys: IS_SET ? $default : getMethod(KEYS),\n      entries: $entries\n    };\n    if (FORCED) for (key in methods) {\n      if (!(key in proto)) _redefine(proto, key, methods[key]);\n    } else _export(_export.P + _export.F * (BUGGY || VALUES_BUG), NAME, methods);\n  }\n  return methods;\n};\n\nvar $at = _stringAt(true);\n\n// 21.1.3.27 String.prototype[@@iterator]()\n_iterDefine(String, 'String', function (iterated) {\n  this._t = String(iterated); // target\n  this._i = 0;                // next index\n// 21.1.5.2.1 %StringIteratorPrototype%.next()\n}, function () {\n  var O = this._t;\n  var index = this._i;\n  var point;\n  if (index >= O.length) return { value: undefined, done: true };\n  point = $at(O, index);\n  this._i += point.length;\n  return { value: point, done: false };\n});\n\nvar _iterStep = function (done, value) {\n  return { value: value, done: !!done };\n};\n\n// 22.1.3.4 Array.prototype.entries()\n// 22.1.3.13 Array.prototype.keys()\n// 22.1.3.29 Array.prototype.values()\n// 22.1.3.30 Array.prototype[@@iterator]()\nvar es6_array_iterator = _iterDefine(Array, 'Array', function (iterated, kind) {\n  this._t = _toIobject(iterated); // target\n  this._i = 0;                   // next index\n  this._k = kind;                // kind\n// 22.1.5.2.1 %ArrayIteratorPrototype%.next()\n}, function () {\n  var O = this._t;\n  var kind = this._k;\n  var index = this._i++;\n  if (!O || index >= O.length) {\n    this._t = undefined;\n    return _iterStep(1);\n  }\n  if (kind == 'keys') return _iterStep(0, index);\n  if (kind == 'values') return _iterStep(0, O[index]);\n  return _iterStep(0, [index, O[index]]);\n}, 'values');\n\n// argumentsList[@@iterator] is %ArrayProto_values% (9.4.4.6, 9.4.4.7)\n_iterators.Arguments = _iterators.Array;\n\n_addToUnscopables('keys');\n_addToUnscopables('values');\n_addToUnscopables('entries');\n\nvar ITERATOR$1 = _wks('iterator');\nvar TO_STRING_TAG = _wks('toStringTag');\nvar ArrayValues = _iterators.Array;\n\nvar DOMIterables = {\n  CSSRuleList: true, // TODO: Not spec compliant, should be false.\n  CSSStyleDeclaration: false,\n  CSSValueList: false,\n  ClientRectList: false,\n  DOMRectList: false,\n  DOMStringList: false,\n  DOMTokenList: true,\n  DataTransferItemList: false,\n  FileList: false,\n  HTMLAllCollection: false,\n  HTMLCollection: false,\n  HTMLFormElement: false,\n  HTMLSelectElement: false,\n  MediaList: true, // TODO: Not spec compliant, should be false.\n  MimeTypeArray: false,\n  NamedNodeMap: false,\n  NodeList: true,\n  PaintRequestList: false,\n  Plugin: false,\n  PluginArray: false,\n  SVGLengthList: false,\n  SVGNumberList: false,\n  SVGPathSegList: false,\n  SVGPointList: false,\n  SVGStringList: false,\n  SVGTransformList: false,\n  SourceBufferList: false,\n  StyleSheetList: true, // TODO: Not spec compliant, should be false.\n  TextTrackCueList: false,\n  TextTrackList: false,\n  TouchList: false\n};\n\nfor (var collections = _objectKeys(DOMIterables), i = 0; i < collections.length; i++) {\n  var NAME = collections[i];\n  var explicit = DOMIterables[NAME];\n  var Collection = _global[NAME];\n  var proto = Collection && Collection.prototype;\n  var key;\n  if (proto) {\n    if (!proto[ITERATOR$1]) _hide(proto, ITERATOR$1, ArrayValues);\n    if (!proto[TO_STRING_TAG]) _hide(proto, TO_STRING_TAG, NAME);\n    _iterators[NAME] = ArrayValues;\n    if (explicit) for (key in es6_array_iterator) if (!proto[key]) _redefine(proto, key, es6_array_iterator[key], true);\n  }\n}\n\nvar iterator = _wksExt.f('iterator');\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/@firebase/polyfill/dist/index.esm.js","import '@firebase/polyfill';\nimport firebase from '@firebase/app';\n\n/**\r\n * Copyright 2018 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nexport default firebase;\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/firebase/app/dist/index.esm.js","import '@firebase/database';\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/firebase/database/dist/index.esm.js","import firebase from 'firebase/app'\nimport 'firebase/database'\n\nconst config = {\n  apiKey: \"AIzaSyBeyNtKCVeK7dSnZX0xr6qWCrKj5PnTmfM\",\n  authDomain: \"flexicon-757a0.firebaseapp.com\",\n  databaseURL: \"https://flexicon-757a0.firebaseio.com\",\n  projectId: \"flexicon-757a0\",\n  storageBucket: \"flexicon-757a0.appspot.com\",\n  messagingSenderId: \"357714471064\"\n}\n\nfirebase.initializeApp(config)\nexport default firebase\n\n\n\n// WEBPACK FOOTER //\n// ./firebase.js","import './style'\nimport { Component } from 'preact'\nimport firebase from './firebase.js'\nimport './assets/style.css'\n\nexport default class App extends Component {\n\tstate = {\n\t\tword: '',\n\t\ttranslation: '',\n\t\ttranslations: [],\n\t\taddWord: '',\n\t\taddTranslation: '',\n\n\t\tshowStartPage: true,\n\t\tshowAddNewWord: false,\n\t\tshowWordAdded: false\n\t}\n\n\tisShowAddNewBlock = false;\n\n\thandleChange = (e) => {\n\t\tthis.setState({ word: e.target.value })\n\t\tthis.checkWord()\n\t}\n\n\thandleAddWordChange = (e) => {\n\t\tthis.setState({ addWord: e.target.value })\n\t}\n\n\thandleAddTranslationChange = (e) => {\n\t\tthis.setState({ addTranslation: e.target.value })\n\t}\n\n\tcheckWord = () => {\n\t\tthis.setState({ translation: '' })\n\t\tlet obj = this.state.translations.find(word => word.word === this.state.word)\n\t\tif (obj) {\n\t\t\tthis.setState({ translation: obj.translation })\n\t\t}\n\t}\n\n\taddTranslation = () => {\n\t\tconst translationsRef = firebase.database().ref('translations');\n\t\tconst item = {\n\t\t\tword: this.state.addWord,\n\t\t\ttranslation: this.state.addTranslation\n\t\t}\n\t\tif (this.state.addWord.length > 0 && this.state.addTranslation.length > 0) {\n\t\t\ttranslationsRef.push(item);\n\t\t\tthis.setState({\n\t\t\t\taddWord: '',\n\t\t\t\taddTranslation: '',\n\t\t\t\tshowWordAdded: true\n\t\t\t});\n\t\t}\n\t}\n\n\tpopulate = () => {\n\t\tconst translationsRef = firebase.database().ref('translations');\n\n\t\ttranslations.map(o => translationsRef.push(o));\n\t}\n\n\tshowAddNew = () => {\n\t\tthis.setState({ showAddNewText: true })\n\t}\n\n\thideAddNew = () => {\n\t\tthis.setState({ showAddNewText: false })\n\t}\n\n\ttoggleAddNewWord = () => {\n\t\tthis.setState({\n\t\t\tshowAddNewWord: !this.state.showAddNewWord,\n\t\t\tshowWordAdded: false,\n\t\t\tword: '',\n\t\t\ttranslation: ''\n\t\t})\n\t\tthis.isShowAddNewBlock ? this.isShowAddNewBlock = false : setTimeout(() => this.isShowAddNewBlock = true, 100)\n\t}\n\n\thideStartPage = () => {\n\t\tthis.setState({ showStartPage: false })\n\t}\n\n\tcomponentDidMount() {\n\t\tconst translationsRef = firebase.database().ref('translations');\n\t\ttranslationsRef.on('value', (snapshot) => {\n\t\t\tlet translations = snapshot.val()\n\t\t\tlet newState = []\n\t\t\tfor (let item in translations) {\n\t\t\t\tnewState.push({\n\t\t\t\t\tid: item,\n\t\t\t\t\tword: translations[item].word,\n\t\t\t\t\ttranslation: translations[item].translation\n\t\t\t\t})\n\t\t\t}\n\t\t\tthis.setState({\n\t\t\t\ttranslations: newState\n\t\t\t})\n\t\t})\n\t\t\n\t\tdocument.onclick = (e) => {\n\t\t\tif(e.target.className !== 'add-new-block'\n\t\t\t\t\t&& e.target.className !== 'add-new-block-input'\n\t\t\t\t\t&& e.target.className !== 'add-btn'\n\t\t\t\t\t&& this.isShowAddNewBlock){\n\t\t\t\tthis.toggleAddNewWord();\n\t\t\t}\n\t\t};\n\t}\n\n\trender() {\n\t\tconst classNames = require('classnames')\n\t\tconst addNewClass = classNames({\n      'add-new': true,\n      'hide': !this.state.showAddNewText\n\t\t})\n\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t{ this.state.showStartPage ?\n\t\t\t\t\t<div className='startPage'>\n\t\t\t\t\t\t<img src='/assets/startPageText.svg' alt='start page text' />\n\t\t\t\t\t\t<img src='/assets/okich.svg' alt='start page text' onClick={this.hideStartPage} />\n\t\t\t\t\t</div> : ''\n\t\t\t\t}\n\t\t\t\t<div className='container'>\n\t\t\t\t\t<img src='/assets/r.svg' alt='R' />\n\t\t\t\t\t<p className='line' />\n\t\t\t\t\t<div className='head'>\n\t\t\t\t\t\t<img src='/assets/flexicon.svg' alt='Flexicon' />\n\t\t\t\t\t\t<div className=\"add-new-container\">\n\t\t\t\t\t\t\t<img className={addNewClass} src='/assets/add_new.svg' alt='add new' />\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tclassName='plus'\n\t\t\t\t\t\t\t\tsrc='/assets/plus.svg'\n\t\t\t\t\t\t\t\talt='plus'\n\t\t\t\t\t\t\t\tonMouseEnter={this.showAddNew}\n\t\t\t\t\t\t\t\tonMouseLeave={this.hideAddNew}\n\t\t\t\t\t\t\t\tonClick={this.toggleAddNewWord}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.state.showAddNewWord ?\n\t\t\t\t\t\t\t\t\t<div className='add-new-block'>\n\t\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=' '\n\t\t\t\t\t\t\t\t\t\t\tvalue={this.state.addWord}\n\t\t\t\t\t\t\t\t\t\t\tonInput={this.handleAddWordChange}\n\t\t\t\t\t\t\t\t\t\t\tclassName='add-new-block-input'\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=' '\n\t\t\t\t\t\t\t\t\t\t\tvalue={this.state.addTranslation}\n\t\t\t\t\t\t\t\t\t\t\tonInput={this.handleAddTranslationChange}\n\t\t\t\t\t\t\t\t\t\t\tclassName='add-new-block-input'\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<img className='add-btn' src='/assets/add-btn.svg' alt='plus' onClick={this.addTranslation} />\n\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tthis.state.showWordAdded ? \n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"wordAdded\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"wordAddedText\">,     !       !</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<img src='/assets/okich.svg' alt='start page text' onClick={this.toggleAddNewWord} />\n\t\t\t\t\t\t\t\t\t\t\t\t</div> : ''\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t</div> : ''\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t{ \n\t\t\t\t\t\t!this.state.showAddNewWord ?\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\tclassName='text-to-translate'\n\t\t\t\t\t\t\t\t\tvalue={this.state.word}\n\t\t\t\t\t\t\t\t\tonInput={this.handleChange}\n\t\t\t\t\t\t\t\t\tplaceholder=' '\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<div className='translation-result'>\n\t\t\t\t\t\t\t\t\t{this.state.translation}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div> : ''\t\t\n\t\t\t\t\t}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./index.js","import { createSubscribe, deepCopy, deepExtend, ErrorFactory, patchProperty } from '@firebase/util';\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar contains = function (obj, key) {\r\n    return Object.prototype.hasOwnProperty.call(obj, key);\r\n};\r\nvar DEFAULT_ENTRY_NAME = '[DEFAULT]';\r\n// An array to capture listeners before the true auth functions\r\n// exist\r\nvar tokenListeners = [];\r\n/**\r\n * Global context object for a collection of services using\r\n * a shared authentication state.\r\n */\r\nvar FirebaseAppImpl = /** @class */ (function () {\r\n    function FirebaseAppImpl(options, config, firebase_) {\r\n        this.firebase_ = firebase_;\r\n        this.isDeleted_ = false;\r\n        this.services_ = {};\r\n        this.name_ = config.name;\r\n        this._automaticDataCollectionEnabled =\r\n            config.automaticDataCollectionEnabled || false;\r\n        this.options_ = deepCopy(options);\r\n        this.INTERNAL = {\r\n            getUid: function () { return null; },\r\n            getToken: function () { return Promise.resolve(null); },\r\n            addAuthTokenListener: function (callback) {\r\n                tokenListeners.push(callback);\r\n                // Make sure callback is called, asynchronously, in the absence of the auth module\r\n                setTimeout(function () { return callback(null); }, 0);\r\n            },\r\n            removeAuthTokenListener: function (callback) {\r\n                tokenListeners = tokenListeners.filter(function (listener) { return listener !== callback; });\r\n            }\r\n        };\r\n    }\r\n    Object.defineProperty(FirebaseAppImpl.prototype, \"automaticDataCollectionEnabled\", {\r\n        get: function () {\r\n            this.checkDestroyed_();\r\n            return this._automaticDataCollectionEnabled;\r\n        },\r\n        set: function (val) {\r\n            this.checkDestroyed_();\r\n            this._automaticDataCollectionEnabled = val;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FirebaseAppImpl.prototype, \"name\", {\r\n        get: function () {\r\n            this.checkDestroyed_();\r\n            return this.name_;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FirebaseAppImpl.prototype, \"options\", {\r\n        get: function () {\r\n            this.checkDestroyed_();\r\n            return this.options_;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    FirebaseAppImpl.prototype.delete = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve) {\r\n            _this.checkDestroyed_();\r\n            resolve();\r\n        })\r\n            .then(function () {\r\n            _this.firebase_.INTERNAL.removeApp(_this.name_);\r\n            var services = [];\r\n            Object.keys(_this.services_).forEach(function (serviceKey) {\r\n                Object.keys(_this.services_[serviceKey]).forEach(function (instanceKey) {\r\n                    services.push(_this.services_[serviceKey][instanceKey]);\r\n                });\r\n            });\r\n            return Promise.all(services.map(function (service) {\r\n                return service.INTERNAL.delete();\r\n            }));\r\n        })\r\n            .then(function () {\r\n            _this.isDeleted_ = true;\r\n            _this.services_ = {};\r\n        });\r\n    };\r\n    /**\r\n     * Return a service instance associated with this app (creating it\r\n     * on demand), identified by the passed instanceIdentifier.\r\n     *\r\n     * NOTE: Currently storage is the only one that is leveraging this\r\n     * functionality. They invoke it by calling:\r\n     *\r\n     * ```javascript\r\n     * firebase.app().storage('STORAGE BUCKET ID')\r\n     * ```\r\n     *\r\n     * The service name is passed to this already\r\n     * @internal\r\n     */\r\n    FirebaseAppImpl.prototype._getService = function (name, instanceIdentifier) {\r\n        if (instanceIdentifier === void 0) { instanceIdentifier = DEFAULT_ENTRY_NAME; }\r\n        this.checkDestroyed_();\r\n        if (!this.services_[name]) {\r\n            this.services_[name] = {};\r\n        }\r\n        if (!this.services_[name][instanceIdentifier]) {\r\n            /**\r\n             * If a custom instance has been defined (i.e. not '[DEFAULT]')\r\n             * then we will pass that instance on, otherwise we pass `null`\r\n             */\r\n            var instanceSpecifier = instanceIdentifier !== DEFAULT_ENTRY_NAME\r\n                ? instanceIdentifier\r\n                : undefined;\r\n            var service = this.firebase_.INTERNAL.factories[name](this, this.extendApp.bind(this), instanceSpecifier);\r\n            this.services_[name][instanceIdentifier] = service;\r\n        }\r\n        return this.services_[name][instanceIdentifier];\r\n    };\r\n    /**\r\n     * Callback function used to extend an App instance at the time\r\n     * of service instance creation.\r\n     */\r\n    FirebaseAppImpl.prototype.extendApp = function (props) {\r\n        var _this = this;\r\n        // Copy the object onto the FirebaseAppImpl prototype\r\n        deepExtend(this, props);\r\n        /**\r\n         * If the app has overwritten the addAuthTokenListener stub, forward\r\n         * the active token listeners on to the true fxn.\r\n         *\r\n         * TODO: This function is required due to our current module\r\n         * structure. Once we are able to rely strictly upon a single module\r\n         * implementation, this code should be refactored and Auth should\r\n         * provide these stubs and the upgrade logic\r\n         */\r\n        if (props.INTERNAL && props.INTERNAL.addAuthTokenListener) {\r\n            tokenListeners.forEach(function (listener) {\r\n                _this.INTERNAL.addAuthTokenListener(listener);\r\n            });\r\n            tokenListeners = [];\r\n        }\r\n    };\r\n    /**\r\n     * This function will throw an Error if the App has already been deleted -\r\n     * use before performing API actions on the App.\r\n     */\r\n    FirebaseAppImpl.prototype.checkDestroyed_ = function () {\r\n        if (this.isDeleted_) {\r\n            error('app-deleted', { name: this.name_ });\r\n        }\r\n    };\r\n    return FirebaseAppImpl;\r\n}());\r\n// Prevent dead-code elimination of these methods w/o invalid property\r\n// copying.\r\n(FirebaseAppImpl.prototype.name && FirebaseAppImpl.prototype.options) ||\r\n    FirebaseAppImpl.prototype.delete ||\r\n    console.log('dc');\r\n/**\r\n * Return a firebase namespace object.\r\n *\r\n * In production, this will be called exactly once and the result\r\n * assigned to the 'firebase' global.  It may be called multiple times\r\n * in unit tests.\r\n */\r\nfunction createFirebaseNamespace() {\r\n    var apps_ = {};\r\n    var factories = {};\r\n    var appHooks = {};\r\n    // A namespace is a plain JavaScript Object.\r\n    var namespace = {\r\n        // Hack to prevent Babel from modifying the object returned\r\n        // as the firebase namespace.\r\n        __esModule: true,\r\n        initializeApp: initializeApp,\r\n        app: app,\r\n        apps: null,\r\n        Promise: Promise,\r\n        SDK_VERSION: '5.5.9',\r\n        INTERNAL: {\r\n            registerService: registerService,\r\n            createFirebaseNamespace: createFirebaseNamespace,\r\n            extendNamespace: extendNamespace,\r\n            createSubscribe: createSubscribe,\r\n            ErrorFactory: ErrorFactory,\r\n            removeApp: removeApp,\r\n            factories: factories,\r\n            useAsService: useAsService,\r\n            Promise: Promise,\r\n            deepExtend: deepExtend\r\n        }\r\n    };\r\n    // Inject a circular default export to allow Babel users who were previously\r\n    // using:\r\n    //\r\n    //   import firebase from 'firebase';\r\n    //   which becomes: var firebase = require('firebase').default;\r\n    //\r\n    // instead of\r\n    //\r\n    //   import * as firebase from 'firebase';\r\n    //   which becomes: var firebase = require('firebase');\r\n    patchProperty(namespace, 'default', namespace);\r\n    // firebase.apps is a read-only getter.\r\n    Object.defineProperty(namespace, 'apps', {\r\n        get: getApps\r\n    });\r\n    /**\r\n     * Called by App.delete() - but before any services associated with the App\r\n     * are deleted.\r\n     */\r\n    function removeApp(name) {\r\n        var app = apps_[name];\r\n        callAppHooks(app, 'delete');\r\n        delete apps_[name];\r\n    }\r\n    /**\r\n     * Get the App object for a given name (or DEFAULT).\r\n     */\r\n    function app(name) {\r\n        name = name || DEFAULT_ENTRY_NAME;\r\n        if (!contains(apps_, name)) {\r\n            error('no-app', { name: name });\r\n        }\r\n        return apps_[name];\r\n    }\r\n    patchProperty(app, 'App', FirebaseAppImpl);\r\n    function initializeApp(options, rawConfig) {\r\n        if (rawConfig === void 0) { rawConfig = {}; }\r\n        if (typeof rawConfig !== 'object' || rawConfig === null) {\r\n            var name_1 = rawConfig;\r\n            rawConfig = { name: name_1 };\r\n        }\r\n        var config = rawConfig;\r\n        if (config.name === undefined) {\r\n            config.name = DEFAULT_ENTRY_NAME;\r\n        }\r\n        var name = config.name;\r\n        if (typeof name !== 'string' || !name) {\r\n            error('bad-app-name', { name: name + '' });\r\n        }\r\n        if (contains(apps_, name)) {\r\n            error('duplicate-app', { name: name });\r\n        }\r\n        var app = new FirebaseAppImpl(options, config, namespace);\r\n        apps_[name] = app;\r\n        callAppHooks(app, 'create');\r\n        return app;\r\n    }\r\n    /*\r\n     * Return an array of all the non-deleted FirebaseApps.\r\n     */\r\n    function getApps() {\r\n        // Make a copy so caller cannot mutate the apps list.\r\n        return Object.keys(apps_).map(function (name) { return apps_[name]; });\r\n    }\r\n    /*\r\n     * Register a Firebase Service.\r\n     *\r\n     * firebase.INTERNAL.registerService()\r\n     *\r\n     * TODO: Implement serviceProperties.\r\n     */\r\n    function registerService(name, createService, serviceProperties, appHook, allowMultipleInstances) {\r\n        // Cannot re-register a service that already exists\r\n        if (factories[name]) {\r\n            error('duplicate-service', { name: name });\r\n        }\r\n        // Capture the service factory for later service instantiation\r\n        factories[name] = createService;\r\n        // Capture the appHook, if passed\r\n        if (appHook) {\r\n            appHooks[name] = appHook;\r\n            // Run the **new** app hook on all existing apps\r\n            getApps().forEach(function (app) {\r\n                appHook('create', app);\r\n            });\r\n        }\r\n        // The Service namespace is an accessor function ...\r\n        var serviceNamespace = function (appArg) {\r\n            if (appArg === void 0) { appArg = app(); }\r\n            if (typeof appArg[name] !== 'function') {\r\n                // Invalid argument.\r\n                // This happens in the following case: firebase.storage('gs:/')\r\n                error('invalid-app-argument', { name: name });\r\n            }\r\n            // Forward service instance lookup to the FirebaseApp.\r\n            return appArg[name]();\r\n        };\r\n        // ... and a container for service-level properties.\r\n        if (serviceProperties !== undefined) {\r\n            deepExtend(serviceNamespace, serviceProperties);\r\n        }\r\n        // Monkey-patch the serviceNamespace onto the firebase namespace\r\n        namespace[name] = serviceNamespace;\r\n        // Patch the FirebaseAppImpl prototype\r\n        FirebaseAppImpl.prototype[name] = function () {\r\n            var args = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                args[_i] = arguments[_i];\r\n            }\r\n            var serviceFxn = this._getService.bind(this, name);\r\n            return serviceFxn.apply(this, allowMultipleInstances ? args : []);\r\n        };\r\n        return serviceNamespace;\r\n    }\r\n    /**\r\n     * Patch the top-level firebase namespace with additional properties.\r\n     *\r\n     * firebase.INTERNAL.extendNamespace()\r\n     */\r\n    function extendNamespace(props) {\r\n        deepExtend(namespace, props);\r\n    }\r\n    function callAppHooks(app, eventName) {\r\n        Object.keys(factories).forEach(function (serviceName) {\r\n            // Ignore virtual services\r\n            var factoryName = useAsService(app, serviceName);\r\n            if (factoryName === null) {\r\n                return;\r\n            }\r\n            if (appHooks[factoryName]) {\r\n                appHooks[factoryName](eventName, app);\r\n            }\r\n        });\r\n    }\r\n    // Map the requested service to a registered service name\r\n    // (used to map auth to serverAuth service when needed).\r\n    function useAsService(app, name) {\r\n        if (name === 'serverAuth') {\r\n            return null;\r\n        }\r\n        var useService = name;\r\n        var options = app.options;\r\n        return useService;\r\n    }\r\n    return namespace;\r\n}\r\nfunction error(code, args) {\r\n    throw appErrors.create(code, args);\r\n}\r\n// TypeScript does not support non-string indexes!\r\n// let errors: {[code: AppError: string} = {\r\nvar errors = {\r\n    'no-app': \"No Firebase App '{$name}' has been created - \" +\r\n        'call Firebase App.initializeApp()',\r\n    'bad-app-name': \"Illegal App name: '{$name}\",\r\n    'duplicate-app': \"Firebase App named '{$name}' already exists\",\r\n    'app-deleted': \"Firebase App named '{$name}' already deleted\",\r\n    'duplicate-service': \"Firebase service named '{$name}' already registered\",\r\n    'sa-not-supported': 'Initializing the Firebase SDK with a service ' +\r\n        'account is only allowed in a Node.js environment. On client ' +\r\n        'devices, you should instead initialize the SDK with an api key and ' +\r\n        'auth domain',\r\n    'invalid-app-argument': 'firebase.{$name}() takes either no argument or a ' +\r\n        'Firebase App instance.'\r\n};\r\nvar appErrors = new ErrorFactory('app', 'Firebase', errors);\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar firebase = createFirebaseNamespace();\n\nexport default firebase;\nexport { firebase };\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/@firebase/app/dist/index.esm.js","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = Object.setPrototypeOf ||\r\n    ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n    function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = Object.assign || function __assign(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n    }\r\n    return t;\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r);  }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { if (o[n]) i[n] = function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; }; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator];\r\n    return m ? m.call(o) : typeof __values === \"function\" ? __values(o) : o[Symbol.iterator]();\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/tslib/tslib.es6.js","import { jsonEval, stringify, contains, assert, forEach, base64, Sha1, stringToByteArray, isNodeSdk, stringLength, safeGet, errorPrefix, validateArgCount, validateCallback, Deferred, assertionError, clone, map, getCount, getAnyKey, every, validateContextObject, isEmpty, getValues, findValue, findKey, deepCopy, isMobileCordova, base64Encode, CONSTANTS, isAdmin, isValidFormat, isReactNative, querystring } from '@firebase/util';\nimport { Logger, LogLevel } from '@firebase/logger';\nimport { __awaiter, __generator, __extends } from 'tslib';\nimport firebase from '@firebase/app';\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Wraps a DOM Storage object and:\r\n * - automatically encode objects as JSON strings before storing them to allow us to store arbitrary types.\r\n * - prefixes names with \"firebase:\" to avoid collisions with app data.\r\n *\r\n * We automatically (see storage.js) create two such wrappers, one for sessionStorage,\r\n * and one for localStorage.\r\n *\r\n * @constructor\r\n */\r\nvar DOMStorageWrapper = /** @class */ (function () {\r\n    /**\r\n     * @param {Storage} domStorage_ The underlying storage object (e.g. localStorage or sessionStorage)\r\n     */\r\n    function DOMStorageWrapper(domStorage_) {\r\n        this.domStorage_ = domStorage_;\r\n        // Use a prefix to avoid collisions with other stuff saved by the app.\r\n        this.prefix_ = 'firebase:';\r\n    }\r\n    /**\r\n     * @param {string} key The key to save the value under\r\n     * @param {?Object} value The value being stored, or null to remove the key.\r\n     */\r\n    DOMStorageWrapper.prototype.set = function (key, value) {\r\n        if (value == null) {\r\n            this.domStorage_.removeItem(this.prefixedName_(key));\r\n        }\r\n        else {\r\n            this.domStorage_.setItem(this.prefixedName_(key), stringify(value));\r\n        }\r\n    };\r\n    /**\r\n     * @param {string} key\r\n     * @return {*} The value that was stored under this key, or null\r\n     */\r\n    DOMStorageWrapper.prototype.get = function (key) {\r\n        var storedVal = this.domStorage_.getItem(this.prefixedName_(key));\r\n        if (storedVal == null) {\r\n            return null;\r\n        }\r\n        else {\r\n            return jsonEval(storedVal);\r\n        }\r\n    };\r\n    /**\r\n     * @param {string} key\r\n     */\r\n    DOMStorageWrapper.prototype.remove = function (key) {\r\n        this.domStorage_.removeItem(this.prefixedName_(key));\r\n    };\r\n    /**\r\n     * @param {string} name\r\n     * @return {string}\r\n     */\r\n    DOMStorageWrapper.prototype.prefixedName_ = function (name) {\r\n        return this.prefix_ + name;\r\n    };\r\n    DOMStorageWrapper.prototype.toString = function () {\r\n        return this.domStorage_.toString();\r\n    };\r\n    return DOMStorageWrapper;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * An in-memory storage implementation that matches the API of DOMStorageWrapper\r\n * (TODO: create interface for both to implement).\r\n *\r\n * @constructor\r\n */\r\nvar MemoryStorage = /** @class */ (function () {\r\n    function MemoryStorage() {\r\n        this.cache_ = {};\r\n        this.isInMemoryStorage = true;\r\n    }\r\n    MemoryStorage.prototype.set = function (key, value) {\r\n        if (value == null) {\r\n            delete this.cache_[key];\r\n        }\r\n        else {\r\n            this.cache_[key] = value;\r\n        }\r\n    };\r\n    MemoryStorage.prototype.get = function (key) {\r\n        if (contains(this.cache_, key)) {\r\n            return this.cache_[key];\r\n        }\r\n        return null;\r\n    };\r\n    MemoryStorage.prototype.remove = function (key) {\r\n        delete this.cache_[key];\r\n    };\r\n    return MemoryStorage;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Helper to create a DOMStorageWrapper or else fall back to MemoryStorage.\r\n * TODO: Once MemoryStorage and DOMStorageWrapper have a shared interface this method annotation should change\r\n * to reflect this type\r\n *\r\n * @param {string} domStorageName Name of the underlying storage object\r\n *   (e.g. 'localStorage' or 'sessionStorage').\r\n * @return {?} Turning off type information until a common interface is defined.\r\n */\r\nvar createStoragefor = function (domStorageName) {\r\n    try {\r\n        // NOTE: just accessing \"localStorage\" or \"window['localStorage']\" may throw a security exception,\r\n        // so it must be inside the try/catch.\r\n        if (typeof window !== 'undefined' &&\r\n            typeof window[domStorageName] !== 'undefined') {\r\n            // Need to test cache. Just because it's here doesn't mean it works\r\n            var domStorage = window[domStorageName];\r\n            domStorage.setItem('firebase:sentinel', 'cache');\r\n            domStorage.removeItem('firebase:sentinel');\r\n            return new DOMStorageWrapper(domStorage);\r\n        }\r\n    }\r\n    catch (e) { }\r\n    // Failed to create wrapper.  Just return in-memory storage.\r\n    // TODO: log?\r\n    return new MemoryStorage();\r\n};\r\n/** A storage object that lasts across sessions */\r\nvar PersistentStorage = createStoragefor('localStorage');\r\n/** A storage object that only lasts one session */\r\nvar SessionStorage = createStoragefor('sessionStorage');\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar logClient = new Logger('@firebase/database');\r\n/**\r\n * Returns a locally-unique ID (generated by just incrementing up from 0 each time its called).\r\n * @type {function(): number} Generated ID.\r\n */\r\nvar LUIDGenerator = (function () {\r\n    var id = 1;\r\n    return function () {\r\n        return id++;\r\n    };\r\n})();\r\n/**\r\n * Sha1 hash of the input string\r\n * @param {!string} str The string to hash\r\n * @return {!string} The resulting hash\r\n */\r\nvar sha1 = function (str) {\r\n    var utf8Bytes = stringToByteArray(str);\r\n    var sha1 = new Sha1();\r\n    sha1.update(utf8Bytes);\r\n    var sha1Bytes = sha1.digest();\r\n    return base64.encodeByteArray(sha1Bytes);\r\n};\r\n/**\r\n * @param {...*} var_args\r\n * @return {string}\r\n * @private\r\n */\r\nvar buildLogMessage_ = function () {\r\n    var var_args = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        var_args[_i] = arguments[_i];\r\n    }\r\n    var message = '';\r\n    for (var i = 0; i < var_args.length; i++) {\r\n        if (Array.isArray(var_args[i]) ||\r\n            (var_args[i] &&\r\n                typeof var_args[i] === 'object' &&\r\n                typeof var_args[i].length === 'number')) {\r\n            message += buildLogMessage_.apply(null, var_args[i]);\r\n        }\r\n        else if (typeof var_args[i] === 'object') {\r\n            message += stringify(var_args[i]);\r\n        }\r\n        else {\r\n            message += var_args[i];\r\n        }\r\n        message += ' ';\r\n    }\r\n    return message;\r\n};\r\n/**\r\n * Use this for all debug messages in Firebase.\r\n * @type {?function(string)}\r\n */\r\nvar logger = null;\r\n/**\r\n * Flag to check for log availability on first log message\r\n * @type {boolean}\r\n * @private\r\n */\r\nvar firstLog_ = true;\r\n/**\r\n * The implementation of Firebase.enableLogging (defined here to break dependencies)\r\n * @param {boolean|?function(string)} logger_ A flag to turn on logging, or a custom logger\r\n * @param {boolean=} persistent Whether or not to persist logging settings across refreshes\r\n */\r\nvar enableLogging = function (logger_, persistent) {\r\n    assert(!persistent || (logger_ === true || logger_ === false), \"Can't turn on custom loggers persistently.\");\r\n    if (logger_ === true) {\r\n        logClient.logLevel = LogLevel.VERBOSE;\r\n        logger = logClient.log.bind(logClient);\r\n        if (persistent)\r\n            SessionStorage.set('logging_enabled', true);\r\n    }\r\n    else if (typeof logger_ === 'function') {\r\n        logger = logger_;\r\n    }\r\n    else {\r\n        logger = null;\r\n        SessionStorage.remove('logging_enabled');\r\n    }\r\n};\r\n/**\r\n *\r\n * @param {...(string|Arguments)} var_args\r\n */\r\nvar log = function () {\r\n    var var_args = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        var_args[_i] = arguments[_i];\r\n    }\r\n    if (firstLog_ === true) {\r\n        firstLog_ = false;\r\n        if (logger === null && SessionStorage.get('logging_enabled') === true)\r\n            enableLogging(true);\r\n    }\r\n    if (logger) {\r\n        var message = buildLogMessage_.apply(null, var_args);\r\n        logger(message);\r\n    }\r\n};\r\n/**\r\n * @param {!string} prefix\r\n * @return {function(...[*])}\r\n */\r\nvar logWrapper = function (prefix) {\r\n    return function () {\r\n        var var_args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            var_args[_i] = arguments[_i];\r\n        }\r\n        log.apply(void 0, [prefix].concat(var_args));\r\n    };\r\n};\r\n/**\r\n * @param {...string} var_args\r\n */\r\nvar error = function () {\r\n    var var_args = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        var_args[_i] = arguments[_i];\r\n    }\r\n    var message = 'FIREBASE INTERNAL ERROR: ' + buildLogMessage_.apply(void 0, var_args);\r\n    logClient.error(message);\r\n};\r\n/**\r\n * @param {...string} var_args\r\n */\r\nvar fatal = function () {\r\n    var var_args = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        var_args[_i] = arguments[_i];\r\n    }\r\n    var message = \"FIREBASE FATAL ERROR: \" + buildLogMessage_.apply(void 0, var_args);\r\n    logClient.error(message);\r\n    throw new Error(message);\r\n};\r\n/**\r\n * @param {...*} var_args\r\n */\r\nvar warn = function () {\r\n    var var_args = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        var_args[_i] = arguments[_i];\r\n    }\r\n    var message = 'FIREBASE WARNING: ' + buildLogMessage_.apply(void 0, var_args);\r\n    logClient.warn(message);\r\n};\r\n/**\r\n * Logs a warning if the containing page uses https. Called when a call to new Firebase\r\n * does not use https.\r\n */\r\nvar warnIfPageIsSecure = function () {\r\n    // Be very careful accessing browser globals. Who knows what may or may not exist.\r\n    if (typeof window !== 'undefined' &&\r\n        window.location &&\r\n        window.location.protocol &&\r\n        window.location.protocol.indexOf('https:') !== -1) {\r\n        warn('Insecure Firebase access from a secure page. ' +\r\n            'Please use https in calls to new Firebase().');\r\n    }\r\n};\r\n/**\r\n * Returns true if data is NaN, or +/- Infinity.\r\n * @param {*} data\r\n * @return {boolean}\r\n */\r\nvar isInvalidJSONNumber = function (data) {\r\n    return (typeof data === 'number' &&\r\n        (data != data || // NaN\r\n            data == Number.POSITIVE_INFINITY ||\r\n            data == Number.NEGATIVE_INFINITY));\r\n};\r\n/**\r\n * @param {function()} fn\r\n */\r\nvar executeWhenDOMReady = function (fn) {\r\n    if (isNodeSdk() || document.readyState === 'complete') {\r\n        fn();\r\n    }\r\n    else {\r\n        // Modeled after jQuery. Try DOMContentLoaded and onreadystatechange (which\r\n        // fire before onload), but fall back to onload.\r\n        var called_1 = false;\r\n        var wrappedFn_1 = function () {\r\n            if (!document.body) {\r\n                setTimeout(wrappedFn_1, Math.floor(10));\r\n                return;\r\n            }\r\n            if (!called_1) {\r\n                called_1 = true;\r\n                fn();\r\n            }\r\n        };\r\n        if (document.addEventListener) {\r\n            document.addEventListener('DOMContentLoaded', wrappedFn_1, false);\r\n            // fallback to onload.\r\n            window.addEventListener('load', wrappedFn_1, false);\r\n        }\r\n        else if (document.attachEvent) {\r\n            // IE.\r\n            document.attachEvent('onreadystatechange', function () {\r\n                if (document.readyState === 'complete')\r\n                    wrappedFn_1();\r\n            });\r\n            // fallback to onload.\r\n            window.attachEvent('onload', wrappedFn_1);\r\n            // jQuery has an extra hack for IE that we could employ (based on\r\n            // http://javascript.nwbox.com/IEContentLoaded/) But it looks really old.\r\n            // I'm hoping we don't need it.\r\n        }\r\n    }\r\n};\r\n/**\r\n * Minimum key name. Invalid for actual data, used as a marker to sort before any valid names\r\n * @type {!string}\r\n */\r\nvar MIN_NAME = '[MIN_NAME]';\r\n/**\r\n * Maximum key name. Invalid for actual data, used as a marker to sort above any valid names\r\n * @type {!string}\r\n */\r\nvar MAX_NAME = '[MAX_NAME]';\r\n/**\r\n * Compares valid Firebase key names, plus min and max name\r\n * @param {!string} a\r\n * @param {!string} b\r\n * @return {!number}\r\n */\r\nvar nameCompare = function (a, b) {\r\n    if (a === b) {\r\n        return 0;\r\n    }\r\n    else if (a === MIN_NAME || b === MAX_NAME) {\r\n        return -1;\r\n    }\r\n    else if (b === MIN_NAME || a === MAX_NAME) {\r\n        return 1;\r\n    }\r\n    else {\r\n        var aAsInt = tryParseInt(a), bAsInt = tryParseInt(b);\r\n        if (aAsInt !== null) {\r\n            if (bAsInt !== null) {\r\n                return aAsInt - bAsInt == 0 ? a.length - b.length : aAsInt - bAsInt;\r\n            }\r\n            else {\r\n                return -1;\r\n            }\r\n        }\r\n        else if (bAsInt !== null) {\r\n            return 1;\r\n        }\r\n        else {\r\n            return a < b ? -1 : 1;\r\n        }\r\n    }\r\n};\r\n/**\r\n * @param {!string} a\r\n * @param {!string} b\r\n * @return {!number} comparison result.\r\n */\r\nvar stringCompare = function (a, b) {\r\n    if (a === b) {\r\n        return 0;\r\n    }\r\n    else if (a < b) {\r\n        return -1;\r\n    }\r\n    else {\r\n        return 1;\r\n    }\r\n};\r\n/**\r\n * @param {string} key\r\n * @param {Object} obj\r\n * @return {*}\r\n */\r\nvar requireKey = function (key, obj) {\r\n    if (obj && key in obj) {\r\n        return obj[key];\r\n    }\r\n    else {\r\n        throw new Error('Missing required key (' + key + ') in object: ' + stringify(obj));\r\n    }\r\n};\r\n/**\r\n * @param {*} obj\r\n * @return {string}\r\n */\r\nvar ObjectToUniqueKey = function (obj) {\r\n    if (typeof obj !== 'object' || obj === null)\r\n        return stringify(obj);\r\n    var keys = [];\r\n    for (var k in obj) {\r\n        keys.push(k);\r\n    }\r\n    // Export as json, but with the keys sorted.\r\n    keys.sort();\r\n    var key = '{';\r\n    for (var i = 0; i < keys.length; i++) {\r\n        if (i !== 0)\r\n            key += ',';\r\n        key += stringify(keys[i]);\r\n        key += ':';\r\n        key += ObjectToUniqueKey(obj[keys[i]]);\r\n    }\r\n    key += '}';\r\n    return key;\r\n};\r\n/**\r\n * Splits a string into a number of smaller segments of maximum size\r\n * @param {!string} str The string\r\n * @param {!number} segsize The maximum number of chars in the string.\r\n * @return {Array.<string>} The string, split into appropriately-sized chunks\r\n */\r\nvar splitStringBySize = function (str, segsize) {\r\n    var len = str.length;\r\n    if (len <= segsize) {\r\n        return [str];\r\n    }\r\n    var dataSegs = [];\r\n    for (var c = 0; c < len; c += segsize) {\r\n        if (c + segsize > len) {\r\n            dataSegs.push(str.substring(c, len));\r\n        }\r\n        else {\r\n            dataSegs.push(str.substring(c, c + segsize));\r\n        }\r\n    }\r\n    return dataSegs;\r\n};\r\n/**\r\n * Apply a function to each (key, value) pair in an object or\r\n * apply a function to each (index, value) pair in an array\r\n * @param {!(Object|Array)} obj The object or array to iterate over\r\n * @param {function(?, ?)} fn The function to apply\r\n */\r\nvar each = function (obj, fn) {\r\n    if (Array.isArray(obj)) {\r\n        for (var i = 0; i < obj.length; ++i) {\r\n            fn(i, obj[i]);\r\n        }\r\n    }\r\n    else {\r\n        /**\r\n         * in the conversion of code we removed the goog.object.forEach\r\n         * function which did a value,key callback. We standardized on\r\n         * a single impl that does a key, value callback. So we invert\r\n         * to not have to touch the `each` code points\r\n         */\r\n        forEach(obj, function (key, val) { return fn(val, key); });\r\n    }\r\n};\r\n/**\r\n * Borrowed from http://hg.secondlife.com/llsd/src/tip/js/typedarray.js (MIT License)\r\n * I made one modification at the end and removed the NaN / Infinity\r\n * handling (since it seemed broken [caused an overflow] and we don't need it).  See MJL comments.\r\n * @param {!number} v A double\r\n * @return {string}\r\n */\r\nvar doubleToIEEE754String = function (v) {\r\n    assert(!isInvalidJSONNumber(v), 'Invalid JSON number'); // MJL\r\n    var ebits = 11, fbits = 52;\r\n    var bias = (1 << (ebits - 1)) - 1, s, e, f, ln, i, bits, str;\r\n    // Compute sign, exponent, fraction\r\n    // Skip NaN / Infinity handling --MJL.\r\n    if (v === 0) {\r\n        e = 0;\r\n        f = 0;\r\n        s = 1 / v === -Infinity ? 1 : 0;\r\n    }\r\n    else {\r\n        s = v < 0;\r\n        v = Math.abs(v);\r\n        if (v >= Math.pow(2, 1 - bias)) {\r\n            // Normalized\r\n            ln = Math.min(Math.floor(Math.log(v) / Math.LN2), bias);\r\n            e = ln + bias;\r\n            f = Math.round(v * Math.pow(2, fbits - ln) - Math.pow(2, fbits));\r\n        }\r\n        else {\r\n            // Denormalized\r\n            e = 0;\r\n            f = Math.round(v / Math.pow(2, 1 - bias - fbits));\r\n        }\r\n    }\r\n    // Pack sign, exponent, fraction\r\n    bits = [];\r\n    for (i = fbits; i; i -= 1) {\r\n        bits.push(f % 2 ? 1 : 0);\r\n        f = Math.floor(f / 2);\r\n    }\r\n    for (i = ebits; i; i -= 1) {\r\n        bits.push(e % 2 ? 1 : 0);\r\n        e = Math.floor(e / 2);\r\n    }\r\n    bits.push(s ? 1 : 0);\r\n    bits.reverse();\r\n    str = bits.join('');\r\n    // Return the data as a hex string. --MJL\r\n    var hexByteString = '';\r\n    for (i = 0; i < 64; i += 8) {\r\n        var hexByte = parseInt(str.substr(i, 8), 2).toString(16);\r\n        if (hexByte.length === 1)\r\n            hexByte = '0' + hexByte;\r\n        hexByteString = hexByteString + hexByte;\r\n    }\r\n    return hexByteString.toLowerCase();\r\n};\r\n/**\r\n * Used to detect if we're in a Chrome content script (which executes in an\r\n * isolated environment where long-polling doesn't work).\r\n * @return {boolean}\r\n */\r\nvar isChromeExtensionContentScript = function () {\r\n    return !!(typeof window === 'object' &&\r\n        window['chrome'] &&\r\n        window['chrome']['extension'] &&\r\n        !/^chrome/.test(window.location.href));\r\n};\r\n/**\r\n * Used to detect if we're in a Windows 8 Store app.\r\n * @return {boolean}\r\n */\r\nvar isWindowsStoreApp = function () {\r\n    // Check for the presence of a couple WinRT globals\r\n    return typeof Windows === 'object' && typeof Windows.UI === 'object';\r\n};\r\n/**\r\n * Converts a server error code to a Javascript Error\r\n * @param {!string} code\r\n * @param {!Query} query\r\n * @return {Error}\r\n */\r\nvar errorForServerCode = function (code, query) {\r\n    var reason = 'Unknown Error';\r\n    if (code === 'too_big') {\r\n        reason =\r\n            'The data requested exceeds the maximum size ' +\r\n                'that can be accessed with a single request.';\r\n    }\r\n    else if (code == 'permission_denied') {\r\n        reason = \"Client doesn't have permission to access the desired data.\";\r\n    }\r\n    else if (code == 'unavailable') {\r\n        reason = 'The service is unavailable';\r\n    }\r\n    var error = new Error(code + ' at ' + query.path.toString() + ': ' + reason);\r\n    error.code = code.toUpperCase();\r\n    return error;\r\n};\r\n/**\r\n * Used to test for integer-looking strings\r\n * @type {RegExp}\r\n * @private\r\n */\r\nvar INTEGER_REGEXP_ = new RegExp('^-?\\\\d{1,10}$');\r\n/**\r\n * If the string contains a 32-bit integer, return it.  Else return null.\r\n * @param {!string} str\r\n * @return {?number}\r\n */\r\nvar tryParseInt = function (str) {\r\n    if (INTEGER_REGEXP_.test(str)) {\r\n        var intVal = Number(str);\r\n        if (intVal >= -2147483648 && intVal <= 2147483647) {\r\n            return intVal;\r\n        }\r\n    }\r\n    return null;\r\n};\r\n/**\r\n * Helper to run some code but catch any exceptions and re-throw them later.\r\n * Useful for preventing user callbacks from breaking internal code.\r\n *\r\n * Re-throwing the exception from a setTimeout is a little evil, but it's very\r\n * convenient (we don't have to try to figure out when is a safe point to\r\n * re-throw it), and the behavior seems reasonable:\r\n *\r\n * * If you aren't pausing on exceptions, you get an error in the console with\r\n *   the correct stack trace.\r\n * * If you're pausing on all exceptions, the debugger will pause on your\r\n *   exception and then again when we rethrow it.\r\n * * If you're only pausing on uncaught exceptions, the debugger will only pause\r\n *   on us re-throwing it.\r\n *\r\n * @param {!function()} fn The code to guard.\r\n */\r\nvar exceptionGuard = function (fn) {\r\n    try {\r\n        fn();\r\n    }\r\n    catch (e) {\r\n        // Re-throw exception when it's safe.\r\n        setTimeout(function () {\r\n            // It used to be that \"throw e\" would result in a good console error with\r\n            // relevant context, but as of Chrome 39, you just get the firebase.js\r\n            // file/line number where we re-throw it, which is useless. So we log\r\n            // e.stack explicitly.\r\n            var stack = e.stack || '';\r\n            warn('Exception was thrown by user callback.', stack);\r\n            throw e;\r\n        }, Math.floor(0));\r\n    }\r\n};\r\n/**\r\n * @return {boolean} true if we think we're currently being crawled.\r\n */\r\nvar beingCrawled = function () {\r\n    var userAgent = (typeof window === 'object' &&\r\n        window['navigator'] &&\r\n        window['navigator']['userAgent']) ||\r\n        '';\r\n    // For now we whitelist the most popular crawlers.  We should refine this to be the set of crawlers we\r\n    // believe to support JavaScript/AJAX rendering.\r\n    // NOTE: Google Webmaster Tools doesn't really belong, but their \"This is how a visitor to your website\r\n    // would have seen the page\" is flaky if we don't treat it as a crawler.\r\n    return (userAgent.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i) >= 0);\r\n};\r\n/**\r\n * Same as setTimeout() except on Node.JS it will /not/ prevent the process from exiting.\r\n *\r\n * It is removed with clearTimeout() as normal.\r\n *\r\n * @param {Function} fn Function to run.\r\n * @param {number} time Milliseconds to wait before running.\r\n * @return {number|Object} The setTimeout() return value.\r\n */\r\nvar setTimeoutNonBlocking = function (fn, time) {\r\n    var timeout = setTimeout(fn, time);\r\n    if (typeof timeout === 'object' && timeout['unref']) {\r\n        timeout['unref']();\r\n    }\r\n    return timeout;\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * An immutable object representing a parsed path.  It's immutable so that you\r\n * can pass them around to other functions without worrying about them changing\r\n * it.\r\n */\r\nvar Path = /** @class */ (function () {\r\n    /**\r\n     * @param {string|Array.<string>} pathOrString Path string to parse,\r\n     *      or another path, or the raw tokens array\r\n     * @param {number=} pieceNum\r\n     */\r\n    function Path(pathOrString, pieceNum) {\r\n        if (pieceNum === void 0) {\r\n            this.pieces_ = pathOrString.split('/');\r\n            // Remove empty pieces.\r\n            var copyTo = 0;\r\n            for (var i = 0; i < this.pieces_.length; i++) {\r\n                if (this.pieces_[i].length > 0) {\r\n                    this.pieces_[copyTo] = this.pieces_[i];\r\n                    copyTo++;\r\n                }\r\n            }\r\n            this.pieces_.length = copyTo;\r\n            this.pieceNum_ = 0;\r\n        }\r\n        else {\r\n            this.pieces_ = pathOrString;\r\n            this.pieceNum_ = pieceNum;\r\n        }\r\n    }\r\n    Object.defineProperty(Path, \"Empty\", {\r\n        /**\r\n         * Singleton to represent an empty path\r\n         *\r\n         * @const\r\n         */\r\n        get: function () {\r\n            return new Path('');\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Path.prototype.getFront = function () {\r\n        if (this.pieceNum_ >= this.pieces_.length)\r\n            return null;\r\n        return this.pieces_[this.pieceNum_];\r\n    };\r\n    /**\r\n     * @return {number} The number of segments in this path\r\n     */\r\n    Path.prototype.getLength = function () {\r\n        return this.pieces_.length - this.pieceNum_;\r\n    };\r\n    /**\r\n     * @return {!Path}\r\n     */\r\n    Path.prototype.popFront = function () {\r\n        var pieceNum = this.pieceNum_;\r\n        if (pieceNum < this.pieces_.length) {\r\n            pieceNum++;\r\n        }\r\n        return new Path(this.pieces_, pieceNum);\r\n    };\r\n    /**\r\n     * @return {?string}\r\n     */\r\n    Path.prototype.getBack = function () {\r\n        if (this.pieceNum_ < this.pieces_.length)\r\n            return this.pieces_[this.pieces_.length - 1];\r\n        return null;\r\n    };\r\n    Path.prototype.toString = function () {\r\n        var pathString = '';\r\n        for (var i = this.pieceNum_; i < this.pieces_.length; i++) {\r\n            if (this.pieces_[i] !== '')\r\n                pathString += '/' + this.pieces_[i];\r\n        }\r\n        return pathString || '/';\r\n    };\r\n    Path.prototype.toUrlEncodedString = function () {\r\n        var pathString = '';\r\n        for (var i = this.pieceNum_; i < this.pieces_.length; i++) {\r\n            if (this.pieces_[i] !== '')\r\n                pathString += '/' + encodeURIComponent(String(this.pieces_[i]));\r\n        }\r\n        return pathString || '/';\r\n    };\r\n    /**\r\n     * Shallow copy of the parts of the path.\r\n     *\r\n     * @param {number=} begin\r\n     * @return {!Array<string>}\r\n     */\r\n    Path.prototype.slice = function (begin) {\r\n        if (begin === void 0) { begin = 0; }\r\n        return this.pieces_.slice(this.pieceNum_ + begin);\r\n    };\r\n    /**\r\n     * @return {?Path}\r\n     */\r\n    Path.prototype.parent = function () {\r\n        if (this.pieceNum_ >= this.pieces_.length)\r\n            return null;\r\n        var pieces = [];\r\n        for (var i = this.pieceNum_; i < this.pieces_.length - 1; i++)\r\n            pieces.push(this.pieces_[i]);\r\n        return new Path(pieces, 0);\r\n    };\r\n    /**\r\n     * @param {string|!Path} childPathObj\r\n     * @return {!Path}\r\n     */\r\n    Path.prototype.child = function (childPathObj) {\r\n        var pieces = [];\r\n        for (var i = this.pieceNum_; i < this.pieces_.length; i++)\r\n            pieces.push(this.pieces_[i]);\r\n        if (childPathObj instanceof Path) {\r\n            for (var i = childPathObj.pieceNum_; i < childPathObj.pieces_.length; i++) {\r\n                pieces.push(childPathObj.pieces_[i]);\r\n            }\r\n        }\r\n        else {\r\n            var childPieces = childPathObj.split('/');\r\n            for (var i = 0; i < childPieces.length; i++) {\r\n                if (childPieces[i].length > 0)\r\n                    pieces.push(childPieces[i]);\r\n            }\r\n        }\r\n        return new Path(pieces, 0);\r\n    };\r\n    /**\r\n     * @return {boolean} True if there are no segments in this path\r\n     */\r\n    Path.prototype.isEmpty = function () {\r\n        return this.pieceNum_ >= this.pieces_.length;\r\n    };\r\n    /**\r\n     * @param {!Path} outerPath\r\n     * @param {!Path} innerPath\r\n     * @return {!Path} The path from outerPath to innerPath\r\n     */\r\n    Path.relativePath = function (outerPath, innerPath) {\r\n        var outer = outerPath.getFront(), inner = innerPath.getFront();\r\n        if (outer === null) {\r\n            return innerPath;\r\n        }\r\n        else if (outer === inner) {\r\n            return Path.relativePath(outerPath.popFront(), innerPath.popFront());\r\n        }\r\n        else {\r\n            throw new Error('INTERNAL ERROR: innerPath (' +\r\n                innerPath +\r\n                ') is not within ' +\r\n                'outerPath (' +\r\n                outerPath +\r\n                ')');\r\n        }\r\n    };\r\n    /**\r\n     * @param {!Path} left\r\n     * @param {!Path} right\r\n     * @return {number} -1, 0, 1 if left is less, equal, or greater than the right.\r\n     */\r\n    Path.comparePaths = function (left, right) {\r\n        var leftKeys = left.slice();\r\n        var rightKeys = right.slice();\r\n        for (var i = 0; i < leftKeys.length && i < rightKeys.length; i++) {\r\n            var cmp = nameCompare(leftKeys[i], rightKeys[i]);\r\n            if (cmp !== 0)\r\n                return cmp;\r\n        }\r\n        if (leftKeys.length === rightKeys.length)\r\n            return 0;\r\n        return leftKeys.length < rightKeys.length ? -1 : 1;\r\n    };\r\n    /**\r\n     *\r\n     * @param {Path} other\r\n     * @return {boolean} true if paths are the same.\r\n     */\r\n    Path.prototype.equals = function (other) {\r\n        if (this.getLength() !== other.getLength()) {\r\n            return false;\r\n        }\r\n        for (var i = this.pieceNum_, j = other.pieceNum_; i <= this.pieces_.length; i++, j++) {\r\n            if (this.pieces_[i] !== other.pieces_[j]) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n    /**\r\n     *\r\n     * @param {!Path} other\r\n     * @return {boolean} True if this path is a parent (or the same as) other\r\n     */\r\n    Path.prototype.contains = function (other) {\r\n        var i = this.pieceNum_;\r\n        var j = other.pieceNum_;\r\n        if (this.getLength() > other.getLength()) {\r\n            return false;\r\n        }\r\n        while (i < this.pieces_.length) {\r\n            if (this.pieces_[i] !== other.pieces_[j]) {\r\n                return false;\r\n            }\r\n            ++i;\r\n            ++j;\r\n        }\r\n        return true;\r\n    };\r\n    return Path;\r\n}()); // end Path\r\n/**\r\n * Dynamic (mutable) path used to count path lengths.\r\n *\r\n * This class is used to efficiently check paths for valid\r\n * length (in UTF8 bytes) and depth (used in path validation).\r\n *\r\n * Throws Error exception if path is ever invalid.\r\n *\r\n * The definition of a path always begins with '/'.\r\n */\r\nvar ValidationPath = /** @class */ (function () {\r\n    /**\r\n     * @param {!Path} path Initial Path.\r\n     * @param {string} errorPrefix_ Prefix for any error messages.\r\n     */\r\n    function ValidationPath(path, errorPrefix_) {\r\n        this.errorPrefix_ = errorPrefix_;\r\n        /** @type {!Array<string>} */\r\n        this.parts_ = path.slice();\r\n        /** @type {number} Initialize to number of '/' chars needed in path. */\r\n        this.byteLength_ = Math.max(1, this.parts_.length);\r\n        for (var i = 0; i < this.parts_.length; i++) {\r\n            this.byteLength_ += stringLength(this.parts_[i]);\r\n        }\r\n        this.checkValid_();\r\n    }\r\n    Object.defineProperty(ValidationPath, \"MAX_PATH_DEPTH\", {\r\n        /** @const {number} Maximum key depth. */\r\n        get: function () {\r\n            return 32;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ValidationPath, \"MAX_PATH_LENGTH_BYTES\", {\r\n        /** @const {number} Maximum number of (UTF8) bytes in a Firebase path. */\r\n        get: function () {\r\n            return 768;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /** @param {string} child */\r\n    ValidationPath.prototype.push = function (child) {\r\n        // Count the needed '/'\r\n        if (this.parts_.length > 0) {\r\n            this.byteLength_ += 1;\r\n        }\r\n        this.parts_.push(child);\r\n        this.byteLength_ += stringLength(child);\r\n        this.checkValid_();\r\n    };\r\n    ValidationPath.prototype.pop = function () {\r\n        var last = this.parts_.pop();\r\n        this.byteLength_ -= stringLength(last);\r\n        // Un-count the previous '/'\r\n        if (this.parts_.length > 0) {\r\n            this.byteLength_ -= 1;\r\n        }\r\n    };\r\n    ValidationPath.prototype.checkValid_ = function () {\r\n        if (this.byteLength_ > ValidationPath.MAX_PATH_LENGTH_BYTES) {\r\n            throw new Error(this.errorPrefix_ +\r\n                'has a key path longer than ' +\r\n                ValidationPath.MAX_PATH_LENGTH_BYTES +\r\n                ' bytes (' +\r\n                this.byteLength_ +\r\n                ').');\r\n        }\r\n        if (this.parts_.length > ValidationPath.MAX_PATH_DEPTH) {\r\n            throw new Error(this.errorPrefix_ +\r\n                'path specified exceeds the maximum depth that can be written (' +\r\n                ValidationPath.MAX_PATH_DEPTH +\r\n                ') or object contains a cycle ' +\r\n                this.toErrorString());\r\n        }\r\n    };\r\n    /**\r\n     * String for use in error messages - uses '.' notation for path.\r\n     *\r\n     * @return {string}\r\n     */\r\n    ValidationPath.prototype.toErrorString = function () {\r\n        if (this.parts_.length == 0) {\r\n            return '';\r\n        }\r\n        return \"in property '\" + this.parts_.join('.') + \"'\";\r\n    };\r\n    return ValidationPath;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar PROTOCOL_VERSION = '5';\r\nvar VERSION_PARAM = 'v';\r\nvar TRANSPORT_SESSION_PARAM = 's';\r\nvar REFERER_PARAM = 'r';\r\nvar FORGE_REF = 'f';\r\nvar FORGE_DOMAIN = 'firebaseio.com';\r\nvar LAST_SESSION_PARAM = 'ls';\r\nvar WEBSOCKET = 'websocket';\r\nvar LONG_POLLING = 'long_polling';\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * A class that holds metadata about a Repo object\r\n *\r\n * @constructor\r\n */\r\nvar RepoInfo = /** @class */ (function () {\r\n    /**\r\n     * @param {string} host Hostname portion of the url for the repo\r\n     * @param {boolean} secure Whether or not this repo is accessed over ssl\r\n     * @param {string} namespace The namespace represented by the repo\r\n     * @param {boolean} webSocketOnly Whether to prefer websockets over all other transports (used by Nest).\r\n     * @param {string=} persistenceKey Override the default session persistence storage key\r\n     */\r\n    function RepoInfo(host, secure, namespace, webSocketOnly, persistenceKey) {\r\n        if (persistenceKey === void 0) { persistenceKey = ''; }\r\n        this.secure = secure;\r\n        this.namespace = namespace;\r\n        this.webSocketOnly = webSocketOnly;\r\n        this.persistenceKey = persistenceKey;\r\n        this.host = host.toLowerCase();\r\n        this.domain = this.host.substr(this.host.indexOf('.') + 1);\r\n        this.internalHost = PersistentStorage.get('host:' + host) || this.host;\r\n    }\r\n    RepoInfo.prototype.needsQueryParam = function () {\r\n        return this.host !== this.internalHost || this.isCustomHost();\r\n    };\r\n    RepoInfo.prototype.isCacheableHost = function () {\r\n        return this.internalHost.substr(0, 2) === 's-';\r\n    };\r\n    RepoInfo.prototype.isDemoHost = function () {\r\n        return this.domain === 'firebaseio-demo.com';\r\n    };\r\n    RepoInfo.prototype.isCustomHost = function () {\r\n        return (this.domain !== 'firebaseio.com' && this.domain !== 'firebaseio-demo.com');\r\n    };\r\n    RepoInfo.prototype.updateHost = function (newHost) {\r\n        if (newHost !== this.internalHost) {\r\n            this.internalHost = newHost;\r\n            if (this.isCacheableHost()) {\r\n                PersistentStorage.set('host:' + this.host, this.internalHost);\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Returns the websocket URL for this repo\r\n     * @param {string} type of connection\r\n     * @param {Object} params list\r\n     * @return {string} The URL for this repo\r\n     */\r\n    RepoInfo.prototype.connectionURL = function (type, params) {\r\n        assert(typeof type === 'string', 'typeof type must == string');\r\n        assert(typeof params === 'object', 'typeof params must == object');\r\n        var connURL;\r\n        if (type === WEBSOCKET) {\r\n            connURL =\r\n                (this.secure ? 'wss://' : 'ws://') + this.internalHost + '/.ws?';\r\n        }\r\n        else if (type === LONG_POLLING) {\r\n            connURL =\r\n                (this.secure ? 'https://' : 'http://') + this.internalHost + '/.lp?';\r\n        }\r\n        else {\r\n            throw new Error('Unknown connection type: ' + type);\r\n        }\r\n        if (this.needsQueryParam()) {\r\n            params['ns'] = this.namespace;\r\n        }\r\n        var pairs = [];\r\n        forEach(params, function (key, value) {\r\n            pairs.push(key + '=' + value);\r\n        });\r\n        return connURL + pairs.join('&');\r\n    };\r\n    /** @return {string} */\r\n    RepoInfo.prototype.toString = function () {\r\n        var str = this.toURLString();\r\n        if (this.persistenceKey) {\r\n            str += '<' + this.persistenceKey + '>';\r\n        }\r\n        return str;\r\n    };\r\n    /** @return {string} */\r\n    RepoInfo.prototype.toURLString = function () {\r\n        return (this.secure ? 'https://' : 'http://') + this.host;\r\n    };\r\n    return RepoInfo;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @param {!string} pathString\r\n * @return {string}\r\n */\r\nfunction decodePath(pathString) {\r\n    var pathStringDecoded = '';\r\n    var pieces = pathString.split('/');\r\n    for (var i = 0; i < pieces.length; i++) {\r\n        if (pieces[i].length > 0) {\r\n            var piece = pieces[i];\r\n            try {\r\n                piece = decodeURIComponent(piece.replace(/\\+/g, ' '));\r\n            }\r\n            catch (e) { }\r\n            pathStringDecoded += '/' + piece;\r\n        }\r\n    }\r\n    return pathStringDecoded;\r\n}\r\n/**\r\n * @param {!string} queryString\r\n * @return {!{[key:string]:string}} key value hash\r\n */\r\nfunction decodeQuery(queryString) {\r\n    var results = {};\r\n    if (queryString.charAt(0) === '?') {\r\n        queryString = queryString.substring(1);\r\n    }\r\n    for (var _i = 0, _a = queryString.split('&'); _i < _a.length; _i++) {\r\n        var segment = _a[_i];\r\n        if (segment.length === 0) {\r\n            continue;\r\n        }\r\n        var kv = segment.split('=');\r\n        if (kv.length === 2) {\r\n            results[decodeURIComponent(kv[0])] = decodeURIComponent(kv[1]);\r\n        }\r\n        else {\r\n            warn(\"Invalid query segment '\" + segment + \"' in query '\" + queryString + \"'\");\r\n        }\r\n    }\r\n    return results;\r\n}\r\n/**\r\n *\r\n * @param {!string} dataURL\r\n * @return {{repoInfo: !RepoInfo, path: !Path}}\r\n */\r\nvar parseRepoInfo = function (dataURL) {\r\n    var parsedUrl = parseURL(dataURL), namespace = parsedUrl.subdomain;\r\n    if (parsedUrl.domain === 'firebase') {\r\n        fatal(parsedUrl.host +\r\n            ' is no longer supported. ' +\r\n            'Please use <YOUR FIREBASE>.firebaseio.com instead');\r\n    }\r\n    // Catch common error of uninitialized namespace value.\r\n    if ((!namespace || namespace == 'undefined') &&\r\n        parsedUrl.domain !== 'localhost') {\r\n        fatal('Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com');\r\n    }\r\n    if (!parsedUrl.secure) {\r\n        warnIfPageIsSecure();\r\n    }\r\n    var webSocketOnly = parsedUrl.scheme === 'ws' || parsedUrl.scheme === 'wss';\r\n    return {\r\n        repoInfo: new RepoInfo(parsedUrl.host, parsedUrl.secure, namespace, webSocketOnly),\r\n        path: new Path(parsedUrl.pathString)\r\n    };\r\n};\r\n/**\r\n *\r\n * @param {!string} dataURL\r\n * @return {{host: string, port: number, domain: string, subdomain: string, secure: boolean, scheme: string, pathString: string}}\r\n */\r\nvar parseURL = function (dataURL) {\r\n    // Default to empty strings in the event of a malformed string.\r\n    var host = '', domain = '', subdomain = '', pathString = '';\r\n    // Always default to SSL, unless otherwise specified.\r\n    var secure = true, scheme = 'https', port = 443;\r\n    // Don't do any validation here. The caller is responsible for validating the result of parsing.\r\n    if (typeof dataURL === 'string') {\r\n        // Parse scheme.\r\n        var colonInd = dataURL.indexOf('//');\r\n        if (colonInd >= 0) {\r\n            scheme = dataURL.substring(0, colonInd - 1);\r\n            dataURL = dataURL.substring(colonInd + 2);\r\n        }\r\n        // Parse host, path, and query string.\r\n        var slashInd = dataURL.indexOf('/');\r\n        if (slashInd === -1) {\r\n            slashInd = dataURL.length;\r\n        }\r\n        var questionMarkInd = dataURL.indexOf('?');\r\n        if (questionMarkInd === -1) {\r\n            questionMarkInd = dataURL.length;\r\n        }\r\n        host = dataURL.substring(0, Math.min(slashInd, questionMarkInd));\r\n        if (slashInd < questionMarkInd) {\r\n            // For pathString, questionMarkInd will always come after slashInd\r\n            pathString = decodePath(dataURL.substring(slashInd, questionMarkInd));\r\n        }\r\n        var queryParams = decodeQuery(dataURL.substring(Math.min(dataURL.length, questionMarkInd)));\r\n        // If we have a port, use scheme for determining if it's secure.\r\n        colonInd = host.indexOf(':');\r\n        if (colonInd >= 0) {\r\n            secure = scheme === 'https' || scheme === 'wss';\r\n            port = parseInt(host.substring(colonInd + 1), 10);\r\n        }\r\n        else {\r\n            colonInd = dataURL.length;\r\n        }\r\n        var parts = host.split('.');\r\n        if (parts.length === 3) {\r\n            // Normalize namespaces to lowercase to share storage / connection.\r\n            domain = parts[1];\r\n            subdomain = parts[0].toLowerCase();\r\n        }\r\n        else if (parts.length === 2) {\r\n            domain = parts[0];\r\n        }\r\n        else if (parts[0].slice(0, colonInd).toLowerCase() === 'localhost') {\r\n            domain = 'localhost';\r\n        }\r\n        // Support `ns` query param if subdomain not already set\r\n        if (subdomain === '' && 'ns' in queryParams) {\r\n            subdomain = queryParams['ns'];\r\n        }\r\n    }\r\n    return {\r\n        host: host,\r\n        port: port,\r\n        domain: domain,\r\n        subdomain: subdomain,\r\n        secure: secure,\r\n        scheme: scheme,\r\n        pathString: pathString\r\n    };\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * True for invalid Firebase keys\r\n * @type {RegExp}\r\n * @private\r\n */\r\nvar INVALID_KEY_REGEX_ = /[\\[\\].#$\\/\\u0000-\\u001F\\u007F]/;\r\n/**\r\n * True for invalid Firebase paths.\r\n * Allows '/' in paths.\r\n * @type {RegExp}\r\n * @private\r\n */\r\nvar INVALID_PATH_REGEX_ = /[\\[\\].#$\\u0000-\\u001F\\u007F]/;\r\n/**\r\n * Maximum number of characters to allow in leaf value\r\n * @type {number}\r\n * @private\r\n */\r\nvar MAX_LEAF_SIZE_ = 10 * 1024 * 1024;\r\n/**\r\n * @param {*} key\r\n * @return {boolean}\r\n */\r\nvar isValidKey = function (key) {\r\n    return (typeof key === 'string' && key.length !== 0 && !INVALID_KEY_REGEX_.test(key));\r\n};\r\n/**\r\n * @param {string} pathString\r\n * @return {boolean}\r\n */\r\nvar isValidPathString = function (pathString) {\r\n    return (typeof pathString === 'string' &&\r\n        pathString.length !== 0 &&\r\n        !INVALID_PATH_REGEX_.test(pathString));\r\n};\r\n/**\r\n * @param {string} pathString\r\n * @return {boolean}\r\n */\r\nvar isValidRootPathString = function (pathString) {\r\n    if (pathString) {\r\n        // Allow '/.info/' at the beginning.\r\n        pathString = pathString.replace(/^\\/*\\.info(\\/|$)/, '/');\r\n    }\r\n    return isValidPathString(pathString);\r\n};\r\n/**\r\n * @param {*} priority\r\n * @return {boolean}\r\n */\r\nvar isValidPriority = function (priority) {\r\n    return (priority === null ||\r\n        typeof priority === 'string' ||\r\n        (typeof priority === 'number' && !isInvalidJSONNumber(priority)) ||\r\n        (priority && typeof priority === 'object' && contains(priority, '.sv')));\r\n};\r\n/**\r\n * Pre-validate a datum passed as an argument to Firebase function.\r\n *\r\n * @param {string} fnName\r\n * @param {number} argumentNumber\r\n * @param {*} data\r\n * @param {!Path} path\r\n * @param {boolean} optional\r\n */\r\nvar validateFirebaseDataArg = function (fnName, argumentNumber, data, path, optional) {\r\n    if (optional && data === undefined)\r\n        return;\r\n    validateFirebaseData(errorPrefix(fnName, argumentNumber, optional), data, path);\r\n};\r\n/**\r\n * Validate a data object client-side before sending to server.\r\n *\r\n * @param {string} errorPrefix\r\n * @param {*} data\r\n * @param {!Path|!ValidationPath} path_\r\n */\r\nvar validateFirebaseData = function (errorPrefix$$1, data, path_) {\r\n    var path = path_ instanceof Path ? new ValidationPath(path_, errorPrefix$$1) : path_;\r\n    if (data === undefined) {\r\n        throw new Error(errorPrefix$$1 + 'contains undefined ' + path.toErrorString());\r\n    }\r\n    if (typeof data === 'function') {\r\n        throw new Error(errorPrefix$$1 +\r\n            'contains a function ' +\r\n            path.toErrorString() +\r\n            ' with contents = ' +\r\n            data.toString());\r\n    }\r\n    if (isInvalidJSONNumber(data)) {\r\n        throw new Error(errorPrefix$$1 + 'contains ' + data.toString() + ' ' + path.toErrorString());\r\n    }\r\n    // Check max leaf size, but try to avoid the utf8 conversion if we can.\r\n    if (typeof data === 'string' &&\r\n        data.length > MAX_LEAF_SIZE_ / 3 &&\r\n        stringLength(data) > MAX_LEAF_SIZE_) {\r\n        throw new Error(errorPrefix$$1 +\r\n            'contains a string greater than ' +\r\n            MAX_LEAF_SIZE_ +\r\n            ' utf8 bytes ' +\r\n            path.toErrorString() +\r\n            \" ('\" +\r\n            data.substring(0, 50) +\r\n            \"...')\");\r\n    }\r\n    // TODO = Perf = Consider combining the recursive validation of keys into NodeFromJSON\r\n    // to save extra walking of large objects.\r\n    if (data && typeof data === 'object') {\r\n        var hasDotValue_1 = false, hasActualChild_1 = false;\r\n        forEach(data, function (key, value) {\r\n            if (key === '.value') {\r\n                hasDotValue_1 = true;\r\n            }\r\n            else if (key !== '.priority' && key !== '.sv') {\r\n                hasActualChild_1 = true;\r\n                if (!isValidKey(key)) {\r\n                    throw new Error(errorPrefix$$1 +\r\n                        ' contains an invalid key (' +\r\n                        key +\r\n                        ') ' +\r\n                        path.toErrorString() +\r\n                        '.  Keys must be non-empty strings ' +\r\n                        'and can\\'t contain \".\", \"#\", \"$\", \"/\", \"[\", or \"]\"');\r\n                }\r\n            }\r\n            path.push(key);\r\n            validateFirebaseData(errorPrefix$$1, value, path);\r\n            path.pop();\r\n        });\r\n        if (hasDotValue_1 && hasActualChild_1) {\r\n            throw new Error(errorPrefix$$1 +\r\n                ' contains \".value\" child ' +\r\n                path.toErrorString() +\r\n                ' in addition to actual children.');\r\n        }\r\n    }\r\n};\r\n/**\r\n * Pre-validate paths passed in the firebase function.\r\n *\r\n * @param {string} errorPrefix\r\n * @param {Array<!Path>} mergePaths\r\n */\r\nvar validateFirebaseMergePaths = function (errorPrefix$$1, mergePaths) {\r\n    var i, curPath;\r\n    for (i = 0; i < mergePaths.length; i++) {\r\n        curPath = mergePaths[i];\r\n        var keys = curPath.slice();\r\n        for (var j = 0; j < keys.length; j++) {\r\n            if (keys[j] === '.priority' && j === keys.length - 1) {\r\n                // .priority is OK\r\n            }\r\n            else if (!isValidKey(keys[j])) {\r\n                throw new Error(errorPrefix$$1 +\r\n                    'contains an invalid key (' +\r\n                    keys[j] +\r\n                    ') in path ' +\r\n                    curPath.toString() +\r\n                    '. Keys must be non-empty strings ' +\r\n                    'and can\\'t contain \".\", \"#\", \"$\", \"/\", \"[\", or \"]\"');\r\n            }\r\n        }\r\n    }\r\n    // Check that update keys are not descendants of each other.\r\n    // We rely on the property that sorting guarantees that ancestors come\r\n    // right before descendants.\r\n    mergePaths.sort(Path.comparePaths);\r\n    var prevPath = null;\r\n    for (i = 0; i < mergePaths.length; i++) {\r\n        curPath = mergePaths[i];\r\n        if (prevPath !== null && prevPath.contains(curPath)) {\r\n            throw new Error(errorPrefix$$1 +\r\n                'contains a path ' +\r\n                prevPath.toString() +\r\n                ' that is ancestor of another path ' +\r\n                curPath.toString());\r\n        }\r\n        prevPath = curPath;\r\n    }\r\n};\r\n/**\r\n * pre-validate an object passed as an argument to firebase function (\r\n * must be an object - e.g. for firebase.update()).\r\n *\r\n * @param {string} fnName\r\n * @param {number} argumentNumber\r\n * @param {*} data\r\n * @param {!Path} path\r\n * @param {boolean} optional\r\n */\r\nvar validateFirebaseMergeDataArg = function (fnName, argumentNumber, data, path, optional) {\r\n    if (optional && data === undefined)\r\n        return;\r\n    var errorPrefix$$1 = errorPrefix(fnName, argumentNumber, optional);\r\n    if (!(data && typeof data === 'object') || Array.isArray(data)) {\r\n        throw new Error(errorPrefix$$1 + ' must be an object containing the children to replace.');\r\n    }\r\n    var mergePaths = [];\r\n    forEach(data, function (key, value) {\r\n        var curPath = new Path(key);\r\n        validateFirebaseData(errorPrefix$$1, value, path.child(curPath));\r\n        if (curPath.getBack() === '.priority') {\r\n            if (!isValidPriority(value)) {\r\n                throw new Error(errorPrefix$$1 +\r\n                    \"contains an invalid value for '\" +\r\n                    curPath.toString() +\r\n                    \"', which must be a valid \" +\r\n                    'Firebase priority (a string, finite number, server value, or null).');\r\n            }\r\n        }\r\n        mergePaths.push(curPath);\r\n    });\r\n    validateFirebaseMergePaths(errorPrefix$$1, mergePaths);\r\n};\r\nvar validatePriority = function (fnName, argumentNumber, priority, optional) {\r\n    if (optional && priority === undefined)\r\n        return;\r\n    if (isInvalidJSONNumber(priority))\r\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) +\r\n            'is ' +\r\n            priority.toString() +\r\n            ', but must be a valid Firebase priority (a string, finite number, ' +\r\n            'server value, or null).');\r\n    // Special case to allow importing data with a .sv.\r\n    if (!isValidPriority(priority))\r\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) +\r\n            'must be a valid Firebase priority ' +\r\n            '(a string, finite number, server value, or null).');\r\n};\r\nvar validateEventType = function (fnName, argumentNumber, eventType, optional) {\r\n    if (optional && eventType === undefined)\r\n        return;\r\n    switch (eventType) {\r\n        case 'value':\r\n        case 'child_added':\r\n        case 'child_removed':\r\n        case 'child_changed':\r\n        case 'child_moved':\r\n            break;\r\n        default:\r\n            throw new Error(errorPrefix(fnName, argumentNumber, optional) +\r\n                'must be a valid event type = \"value\", \"child_added\", \"child_removed\", ' +\r\n                '\"child_changed\", or \"child_moved\".');\r\n    }\r\n};\r\nvar validateKey = function (fnName, argumentNumber, key, optional) {\r\n    if (optional && key === undefined)\r\n        return;\r\n    if (!isValidKey(key))\r\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) +\r\n            'was an invalid key = \"' +\r\n            key +\r\n            '\".  Firebase keys must be non-empty strings and ' +\r\n            'can\\'t contain \".\", \"#\", \"$\", \"/\", \"[\", or \"]\").');\r\n};\r\nvar validatePathString = function (fnName, argumentNumber, pathString, optional) {\r\n    if (optional && pathString === undefined)\r\n        return;\r\n    if (!isValidPathString(pathString))\r\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) +\r\n            'was an invalid path = \"' +\r\n            pathString +\r\n            '\". Paths must be non-empty strings and ' +\r\n            'can\\'t contain \".\", \"#\", \"$\", \"[\", or \"]\"');\r\n};\r\nvar validateRootPathString = function (fnName, argumentNumber, pathString, optional) {\r\n    if (pathString) {\r\n        // Allow '/.info/' at the beginning.\r\n        pathString = pathString.replace(/^\\/*\\.info(\\/|$)/, '/');\r\n    }\r\n    validatePathString(fnName, argumentNumber, pathString, optional);\r\n};\r\nvar validateWritablePath = function (fnName, path) {\r\n    if (path.getFront() === '.info') {\r\n        throw new Error(fnName + \" failed = Can't modify data under /.info/\");\r\n    }\r\n};\r\nvar validateUrl = function (fnName, argumentNumber, parsedUrl) {\r\n    // TODO = Validate server better.\r\n    var pathString = parsedUrl.path.toString();\r\n    if (!(typeof parsedUrl.repoInfo.host === 'string') ||\r\n        parsedUrl.repoInfo.host.length === 0 ||\r\n        (!isValidKey(parsedUrl.repoInfo.namespace) &&\r\n            parsedUrl.repoInfo.host.split(':')[0] !== 'localhost') ||\r\n        (pathString.length !== 0 && !isValidRootPathString(pathString))) {\r\n        throw new Error(errorPrefix(fnName, argumentNumber, false) +\r\n            'must be a valid firebase URL and ' +\r\n            'the path can\\'t contain \".\", \"#\", \"$\", \"[\", or \"]\".');\r\n    }\r\n};\r\nvar validateBoolean = function (fnName, argumentNumber, bool, optional) {\r\n    if (optional && bool === undefined)\r\n        return;\r\n    if (typeof bool !== 'boolean')\r\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) + 'must be a boolean.');\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @constructor\r\n */\r\nvar OnDisconnect = /** @class */ (function () {\r\n    /**\r\n     * @param {!Repo} repo_\r\n     * @param {!Path} path_\r\n     */\r\n    function OnDisconnect(repo_, path_) {\r\n        this.repo_ = repo_;\r\n        this.path_ = path_;\r\n    }\r\n    /**\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!firebase.Promise}\r\n     */\r\n    OnDisconnect.prototype.cancel = function (onComplete) {\r\n        validateArgCount('OnDisconnect.cancel', 0, 1, arguments.length);\r\n        validateCallback('OnDisconnect.cancel', 1, onComplete, true);\r\n        var deferred = new Deferred();\r\n        this.repo_.onDisconnectCancel(this.path_, deferred.wrapCallback(onComplete));\r\n        return deferred.promise;\r\n    };\r\n    /**\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!firebase.Promise}\r\n     */\r\n    OnDisconnect.prototype.remove = function (onComplete) {\r\n        validateArgCount('OnDisconnect.remove', 0, 1, arguments.length);\r\n        validateWritablePath('OnDisconnect.remove', this.path_);\r\n        validateCallback('OnDisconnect.remove', 1, onComplete, true);\r\n        var deferred = new Deferred();\r\n        this.repo_.onDisconnectSet(this.path_, null, deferred.wrapCallback(onComplete));\r\n        return deferred.promise;\r\n    };\r\n    /**\r\n     * @param {*} value\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!firebase.Promise}\r\n     */\r\n    OnDisconnect.prototype.set = function (value, onComplete) {\r\n        validateArgCount('OnDisconnect.set', 1, 2, arguments.length);\r\n        validateWritablePath('OnDisconnect.set', this.path_);\r\n        validateFirebaseDataArg('OnDisconnect.set', 1, value, this.path_, false);\r\n        validateCallback('OnDisconnect.set', 2, onComplete, true);\r\n        var deferred = new Deferred();\r\n        this.repo_.onDisconnectSet(this.path_, value, deferred.wrapCallback(onComplete));\r\n        return deferred.promise;\r\n    };\r\n    /**\r\n     * @param {*} value\r\n     * @param {number|string|null} priority\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!firebase.Promise}\r\n     */\r\n    OnDisconnect.prototype.setWithPriority = function (value, priority, onComplete) {\r\n        validateArgCount('OnDisconnect.setWithPriority', 2, 3, arguments.length);\r\n        validateWritablePath('OnDisconnect.setWithPriority', this.path_);\r\n        validateFirebaseDataArg('OnDisconnect.setWithPriority', 1, value, this.path_, false);\r\n        validatePriority('OnDisconnect.setWithPriority', 2, priority, false);\r\n        validateCallback('OnDisconnect.setWithPriority', 3, onComplete, true);\r\n        var deferred = new Deferred();\r\n        this.repo_.onDisconnectSetWithPriority(this.path_, value, priority, deferred.wrapCallback(onComplete));\r\n        return deferred.promise;\r\n    };\r\n    /**\r\n     * @param {!Object} objectToMerge\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!firebase.Promise}\r\n     */\r\n    OnDisconnect.prototype.update = function (objectToMerge, onComplete) {\r\n        validateArgCount('OnDisconnect.update', 1, 2, arguments.length);\r\n        validateWritablePath('OnDisconnect.update', this.path_);\r\n        if (Array.isArray(objectToMerge)) {\r\n            var newObjectToMerge = {};\r\n            for (var i = 0; i < objectToMerge.length; ++i) {\r\n                newObjectToMerge['' + i] = objectToMerge[i];\r\n            }\r\n            objectToMerge = newObjectToMerge;\r\n            warn('Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the ' +\r\n                'existing data, or an Object with integer keys if you really do want to only update some of the children.');\r\n        }\r\n        validateFirebaseMergeDataArg('OnDisconnect.update', 1, objectToMerge, this.path_, false);\r\n        validateCallback('OnDisconnect.update', 2, onComplete, true);\r\n        var deferred = new Deferred();\r\n        this.repo_.onDisconnectUpdate(this.path_, objectToMerge, deferred.wrapCallback(onComplete));\r\n        return deferred.promise;\r\n    };\r\n    return OnDisconnect;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar TransactionResult = /** @class */ (function () {\r\n    /**\r\n     * A type for the resolve value of Firebase.transaction.\r\n     * @constructor\r\n     * @dict\r\n     * @param {boolean} committed\r\n     * @param {DataSnapshot} snapshot\r\n     */\r\n    function TransactionResult(committed, snapshot) {\r\n        this.committed = committed;\r\n        this.snapshot = snapshot;\r\n    }\r\n    // Do not create public documentation. This is intended to make JSON serialization work but is otherwise unnecessary\r\n    // for end-users\r\n    TransactionResult.prototype.toJSON = function () {\r\n        validateArgCount('TransactionResult.toJSON', 0, 1, arguments.length);\r\n        return { committed: this.committed, snapshot: this.snapshot.toJSON() };\r\n    };\r\n    return TransactionResult;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Fancy ID generator that creates 20-character string identifiers with the\r\n * following properties:\r\n *\r\n * 1. They're based on timestamp so that they sort *after* any existing ids.\r\n * 2. They contain 72-bits of random data after the timestamp so that IDs won't\r\n *    collide with other clients' IDs.\r\n * 3. They sort *lexicographically* (so the timestamp is converted to characters\r\n *    that will sort properly).\r\n * 4. They're monotonically increasing. Even if you generate more than one in\r\n *    the same timestamp, the latter ones will sort after the former ones. We do\r\n *    this by using the previous random bits but \"incrementing\" them by 1 (only\r\n *    in the case of a timestamp collision).\r\n */\r\nvar nextPushId = (function () {\r\n    // Modeled after base64 web-safe chars, but ordered by ASCII.\r\n    var PUSH_CHARS = '-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz';\r\n    // Timestamp of last push, used to prevent local collisions if you push twice\r\n    // in one ms.\r\n    var lastPushTime = 0;\r\n    // We generate 72-bits of randomness which get turned into 12 characters and\r\n    // appended to the timestamp to prevent collisions with other clients. We\r\n    // store the last characters we generated because in the event of a collision,\r\n    // we'll use those same characters except \"incremented\" by one.\r\n    var lastRandChars = [];\r\n    return function (now) {\r\n        var duplicateTime = now === lastPushTime;\r\n        lastPushTime = now;\r\n        var i;\r\n        var timeStampChars = new Array(8);\r\n        for (i = 7; i >= 0; i--) {\r\n            timeStampChars[i] = PUSH_CHARS.charAt(now % 64);\r\n            // NOTE: Can't use << here because javascript will convert to int and lose\r\n            // the upper bits.\r\n            now = Math.floor(now / 64);\r\n        }\r\n        assert(now === 0, 'Cannot push at time == 0');\r\n        var id = timeStampChars.join('');\r\n        if (!duplicateTime) {\r\n            for (i = 0; i < 12; i++) {\r\n                lastRandChars[i] = Math.floor(Math.random() * 64);\r\n            }\r\n        }\r\n        else {\r\n            // If the timestamp hasn't changed since last push, use the same random\r\n            // number, except incremented by 1.\r\n            for (i = 11; i >= 0 && lastRandChars[i] === 63; i--) {\r\n                lastRandChars[i] = 0;\r\n            }\r\n            lastRandChars[i]++;\r\n        }\r\n        for (i = 0; i < 12; i++) {\r\n            id += PUSH_CHARS.charAt(lastRandChars[i]);\r\n        }\r\n        assert(id.length === 20, 'nextPushId: Length should be 20.');\r\n        return id;\r\n    };\r\n})();\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n *\r\n * @param {!string} name\r\n * @param {!Node} node\r\n * @constructor\r\n * @struct\r\n */\r\nvar NamedNode = /** @class */ (function () {\r\n    function NamedNode(name, node) {\r\n        this.name = name;\r\n        this.node = node;\r\n    }\r\n    /**\r\n     *\r\n     * @param {!string} name\r\n     * @param {!Node} node\r\n     * @return {NamedNode}\r\n     */\r\n    NamedNode.Wrap = function (name, node) {\r\n        return new NamedNode(name, node);\r\n    };\r\n    return NamedNode;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n *\r\n * @constructor\r\n */\r\nvar Index = /** @class */ (function () {\r\n    function Index() {\r\n    }\r\n    /**\r\n     * @return {function(!NamedNode, !NamedNode):number} A standalone comparison function for\r\n     * this index\r\n     */\r\n    Index.prototype.getCompare = function () {\r\n        return this.compare.bind(this);\r\n    };\r\n    /**\r\n     * Given a before and after value for a node, determine if the indexed value has changed. Even if they are different,\r\n     * it's possible that the changes are isolated to parts of the snapshot that are not indexed.\r\n     *\r\n     * @param {!Node} oldNode\r\n     * @param {!Node} newNode\r\n     * @return {boolean} True if the portion of the snapshot being indexed changed between oldNode and newNode\r\n     */\r\n    Index.prototype.indexedValueChanged = function (oldNode, newNode) {\r\n        var oldWrapped = new NamedNode(MIN_NAME, oldNode);\r\n        var newWrapped = new NamedNode(MIN_NAME, newNode);\r\n        return this.compare(oldWrapped, newWrapped) !== 0;\r\n    };\r\n    /**\r\n     * @return {!NamedNode} a node wrapper that will sort equal to or less than\r\n     * any other node wrapper, using this index\r\n     */\r\n    Index.prototype.minPost = function () {\r\n        return NamedNode.MIN;\r\n    };\r\n    return Index;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar __EMPTY_NODE;\r\nvar KeyIndex = /** @class */ (function (_super) {\r\n    __extends(KeyIndex, _super);\r\n    function KeyIndex() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    Object.defineProperty(KeyIndex, \"__EMPTY_NODE\", {\r\n        get: function () {\r\n            return __EMPTY_NODE;\r\n        },\r\n        set: function (val) {\r\n            __EMPTY_NODE = val;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    KeyIndex.prototype.compare = function (a, b) {\r\n        return nameCompare(a.name, b.name);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    KeyIndex.prototype.isDefinedOn = function (node) {\r\n        // We could probably return true here (since every node has a key), but it's never called\r\n        // so just leaving unimplemented for now.\r\n        throw assertionError('KeyIndex.isDefinedOn not expected to be called.');\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    KeyIndex.prototype.indexedValueChanged = function (oldNode, newNode) {\r\n        return false; // The key for a node never changes.\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    KeyIndex.prototype.minPost = function () {\r\n        return NamedNode.MIN;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    KeyIndex.prototype.maxPost = function () {\r\n        // TODO: This should really be created once and cached in a static property, but\r\n        // NamedNode isn't defined yet, so I can't use it in a static.  Bleh.\r\n        return new NamedNode(MAX_NAME, __EMPTY_NODE);\r\n    };\r\n    /**\r\n     * @param {*} indexValue\r\n     * @param {string} name\r\n     * @return {!NamedNode}\r\n     */\r\n    KeyIndex.prototype.makePost = function (indexValue, name) {\r\n        assert(typeof indexValue === 'string', 'KeyIndex indexValue must always be a string.');\r\n        // We just use empty node, but it'll never be compared, since our comparator only looks at name.\r\n        return new NamedNode(indexValue, __EMPTY_NODE);\r\n    };\r\n    /**\r\n     * @return {!string} String representation for inclusion in a query spec\r\n     */\r\n    KeyIndex.prototype.toString = function () {\r\n        return '.key';\r\n    };\r\n    return KeyIndex;\r\n}(Index));\r\nvar KEY_INDEX = new KeyIndex();\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar MAX_NODE;\r\nfunction setMaxNode(val) {\r\n    MAX_NODE = val;\r\n}\r\n/**\r\n * @param {(!string|!number)} priority\r\n * @return {!string}\r\n */\r\nvar priorityHashText = function (priority) {\r\n    if (typeof priority === 'number')\r\n        return 'number:' + doubleToIEEE754String(priority);\r\n    else\r\n        return 'string:' + priority;\r\n};\r\n/**\r\n * Validates that a priority snapshot Node is valid.\r\n *\r\n * @param {!Node} priorityNode\r\n */\r\nvar validatePriorityNode = function (priorityNode) {\r\n    if (priorityNode.isLeafNode()) {\r\n        var val = priorityNode.val();\r\n        assert(typeof val === 'string' ||\r\n            typeof val === 'number' ||\r\n            (typeof val === 'object' && contains(val, '.sv')), 'Priority must be a string or number.');\r\n    }\r\n    else {\r\n        assert(priorityNode === MAX_NODE || priorityNode.isEmpty(), 'priority of unexpected type.');\r\n    }\r\n    // Don't call getPriority() on MAX_NODE to avoid hitting assertion.\r\n    assert(priorityNode === MAX_NODE || priorityNode.getPriority().isEmpty(), \"Priority nodes can't have a priority of their own.\");\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar __childrenNodeConstructor;\r\n/**\r\n * LeafNode is a class for storing leaf nodes in a DataSnapshot.  It\r\n * implements Node and stores the value of the node (a string,\r\n * number, or boolean) accessible via getValue().\r\n */\r\nvar LeafNode = /** @class */ (function () {\r\n    /**\r\n     * @implements {Node}\r\n     * @param {!(string|number|boolean|Object)} value_ The value to store in this leaf node.\r\n     *                                         The object type is possible in the event of a deferred value\r\n     * @param {!Node=} priorityNode_ The priority of this node.\r\n     */\r\n    function LeafNode(value_, priorityNode_) {\r\n        if (priorityNode_ === void 0) { priorityNode_ = LeafNode.__childrenNodeConstructor.EMPTY_NODE; }\r\n        this.value_ = value_;\r\n        this.priorityNode_ = priorityNode_;\r\n        this.lazyHash_ = null;\r\n        assert(this.value_ !== undefined && this.value_ !== null, \"LeafNode shouldn't be created with null/undefined value.\");\r\n        validatePriorityNode(this.priorityNode_);\r\n    }\r\n    Object.defineProperty(LeafNode, \"__childrenNodeConstructor\", {\r\n        get: function () {\r\n            return __childrenNodeConstructor;\r\n        },\r\n        set: function (val) {\r\n            __childrenNodeConstructor = val;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.isLeafNode = function () {\r\n        return true;\r\n    };\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.getPriority = function () {\r\n        return this.priorityNode_;\r\n    };\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.updatePriority = function (newPriorityNode) {\r\n        return new LeafNode(this.value_, newPriorityNode);\r\n    };\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.getImmediateChild = function (childName) {\r\n        // Hack to treat priority as a regular child\r\n        if (childName === '.priority') {\r\n            return this.priorityNode_;\r\n        }\r\n        else {\r\n            return LeafNode.__childrenNodeConstructor.EMPTY_NODE;\r\n        }\r\n    };\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.getChild = function (path) {\r\n        if (path.isEmpty()) {\r\n            return this;\r\n        }\r\n        else if (path.getFront() === '.priority') {\r\n            return this.priorityNode_;\r\n        }\r\n        else {\r\n            return LeafNode.__childrenNodeConstructor.EMPTY_NODE;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LeafNode.prototype.hasChild = function () {\r\n        return false;\r\n    };\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.getPredecessorChildName = function (childName, childNode) {\r\n        return null;\r\n    };\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.updateImmediateChild = function (childName, newChildNode) {\r\n        if (childName === '.priority') {\r\n            return this.updatePriority(newChildNode);\r\n        }\r\n        else if (newChildNode.isEmpty() && childName !== '.priority') {\r\n            return this;\r\n        }\r\n        else {\r\n            return LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(childName, newChildNode).updatePriority(this.priorityNode_);\r\n        }\r\n    };\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.updateChild = function (path, newChildNode) {\r\n        var front = path.getFront();\r\n        if (front === null) {\r\n            return newChildNode;\r\n        }\r\n        else if (newChildNode.isEmpty() && front !== '.priority') {\r\n            return this;\r\n        }\r\n        else {\r\n            assert(front !== '.priority' || path.getLength() === 1, '.priority must be the last token in a path');\r\n            return this.updateImmediateChild(front, LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateChild(path.popFront(), newChildNode));\r\n        }\r\n    };\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.isEmpty = function () {\r\n        return false;\r\n    };\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.numChildren = function () {\r\n        return 0;\r\n    };\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.forEachChild = function (index, action) {\r\n        return false;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LeafNode.prototype.val = function (exportFormat) {\r\n        if (exportFormat && !this.getPriority().isEmpty())\r\n            return {\r\n                '.value': this.getValue(),\r\n                '.priority': this.getPriority().val()\r\n            };\r\n        else\r\n            return this.getValue();\r\n    };\r\n    /** @inheritDoc */\r\n    LeafNode.prototype.hash = function () {\r\n        if (this.lazyHash_ === null) {\r\n            var toHash = '';\r\n            if (!this.priorityNode_.isEmpty())\r\n                toHash +=\r\n                    'priority:' +\r\n                        priorityHashText(this.priorityNode_.val()) +\r\n                        ':';\r\n            var type = typeof this.value_;\r\n            toHash += type + ':';\r\n            if (type === 'number') {\r\n                toHash += doubleToIEEE754String(this.value_);\r\n            }\r\n            else {\r\n                toHash += this.value_;\r\n            }\r\n            this.lazyHash_ = sha1(toHash);\r\n        }\r\n        return this.lazyHash_;\r\n    };\r\n    /**\r\n     * Returns the value of the leaf node.\r\n     * @return {Object|string|number|boolean} The value of the node.\r\n     */\r\n    LeafNode.prototype.getValue = function () {\r\n        return this.value_;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LeafNode.prototype.compareTo = function (other) {\r\n        if (other === LeafNode.__childrenNodeConstructor.EMPTY_NODE) {\r\n            return 1;\r\n        }\r\n        else if (other instanceof LeafNode.__childrenNodeConstructor) {\r\n            return -1;\r\n        }\r\n        else {\r\n            assert(other.isLeafNode(), 'Unknown node type');\r\n            return this.compareToLeafNode_(other);\r\n        }\r\n    };\r\n    /**\r\n     * Comparison specifically for two leaf nodes\r\n     * @param {!LeafNode} otherLeaf\r\n     * @return {!number}\r\n     * @private\r\n     */\r\n    LeafNode.prototype.compareToLeafNode_ = function (otherLeaf) {\r\n        var otherLeafType = typeof otherLeaf.value_;\r\n        var thisLeafType = typeof this.value_;\r\n        var otherIndex = LeafNode.VALUE_TYPE_ORDER.indexOf(otherLeafType);\r\n        var thisIndex = LeafNode.VALUE_TYPE_ORDER.indexOf(thisLeafType);\r\n        assert(otherIndex >= 0, 'Unknown leaf type: ' + otherLeafType);\r\n        assert(thisIndex >= 0, 'Unknown leaf type: ' + thisLeafType);\r\n        if (otherIndex === thisIndex) {\r\n            // Same type, compare values\r\n            if (thisLeafType === 'object') {\r\n                // Deferred value nodes are all equal, but we should also never get to this point...\r\n                return 0;\r\n            }\r\n            else {\r\n                // Note that this works because true > false, all others are number or string comparisons\r\n                if (this.value_ < otherLeaf.value_) {\r\n                    return -1;\r\n                }\r\n                else if (this.value_ === otherLeaf.value_) {\r\n                    return 0;\r\n                }\r\n                else {\r\n                    return 1;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            return thisIndex - otherIndex;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LeafNode.prototype.withIndex = function () {\r\n        return this;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LeafNode.prototype.isIndexed = function () {\r\n        return true;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LeafNode.prototype.equals = function (other) {\r\n        /**\r\n         * @inheritDoc\r\n         */\r\n        if (other === this) {\r\n            return true;\r\n        }\r\n        else if (other.isLeafNode()) {\r\n            var otherLeaf = other;\r\n            return (this.value_ === otherLeaf.value_ &&\r\n                this.priorityNode_.equals(otherLeaf.priorityNode_));\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    };\r\n    /**\r\n     * The sort order for comparing leaf nodes of different types. If two leaf nodes have\r\n     * the same type, the comparison falls back to their value\r\n     * @type {Array.<!string>}\r\n     * @const\r\n     */\r\n    LeafNode.VALUE_TYPE_ORDER = ['object', 'boolean', 'number', 'string'];\r\n    return LeafNode;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar nodeFromJSON;\r\nvar MAX_NODE$1;\r\nfunction setNodeFromJSON(val) {\r\n    nodeFromJSON = val;\r\n}\r\nfunction setMaxNode$1(val) {\r\n    MAX_NODE$1 = val;\r\n}\r\n/**\r\n * @constructor\r\n * @extends {Index}\r\n * @private\r\n */\r\nvar PriorityIndex = /** @class */ (function (_super) {\r\n    __extends(PriorityIndex, _super);\r\n    function PriorityIndex() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PriorityIndex.prototype.compare = function (a, b) {\r\n        var aPriority = a.node.getPriority();\r\n        var bPriority = b.node.getPriority();\r\n        var indexCmp = aPriority.compareTo(bPriority);\r\n        if (indexCmp === 0) {\r\n            return nameCompare(a.name, b.name);\r\n        }\r\n        else {\r\n            return indexCmp;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PriorityIndex.prototype.isDefinedOn = function (node) {\r\n        return !node.getPriority().isEmpty();\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PriorityIndex.prototype.indexedValueChanged = function (oldNode, newNode) {\r\n        return !oldNode.getPriority().equals(newNode.getPriority());\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PriorityIndex.prototype.minPost = function () {\r\n        return NamedNode.MIN;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PriorityIndex.prototype.maxPost = function () {\r\n        return new NamedNode(MAX_NAME, new LeafNode('[PRIORITY-POST]', MAX_NODE$1));\r\n    };\r\n    /**\r\n     * @param {*} indexValue\r\n     * @param {string} name\r\n     * @return {!NamedNode}\r\n     */\r\n    PriorityIndex.prototype.makePost = function (indexValue, name) {\r\n        var priorityNode = nodeFromJSON(indexValue);\r\n        return new NamedNode(name, new LeafNode('[PRIORITY-POST]', priorityNode));\r\n    };\r\n    /**\r\n     * @return {!string} String representation for inclusion in a query spec\r\n     */\r\n    PriorityIndex.prototype.toString = function () {\r\n        return '.priority';\r\n    };\r\n    return PriorityIndex;\r\n}(Index));\r\nvar PRIORITY_INDEX = new PriorityIndex();\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * An iterator over an LLRBNode.\r\n */\r\nvar SortedMapIterator = /** @class */ (function () {\r\n    /**\r\n     * @template K, V, T\r\n     * @param {LLRBNode|LLRBEmptyNode} node Node to iterate.\r\n     * @param {?K} startKey\r\n     * @param {function(K, K): number} comparator\r\n     * @param {boolean} isReverse_ Whether or not to iterate in reverse\r\n     * @param {(function(K, V):T)=} resultGenerator_\r\n     */\r\n    function SortedMapIterator(node, startKey, comparator, isReverse_, resultGenerator_) {\r\n        if (resultGenerator_ === void 0) { resultGenerator_ = null; }\r\n        this.isReverse_ = isReverse_;\r\n        this.resultGenerator_ = resultGenerator_;\r\n        /** @private\r\n         * @type {Array.<!LLRBNode>}\r\n         */\r\n        this.nodeStack_ = [];\r\n        var cmp = 1;\r\n        while (!node.isEmpty()) {\r\n            node = node;\r\n            cmp = startKey ? comparator(node.key, startKey) : 1;\r\n            // flip the comparison if we're going in reverse\r\n            if (isReverse_)\r\n                cmp *= -1;\r\n            if (cmp < 0) {\r\n                // This node is less than our start key. ignore it\r\n                if (this.isReverse_) {\r\n                    node = node.left;\r\n                }\r\n                else {\r\n                    node = node.right;\r\n                }\r\n            }\r\n            else if (cmp === 0) {\r\n                // This node is exactly equal to our start key. Push it on the stack, but stop iterating;\r\n                this.nodeStack_.push(node);\r\n                break;\r\n            }\r\n            else {\r\n                // This node is greater than our start key, add it to the stack and move to the next one\r\n                this.nodeStack_.push(node);\r\n                if (this.isReverse_) {\r\n                    node = node.right;\r\n                }\r\n                else {\r\n                    node = node.left;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    SortedMapIterator.prototype.getNext = function () {\r\n        if (this.nodeStack_.length === 0)\r\n            return null;\r\n        var node = this.nodeStack_.pop();\r\n        var result;\r\n        if (this.resultGenerator_)\r\n            result = this.resultGenerator_(node.key, node.value);\r\n        else\r\n            result = { key: node.key, value: node.value };\r\n        if (this.isReverse_) {\r\n            node = node.left;\r\n            while (!node.isEmpty()) {\r\n                this.nodeStack_.push(node);\r\n                node = node.right;\r\n            }\r\n        }\r\n        else {\r\n            node = node.right;\r\n            while (!node.isEmpty()) {\r\n                this.nodeStack_.push(node);\r\n                node = node.left;\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n    SortedMapIterator.prototype.hasNext = function () {\r\n        return this.nodeStack_.length > 0;\r\n    };\r\n    SortedMapIterator.prototype.peek = function () {\r\n        if (this.nodeStack_.length === 0)\r\n            return null;\r\n        var node = this.nodeStack_[this.nodeStack_.length - 1];\r\n        if (this.resultGenerator_) {\r\n            return this.resultGenerator_(node.key, node.value);\r\n        }\r\n        else {\r\n            return { key: node.key, value: node.value };\r\n        }\r\n    };\r\n    return SortedMapIterator;\r\n}());\r\n/**\r\n * Represents a node in a Left-leaning Red-Black tree.\r\n */\r\nvar LLRBNode = /** @class */ (function () {\r\n    /**\r\n     * @template K, V\r\n     * @param {!K} key Key associated with this node.\r\n     * @param {!V} value Value associated with this node.\r\n     * @param {?boolean} color Whether this node is red.\r\n     * @param {?(LLRBNode|LLRBEmptyNode)=} left Left child.\r\n     * @param {?(LLRBNode|LLRBEmptyNode)=} right Right child.\r\n     */\r\n    function LLRBNode(key, value, color, left, right) {\r\n        this.key = key;\r\n        this.value = value;\r\n        this.color = color != null ? color : LLRBNode.RED;\r\n        this.left =\r\n            left != null ? left : SortedMap.EMPTY_NODE;\r\n        this.right =\r\n            right != null ? right : SortedMap.EMPTY_NODE;\r\n    }\r\n    /**\r\n     * Returns a copy of the current node, optionally replacing pieces of it.\r\n     *\r\n     * @param {?K} key New key for the node, or null.\r\n     * @param {?V} value New value for the node, or null.\r\n     * @param {?boolean} color New color for the node, or null.\r\n     * @param {?LLRBNode|LLRBEmptyNode} left New left child for the node, or null.\r\n     * @param {?LLRBNode|LLRBEmptyNode} right New right child for the node, or null.\r\n     * @return {!LLRBNode} The node copy.\r\n     */\r\n    LLRBNode.prototype.copy = function (key, value, color, left, right) {\r\n        return new LLRBNode(key != null ? key : this.key, value != null ? value : this.value, color != null ? color : this.color, left != null ? left : this.left, right != null ? right : this.right);\r\n    };\r\n    /**\r\n     * @return {number} The total number of nodes in the tree.\r\n     */\r\n    LLRBNode.prototype.count = function () {\r\n        return this.left.count() + 1 + this.right.count();\r\n    };\r\n    /**\r\n     * @return {boolean} True if the tree is empty.\r\n     */\r\n    LLRBNode.prototype.isEmpty = function () {\r\n        return false;\r\n    };\r\n    /**\r\n     * Traverses the tree in key order and calls the specified action function\r\n     * for each node.\r\n     *\r\n     * @param {function(!K, !V):*} action Callback function to be called for each\r\n     *   node.  If it returns true, traversal is aborted.\r\n     * @return {*} The first truthy value returned by action, or the last falsey\r\n     *   value returned by action\r\n     */\r\n    LLRBNode.prototype.inorderTraversal = function (action) {\r\n        return (this.left.inorderTraversal(action) ||\r\n            action(this.key, this.value) ||\r\n            this.right.inorderTraversal(action));\r\n    };\r\n    /**\r\n     * Traverses the tree in reverse key order and calls the specified action function\r\n     * for each node.\r\n     *\r\n     * @param {function(!Object, !Object)} action Callback function to be called for each\r\n     * node.  If it returns true, traversal is aborted.\r\n     * @return {*} True if traversal was aborted.\r\n     */\r\n    LLRBNode.prototype.reverseTraversal = function (action) {\r\n        return (this.right.reverseTraversal(action) ||\r\n            action(this.key, this.value) ||\r\n            this.left.reverseTraversal(action));\r\n    };\r\n    /**\r\n     * @return {!Object} The minimum node in the tree.\r\n     * @private\r\n     */\r\n    LLRBNode.prototype.min_ = function () {\r\n        if (this.left.isEmpty()) {\r\n            return this;\r\n        }\r\n        else {\r\n            return this.left.min_();\r\n        }\r\n    };\r\n    /**\r\n     * @return {!K} The maximum key in the tree.\r\n     */\r\n    LLRBNode.prototype.minKey = function () {\r\n        return this.min_().key;\r\n    };\r\n    /**\r\n     * @return {!K} The maximum key in the tree.\r\n     */\r\n    LLRBNode.prototype.maxKey = function () {\r\n        if (this.right.isEmpty()) {\r\n            return this.key;\r\n        }\r\n        else {\r\n            return this.right.maxKey();\r\n        }\r\n    };\r\n    /**\r\n     *\r\n     * @param {!Object} key Key to insert.\r\n     * @param {!Object} value Value to insert.\r\n     * @param {Comparator} comparator Comparator.\r\n     * @return {!LLRBNode} New tree, with the key/value added.\r\n     */\r\n    LLRBNode.prototype.insert = function (key, value, comparator) {\r\n        var cmp, n;\r\n        n = this;\r\n        cmp = comparator(key, n.key);\r\n        if (cmp < 0) {\r\n            n = n.copy(null, null, null, n.left.insert(key, value, comparator), null);\r\n        }\r\n        else if (cmp === 0) {\r\n            n = n.copy(null, value, null, null, null);\r\n        }\r\n        else {\r\n            n = n.copy(null, null, null, null, n.right.insert(key, value, comparator));\r\n        }\r\n        return n.fixUp_();\r\n    };\r\n    /**\r\n     * @private\r\n     * @return {!LLRBNode|LLRBEmptyNode} New tree, with the minimum key removed.\r\n     */\r\n    LLRBNode.prototype.removeMin_ = function () {\r\n        if (this.left.isEmpty()) {\r\n            return SortedMap.EMPTY_NODE;\r\n        }\r\n        var n = this;\r\n        if (!n.left.isRed_() && !n.left.left.isRed_())\r\n            n = n.moveRedLeft_();\r\n        n = n.copy(null, null, null, n.left.removeMin_(), null);\r\n        return n.fixUp_();\r\n    };\r\n    /**\r\n     * @param {!Object} key The key of the item to remove.\r\n     * @param {Comparator} comparator Comparator.\r\n     * @return {!LLRBNode|LLRBEmptyNode} New tree, with the specified item removed.\r\n     */\r\n    LLRBNode.prototype.remove = function (key, comparator) {\r\n        var n, smallest;\r\n        n = this;\r\n        if (comparator(key, n.key) < 0) {\r\n            if (!n.left.isEmpty() && !n.left.isRed_() && !n.left.left.isRed_()) {\r\n                n = n.moveRedLeft_();\r\n            }\r\n            n = n.copy(null, null, null, n.left.remove(key, comparator), null);\r\n        }\r\n        else {\r\n            if (n.left.isRed_())\r\n                n = n.rotateRight_();\r\n            if (!n.right.isEmpty() && !n.right.isRed_() && !n.right.left.isRed_()) {\r\n                n = n.moveRedRight_();\r\n            }\r\n            if (comparator(key, n.key) === 0) {\r\n                if (n.right.isEmpty()) {\r\n                    return SortedMap.EMPTY_NODE;\r\n                }\r\n                else {\r\n                    smallest = n.right.min_();\r\n                    n = n.copy(smallest.key, smallest.value, null, null, n.right.removeMin_());\r\n                }\r\n            }\r\n            n = n.copy(null, null, null, null, n.right.remove(key, comparator));\r\n        }\r\n        return n.fixUp_();\r\n    };\r\n    /**\r\n     * @private\r\n     * @return {boolean} Whether this is a RED node.\r\n     */\r\n    LLRBNode.prototype.isRed_ = function () {\r\n        return this.color;\r\n    };\r\n    /**\r\n     * @private\r\n     * @return {!LLRBNode} New tree after performing any needed rotations.\r\n     */\r\n    LLRBNode.prototype.fixUp_ = function () {\r\n        var n = this;\r\n        if (n.right.isRed_() && !n.left.isRed_())\r\n            n = n.rotateLeft_();\r\n        if (n.left.isRed_() && n.left.left.isRed_())\r\n            n = n.rotateRight_();\r\n        if (n.left.isRed_() && n.right.isRed_())\r\n            n = n.colorFlip_();\r\n        return n;\r\n    };\r\n    /**\r\n     * @private\r\n     * @return {!LLRBNode} New tree, after moveRedLeft.\r\n     */\r\n    LLRBNode.prototype.moveRedLeft_ = function () {\r\n        var n = this.colorFlip_();\r\n        if (n.right.left.isRed_()) {\r\n            n = n.copy(null, null, null, null, n.right.rotateRight_());\r\n            n = n.rotateLeft_();\r\n            n = n.colorFlip_();\r\n        }\r\n        return n;\r\n    };\r\n    /**\r\n     * @private\r\n     * @return {!LLRBNode} New tree, after moveRedRight.\r\n     */\r\n    LLRBNode.prototype.moveRedRight_ = function () {\r\n        var n = this.colorFlip_();\r\n        if (n.left.left.isRed_()) {\r\n            n = n.rotateRight_();\r\n            n = n.colorFlip_();\r\n        }\r\n        return n;\r\n    };\r\n    /**\r\n     * @private\r\n     * @return {!LLRBNode} New tree, after rotateLeft.\r\n     */\r\n    LLRBNode.prototype.rotateLeft_ = function () {\r\n        var nl = this.copy(null, null, LLRBNode.RED, null, this.right.left);\r\n        return this.right.copy(null, null, this.color, nl, null);\r\n    };\r\n    /**\r\n     * @private\r\n     * @return {!LLRBNode} New tree, after rotateRight.\r\n     */\r\n    LLRBNode.prototype.rotateRight_ = function () {\r\n        var nr = this.copy(null, null, LLRBNode.RED, this.left.right, null);\r\n        return this.left.copy(null, null, this.color, null, nr);\r\n    };\r\n    /**\r\n     * @private\r\n     * @return {!LLRBNode} New tree, after colorFlip.\r\n     */\r\n    LLRBNode.prototype.colorFlip_ = function () {\r\n        var left = this.left.copy(null, null, !this.left.color, null, null);\r\n        var right = this.right.copy(null, null, !this.right.color, null, null);\r\n        return this.copy(null, null, !this.color, left, right);\r\n    };\r\n    /**\r\n     * For testing.\r\n     *\r\n     * @private\r\n     * @return {boolean} True if all is well.\r\n     */\r\n    LLRBNode.prototype.checkMaxDepth_ = function () {\r\n        var blackDepth = this.check_();\r\n        return Math.pow(2.0, blackDepth) <= this.count() + 1;\r\n    };\r\n    /**\r\n     * @private\r\n     * @return {number} Not sure what this returns exactly. :-).\r\n     */\r\n    LLRBNode.prototype.check_ = function () {\r\n        var blackDepth;\r\n        if (this.isRed_() && this.left.isRed_()) {\r\n            throw new Error('Red node has red child(' + this.key + ',' + this.value + ')');\r\n        }\r\n        if (this.right.isRed_()) {\r\n            throw new Error('Right child of (' + this.key + ',' + this.value + ') is red');\r\n        }\r\n        blackDepth = this.left.check_();\r\n        if (blackDepth !== this.right.check_()) {\r\n            throw new Error('Black depths differ');\r\n        }\r\n        else {\r\n            return blackDepth + (this.isRed_() ? 0 : 1);\r\n        }\r\n    };\r\n    LLRBNode.RED = true;\r\n    LLRBNode.BLACK = false;\r\n    return LLRBNode;\r\n}());\r\n/**\r\n * Represents an empty node (a leaf node in the Red-Black Tree).\r\n */\r\nvar LLRBEmptyNode = /** @class */ (function () {\r\n    function LLRBEmptyNode() {\r\n    }\r\n    /**\r\n     * Returns a copy of the current node.\r\n     *\r\n     * @return {!LLRBEmptyNode} The node copy.\r\n     */\r\n    LLRBEmptyNode.prototype.copy = function (key, value, color, left, right) {\r\n        return this;\r\n    };\r\n    /**\r\n     * Returns a copy of the tree, with the specified key/value added.\r\n     *\r\n     * @param {!K} key Key to be added.\r\n     * @param {!V} value Value to be added.\r\n     * @param {Comparator} comparator Comparator.\r\n     * @return {!LLRBNode} New tree, with item added.\r\n     */\r\n    LLRBEmptyNode.prototype.insert = function (key, value, comparator) {\r\n        return new LLRBNode(key, value, null);\r\n    };\r\n    /**\r\n     * Returns a copy of the tree, with the specified key removed.\r\n     *\r\n     * @param {!K} key The key to remove.\r\n     * @param {Comparator} comparator Comparator.\r\n     * @return {!LLRBEmptyNode} New tree, with item removed.\r\n     */\r\n    LLRBEmptyNode.prototype.remove = function (key, comparator) {\r\n        return this;\r\n    };\r\n    /**\r\n     * @return {number} The total number of nodes in the tree.\r\n     */\r\n    LLRBEmptyNode.prototype.count = function () {\r\n        return 0;\r\n    };\r\n    /**\r\n     * @return {boolean} True if the tree is empty.\r\n     */\r\n    LLRBEmptyNode.prototype.isEmpty = function () {\r\n        return true;\r\n    };\r\n    /**\r\n     * Traverses the tree in key order and calls the specified action function\r\n     * for each node.\r\n     *\r\n     * @param {function(!K, !V):*} action Callback function to be called for each\r\n     * node.  If it returns true, traversal is aborted.\r\n     * @return {boolean} True if traversal was aborted.\r\n     */\r\n    LLRBEmptyNode.prototype.inorderTraversal = function (action) {\r\n        return false;\r\n    };\r\n    /**\r\n     * Traverses the tree in reverse key order and calls the specified action function\r\n     * for each node.\r\n     *\r\n     * @param {function(!K, !V)} action Callback function to be called for each\r\n     * node.  If it returns true, traversal is aborted.\r\n     * @return {boolean} True if traversal was aborted.\r\n     */\r\n    LLRBEmptyNode.prototype.reverseTraversal = function (action) {\r\n        return false;\r\n    };\r\n    /**\r\n     * @return {null}\r\n     */\r\n    LLRBEmptyNode.prototype.minKey = function () {\r\n        return null;\r\n    };\r\n    /**\r\n     * @return {null}\r\n     */\r\n    LLRBEmptyNode.prototype.maxKey = function () {\r\n        return null;\r\n    };\r\n    /**\r\n     * @private\r\n     * @return {number} Not sure what this returns exactly. :-).\r\n     */\r\n    LLRBEmptyNode.prototype.check_ = function () {\r\n        return 0;\r\n    };\r\n    /**\r\n     * @private\r\n     * @return {boolean} Whether this node is red.\r\n     */\r\n    LLRBEmptyNode.prototype.isRed_ = function () {\r\n        return false;\r\n    };\r\n    return LLRBEmptyNode;\r\n}());\r\n/**\r\n * An immutable sorted map implementation, based on a Left-leaning Red-Black\r\n * tree.\r\n */\r\nvar SortedMap = /** @class */ (function () {\r\n    /**\r\n     * @template K, V\r\n     * @param {function(K, K):number} comparator_ Key comparator.\r\n     * @param {LLRBNode=} root_ (Optional) Root node for the map.\r\n     */\r\n    function SortedMap(comparator_, root_) {\r\n        if (root_ === void 0) { root_ = SortedMap.EMPTY_NODE; }\r\n        this.comparator_ = comparator_;\r\n        this.root_ = root_;\r\n    }\r\n    /**\r\n     * Returns a copy of the map, with the specified key/value added or replaced.\r\n     * (TODO: We should perhaps rename this method to 'put')\r\n     *\r\n     * @param {!K} key Key to be added.\r\n     * @param {!V} value Value to be added.\r\n     * @return {!SortedMap.<K, V>} New map, with item added.\r\n     */\r\n    SortedMap.prototype.insert = function (key, value) {\r\n        return new SortedMap(this.comparator_, this.root_\r\n            .insert(key, value, this.comparator_)\r\n            .copy(null, null, LLRBNode.BLACK, null, null));\r\n    };\r\n    /**\r\n     * Returns a copy of the map, with the specified key removed.\r\n     *\r\n     * @param {!K} key The key to remove.\r\n     * @return {!SortedMap.<K, V>} New map, with item removed.\r\n     */\r\n    SortedMap.prototype.remove = function (key) {\r\n        return new SortedMap(this.comparator_, this.root_\r\n            .remove(key, this.comparator_)\r\n            .copy(null, null, LLRBNode.BLACK, null, null));\r\n    };\r\n    /**\r\n     * Returns the value of the node with the given key, or null.\r\n     *\r\n     * @param {!K} key The key to look up.\r\n     * @return {?V} The value of the node with the given key, or null if the\r\n     * key doesn't exist.\r\n     */\r\n    SortedMap.prototype.get = function (key) {\r\n        var cmp;\r\n        var node = this.root_;\r\n        while (!node.isEmpty()) {\r\n            cmp = this.comparator_(key, node.key);\r\n            if (cmp === 0) {\r\n                return node.value;\r\n            }\r\n            else if (cmp < 0) {\r\n                node = node.left;\r\n            }\r\n            else if (cmp > 0) {\r\n                node = node.right;\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    /**\r\n     * Returns the key of the item *before* the specified key, or null if key is the first item.\r\n     * @param {K} key The key to find the predecessor of\r\n     * @return {?K} The predecessor key.\r\n     */\r\n    SortedMap.prototype.getPredecessorKey = function (key) {\r\n        var cmp, node = this.root_, rightParent = null;\r\n        while (!node.isEmpty()) {\r\n            cmp = this.comparator_(key, node.key);\r\n            if (cmp === 0) {\r\n                if (!node.left.isEmpty()) {\r\n                    node = node.left;\r\n                    while (!node.right.isEmpty())\r\n                        node = node.right;\r\n                    return node.key;\r\n                }\r\n                else if (rightParent) {\r\n                    return rightParent.key;\r\n                }\r\n                else {\r\n                    return null; // first item.\r\n                }\r\n            }\r\n            else if (cmp < 0) {\r\n                node = node.left;\r\n            }\r\n            else if (cmp > 0) {\r\n                rightParent = node;\r\n                node = node.right;\r\n            }\r\n        }\r\n        throw new Error('Attempted to find predecessor key for a nonexistent key.  What gives?');\r\n    };\r\n    /**\r\n     * @return {boolean} True if the map is empty.\r\n     */\r\n    SortedMap.prototype.isEmpty = function () {\r\n        return this.root_.isEmpty();\r\n    };\r\n    /**\r\n     * @return {number} The total number of nodes in the map.\r\n     */\r\n    SortedMap.prototype.count = function () {\r\n        return this.root_.count();\r\n    };\r\n    /**\r\n     * @return {?K} The minimum key in the map.\r\n     */\r\n    SortedMap.prototype.minKey = function () {\r\n        return this.root_.minKey();\r\n    };\r\n    /**\r\n     * @return {?K} The maximum key in the map.\r\n     */\r\n    SortedMap.prototype.maxKey = function () {\r\n        return this.root_.maxKey();\r\n    };\r\n    /**\r\n     * Traverses the map in key order and calls the specified action function\r\n     * for each key/value pair.\r\n     *\r\n     * @param {function(!K, !V):*} action Callback function to be called\r\n     * for each key/value pair.  If action returns true, traversal is aborted.\r\n     * @return {*} The first truthy value returned by action, or the last falsey\r\n     *   value returned by action\r\n     */\r\n    SortedMap.prototype.inorderTraversal = function (action) {\r\n        return this.root_.inorderTraversal(action);\r\n    };\r\n    /**\r\n     * Traverses the map in reverse key order and calls the specified action function\r\n     * for each key/value pair.\r\n     *\r\n     * @param {function(!Object, !Object)} action Callback function to be called\r\n     * for each key/value pair.  If action returns true, traversal is aborted.\r\n     * @return {*} True if the traversal was aborted.\r\n     */\r\n    SortedMap.prototype.reverseTraversal = function (action) {\r\n        return this.root_.reverseTraversal(action);\r\n    };\r\n    /**\r\n     * Returns an iterator over the SortedMap.\r\n     * @template T\r\n     * @param {(function(K, V):T)=} resultGenerator\r\n     * @return {SortedMapIterator.<K, V, T>} The iterator.\r\n     */\r\n    SortedMap.prototype.getIterator = function (resultGenerator) {\r\n        return new SortedMapIterator(this.root_, null, this.comparator_, false, resultGenerator);\r\n    };\r\n    SortedMap.prototype.getIteratorFrom = function (key, resultGenerator) {\r\n        return new SortedMapIterator(this.root_, key, this.comparator_, false, resultGenerator);\r\n    };\r\n    SortedMap.prototype.getReverseIteratorFrom = function (key, resultGenerator) {\r\n        return new SortedMapIterator(this.root_, key, this.comparator_, true, resultGenerator);\r\n    };\r\n    SortedMap.prototype.getReverseIterator = function (resultGenerator) {\r\n        return new SortedMapIterator(this.root_, null, this.comparator_, true, resultGenerator);\r\n    };\r\n    /**\r\n     * Always use the same empty node, to reduce memory.\r\n     * @const\r\n     */\r\n    SortedMap.EMPTY_NODE = new LLRBEmptyNode();\r\n    return SortedMap;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar LOG_2 = Math.log(2);\r\n/**\r\n * @constructor\r\n */\r\nvar Base12Num = /** @class */ (function () {\r\n    /**\r\n     * @param {number} length\r\n     */\r\n    function Base12Num(length) {\r\n        var logBase2 = function (num) {\r\n            return parseInt((Math.log(num) / LOG_2), 10);\r\n        };\r\n        var bitMask = function (bits) { return parseInt(Array(bits + 1).join('1'), 2); };\r\n        this.count = logBase2(length + 1);\r\n        this.current_ = this.count - 1;\r\n        var mask = bitMask(this.count);\r\n        this.bits_ = (length + 1) & mask;\r\n    }\r\n    /**\r\n     * @return {boolean}\r\n     */\r\n    Base12Num.prototype.nextBitIsOne = function () {\r\n        //noinspection JSBitwiseOperatorUsage\r\n        var result = !(this.bits_ & (0x1 << this.current_));\r\n        this.current_--;\r\n        return result;\r\n    };\r\n    return Base12Num;\r\n}());\r\n/**\r\n * Takes a list of child nodes and constructs a SortedSet using the given comparison\r\n * function\r\n *\r\n * Uses the algorithm described in the paper linked here:\r\n * http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.46.1458\r\n *\r\n * @template K, V\r\n * @param {Array.<!NamedNode>} childList Unsorted list of children\r\n * @param {function(!NamedNode, !NamedNode):number} cmp The comparison method to be used\r\n * @param {(function(NamedNode):K)=} keyFn An optional function to extract K from a node wrapper, if K's\r\n *                                                        type is not NamedNode\r\n * @param {(function(K, K):number)=} mapSortFn An optional override for comparator used by the generated sorted map\r\n * @return {SortedMap.<K, V>}\r\n */\r\nvar buildChildSet = function (childList, cmp, keyFn, mapSortFn) {\r\n    childList.sort(cmp);\r\n    var buildBalancedTree = function (low, high) {\r\n        var length = high - low;\r\n        var namedNode;\r\n        var key;\r\n        if (length == 0) {\r\n            return null;\r\n        }\r\n        else if (length == 1) {\r\n            namedNode = childList[low];\r\n            key = keyFn ? keyFn(namedNode) : namedNode;\r\n            return new LLRBNode(key, namedNode.node, LLRBNode.BLACK, null, null);\r\n        }\r\n        else {\r\n            var middle = parseInt((length / 2), 10) + low;\r\n            var left = buildBalancedTree(low, middle);\r\n            var right = buildBalancedTree(middle + 1, high);\r\n            namedNode = childList[middle];\r\n            key = keyFn ? keyFn(namedNode) : namedNode;\r\n            return new LLRBNode(key, namedNode.node, LLRBNode.BLACK, left, right);\r\n        }\r\n    };\r\n    var buildFrom12Array = function (base12) {\r\n        var node = null;\r\n        var root = null;\r\n        var index = childList.length;\r\n        var buildPennant = function (chunkSize, color) {\r\n            var low = index - chunkSize;\r\n            var high = index;\r\n            index -= chunkSize;\r\n            var childTree = buildBalancedTree(low + 1, high);\r\n            var namedNode = childList[low];\r\n            var key = keyFn ? keyFn(namedNode) : namedNode;\r\n            attachPennant(new LLRBNode(key, namedNode.node, color, null, childTree));\r\n        };\r\n        var attachPennant = function (pennant) {\r\n            if (node) {\r\n                node.left = pennant;\r\n                node = pennant;\r\n            }\r\n            else {\r\n                root = pennant;\r\n                node = pennant;\r\n            }\r\n        };\r\n        for (var i = 0; i < base12.count; ++i) {\r\n            var isOne = base12.nextBitIsOne();\r\n            // The number of nodes taken in each slice is 2^(arr.length - (i + 1))\r\n            var chunkSize = Math.pow(2, base12.count - (i + 1));\r\n            if (isOne) {\r\n                buildPennant(chunkSize, LLRBNode.BLACK);\r\n            }\r\n            else {\r\n                // current == 2\r\n                buildPennant(chunkSize, LLRBNode.BLACK);\r\n                buildPennant(chunkSize, LLRBNode.RED);\r\n            }\r\n        }\r\n        return root;\r\n    };\r\n    var base12 = new Base12Num(childList.length);\r\n    var root = buildFrom12Array(base12);\r\n    return new SortedMap(mapSortFn || cmp, root);\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _defaultIndexMap;\r\nvar fallbackObject = {};\r\n/**\r\n *\r\n * @param {Object.<string, FallbackType|SortedMap.<NamedNode, Node>>} indexes\r\n * @param {Object.<string, Index>} indexSet\r\n * @constructor\r\n */\r\nvar IndexMap = /** @class */ (function () {\r\n    function IndexMap(indexes_, indexSet_) {\r\n        this.indexes_ = indexes_;\r\n        this.indexSet_ = indexSet_;\r\n    }\r\n    Object.defineProperty(IndexMap, \"Default\", {\r\n        /**\r\n         * The default IndexMap for nodes without a priority\r\n         * @type {!IndexMap}\r\n         * @const\r\n         */\r\n        get: function () {\r\n            assert(fallbackObject && PRIORITY_INDEX, 'ChildrenNode.ts has not been loaded');\r\n            _defaultIndexMap =\r\n                _defaultIndexMap ||\r\n                    new IndexMap({ '.priority': fallbackObject }, { '.priority': PRIORITY_INDEX });\r\n            return _defaultIndexMap;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     *\r\n     * @param {!string} indexKey\r\n     * @return {?SortedMap.<NamedNode, Node>}\r\n     */\r\n    IndexMap.prototype.get = function (indexKey) {\r\n        var sortedMap = safeGet(this.indexes_, indexKey);\r\n        if (!sortedMap)\r\n            throw new Error('No index defined for ' + indexKey);\r\n        if (sortedMap === fallbackObject) {\r\n            // The index exists, but it falls back to just name comparison. Return null so that the calling code uses the\r\n            // regular child map\r\n            return null;\r\n        }\r\n        else {\r\n            return sortedMap;\r\n        }\r\n    };\r\n    /**\r\n     * @param {!Index} indexDefinition\r\n     * @return {boolean}\r\n     */\r\n    IndexMap.prototype.hasIndex = function (indexDefinition) {\r\n        return contains(this.indexSet_, indexDefinition.toString());\r\n    };\r\n    /**\r\n     * @param {!Index} indexDefinition\r\n     * @param {!SortedMap.<string, !Node>} existingChildren\r\n     * @return {!IndexMap}\r\n     */\r\n    IndexMap.prototype.addIndex = function (indexDefinition, existingChildren) {\r\n        assert(indexDefinition !== KEY_INDEX, \"KeyIndex always exists and isn't meant to be added to the IndexMap.\");\r\n        var childList = [];\r\n        var sawIndexedValue = false;\r\n        var iter = existingChildren.getIterator(NamedNode.Wrap);\r\n        var next = iter.getNext();\r\n        while (next) {\r\n            sawIndexedValue =\r\n                sawIndexedValue || indexDefinition.isDefinedOn(next.node);\r\n            childList.push(next);\r\n            next = iter.getNext();\r\n        }\r\n        var newIndex;\r\n        if (sawIndexedValue) {\r\n            newIndex = buildChildSet(childList, indexDefinition.getCompare());\r\n        }\r\n        else {\r\n            newIndex = fallbackObject;\r\n        }\r\n        var indexName = indexDefinition.toString();\r\n        var newIndexSet = clone(this.indexSet_);\r\n        newIndexSet[indexName] = indexDefinition;\r\n        var newIndexes = clone(this.indexes_);\r\n        newIndexes[indexName] = newIndex;\r\n        return new IndexMap(newIndexes, newIndexSet);\r\n    };\r\n    /**\r\n     * Ensure that this node is properly tracked in any indexes that we're maintaining\r\n     * @param {!NamedNode} namedNode\r\n     * @param {!SortedMap.<string, !Node>} existingChildren\r\n     * @return {!IndexMap}\r\n     */\r\n    IndexMap.prototype.addToIndexes = function (namedNode, existingChildren) {\r\n        var _this = this;\r\n        var newIndexes = map(this.indexes_, function (indexedChildren, indexName) {\r\n            var index = safeGet(_this.indexSet_, indexName);\r\n            assert(index, 'Missing index implementation for ' + indexName);\r\n            if (indexedChildren === fallbackObject) {\r\n                // Check to see if we need to index everything\r\n                if (index.isDefinedOn(namedNode.node)) {\r\n                    // We need to build this index\r\n                    var childList = [];\r\n                    var iter = existingChildren.getIterator(NamedNode.Wrap);\r\n                    var next = iter.getNext();\r\n                    while (next) {\r\n                        if (next.name != namedNode.name) {\r\n                            childList.push(next);\r\n                        }\r\n                        next = iter.getNext();\r\n                    }\r\n                    childList.push(namedNode);\r\n                    return buildChildSet(childList, index.getCompare());\r\n                }\r\n                else {\r\n                    // No change, this remains a fallback\r\n                    return fallbackObject;\r\n                }\r\n            }\r\n            else {\r\n                var existingSnap = existingChildren.get(namedNode.name);\r\n                var newChildren = indexedChildren;\r\n                if (existingSnap) {\r\n                    newChildren = newChildren.remove(new NamedNode(namedNode.name, existingSnap));\r\n                }\r\n                return newChildren.insert(namedNode, namedNode.node);\r\n            }\r\n        });\r\n        return new IndexMap(newIndexes, this.indexSet_);\r\n    };\r\n    /**\r\n     * Create a new IndexMap instance with the given value removed\r\n     * @param {!NamedNode} namedNode\r\n     * @param {!SortedMap.<string, !Node>} existingChildren\r\n     * @return {!IndexMap}\r\n     */\r\n    IndexMap.prototype.removeFromIndexes = function (namedNode, existingChildren) {\r\n        var newIndexes = map(this.indexes_, function (indexedChildren) {\r\n            if (indexedChildren === fallbackObject) {\r\n                // This is the fallback. Just return it, nothing to do in this case\r\n                return indexedChildren;\r\n            }\r\n            else {\r\n                var existingSnap = existingChildren.get(namedNode.name);\r\n                if (existingSnap) {\r\n                    return indexedChildren.remove(new NamedNode(namedNode.name, existingSnap));\r\n                }\r\n                else {\r\n                    // No record of this child\r\n                    return indexedChildren;\r\n                }\r\n            }\r\n        });\r\n        return new IndexMap(newIndexes, this.indexSet_);\r\n    };\r\n    return IndexMap;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction NAME_ONLY_COMPARATOR(left, right) {\r\n    return nameCompare(left.name, right.name);\r\n}\r\nfunction NAME_COMPARATOR(left, right) {\r\n    return nameCompare(left, right);\r\n}\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// TODO: For memory savings, don't store priorityNode_ if it's empty.\r\nvar EMPTY_NODE;\r\n/**\r\n * ChildrenNode is a class for storing internal nodes in a DataSnapshot\r\n * (i.e. nodes with children).  It implements Node and stores the\r\n * list of children in the children property, sorted by child name.\r\n *\r\n * @constructor\r\n * @implements {Node}\r\n */\r\nvar ChildrenNode = /** @class */ (function () {\r\n    /**\r\n     *\r\n     * @param {!SortedMap.<string, !Node>} children_ List of children\r\n     * of this node..\r\n     * @param {?Node} priorityNode_ The priority of this node (as a snapshot node).\r\n     * @param {!IndexMap} indexMap_\r\n     */\r\n    function ChildrenNode(children_, priorityNode_, indexMap_) {\r\n        this.children_ = children_;\r\n        this.priorityNode_ = priorityNode_;\r\n        this.indexMap_ = indexMap_;\r\n        this.lazyHash_ = null;\r\n        /**\r\n         * Note: The only reason we allow null priority is for EMPTY_NODE, since we can't use\r\n         * EMPTY_NODE as the priority of EMPTY_NODE.  We might want to consider making EMPTY_NODE its own\r\n         * class instead of an empty ChildrenNode.\r\n         */\r\n        if (this.priorityNode_) {\r\n            validatePriorityNode(this.priorityNode_);\r\n        }\r\n        if (this.children_.isEmpty()) {\r\n            assert(!this.priorityNode_ || this.priorityNode_.isEmpty(), 'An empty node cannot have a priority');\r\n        }\r\n    }\r\n    Object.defineProperty(ChildrenNode, \"EMPTY_NODE\", {\r\n        get: function () {\r\n            return (EMPTY_NODE ||\r\n                (EMPTY_NODE = new ChildrenNode(new SortedMap(NAME_COMPARATOR), null, IndexMap.Default)));\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.isLeafNode = function () {\r\n        return false;\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.getPriority = function () {\r\n        return this.priorityNode_ || EMPTY_NODE;\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.updatePriority = function (newPriorityNode) {\r\n        if (this.children_.isEmpty()) {\r\n            // Don't allow priorities on empty nodes\r\n            return this;\r\n        }\r\n        else {\r\n            return new ChildrenNode(this.children_, newPriorityNode, this.indexMap_);\r\n        }\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.getImmediateChild = function (childName) {\r\n        // Hack to treat priority as a regular child\r\n        if (childName === '.priority') {\r\n            return this.getPriority();\r\n        }\r\n        else {\r\n            var child = this.children_.get(childName);\r\n            return child === null ? EMPTY_NODE : child;\r\n        }\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.getChild = function (path) {\r\n        var front = path.getFront();\r\n        if (front === null)\r\n            return this;\r\n        return this.getImmediateChild(front).getChild(path.popFront());\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.hasChild = function (childName) {\r\n        return this.children_.get(childName) !== null;\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.updateImmediateChild = function (childName, newChildNode) {\r\n        assert(newChildNode, 'We should always be passing snapshot nodes');\r\n        if (childName === '.priority') {\r\n            return this.updatePriority(newChildNode);\r\n        }\r\n        else {\r\n            var namedNode = new NamedNode(childName, newChildNode);\r\n            var newChildren = void 0, newIndexMap = void 0, newPriority = void 0;\r\n            if (newChildNode.isEmpty()) {\r\n                newChildren = this.children_.remove(childName);\r\n                newIndexMap = this.indexMap_.removeFromIndexes(namedNode, this.children_);\r\n            }\r\n            else {\r\n                newChildren = this.children_.insert(childName, newChildNode);\r\n                newIndexMap = this.indexMap_.addToIndexes(namedNode, this.children_);\r\n            }\r\n            newPriority = newChildren.isEmpty() ? EMPTY_NODE : this.priorityNode_;\r\n            return new ChildrenNode(newChildren, newPriority, newIndexMap);\r\n        }\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.updateChild = function (path, newChildNode) {\r\n        var front = path.getFront();\r\n        if (front === null) {\r\n            return newChildNode;\r\n        }\r\n        else {\r\n            assert(path.getFront() !== '.priority' || path.getLength() === 1, '.priority must be the last token in a path');\r\n            var newImmediateChild = this.getImmediateChild(front).updateChild(path.popFront(), newChildNode);\r\n            return this.updateImmediateChild(front, newImmediateChild);\r\n        }\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.isEmpty = function () {\r\n        return this.children_.isEmpty();\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.numChildren = function () {\r\n        return this.children_.count();\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.val = function (exportFormat) {\r\n        if (this.isEmpty())\r\n            return null;\r\n        var obj = {};\r\n        var numKeys = 0, maxKey = 0, allIntegerKeys = true;\r\n        this.forEachChild(PRIORITY_INDEX, function (key, childNode) {\r\n            obj[key] = childNode.val(exportFormat);\r\n            numKeys++;\r\n            if (allIntegerKeys && ChildrenNode.INTEGER_REGEXP_.test(key)) {\r\n                maxKey = Math.max(maxKey, Number(key));\r\n            }\r\n            else {\r\n                allIntegerKeys = false;\r\n            }\r\n        });\r\n        if (!exportFormat && allIntegerKeys && maxKey < 2 * numKeys) {\r\n            // convert to array.\r\n            var array = [];\r\n            for (var key in obj)\r\n                array[key] = obj[key];\r\n            return array;\r\n        }\r\n        else {\r\n            if (exportFormat && !this.getPriority().isEmpty()) {\r\n                obj['.priority'] = this.getPriority().val();\r\n            }\r\n            return obj;\r\n        }\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.hash = function () {\r\n        if (this.lazyHash_ === null) {\r\n            var toHash_1 = '';\r\n            if (!this.getPriority().isEmpty())\r\n                toHash_1 +=\r\n                    'priority:' +\r\n                        priorityHashText(this.getPriority().val()) +\r\n                        ':';\r\n            this.forEachChild(PRIORITY_INDEX, function (key, childNode) {\r\n                var childHash = childNode.hash();\r\n                if (childHash !== '')\r\n                    toHash_1 += ':' + key + ':' + childHash;\r\n            });\r\n            this.lazyHash_ = toHash_1 === '' ? '' : sha1(toHash_1);\r\n        }\r\n        return this.lazyHash_;\r\n    };\r\n    /** @inheritDoc */\r\n    ChildrenNode.prototype.getPredecessorChildName = function (childName, childNode, index) {\r\n        var idx = this.resolveIndex_(index);\r\n        if (idx) {\r\n            var predecessor = idx.getPredecessorKey(new NamedNode(childName, childNode));\r\n            return predecessor ? predecessor.name : null;\r\n        }\r\n        else {\r\n            return this.children_.getPredecessorKey(childName);\r\n        }\r\n    };\r\n    /**\r\n     * @param {!Index} indexDefinition\r\n     * @return {?string}\r\n     */\r\n    ChildrenNode.prototype.getFirstChildName = function (indexDefinition) {\r\n        var idx = this.resolveIndex_(indexDefinition);\r\n        if (idx) {\r\n            var minKey = idx.minKey();\r\n            return minKey && minKey.name;\r\n        }\r\n        else {\r\n            return this.children_.minKey();\r\n        }\r\n    };\r\n    /**\r\n     * @param {!Index} indexDefinition\r\n     * @return {?NamedNode}\r\n     */\r\n    ChildrenNode.prototype.getFirstChild = function (indexDefinition) {\r\n        var minKey = this.getFirstChildName(indexDefinition);\r\n        if (minKey) {\r\n            return new NamedNode(minKey, this.children_.get(minKey));\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    };\r\n    /**\r\n     * Given an index, return the key name of the largest value we have, according to that index\r\n     * @param {!Index} indexDefinition\r\n     * @return {?string}\r\n     */\r\n    ChildrenNode.prototype.getLastChildName = function (indexDefinition) {\r\n        var idx = this.resolveIndex_(indexDefinition);\r\n        if (idx) {\r\n            var maxKey = idx.maxKey();\r\n            return maxKey && maxKey.name;\r\n        }\r\n        else {\r\n            return this.children_.maxKey();\r\n        }\r\n    };\r\n    /**\r\n     * @param {!Index} indexDefinition\r\n     * @return {?NamedNode}\r\n     */\r\n    ChildrenNode.prototype.getLastChild = function (indexDefinition) {\r\n        var maxKey = this.getLastChildName(indexDefinition);\r\n        if (maxKey) {\r\n            return new NamedNode(maxKey, this.children_.get(maxKey));\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ChildrenNode.prototype.forEachChild = function (index, action) {\r\n        var idx = this.resolveIndex_(index);\r\n        if (idx) {\r\n            return idx.inorderTraversal(function (wrappedNode) {\r\n                return action(wrappedNode.name, wrappedNode.node);\r\n            });\r\n        }\r\n        else {\r\n            return this.children_.inorderTraversal(action);\r\n        }\r\n    };\r\n    /**\r\n     * @param {!Index} indexDefinition\r\n     * @return {SortedMapIterator}\r\n     */\r\n    ChildrenNode.prototype.getIterator = function (indexDefinition) {\r\n        return this.getIteratorFrom(indexDefinition.minPost(), indexDefinition);\r\n    };\r\n    /**\r\n     *\r\n     * @param {!NamedNode} startPost\r\n     * @param {!Index} indexDefinition\r\n     * @return {!SortedMapIterator}\r\n     */\r\n    ChildrenNode.prototype.getIteratorFrom = function (startPost, indexDefinition) {\r\n        var idx = this.resolveIndex_(indexDefinition);\r\n        if (idx) {\r\n            return idx.getIteratorFrom(startPost, function (key) { return key; });\r\n        }\r\n        else {\r\n            var iterator = this.children_.getIteratorFrom(startPost.name, NamedNode.Wrap);\r\n            var next = iterator.peek();\r\n            while (next != null && indexDefinition.compare(next, startPost) < 0) {\r\n                iterator.getNext();\r\n                next = iterator.peek();\r\n            }\r\n            return iterator;\r\n        }\r\n    };\r\n    /**\r\n     * @param {!Index} indexDefinition\r\n     * @return {!SortedMapIterator}\r\n     */\r\n    ChildrenNode.prototype.getReverseIterator = function (indexDefinition) {\r\n        return this.getReverseIteratorFrom(indexDefinition.maxPost(), indexDefinition);\r\n    };\r\n    /**\r\n     * @param {!NamedNode} endPost\r\n     * @param {!Index} indexDefinition\r\n     * @return {!SortedMapIterator}\r\n     */\r\n    ChildrenNode.prototype.getReverseIteratorFrom = function (endPost, indexDefinition) {\r\n        var idx = this.resolveIndex_(indexDefinition);\r\n        if (idx) {\r\n            return idx.getReverseIteratorFrom(endPost, function (key) {\r\n                return key;\r\n            });\r\n        }\r\n        else {\r\n            var iterator = this.children_.getReverseIteratorFrom(endPost.name, NamedNode.Wrap);\r\n            var next = iterator.peek();\r\n            while (next != null && indexDefinition.compare(next, endPost) > 0) {\r\n                iterator.getNext();\r\n                next = iterator.peek();\r\n            }\r\n            return iterator;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ChildrenNode.prototype.compareTo = function (other) {\r\n        if (this.isEmpty()) {\r\n            if (other.isEmpty()) {\r\n                return 0;\r\n            }\r\n            else {\r\n                return -1;\r\n            }\r\n        }\r\n        else if (other.isLeafNode() || other.isEmpty()) {\r\n            return 1;\r\n        }\r\n        else if (other === MAX_NODE$2) {\r\n            return -1;\r\n        }\r\n        else {\r\n            // Must be another node with children.\r\n            return 0;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ChildrenNode.prototype.withIndex = function (indexDefinition) {\r\n        if (indexDefinition === KEY_INDEX ||\r\n            this.indexMap_.hasIndex(indexDefinition)) {\r\n            return this;\r\n        }\r\n        else {\r\n            var newIndexMap = this.indexMap_.addIndex(indexDefinition, this.children_);\r\n            return new ChildrenNode(this.children_, this.priorityNode_, newIndexMap);\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ChildrenNode.prototype.isIndexed = function (index) {\r\n        return index === KEY_INDEX || this.indexMap_.hasIndex(index);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ChildrenNode.prototype.equals = function (other) {\r\n        if (other === this) {\r\n            return true;\r\n        }\r\n        else if (other.isLeafNode()) {\r\n            return false;\r\n        }\r\n        else {\r\n            var otherChildrenNode = other;\r\n            if (!this.getPriority().equals(otherChildrenNode.getPriority())) {\r\n                return false;\r\n            }\r\n            else if (this.children_.count() === otherChildrenNode.children_.count()) {\r\n                var thisIter = this.getIterator(PRIORITY_INDEX);\r\n                var otherIter = otherChildrenNode.getIterator(PRIORITY_INDEX);\r\n                var thisCurrent = thisIter.getNext();\r\n                var otherCurrent = otherIter.getNext();\r\n                while (thisCurrent && otherCurrent) {\r\n                    if (thisCurrent.name !== otherCurrent.name ||\r\n                        !thisCurrent.node.equals(otherCurrent.node)) {\r\n                        return false;\r\n                    }\r\n                    thisCurrent = thisIter.getNext();\r\n                    otherCurrent = otherIter.getNext();\r\n                }\r\n                return thisCurrent === null && otherCurrent === null;\r\n            }\r\n            else {\r\n                return false;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Returns a SortedMap ordered by index, or null if the default (by-key) ordering can be used\r\n     * instead.\r\n     *\r\n     * @private\r\n     * @param {!Index} indexDefinition\r\n     * @return {?SortedMap.<NamedNode, Node>}\r\n     */\r\n    ChildrenNode.prototype.resolveIndex_ = function (indexDefinition) {\r\n        if (indexDefinition === KEY_INDEX) {\r\n            return null;\r\n        }\r\n        else {\r\n            return this.indexMap_.get(indexDefinition.toString());\r\n        }\r\n    };\r\n    /**\r\n     * @private\r\n     * @type {RegExp}\r\n     */\r\n    ChildrenNode.INTEGER_REGEXP_ = /^(0|[1-9]\\d*)$/;\r\n    return ChildrenNode;\r\n}());\r\n/**\r\n * @constructor\r\n * @extends {ChildrenNode}\r\n * @private\r\n */\r\nvar MaxNode = /** @class */ (function (_super) {\r\n    __extends(MaxNode, _super);\r\n    function MaxNode() {\r\n        return _super.call(this, new SortedMap(NAME_COMPARATOR), ChildrenNode.EMPTY_NODE, IndexMap.Default) || this;\r\n    }\r\n    MaxNode.prototype.compareTo = function (other) {\r\n        if (other === this) {\r\n            return 0;\r\n        }\r\n        else {\r\n            return 1;\r\n        }\r\n    };\r\n    MaxNode.prototype.equals = function (other) {\r\n        // Not that we every compare it, but MAX_NODE is only ever equal to itself\r\n        return other === this;\r\n    };\r\n    MaxNode.prototype.getPriority = function () {\r\n        return this;\r\n    };\r\n    MaxNode.prototype.getImmediateChild = function (childName) {\r\n        return ChildrenNode.EMPTY_NODE;\r\n    };\r\n    MaxNode.prototype.isEmpty = function () {\r\n        return false;\r\n    };\r\n    return MaxNode;\r\n}(ChildrenNode));\r\n/**\r\n * Marker that will sort higher than any other snapshot.\r\n * @type {!MAX_NODE}\r\n * @const\r\n */\r\nvar MAX_NODE$2 = new MaxNode();\r\nObject.defineProperties(NamedNode, {\r\n    MIN: {\r\n        value: new NamedNode(MIN_NAME, ChildrenNode.EMPTY_NODE)\r\n    },\r\n    MAX: {\r\n        value: new NamedNode(MAX_NAME, MAX_NODE$2)\r\n    }\r\n});\r\n/**\r\n * Reference Extensions\r\n */\r\nKeyIndex.__EMPTY_NODE = ChildrenNode.EMPTY_NODE;\r\nLeafNode.__childrenNodeConstructor = ChildrenNode;\r\nsetMaxNode(MAX_NODE$2);\r\nsetMaxNode$1(MAX_NODE$2);\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar USE_HINZE = true;\r\n/**\r\n * Constructs a snapshot node representing the passed JSON and returns it.\r\n * @param {*} json JSON to create a node for.\r\n * @param {?string|?number=} priority Optional priority to use.  This will be ignored if the\r\n * passed JSON contains a .priority property.\r\n * @return {!Node}\r\n */\r\nfunction nodeFromJSON$1(json, priority) {\r\n    if (priority === void 0) { priority = null; }\r\n    if (json === null) {\r\n        return ChildrenNode.EMPTY_NODE;\r\n    }\r\n    if (typeof json === 'object' && '.priority' in json) {\r\n        priority = json['.priority'];\r\n    }\r\n    assert(priority === null ||\r\n        typeof priority === 'string' ||\r\n        typeof priority === 'number' ||\r\n        (typeof priority === 'object' && '.sv' in priority), 'Invalid priority type found: ' + typeof priority);\r\n    if (typeof json === 'object' && '.value' in json && json['.value'] !== null) {\r\n        json = json['.value'];\r\n    }\r\n    // Valid leaf nodes include non-objects or server-value wrapper objects\r\n    if (typeof json !== 'object' || '.sv' in json) {\r\n        var jsonLeaf = json;\r\n        return new LeafNode(jsonLeaf, nodeFromJSON$1(priority));\r\n    }\r\n    if (!(json instanceof Array) && USE_HINZE) {\r\n        var children_1 = [];\r\n        var childrenHavePriority_1 = false;\r\n        var hinzeJsonObj_1 = json;\r\n        forEach(hinzeJsonObj_1, function (key, child) {\r\n            if (typeof key !== 'string' || key.substring(0, 1) !== '.') {\r\n                // Ignore metadata nodes\r\n                var childNode = nodeFromJSON$1(hinzeJsonObj_1[key]);\r\n                if (!childNode.isEmpty()) {\r\n                    childrenHavePriority_1 =\r\n                        childrenHavePriority_1 || !childNode.getPriority().isEmpty();\r\n                    children_1.push(new NamedNode(key, childNode));\r\n                }\r\n            }\r\n        });\r\n        if (children_1.length == 0) {\r\n            return ChildrenNode.EMPTY_NODE;\r\n        }\r\n        var childSet = buildChildSet(children_1, NAME_ONLY_COMPARATOR, function (namedNode) { return namedNode.name; }, NAME_COMPARATOR);\r\n        if (childrenHavePriority_1) {\r\n            var sortedChildSet = buildChildSet(children_1, PRIORITY_INDEX.getCompare());\r\n            return new ChildrenNode(childSet, nodeFromJSON$1(priority), new IndexMap({ '.priority': sortedChildSet }, { '.priority': PRIORITY_INDEX }));\r\n        }\r\n        else {\r\n            return new ChildrenNode(childSet, nodeFromJSON$1(priority), IndexMap.Default);\r\n        }\r\n    }\r\n    else {\r\n        var node_1 = ChildrenNode.EMPTY_NODE;\r\n        var jsonObj_1 = json;\r\n        forEach(jsonObj_1, function (key, childData) {\r\n            if (contains(jsonObj_1, key)) {\r\n                if (key.substring(0, 1) !== '.') {\r\n                    // ignore metadata nodes.\r\n                    var childNode = nodeFromJSON$1(childData);\r\n                    if (childNode.isLeafNode() || !childNode.isEmpty())\r\n                        node_1 = node_1.updateImmediateChild(key, childNode);\r\n                }\r\n            }\r\n        });\r\n        return node_1.updatePriority(nodeFromJSON$1(priority));\r\n    }\r\n}\r\nsetNodeFromJSON(nodeFromJSON$1);\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @constructor\r\n * @extends {Index}\r\n * @private\r\n */\r\nvar ValueIndex = /** @class */ (function (_super) {\r\n    __extends(ValueIndex, _super);\r\n    function ValueIndex() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ValueIndex.prototype.compare = function (a, b) {\r\n        var indexCmp = a.node.compareTo(b.node);\r\n        if (indexCmp === 0) {\r\n            return nameCompare(a.name, b.name);\r\n        }\r\n        else {\r\n            return indexCmp;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ValueIndex.prototype.isDefinedOn = function (node) {\r\n        return true;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ValueIndex.prototype.indexedValueChanged = function (oldNode, newNode) {\r\n        return !oldNode.equals(newNode);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ValueIndex.prototype.minPost = function () {\r\n        return NamedNode.MIN;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ValueIndex.prototype.maxPost = function () {\r\n        return NamedNode.MAX;\r\n    };\r\n    /**\r\n     * @param {*} indexValue\r\n     * @param {string} name\r\n     * @return {!NamedNode}\r\n     */\r\n    ValueIndex.prototype.makePost = function (indexValue, name) {\r\n        var valueNode = nodeFromJSON$1(indexValue);\r\n        return new NamedNode(name, valueNode);\r\n    };\r\n    /**\r\n     * @return {!string} String representation for inclusion in a query spec\r\n     */\r\n    ValueIndex.prototype.toString = function () {\r\n        return '.value';\r\n    };\r\n    return ValueIndex;\r\n}(Index));\r\nvar VALUE_INDEX = new ValueIndex();\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @param {!Path} indexPath\r\n * @constructor\r\n * @extends {Index}\r\n */\r\nvar PathIndex = /** @class */ (function (_super) {\r\n    __extends(PathIndex, _super);\r\n    function PathIndex(indexPath_) {\r\n        var _this = _super.call(this) || this;\r\n        _this.indexPath_ = indexPath_;\r\n        assert(!indexPath_.isEmpty() && indexPath_.getFront() !== '.priority', \"Can't create PathIndex with empty path or .priority key\");\r\n        return _this;\r\n    }\r\n    /**\r\n     * @param {!Node} snap\r\n     * @return {!Node}\r\n     * @protected\r\n     */\r\n    PathIndex.prototype.extractChild = function (snap) {\r\n        return snap.getChild(this.indexPath_);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PathIndex.prototype.isDefinedOn = function (node) {\r\n        return !node.getChild(this.indexPath_).isEmpty();\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PathIndex.prototype.compare = function (a, b) {\r\n        var aChild = this.extractChild(a.node);\r\n        var bChild = this.extractChild(b.node);\r\n        var indexCmp = aChild.compareTo(bChild);\r\n        if (indexCmp === 0) {\r\n            return nameCompare(a.name, b.name);\r\n        }\r\n        else {\r\n            return indexCmp;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PathIndex.prototype.makePost = function (indexValue, name) {\r\n        var valueNode = nodeFromJSON$1(indexValue);\r\n        var node = ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_, valueNode);\r\n        return new NamedNode(name, node);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PathIndex.prototype.maxPost = function () {\r\n        var node = ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_, MAX_NODE$2);\r\n        return new NamedNode(MAX_NAME, node);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PathIndex.prototype.toString = function () {\r\n        return this.indexPath_.slice().join('/');\r\n    };\r\n    return PathIndex;\r\n}(Index));\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Class representing a firebase data snapshot.  It wraps a SnapshotNode and\r\n * surfaces the public methods (val, forEach, etc.) we want to expose.\r\n */\r\nvar DataSnapshot = /** @class */ (function () {\r\n    /**\r\n     * @param {!Node} node_ A SnapshotNode to wrap.\r\n     * @param {!Reference} ref_ The ref of the location this snapshot came from.\r\n     * @param {!Index} index_ The iteration order for this snapshot\r\n     */\r\n    function DataSnapshot(node_, ref_, index_) {\r\n        this.node_ = node_;\r\n        this.ref_ = ref_;\r\n        this.index_ = index_;\r\n    }\r\n    /**\r\n     * Retrieves the snapshot contents as JSON.  Returns null if the snapshot is\r\n     * empty.\r\n     *\r\n     * @return {*} JSON representation of the DataSnapshot contents, or null if empty.\r\n     */\r\n    DataSnapshot.prototype.val = function () {\r\n        validateArgCount('DataSnapshot.val', 0, 0, arguments.length);\r\n        return this.node_.val();\r\n    };\r\n    /**\r\n     * Returns the snapshot contents as JSON, including priorities of node.  Suitable for exporting\r\n     * the entire node contents.\r\n     * @return {*} JSON representation of the DataSnapshot contents, or null if empty.\r\n     */\r\n    DataSnapshot.prototype.exportVal = function () {\r\n        validateArgCount('DataSnapshot.exportVal', 0, 0, arguments.length);\r\n        return this.node_.val(true);\r\n    };\r\n    // Do not create public documentation. This is intended to make JSON serialization work but is otherwise unnecessary\r\n    // for end-users\r\n    DataSnapshot.prototype.toJSON = function () {\r\n        // Optional spacer argument is unnecessary because we're depending on recursion rather than stringifying the content\r\n        validateArgCount('DataSnapshot.toJSON', 0, 1, arguments.length);\r\n        return this.exportVal();\r\n    };\r\n    /**\r\n     * Returns whether the snapshot contains a non-null value.\r\n     *\r\n     * @return {boolean} Whether the snapshot contains a non-null value, or is empty.\r\n     */\r\n    DataSnapshot.prototype.exists = function () {\r\n        validateArgCount('DataSnapshot.exists', 0, 0, arguments.length);\r\n        return !this.node_.isEmpty();\r\n    };\r\n    /**\r\n     * Returns a DataSnapshot of the specified child node's contents.\r\n     *\r\n     * @param {!string} childPathString Path to a child.\r\n     * @return {!DataSnapshot} DataSnapshot for child node.\r\n     */\r\n    DataSnapshot.prototype.child = function (childPathString) {\r\n        validateArgCount('DataSnapshot.child', 0, 1, arguments.length);\r\n        // Ensure the childPath is a string (can be a number)\r\n        childPathString = String(childPathString);\r\n        validatePathString('DataSnapshot.child', 1, childPathString, false);\r\n        var childPath = new Path(childPathString);\r\n        var childRef = this.ref_.child(childPath);\r\n        return new DataSnapshot(this.node_.getChild(childPath), childRef, PRIORITY_INDEX);\r\n    };\r\n    /**\r\n     * Returns whether the snapshot contains a child at the specified path.\r\n     *\r\n     * @param {!string} childPathString Path to a child.\r\n     * @return {boolean} Whether the child exists.\r\n     */\r\n    DataSnapshot.prototype.hasChild = function (childPathString) {\r\n        validateArgCount('DataSnapshot.hasChild', 1, 1, arguments.length);\r\n        validatePathString('DataSnapshot.hasChild', 1, childPathString, false);\r\n        var childPath = new Path(childPathString);\r\n        return !this.node_.getChild(childPath).isEmpty();\r\n    };\r\n    /**\r\n     * Returns the priority of the object, or null if no priority was set.\r\n     *\r\n     * @return {string|number|null} The priority.\r\n     */\r\n    DataSnapshot.prototype.getPriority = function () {\r\n        validateArgCount('DataSnapshot.getPriority', 0, 0, arguments.length);\r\n        // typecast here because we never return deferred values or internal priorities (MAX_PRIORITY)\r\n        return this.node_.getPriority().val();\r\n    };\r\n    /**\r\n     * Iterates through child nodes and calls the specified action for each one.\r\n     *\r\n     * @param {function(!DataSnapshot)} action Callback function to be called\r\n     * for each child.\r\n     * @return {boolean} True if forEach was canceled by action returning true for\r\n     * one of the child nodes.\r\n     */\r\n    DataSnapshot.prototype.forEach = function (action) {\r\n        var _this = this;\r\n        validateArgCount('DataSnapshot.forEach', 1, 1, arguments.length);\r\n        validateCallback('DataSnapshot.forEach', 1, action, false);\r\n        if (this.node_.isLeafNode())\r\n            return false;\r\n        var childrenNode = this.node_;\r\n        // Sanitize the return value to a boolean. ChildrenNode.forEachChild has a weird return type...\r\n        return !!childrenNode.forEachChild(this.index_, function (key, node) {\r\n            return action(new DataSnapshot(node, _this.ref_.child(key), PRIORITY_INDEX));\r\n        });\r\n    };\r\n    /**\r\n     * Returns whether this DataSnapshot has children.\r\n     * @return {boolean} True if the DataSnapshot contains 1 or more child nodes.\r\n     */\r\n    DataSnapshot.prototype.hasChildren = function () {\r\n        validateArgCount('DataSnapshot.hasChildren', 0, 0, arguments.length);\r\n        if (this.node_.isLeafNode())\r\n            return false;\r\n        else\r\n            return !this.node_.isEmpty();\r\n    };\r\n    Object.defineProperty(DataSnapshot.prototype, \"key\", {\r\n        get: function () {\r\n            return this.ref_.getKey();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Returns the number of children for this DataSnapshot.\r\n     * @return {number} The number of children that this DataSnapshot contains.\r\n     */\r\n    DataSnapshot.prototype.numChildren = function () {\r\n        validateArgCount('DataSnapshot.numChildren', 0, 0, arguments.length);\r\n        return this.node_.numChildren();\r\n    };\r\n    /**\r\n     * @return {Reference} The Firebase reference for the location this snapshot's data came from.\r\n     */\r\n    DataSnapshot.prototype.getRef = function () {\r\n        validateArgCount('DataSnapshot.ref', 0, 0, arguments.length);\r\n        return this.ref_;\r\n    };\r\n    Object.defineProperty(DataSnapshot.prototype, \"ref\", {\r\n        get: function () {\r\n            return this.getRef();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return DataSnapshot;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Encapsulates the data needed to raise an event\r\n * @implements {Event}\r\n */\r\nvar DataEvent = /** @class */ (function () {\r\n    /**\r\n     * @param {!string} eventType One of: value, child_added, child_changed, child_moved, child_removed\r\n     * @param {!EventRegistration} eventRegistration The function to call to with the event data. User provided\r\n     * @param {!DataSnapshot} snapshot The data backing the event\r\n     * @param {?string=} prevName Optional, the name of the previous child for child_* events.\r\n     */\r\n    function DataEvent(eventType, eventRegistration, snapshot, prevName) {\r\n        this.eventType = eventType;\r\n        this.eventRegistration = eventRegistration;\r\n        this.snapshot = snapshot;\r\n        this.prevName = prevName;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    DataEvent.prototype.getPath = function () {\r\n        var ref = this.snapshot.getRef();\r\n        if (this.eventType === 'value') {\r\n            return ref.path;\r\n        }\r\n        else {\r\n            return ref.getParent().path;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    DataEvent.prototype.getEventType = function () {\r\n        return this.eventType;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    DataEvent.prototype.getEventRunner = function () {\r\n        return this.eventRegistration.getEventRunner(this);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    DataEvent.prototype.toString = function () {\r\n        return (this.getPath().toString() +\r\n            ':' +\r\n            this.eventType +\r\n            ':' +\r\n            stringify(this.snapshot.exportVal()));\r\n    };\r\n    return DataEvent;\r\n}());\r\nvar CancelEvent = /** @class */ (function () {\r\n    /**\r\n     * @param {EventRegistration} eventRegistration\r\n     * @param {Error} error\r\n     * @param {!Path} path\r\n     */\r\n    function CancelEvent(eventRegistration, error, path) {\r\n        this.eventRegistration = eventRegistration;\r\n        this.error = error;\r\n        this.path = path;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    CancelEvent.prototype.getPath = function () {\r\n        return this.path;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    CancelEvent.prototype.getEventType = function () {\r\n        return 'cancel';\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    CancelEvent.prototype.getEventRunner = function () {\r\n        return this.eventRegistration.getEventRunner(this);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    CancelEvent.prototype.toString = function () {\r\n        return this.path.toString() + ':cancel';\r\n    };\r\n    return CancelEvent;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Represents registration for 'value' events.\r\n */\r\nvar ValueEventRegistration = /** @class */ (function () {\r\n    /**\r\n     * @param {?function(!DataSnapshot)} callback_\r\n     * @param {?function(Error)} cancelCallback_\r\n     * @param {?Object} context_\r\n     */\r\n    function ValueEventRegistration(callback_, cancelCallback_, context_) {\r\n        this.callback_ = callback_;\r\n        this.cancelCallback_ = cancelCallback_;\r\n        this.context_ = context_;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ValueEventRegistration.prototype.respondsTo = function (eventType) {\r\n        return eventType === 'value';\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ValueEventRegistration.prototype.createEvent = function (change, query) {\r\n        var index = query.getQueryParams().getIndex();\r\n        return new DataEvent('value', this, new DataSnapshot(change.snapshotNode, query.getRef(), index));\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ValueEventRegistration.prototype.getEventRunner = function (eventData) {\r\n        var ctx = this.context_;\r\n        if (eventData.getEventType() === 'cancel') {\r\n            assert(this.cancelCallback_, 'Raising a cancel event on a listener with no cancel callback');\r\n            var cancelCB_1 = this.cancelCallback_;\r\n            return function () {\r\n                // We know that error exists, we checked above that this is a cancel event\r\n                cancelCB_1.call(ctx, eventData.error);\r\n            };\r\n        }\r\n        else {\r\n            var cb_1 = this.callback_;\r\n            return function () {\r\n                cb_1.call(ctx, eventData.snapshot);\r\n            };\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ValueEventRegistration.prototype.createCancelEvent = function (error, path) {\r\n        if (this.cancelCallback_) {\r\n            return new CancelEvent(this, error, path);\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ValueEventRegistration.prototype.matches = function (other) {\r\n        if (!(other instanceof ValueEventRegistration)) {\r\n            return false;\r\n        }\r\n        else if (!other.callback_ || !this.callback_) {\r\n            // If no callback specified, we consider it to match any callback.\r\n            return true;\r\n        }\r\n        else {\r\n            return (other.callback_ === this.callback_ && other.context_ === this.context_);\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ValueEventRegistration.prototype.hasAnyCallback = function () {\r\n        return this.callback_ !== null;\r\n    };\r\n    return ValueEventRegistration;\r\n}());\r\n/**\r\n * Represents the registration of 1 or more child_xxx events.\r\n *\r\n * Currently, it is always exactly 1 child_xxx event, but the idea is we might let you\r\n * register a group of callbacks together in the future.\r\n *\r\n * @constructor\r\n * @implements {EventRegistration}\r\n */\r\nvar ChildEventRegistration = /** @class */ (function () {\r\n    /**\r\n     * @param {?Object.<string, function(!DataSnapshot, ?string=)>} callbacks_\r\n     * @param {?function(Error)} cancelCallback_\r\n     * @param {Object=} context_\r\n     */\r\n    function ChildEventRegistration(callbacks_, cancelCallback_, context_) {\r\n        this.callbacks_ = callbacks_;\r\n        this.cancelCallback_ = cancelCallback_;\r\n        this.context_ = context_;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ChildEventRegistration.prototype.respondsTo = function (eventType) {\r\n        var eventToCheck = eventType === 'children_added' ? 'child_added' : eventType;\r\n        eventToCheck =\r\n            eventToCheck === 'children_removed' ? 'child_removed' : eventToCheck;\r\n        return contains(this.callbacks_, eventToCheck);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ChildEventRegistration.prototype.createCancelEvent = function (error, path) {\r\n        if (this.cancelCallback_) {\r\n            return new CancelEvent(this, error, path);\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ChildEventRegistration.prototype.createEvent = function (change, query) {\r\n        assert(change.childName != null, 'Child events should have a childName.');\r\n        var ref = query.getRef().child(/** @type {!string} */ (change.childName));\r\n        var index = query.getQueryParams().getIndex();\r\n        return new DataEvent(change.type, this, new DataSnapshot(change.snapshotNode, ref, index), change.prevName);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ChildEventRegistration.prototype.getEventRunner = function (eventData) {\r\n        var ctx = this.context_;\r\n        if (eventData.getEventType() === 'cancel') {\r\n            assert(this.cancelCallback_, 'Raising a cancel event on a listener with no cancel callback');\r\n            var cancelCB_2 = this.cancelCallback_;\r\n            return function () {\r\n                // We know that error exists, we checked above that this is a cancel event\r\n                cancelCB_2.call(ctx, eventData.error);\r\n            };\r\n        }\r\n        else {\r\n            var cb_2 = this.callbacks_[eventData.eventType];\r\n            return function () {\r\n                cb_2.call(ctx, eventData.snapshot, eventData.prevName);\r\n            };\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ChildEventRegistration.prototype.matches = function (other) {\r\n        if (other instanceof ChildEventRegistration) {\r\n            if (!this.callbacks_ || !other.callbacks_) {\r\n                return true;\r\n            }\r\n            else if (this.context_ === other.context_) {\r\n                var otherCount = getCount(other.callbacks_);\r\n                var thisCount = getCount(this.callbacks_);\r\n                if (otherCount === thisCount) {\r\n                    // If count is 1, do an exact match on eventType, if either is defined but null, it's a match.\r\n                    //  If event types don't match, not a match\r\n                    // If count is not 1, exact match across all\r\n                    if (otherCount === 1) {\r\n                        var otherKey /** @type {!string} */ = getAnyKey(other.callbacks_);\r\n                        var thisKey /** @type {!string} */ = getAnyKey(this.callbacks_);\r\n                        return (thisKey === otherKey &&\r\n                            (!other.callbacks_[otherKey] ||\r\n                                !this.callbacks_[thisKey] ||\r\n                                other.callbacks_[otherKey] === this.callbacks_[thisKey]));\r\n                    }\r\n                    else {\r\n                        // Exact match on each key.\r\n                        return every(this.callbacks_, function (eventType, cb) { return other.callbacks_[eventType] === cb; });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    ChildEventRegistration.prototype.hasAnyCallback = function () {\r\n        return this.callbacks_ !== null;\r\n    };\r\n    return ChildEventRegistration;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar __referenceConstructor;\r\n/**\r\n * A Query represents a filter to be applied to a firebase location.  This object purely represents the\r\n * query expression (and exposes our public API to build the query).  The actual query logic is in ViewBase.js.\r\n *\r\n * Since every Firebase reference is a query, Firebase inherits from this object.\r\n */\r\nvar Query = /** @class */ (function () {\r\n    function Query(repo, path, queryParams_, orderByCalled_) {\r\n        this.repo = repo;\r\n        this.path = path;\r\n        this.queryParams_ = queryParams_;\r\n        this.orderByCalled_ = orderByCalled_;\r\n    }\r\n    Object.defineProperty(Query, \"__referenceConstructor\", {\r\n        get: function () {\r\n            assert(__referenceConstructor, 'Reference.ts has not been loaded');\r\n            return __referenceConstructor;\r\n        },\r\n        set: function (val) {\r\n            __referenceConstructor = val;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Validates start/end values for queries.\r\n     * @param {!QueryParams} params\r\n     * @private\r\n     */\r\n    Query.validateQueryEndpoints_ = function (params) {\r\n        var startNode = null;\r\n        var endNode = null;\r\n        if (params.hasStart()) {\r\n            startNode = params.getIndexStartValue();\r\n        }\r\n        if (params.hasEnd()) {\r\n            endNode = params.getIndexEndValue();\r\n        }\r\n        if (params.getIndex() === KEY_INDEX) {\r\n            var tooManyArgsError = 'Query: When ordering by key, you may only pass one argument to ' +\r\n                'startAt(), endAt(), or equalTo().';\r\n            var wrongArgTypeError = 'Query: When ordering by key, the argument passed to startAt(), endAt(),' +\r\n                'or equalTo() must be a string.';\r\n            if (params.hasStart()) {\r\n                var startName = params.getIndexStartName();\r\n                if (startName != MIN_NAME) {\r\n                    throw new Error(tooManyArgsError);\r\n                }\r\n                else if (typeof startNode !== 'string') {\r\n                    throw new Error(wrongArgTypeError);\r\n                }\r\n            }\r\n            if (params.hasEnd()) {\r\n                var endName = params.getIndexEndName();\r\n                if (endName != MAX_NAME) {\r\n                    throw new Error(tooManyArgsError);\r\n                }\r\n                else if (typeof endNode !== 'string') {\r\n                    throw new Error(wrongArgTypeError);\r\n                }\r\n            }\r\n        }\r\n        else if (params.getIndex() === PRIORITY_INDEX) {\r\n            if ((startNode != null && !isValidPriority(startNode)) ||\r\n                (endNode != null && !isValidPriority(endNode))) {\r\n                throw new Error('Query: When ordering by priority, the first argument passed to startAt(), ' +\r\n                    'endAt(), or equalTo() must be a valid priority value (null, a number, or a string).');\r\n            }\r\n        }\r\n        else {\r\n            assert(params.getIndex() instanceof PathIndex ||\r\n                params.getIndex() === VALUE_INDEX, 'unknown index type.');\r\n            if ((startNode != null && typeof startNode === 'object') ||\r\n                (endNode != null && typeof endNode === 'object')) {\r\n                throw new Error('Query: First argument passed to startAt(), endAt(), or equalTo() cannot be ' +\r\n                    'an object.');\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Validates that limit* has been called with the correct combination of parameters\r\n     * @param {!QueryParams} params\r\n     * @private\r\n     */\r\n    Query.validateLimit_ = function (params) {\r\n        if (params.hasStart() &&\r\n            params.hasEnd() &&\r\n            params.hasLimit() &&\r\n            !params.hasAnchoredLimit()) {\r\n            throw new Error(\"Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.\");\r\n        }\r\n    };\r\n    /**\r\n     * Validates that no other order by call has been made\r\n     * @param {!string} fnName\r\n     * @private\r\n     */\r\n    Query.prototype.validateNoPreviousOrderByCall_ = function (fnName) {\r\n        if (this.orderByCalled_ === true) {\r\n            throw new Error(fnName + \": You can't combine multiple orderBy calls.\");\r\n        }\r\n    };\r\n    /**\r\n     * @return {!QueryParams}\r\n     */\r\n    Query.prototype.getQueryParams = function () {\r\n        return this.queryParams_;\r\n    };\r\n    /**\r\n     * @return {!Reference}\r\n     */\r\n    Query.prototype.getRef = function () {\r\n        validateArgCount('Query.ref', 0, 0, arguments.length);\r\n        // This is a slight hack. We cannot goog.require('fb.api.Firebase'), since Firebase requires fb.api.Query.\r\n        // However, we will always export 'Firebase' to the global namespace, so it's guaranteed to exist by the time this\r\n        // method gets called.\r\n        return new Query.__referenceConstructor(this.repo, this.path);\r\n    };\r\n    /**\r\n     * @param {!string} eventType\r\n     * @param {!function(DataSnapshot, string=)} callback\r\n     * @param {(function(Error)|Object)=} cancelCallbackOrContext\r\n     * @param {Object=} context\r\n     * @return {!function(DataSnapshot, string=)}\r\n     */\r\n    Query.prototype.on = function (eventType, callback, cancelCallbackOrContext, context) {\r\n        validateArgCount('Query.on', 2, 4, arguments.length);\r\n        validateEventType('Query.on', 1, eventType, false);\r\n        validateCallback('Query.on', 2, callback, false);\r\n        var ret = Query.getCancelAndContextArgs_('Query.on', cancelCallbackOrContext, context);\r\n        if (eventType === 'value') {\r\n            this.onValueEvent(callback, ret.cancel, ret.context);\r\n        }\r\n        else {\r\n            var callbacks = {};\r\n            callbacks[eventType] = callback;\r\n            this.onChildEvent(callbacks, ret.cancel, ret.context);\r\n        }\r\n        return callback;\r\n    };\r\n    /**\r\n     * @param {!function(!DataSnapshot)} callback\r\n     * @param {?function(Error)} cancelCallback\r\n     * @param {?Object} context\r\n     * @protected\r\n     */\r\n    Query.prototype.onValueEvent = function (callback, cancelCallback, context) {\r\n        var container = new ValueEventRegistration(callback, cancelCallback || null, context || null);\r\n        this.repo.addEventCallbackForQuery(this, container);\r\n    };\r\n    /**\r\n     * @param {!Object.<string, !function(!DataSnapshot, ?string)>} callbacks\r\n     * @param {?function(Error)} cancelCallback\r\n     * @param {?Object} context\r\n     * @protected\r\n     */\r\n    Query.prototype.onChildEvent = function (callbacks, cancelCallback, context) {\r\n        var container = new ChildEventRegistration(callbacks, cancelCallback, context);\r\n        this.repo.addEventCallbackForQuery(this, container);\r\n    };\r\n    /**\r\n     * @param {string=} eventType\r\n     * @param {(function(!DataSnapshot, ?string=))=} callback\r\n     * @param {Object=} context\r\n     */\r\n    Query.prototype.off = function (eventType, callback, context) {\r\n        validateArgCount('Query.off', 0, 3, arguments.length);\r\n        validateEventType('Query.off', 1, eventType, true);\r\n        validateCallback('Query.off', 2, callback, true);\r\n        validateContextObject('Query.off', 3, context, true);\r\n        var container = null;\r\n        var callbacks = null;\r\n        if (eventType === 'value') {\r\n            var valueCallback = callback || null;\r\n            container = new ValueEventRegistration(valueCallback, null, context || null);\r\n        }\r\n        else if (eventType) {\r\n            if (callback) {\r\n                callbacks = {};\r\n                callbacks[eventType] = callback;\r\n            }\r\n            container = new ChildEventRegistration(callbacks, null, context || null);\r\n        }\r\n        this.repo.removeEventCallbackForQuery(this, container);\r\n    };\r\n    /**\r\n     * Attaches a listener, waits for the first event, and then removes the listener\r\n     * @param {!string} eventType\r\n     * @param {!function(!DataSnapshot, string=)} userCallback\r\n     * @param cancelOrContext\r\n     * @param context\r\n     * @return {!firebase.Promise}\r\n     */\r\n    Query.prototype.once = function (eventType, userCallback, cancelOrContext, context) {\r\n        var _this = this;\r\n        validateArgCount('Query.once', 1, 4, arguments.length);\r\n        validateEventType('Query.once', 1, eventType, false);\r\n        validateCallback('Query.once', 2, userCallback, true);\r\n        var ret = Query.getCancelAndContextArgs_('Query.once', cancelOrContext, context);\r\n        // TODO: Implement this more efficiently (in particular, use 'get' wire protocol for 'value' event)\r\n        // TODO: consider actually wiring the callbacks into the promise. We cannot do this without a breaking change\r\n        // because the API currently expects callbacks will be called synchronously if the data is cached, but this is\r\n        // against the Promise specification.\r\n        var firstCall = true;\r\n        var deferred = new Deferred();\r\n        // A dummy error handler in case a user wasn't expecting promises\r\n        deferred.promise.catch(function () { });\r\n        var onceCallback = function (snapshot) {\r\n            // NOTE: Even though we unsubscribe, we may get called multiple times if a single action (e.g. set() with JSON)\r\n            // triggers multiple events (e.g. child_added or child_changed).\r\n            if (firstCall) {\r\n                firstCall = false;\r\n                _this.off(eventType, onceCallback);\r\n                if (userCallback) {\r\n                    userCallback.bind(ret.context)(snapshot);\r\n                }\r\n                deferred.resolve(snapshot);\r\n            }\r\n        };\r\n        this.on(eventType, onceCallback, \r\n        /*cancel=*/ function (err) {\r\n            _this.off(eventType, onceCallback);\r\n            if (ret.cancel)\r\n                ret.cancel.bind(ret.context)(err);\r\n            deferred.reject(err);\r\n        });\r\n        return deferred.promise;\r\n    };\r\n    /**\r\n     * Set a limit and anchor it to the start of the window.\r\n     * @param {!number} limit\r\n     * @return {!Query}\r\n     */\r\n    Query.prototype.limitToFirst = function (limit) {\r\n        validateArgCount('Query.limitToFirst', 1, 1, arguments.length);\r\n        if (typeof limit !== 'number' ||\r\n            Math.floor(limit) !== limit ||\r\n            limit <= 0) {\r\n            throw new Error('Query.limitToFirst: First argument must be a positive integer.');\r\n        }\r\n        if (this.queryParams_.hasLimit()) {\r\n            throw new Error('Query.limitToFirst: Limit was already set (by another call to limit, ' +\r\n                'limitToFirst, or limitToLast).');\r\n        }\r\n        return new Query(this.repo, this.path, this.queryParams_.limitToFirst(limit), this.orderByCalled_);\r\n    };\r\n    /**\r\n     * Set a limit and anchor it to the end of the window.\r\n     * @param {!number} limit\r\n     * @return {!Query}\r\n     */\r\n    Query.prototype.limitToLast = function (limit) {\r\n        validateArgCount('Query.limitToLast', 1, 1, arguments.length);\r\n        if (typeof limit !== 'number' ||\r\n            Math.floor(limit) !== limit ||\r\n            limit <= 0) {\r\n            throw new Error('Query.limitToLast: First argument must be a positive integer.');\r\n        }\r\n        if (this.queryParams_.hasLimit()) {\r\n            throw new Error('Query.limitToLast: Limit was already set (by another call to limit, ' +\r\n                'limitToFirst, or limitToLast).');\r\n        }\r\n        return new Query(this.repo, this.path, this.queryParams_.limitToLast(limit), this.orderByCalled_);\r\n    };\r\n    /**\r\n     * Given a child path, return a new query ordered by the specified grandchild path.\r\n     * @param {!string} path\r\n     * @return {!Query}\r\n     */\r\n    Query.prototype.orderByChild = function (path) {\r\n        validateArgCount('Query.orderByChild', 1, 1, arguments.length);\r\n        if (path === '$key') {\r\n            throw new Error('Query.orderByChild: \"$key\" is invalid.  Use Query.orderByKey() instead.');\r\n        }\r\n        else if (path === '$priority') {\r\n            throw new Error('Query.orderByChild: \"$priority\" is invalid.  Use Query.orderByPriority() instead.');\r\n        }\r\n        else if (path === '$value') {\r\n            throw new Error('Query.orderByChild: \"$value\" is invalid.  Use Query.orderByValue() instead.');\r\n        }\r\n        validatePathString('Query.orderByChild', 1, path, false);\r\n        this.validateNoPreviousOrderByCall_('Query.orderByChild');\r\n        var parsedPath = new Path(path);\r\n        if (parsedPath.isEmpty()) {\r\n            throw new Error('Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.');\r\n        }\r\n        var index = new PathIndex(parsedPath);\r\n        var newParams = this.queryParams_.orderBy(index);\r\n        Query.validateQueryEndpoints_(newParams);\r\n        return new Query(this.repo, this.path, newParams, /*orderByCalled=*/ true);\r\n    };\r\n    /**\r\n     * Return a new query ordered by the KeyIndex\r\n     * @return {!Query}\r\n     */\r\n    Query.prototype.orderByKey = function () {\r\n        validateArgCount('Query.orderByKey', 0, 0, arguments.length);\r\n        this.validateNoPreviousOrderByCall_('Query.orderByKey');\r\n        var newParams = this.queryParams_.orderBy(KEY_INDEX);\r\n        Query.validateQueryEndpoints_(newParams);\r\n        return new Query(this.repo, this.path, newParams, /*orderByCalled=*/ true);\r\n    };\r\n    /**\r\n     * Return a new query ordered by the PriorityIndex\r\n     * @return {!Query}\r\n     */\r\n    Query.prototype.orderByPriority = function () {\r\n        validateArgCount('Query.orderByPriority', 0, 0, arguments.length);\r\n        this.validateNoPreviousOrderByCall_('Query.orderByPriority');\r\n        var newParams = this.queryParams_.orderBy(PRIORITY_INDEX);\r\n        Query.validateQueryEndpoints_(newParams);\r\n        return new Query(this.repo, this.path, newParams, /*orderByCalled=*/ true);\r\n    };\r\n    /**\r\n     * Return a new query ordered by the ValueIndex\r\n     * @return {!Query}\r\n     */\r\n    Query.prototype.orderByValue = function () {\r\n        validateArgCount('Query.orderByValue', 0, 0, arguments.length);\r\n        this.validateNoPreviousOrderByCall_('Query.orderByValue');\r\n        var newParams = this.queryParams_.orderBy(VALUE_INDEX);\r\n        Query.validateQueryEndpoints_(newParams);\r\n        return new Query(this.repo, this.path, newParams, /*orderByCalled=*/ true);\r\n    };\r\n    /**\r\n     * @param {number|string|boolean|null} value\r\n     * @param {?string=} name\r\n     * @return {!Query}\r\n     */\r\n    Query.prototype.startAt = function (value, name) {\r\n        if (value === void 0) { value = null; }\r\n        validateArgCount('Query.startAt', 0, 2, arguments.length);\r\n        validateFirebaseDataArg('Query.startAt', 1, value, this.path, true);\r\n        validateKey('Query.startAt', 2, name, true);\r\n        var newParams = this.queryParams_.startAt(value, name);\r\n        Query.validateLimit_(newParams);\r\n        Query.validateQueryEndpoints_(newParams);\r\n        if (this.queryParams_.hasStart()) {\r\n            throw new Error('Query.startAt: Starting point was already set (by another call to startAt ' +\r\n                'or equalTo).');\r\n        }\r\n        // Calling with no params tells us to start at the beginning.\r\n        if (value === undefined) {\r\n            value = null;\r\n            name = null;\r\n        }\r\n        return new Query(this.repo, this.path, newParams, this.orderByCalled_);\r\n    };\r\n    /**\r\n     * @param {number|string|boolean|null} value\r\n     * @param {?string=} name\r\n     * @return {!Query}\r\n     */\r\n    Query.prototype.endAt = function (value, name) {\r\n        if (value === void 0) { value = null; }\r\n        validateArgCount('Query.endAt', 0, 2, arguments.length);\r\n        validateFirebaseDataArg('Query.endAt', 1, value, this.path, true);\r\n        validateKey('Query.endAt', 2, name, true);\r\n        var newParams = this.queryParams_.endAt(value, name);\r\n        Query.validateLimit_(newParams);\r\n        Query.validateQueryEndpoints_(newParams);\r\n        if (this.queryParams_.hasEnd()) {\r\n            throw new Error('Query.endAt: Ending point was already set (by another call to endAt or ' +\r\n                'equalTo).');\r\n        }\r\n        return new Query(this.repo, this.path, newParams, this.orderByCalled_);\r\n    };\r\n    /**\r\n     * Load the selection of children with exactly the specified value, and, optionally,\r\n     * the specified name.\r\n     * @param {number|string|boolean|null} value\r\n     * @param {string=} name\r\n     * @return {!Query}\r\n     */\r\n    Query.prototype.equalTo = function (value, name) {\r\n        validateArgCount('Query.equalTo', 1, 2, arguments.length);\r\n        validateFirebaseDataArg('Query.equalTo', 1, value, this.path, false);\r\n        validateKey('Query.equalTo', 2, name, true);\r\n        if (this.queryParams_.hasStart()) {\r\n            throw new Error('Query.equalTo: Starting point was already set (by another call to startAt or ' +\r\n                'equalTo).');\r\n        }\r\n        if (this.queryParams_.hasEnd()) {\r\n            throw new Error('Query.equalTo: Ending point was already set (by another call to endAt or ' +\r\n                'equalTo).');\r\n        }\r\n        return this.startAt(value, name).endAt(value, name);\r\n    };\r\n    /**\r\n     * @return {!string} URL for this location.\r\n     */\r\n    Query.prototype.toString = function () {\r\n        validateArgCount('Query.toString', 0, 0, arguments.length);\r\n        return this.repo.toString() + this.path.toUrlEncodedString();\r\n    };\r\n    // Do not create public documentation. This is intended to make JSON serialization work but is otherwise unnecessary\r\n    // for end-users.\r\n    Query.prototype.toJSON = function () {\r\n        // An optional spacer argument is unnecessary for a string.\r\n        validateArgCount('Query.toJSON', 0, 1, arguments.length);\r\n        return this.toString();\r\n    };\r\n    /**\r\n     * An object representation of the query parameters used by this Query.\r\n     * @return {!Object}\r\n     */\r\n    Query.prototype.queryObject = function () {\r\n        return this.queryParams_.getQueryObject();\r\n    };\r\n    /**\r\n     * @return {!string}\r\n     */\r\n    Query.prototype.queryIdentifier = function () {\r\n        var obj = this.queryObject();\r\n        var id = ObjectToUniqueKey(obj);\r\n        return id === '{}' ? 'default' : id;\r\n    };\r\n    /**\r\n     * Return true if this query and the provided query are equivalent; otherwise, return false.\r\n     * @param {Query} other\r\n     * @return {boolean}\r\n     */\r\n    Query.prototype.isEqual = function (other) {\r\n        validateArgCount('Query.isEqual', 1, 1, arguments.length);\r\n        if (!(other instanceof Query)) {\r\n            var error$$1 = 'Query.isEqual failed: First argument must be an instance of firebase.database.Query.';\r\n            throw new Error(error$$1);\r\n        }\r\n        var sameRepo = this.repo === other.repo;\r\n        var samePath = this.path.equals(other.path);\r\n        var sameQueryIdentifier = this.queryIdentifier() === other.queryIdentifier();\r\n        return sameRepo && samePath && sameQueryIdentifier;\r\n    };\r\n    /**\r\n     * Helper used by .on and .once to extract the context and or cancel arguments.\r\n     * @param {!string} fnName The function name (on or once)\r\n     * @param {(function(Error)|Object)=} cancelOrContext\r\n     * @param {Object=} context\r\n     * @return {{cancel: ?function(Error), context: ?Object}}\r\n     * @private\r\n     */\r\n    Query.getCancelAndContextArgs_ = function (fnName, cancelOrContext, context) {\r\n        var ret = { cancel: null, context: null };\r\n        if (cancelOrContext && context) {\r\n            ret.cancel = cancelOrContext;\r\n            validateCallback(fnName, 3, ret.cancel, true);\r\n            ret.context = context;\r\n            validateContextObject(fnName, 4, ret.context, true);\r\n        }\r\n        else if (cancelOrContext) {\r\n            // we have either a cancel callback or a context.\r\n            if (typeof cancelOrContext === 'object' && cancelOrContext !== null) {\r\n                // it's a context!\r\n                ret.context = cancelOrContext;\r\n            }\r\n            else if (typeof cancelOrContext === 'function') {\r\n                ret.cancel = cancelOrContext;\r\n            }\r\n            else {\r\n                throw new Error(errorPrefix(fnName, 3, true) +\r\n                    ' must either be a cancel callback or a context object.');\r\n            }\r\n        }\r\n        return ret;\r\n    };\r\n    Object.defineProperty(Query.prototype, \"ref\", {\r\n        get: function () {\r\n            return this.getRef();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return Query;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Implements a set with a count of elements.\r\n *\r\n * @template K, V\r\n */\r\nvar CountedSet = /** @class */ (function () {\r\n    function CountedSet() {\r\n        this.set = {};\r\n    }\r\n    /**\r\n     * @param {!K} item\r\n     * @param {V} val\r\n     */\r\n    CountedSet.prototype.add = function (item, val) {\r\n        this.set[item] = val !== null ? val : true;\r\n    };\r\n    /**\r\n     * @param {!K} key\r\n     * @return {boolean}\r\n     */\r\n    CountedSet.prototype.contains = function (key) {\r\n        return contains(this.set, key);\r\n    };\r\n    /**\r\n     * @param {!K} item\r\n     * @return {V}\r\n     */\r\n    CountedSet.prototype.get = function (item) {\r\n        return this.contains(item) ? this.set[item] : undefined;\r\n    };\r\n    /**\r\n     * @param {!K} item\r\n     */\r\n    CountedSet.prototype.remove = function (item) {\r\n        delete this.set[item];\r\n    };\r\n    /**\r\n     * Deletes everything in the set\r\n     */\r\n    CountedSet.prototype.clear = function () {\r\n        this.set = {};\r\n    };\r\n    /**\r\n     * True if there's nothing in the set\r\n     * @return {boolean}\r\n     */\r\n    CountedSet.prototype.isEmpty = function () {\r\n        return isEmpty(this.set);\r\n    };\r\n    /**\r\n     * @return {number} The number of items in the set\r\n     */\r\n    CountedSet.prototype.count = function () {\r\n        return getCount(this.set);\r\n    };\r\n    /**\r\n     * Run a function on each k,v pair in the set\r\n     * @param {function(K, V)} fn\r\n     */\r\n    CountedSet.prototype.each = function (fn) {\r\n        forEach(this.set, function (k, v) { return fn(k, v); });\r\n    };\r\n    /**\r\n     * Mostly for debugging\r\n     * @return {Array.<K>} The keys present in this CountedSet\r\n     */\r\n    CountedSet.prototype.keys = function () {\r\n        var keys = [];\r\n        forEach(this.set, function (k) {\r\n            keys.push(k);\r\n        });\r\n        return keys;\r\n    };\r\n    return CountedSet;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Helper class to store a sparse set of snapshots.\r\n *\r\n * @constructor\r\n */\r\nvar SparseSnapshotTree = /** @class */ (function () {\r\n    function SparseSnapshotTree() {\r\n        /**\r\n         * @private\r\n         * @type {Node}\r\n         */\r\n        this.value_ = null;\r\n        /**\r\n         * @private\r\n         * @type {CountedSet}\r\n         */\r\n        this.children_ = null;\r\n    }\r\n    /**\r\n     * Gets the node stored at the given path if one exists.\r\n     *\r\n     * @param {!Path} path Path to look up snapshot for.\r\n     * @return {?Node} The retrieved node, or null.\r\n     */\r\n    SparseSnapshotTree.prototype.find = function (path) {\r\n        if (this.value_ != null) {\r\n            return this.value_.getChild(path);\r\n        }\r\n        else if (!path.isEmpty() && this.children_ != null) {\r\n            var childKey = path.getFront();\r\n            path = path.popFront();\r\n            if (this.children_.contains(childKey)) {\r\n                var childTree = this.children_.get(childKey);\r\n                return childTree.find(path);\r\n            }\r\n            else {\r\n                return null;\r\n            }\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    };\r\n    /**\r\n     * Stores the given node at the specified path. If there is already a node\r\n     * at a shallower path, it merges the new data into that snapshot node.\r\n     *\r\n     * @param {!Path} path Path to look up snapshot for.\r\n     * @param {!Node} data The new data, or null.\r\n     */\r\n    SparseSnapshotTree.prototype.remember = function (path, data) {\r\n        if (path.isEmpty()) {\r\n            this.value_ = data;\r\n            this.children_ = null;\r\n        }\r\n        else if (this.value_ !== null) {\r\n            this.value_ = this.value_.updateChild(path, data);\r\n        }\r\n        else {\r\n            if (this.children_ == null) {\r\n                this.children_ = new CountedSet();\r\n            }\r\n            var childKey = path.getFront();\r\n            if (!this.children_.contains(childKey)) {\r\n                this.children_.add(childKey, new SparseSnapshotTree());\r\n            }\r\n            var child = this.children_.get(childKey);\r\n            path = path.popFront();\r\n            child.remember(path, data);\r\n        }\r\n    };\r\n    /**\r\n     * Purge the data at path from the cache.\r\n     *\r\n     * @param {!Path} path Path to look up snapshot for.\r\n     * @return {boolean} True if this node should now be removed.\r\n     */\r\n    SparseSnapshotTree.prototype.forget = function (path) {\r\n        if (path.isEmpty()) {\r\n            this.value_ = null;\r\n            this.children_ = null;\r\n            return true;\r\n        }\r\n        else {\r\n            if (this.value_ !== null) {\r\n                if (this.value_.isLeafNode()) {\r\n                    // We're trying to forget a node that doesn't exist\r\n                    return false;\r\n                }\r\n                else {\r\n                    var value = this.value_;\r\n                    this.value_ = null;\r\n                    var self_1 = this;\r\n                    value.forEachChild(PRIORITY_INDEX, function (key, tree) {\r\n                        self_1.remember(new Path(key), tree);\r\n                    });\r\n                    return this.forget(path);\r\n                }\r\n            }\r\n            else if (this.children_ !== null) {\r\n                var childKey = path.getFront();\r\n                path = path.popFront();\r\n                if (this.children_.contains(childKey)) {\r\n                    var safeToRemove = this.children_.get(childKey).forget(path);\r\n                    if (safeToRemove) {\r\n                        this.children_.remove(childKey);\r\n                    }\r\n                }\r\n                if (this.children_.isEmpty()) {\r\n                    this.children_ = null;\r\n                    return true;\r\n                }\r\n                else {\r\n                    return false;\r\n                }\r\n            }\r\n            else {\r\n                return true;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Recursively iterates through all of the stored tree and calls the\r\n     * callback on each one.\r\n     *\r\n     * @param {!Path} prefixPath Path to look up node for.\r\n     * @param {!Function} func The function to invoke for each tree.\r\n     */\r\n    SparseSnapshotTree.prototype.forEachTree = function (prefixPath, func) {\r\n        if (this.value_ !== null) {\r\n            func(prefixPath, this.value_);\r\n        }\r\n        else {\r\n            this.forEachChild(function (key, tree) {\r\n                var path = new Path(prefixPath.toString() + '/' + key);\r\n                tree.forEachTree(path, func);\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * Iterates through each immediate child and triggers the callback.\r\n     *\r\n     * @param {!Function} func The function to invoke for each child.\r\n     */\r\n    SparseSnapshotTree.prototype.forEachChild = function (func) {\r\n        if (this.children_ !== null) {\r\n            this.children_.each(function (key, tree) {\r\n                func(key, tree);\r\n            });\r\n        }\r\n    };\r\n    return SparseSnapshotTree;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Generate placeholders for deferred values.\r\n * @param {?Object} values\r\n * @return {!Object}\r\n */\r\nvar generateWithValues = function (values) {\r\n    values = values || {};\r\n    values['timestamp'] = values['timestamp'] || new Date().getTime();\r\n    return values;\r\n};\r\n/**\r\n * Value to use when firing local events. When writing server values, fire\r\n * local events with an approximate value, otherwise return value as-is.\r\n * @param {(Object|string|number|boolean)} value\r\n * @param {!Object} serverValues\r\n * @return {!(string|number|boolean)}\r\n */\r\nvar resolveDeferredValue = function (value, serverValues) {\r\n    if (!value || typeof value !== 'object') {\r\n        return value;\r\n    }\r\n    else {\r\n        assert('.sv' in value, 'Unexpected leaf node or priority contents');\r\n        return serverValues[value['.sv']];\r\n    }\r\n};\r\n/**\r\n * Recursively replace all deferred values and priorities in the tree with the\r\n * specified generated replacement values.\r\n * @param {!SparseSnapshotTree} tree\r\n * @param {!Object} serverValues\r\n * @return {!SparseSnapshotTree}\r\n */\r\nvar resolveDeferredValueTree = function (tree, serverValues) {\r\n    var resolvedTree = new SparseSnapshotTree();\r\n    tree.forEachTree(new Path(''), function (path, node) {\r\n        resolvedTree.remember(path, resolveDeferredValueSnapshot(node, serverValues));\r\n    });\r\n    return resolvedTree;\r\n};\r\n/**\r\n * Recursively replace all deferred values and priorities in the node with the\r\n * specified generated replacement values.  If there are no server values in the node,\r\n * it'll be returned as-is.\r\n * @param {!Node} node\r\n * @param {!Object} serverValues\r\n * @return {!Node}\r\n */\r\nvar resolveDeferredValueSnapshot = function (node, serverValues) {\r\n    var rawPri = node.getPriority().val();\r\n    var priority = resolveDeferredValue(rawPri, serverValues);\r\n    var newNode;\r\n    if (node.isLeafNode()) {\r\n        var leafNode = node;\r\n        var value = resolveDeferredValue(leafNode.getValue(), serverValues);\r\n        if (value !== leafNode.getValue() ||\r\n            priority !== leafNode.getPriority().val()) {\r\n            return new LeafNode(value, nodeFromJSON$1(priority));\r\n        }\r\n        else {\r\n            return node;\r\n        }\r\n    }\r\n    else {\r\n        var childrenNode = node;\r\n        newNode = childrenNode;\r\n        if (priority !== childrenNode.getPriority().val()) {\r\n            newNode = newNode.updatePriority(new LeafNode(priority));\r\n        }\r\n        childrenNode.forEachChild(PRIORITY_INDEX, function (childName, childNode) {\r\n            var newChildNode = resolveDeferredValueSnapshot(childNode, serverValues);\r\n            if (newChildNode !== childNode) {\r\n                newNode = newNode.updateImmediateChild(childName, newChildNode);\r\n            }\r\n        });\r\n        return newNode;\r\n    }\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n *\r\n * @enum\r\n */\r\nvar OperationType;\r\n(function (OperationType) {\r\n    OperationType[OperationType[\"OVERWRITE\"] = 0] = \"OVERWRITE\";\r\n    OperationType[OperationType[\"MERGE\"] = 1] = \"MERGE\";\r\n    OperationType[OperationType[\"ACK_USER_WRITE\"] = 2] = \"ACK_USER_WRITE\";\r\n    OperationType[OperationType[\"LISTEN_COMPLETE\"] = 3] = \"LISTEN_COMPLETE\";\r\n})(OperationType || (OperationType = {}));\r\n/**\r\n * @param {boolean} fromUser\r\n * @param {boolean} fromServer\r\n * @param {?string} queryId\r\n * @param {boolean} tagged\r\n * @constructor\r\n */\r\nvar OperationSource = /** @class */ (function () {\r\n    function OperationSource(fromUser, fromServer, queryId, tagged) {\r\n        this.fromUser = fromUser;\r\n        this.fromServer = fromServer;\r\n        this.queryId = queryId;\r\n        this.tagged = tagged;\r\n        assert(!tagged || fromServer, 'Tagged queries must be from server.');\r\n    }\r\n    /**\r\n     * @const\r\n     * @type {!OperationSource}\r\n     */\r\n    OperationSource.User = new OperationSource(\r\n    /*fromUser=*/ true, false, null, \r\n    /*tagged=*/ false);\r\n    /**\r\n     * @const\r\n     * @type {!OperationSource}\r\n     */\r\n    OperationSource.Server = new OperationSource(false, \r\n    /*fromServer=*/ true, null, \r\n    /*tagged=*/ false);\r\n    /**\r\n     * @param {string} queryId\r\n     * @return {!OperationSource}\r\n     */\r\n    OperationSource.forServerTaggedQuery = function (queryId) {\r\n        return new OperationSource(false, \r\n        /*fromServer=*/ true, queryId, \r\n        /*tagged=*/ true);\r\n    };\r\n    return OperationSource;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar AckUserWrite = /** @class */ (function () {\r\n    /**\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!ImmutableTree<!boolean>} affectedTree A tree containing true for each affected path. Affected paths can't overlap.\r\n     * @param {!boolean} revert\r\n     */\r\n    function AckUserWrite(\r\n    /**@inheritDoc */ path, \r\n    /**@inheritDoc */ affectedTree, \r\n    /**@inheritDoc */ revert) {\r\n        this.path = path;\r\n        this.affectedTree = affectedTree;\r\n        this.revert = revert;\r\n        /** @inheritDoc */\r\n        this.type = OperationType.ACK_USER_WRITE;\r\n        /** @inheritDoc */\r\n        this.source = OperationSource.User;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    AckUserWrite.prototype.operationForChild = function (childName) {\r\n        if (!this.path.isEmpty()) {\r\n            assert(this.path.getFront() === childName, 'operationForChild called for unrelated child.');\r\n            return new AckUserWrite(this.path.popFront(), this.affectedTree, this.revert);\r\n        }\r\n        else if (this.affectedTree.value != null) {\r\n            assert(this.affectedTree.children.isEmpty(), 'affectedTree should not have overlapping affected paths.');\r\n            // All child locations are affected as well; just return same operation.\r\n            return this;\r\n        }\r\n        else {\r\n            var childTree = this.affectedTree.subtree(new Path(childName));\r\n            return new AckUserWrite(Path.Empty, childTree, this.revert);\r\n        }\r\n    };\r\n    return AckUserWrite;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar emptyChildrenSingleton;\r\n/**\r\n * Singleton empty children collection.\r\n *\r\n * @const\r\n * @type {!SortedMap.<string, !ImmutableTree.<?>>}\r\n */\r\nvar EmptyChildren = function () {\r\n    if (!emptyChildrenSingleton) {\r\n        emptyChildrenSingleton = new SortedMap(stringCompare);\r\n    }\r\n    return emptyChildrenSingleton;\r\n};\r\n/**\r\n * A tree with immutable elements.\r\n */\r\nvar ImmutableTree = /** @class */ (function () {\r\n    /**\r\n     * @template T\r\n     * @param {?T} value\r\n     * @param {SortedMap.<string, !ImmutableTree.<T>>=} children\r\n     */\r\n    function ImmutableTree(value, children) {\r\n        if (children === void 0) { children = EmptyChildren(); }\r\n        this.value = value;\r\n        this.children = children;\r\n    }\r\n    /**\r\n     * @template T\r\n     * @param {!Object.<string, !T>} obj\r\n     * @return {!ImmutableTree.<!T>}\r\n     */\r\n    ImmutableTree.fromObject = function (obj) {\r\n        var tree = ImmutableTree.Empty;\r\n        forEach(obj, function (childPath, childSnap) {\r\n            tree = tree.set(new Path(childPath), childSnap);\r\n        });\r\n        return tree;\r\n    };\r\n    /**\r\n     * True if the value is empty and there are no children\r\n     * @return {boolean}\r\n     */\r\n    ImmutableTree.prototype.isEmpty = function () {\r\n        return this.value === null && this.children.isEmpty();\r\n    };\r\n    /**\r\n     * Given a path and predicate, return the first node and the path to that node\r\n     * where the predicate returns true.\r\n     *\r\n     * TODO Do a perf test -- If we're creating a bunch of {path: value:} objects\r\n     * on the way back out, it may be better to pass down a pathSoFar obj.\r\n     *\r\n     * @param {!Path} relativePath The remainder of the path\r\n     * @param {function(T):boolean} predicate The predicate to satisfy to return a\r\n     *   node\r\n     * @return {?{path:!Path, value:!T}}\r\n     */\r\n    ImmutableTree.prototype.findRootMostMatchingPathAndValue = function (relativePath, predicate) {\r\n        if (this.value != null && predicate(this.value)) {\r\n            return { path: Path.Empty, value: this.value };\r\n        }\r\n        else {\r\n            if (relativePath.isEmpty()) {\r\n                return null;\r\n            }\r\n            else {\r\n                var front = relativePath.getFront();\r\n                var child = this.children.get(front);\r\n                if (child !== null) {\r\n                    var childExistingPathAndValue = child.findRootMostMatchingPathAndValue(relativePath.popFront(), predicate);\r\n                    if (childExistingPathAndValue != null) {\r\n                        var fullPath = new Path(front).child(childExistingPathAndValue.path);\r\n                        return { path: fullPath, value: childExistingPathAndValue.value };\r\n                    }\r\n                    else {\r\n                        return null;\r\n                    }\r\n                }\r\n                else {\r\n                    return null;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Find, if it exists, the shortest subpath of the given path that points a defined\r\n     * value in the tree\r\n     * @param {!Path} relativePath\r\n     * @return {?{path: !Path, value: !T}}\r\n     */\r\n    ImmutableTree.prototype.findRootMostValueAndPath = function (relativePath) {\r\n        return this.findRootMostMatchingPathAndValue(relativePath, function () { return true; });\r\n    };\r\n    /**\r\n     * @param {!Path} relativePath\r\n     * @return {!ImmutableTree.<T>} The subtree at the given path\r\n     */\r\n    ImmutableTree.prototype.subtree = function (relativePath) {\r\n        if (relativePath.isEmpty()) {\r\n            return this;\r\n        }\r\n        else {\r\n            var front = relativePath.getFront();\r\n            var childTree = this.children.get(front);\r\n            if (childTree !== null) {\r\n                return childTree.subtree(relativePath.popFront());\r\n            }\r\n            else {\r\n                return ImmutableTree.Empty;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Sets a value at the specified path.\r\n     *\r\n     * @param {!Path} relativePath Path to set value at.\r\n     * @param {?T} toSet Value to set.\r\n     * @return {!ImmutableTree.<T>} Resulting tree.\r\n     */\r\n    ImmutableTree.prototype.set = function (relativePath, toSet) {\r\n        if (relativePath.isEmpty()) {\r\n            return new ImmutableTree(toSet, this.children);\r\n        }\r\n        else {\r\n            var front = relativePath.getFront();\r\n            var child = this.children.get(front) || ImmutableTree.Empty;\r\n            var newChild = child.set(relativePath.popFront(), toSet);\r\n            var newChildren = this.children.insert(front, newChild);\r\n            return new ImmutableTree(this.value, newChildren);\r\n        }\r\n    };\r\n    /**\r\n     * Removes the value at the specified path.\r\n     *\r\n     * @param {!Path} relativePath Path to value to remove.\r\n     * @return {!ImmutableTree.<T>} Resulting tree.\r\n     */\r\n    ImmutableTree.prototype.remove = function (relativePath) {\r\n        if (relativePath.isEmpty()) {\r\n            if (this.children.isEmpty()) {\r\n                return ImmutableTree.Empty;\r\n            }\r\n            else {\r\n                return new ImmutableTree(null, this.children);\r\n            }\r\n        }\r\n        else {\r\n            var front = relativePath.getFront();\r\n            var child = this.children.get(front);\r\n            if (child) {\r\n                var newChild = child.remove(relativePath.popFront());\r\n                var newChildren = void 0;\r\n                if (newChild.isEmpty()) {\r\n                    newChildren = this.children.remove(front);\r\n                }\r\n                else {\r\n                    newChildren = this.children.insert(front, newChild);\r\n                }\r\n                if (this.value === null && newChildren.isEmpty()) {\r\n                    return ImmutableTree.Empty;\r\n                }\r\n                else {\r\n                    return new ImmutableTree(this.value, newChildren);\r\n                }\r\n            }\r\n            else {\r\n                return this;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Gets a value from the tree.\r\n     *\r\n     * @param {!Path} relativePath Path to get value for.\r\n     * @return {?T} Value at path, or null.\r\n     */\r\n    ImmutableTree.prototype.get = function (relativePath) {\r\n        if (relativePath.isEmpty()) {\r\n            return this.value;\r\n        }\r\n        else {\r\n            var front = relativePath.getFront();\r\n            var child = this.children.get(front);\r\n            if (child) {\r\n                return child.get(relativePath.popFront());\r\n            }\r\n            else {\r\n                return null;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Replace the subtree at the specified path with the given new tree.\r\n     *\r\n     * @param {!Path} relativePath Path to replace subtree for.\r\n     * @param {!ImmutableTree} newTree New tree.\r\n     * @return {!ImmutableTree} Resulting tree.\r\n     */\r\n    ImmutableTree.prototype.setTree = function (relativePath, newTree) {\r\n        if (relativePath.isEmpty()) {\r\n            return newTree;\r\n        }\r\n        else {\r\n            var front = relativePath.getFront();\r\n            var child = this.children.get(front) || ImmutableTree.Empty;\r\n            var newChild = child.setTree(relativePath.popFront(), newTree);\r\n            var newChildren = void 0;\r\n            if (newChild.isEmpty()) {\r\n                newChildren = this.children.remove(front);\r\n            }\r\n            else {\r\n                newChildren = this.children.insert(front, newChild);\r\n            }\r\n            return new ImmutableTree(this.value, newChildren);\r\n        }\r\n    };\r\n    /**\r\n     * Performs a depth first fold on this tree. Transforms a tree into a single\r\n     * value, given a function that operates on the path to a node, an optional\r\n     * current value, and a map of child names to folded subtrees\r\n     * @template V\r\n     * @param {function(Path, ?T, Object.<string, V>):V} fn\r\n     * @return {V}\r\n     */\r\n    ImmutableTree.prototype.fold = function (fn) {\r\n        return this.fold_(Path.Empty, fn);\r\n    };\r\n    /**\r\n     * Recursive helper for public-facing fold() method\r\n     * @template V\r\n     * @param {!Path} pathSoFar\r\n     * @param {function(Path, ?T, Object.<string, V>):V} fn\r\n     * @return {V}\r\n     * @private\r\n     */\r\n    ImmutableTree.prototype.fold_ = function (pathSoFar, fn) {\r\n        var accum = {};\r\n        this.children.inorderTraversal(function (childKey, childTree) {\r\n            accum[childKey] = childTree.fold_(pathSoFar.child(childKey), fn);\r\n        });\r\n        return fn(pathSoFar, this.value, accum);\r\n    };\r\n    /**\r\n     * Find the first matching value on the given path. Return the result of applying f to it.\r\n     * @template V\r\n     * @param {!Path} path\r\n     * @param {!function(!Path, !T):?V} f\r\n     * @return {?V}\r\n     */\r\n    ImmutableTree.prototype.findOnPath = function (path, f) {\r\n        return this.findOnPath_(path, Path.Empty, f);\r\n    };\r\n    ImmutableTree.prototype.findOnPath_ = function (pathToFollow, pathSoFar, f) {\r\n        var result = this.value ? f(pathSoFar, this.value) : false;\r\n        if (result) {\r\n            return result;\r\n        }\r\n        else {\r\n            if (pathToFollow.isEmpty()) {\r\n                return null;\r\n            }\r\n            else {\r\n                var front = pathToFollow.getFront();\r\n                var nextChild = this.children.get(front);\r\n                if (nextChild) {\r\n                    return nextChild.findOnPath_(pathToFollow.popFront(), pathSoFar.child(front), f);\r\n                }\r\n                else {\r\n                    return null;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!function(!Path, !T)} f\r\n     * @returns {!ImmutableTree.<T>}\r\n     */\r\n    ImmutableTree.prototype.foreachOnPath = function (path, f) {\r\n        return this.foreachOnPath_(path, Path.Empty, f);\r\n    };\r\n    ImmutableTree.prototype.foreachOnPath_ = function (pathToFollow, currentRelativePath, f) {\r\n        if (pathToFollow.isEmpty()) {\r\n            return this;\r\n        }\r\n        else {\r\n            if (this.value) {\r\n                f(currentRelativePath, this.value);\r\n            }\r\n            var front = pathToFollow.getFront();\r\n            var nextChild = this.children.get(front);\r\n            if (nextChild) {\r\n                return nextChild.foreachOnPath_(pathToFollow.popFront(), currentRelativePath.child(front), f);\r\n            }\r\n            else {\r\n                return ImmutableTree.Empty;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Calls the given function for each node in the tree that has a value.\r\n     *\r\n     * @param {function(!Path, !T)} f A function to be called with\r\n     *   the path from the root of the tree to a node, and the value at that node.\r\n     *   Called in depth-first order.\r\n     */\r\n    ImmutableTree.prototype.foreach = function (f) {\r\n        this.foreach_(Path.Empty, f);\r\n    };\r\n    ImmutableTree.prototype.foreach_ = function (currentRelativePath, f) {\r\n        this.children.inorderTraversal(function (childName, childTree) {\r\n            childTree.foreach_(currentRelativePath.child(childName), f);\r\n        });\r\n        if (this.value) {\r\n            f(currentRelativePath, this.value);\r\n        }\r\n    };\r\n    /**\r\n     *\r\n     * @param {function(string, !T)} f\r\n     */\r\n    ImmutableTree.prototype.foreachChild = function (f) {\r\n        this.children.inorderTraversal(function (childName, childTree) {\r\n            if (childTree.value) {\r\n                f(childName, childTree.value);\r\n            }\r\n        });\r\n    };\r\n    ImmutableTree.Empty = new ImmutableTree(null);\r\n    return ImmutableTree;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @param {!OperationSource} source\r\n * @param {!Path} path\r\n * @constructor\r\n * @implements {Operation}\r\n */\r\nvar ListenComplete = /** @class */ (function () {\r\n    function ListenComplete(source, path) {\r\n        this.source = source;\r\n        this.path = path;\r\n        /** @inheritDoc */\r\n        this.type = OperationType.LISTEN_COMPLETE;\r\n    }\r\n    ListenComplete.prototype.operationForChild = function (childName) {\r\n        if (this.path.isEmpty()) {\r\n            return new ListenComplete(this.source, Path.Empty);\r\n        }\r\n        else {\r\n            return new ListenComplete(this.source, this.path.popFront());\r\n        }\r\n    };\r\n    return ListenComplete;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @param {!OperationSource} source\r\n * @param {!Path} path\r\n * @param {!Node} snap\r\n * @constructor\r\n * @implements {Operation}\r\n */\r\nvar Overwrite = /** @class */ (function () {\r\n    function Overwrite(source, path, snap) {\r\n        this.source = source;\r\n        this.path = path;\r\n        this.snap = snap;\r\n        /** @inheritDoc */\r\n        this.type = OperationType.OVERWRITE;\r\n    }\r\n    Overwrite.prototype.operationForChild = function (childName) {\r\n        if (this.path.isEmpty()) {\r\n            return new Overwrite(this.source, Path.Empty, this.snap.getImmediateChild(childName));\r\n        }\r\n        else {\r\n            return new Overwrite(this.source, this.path.popFront(), this.snap);\r\n        }\r\n    };\r\n    return Overwrite;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @param {!OperationSource} source\r\n * @param {!Path} path\r\n * @param {!ImmutableTree.<!Node>} children\r\n * @constructor\r\n * @implements {Operation}\r\n */\r\nvar Merge = /** @class */ (function () {\r\n    function Merge(\r\n    /**@inheritDoc */ source, \r\n    /**@inheritDoc */ path, \r\n    /**@inheritDoc */ children) {\r\n        this.source = source;\r\n        this.path = path;\r\n        this.children = children;\r\n        /** @inheritDoc */\r\n        this.type = OperationType.MERGE;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    Merge.prototype.operationForChild = function (childName) {\r\n        if (this.path.isEmpty()) {\r\n            var childTree = this.children.subtree(new Path(childName));\r\n            if (childTree.isEmpty()) {\r\n                // This child is unaffected\r\n                return null;\r\n            }\r\n            else if (childTree.value) {\r\n                // We have a snapshot for the child in question.  This becomes an overwrite of the child.\r\n                return new Overwrite(this.source, Path.Empty, childTree.value);\r\n            }\r\n            else {\r\n                // This is a merge at a deeper level\r\n                return new Merge(this.source, Path.Empty, childTree);\r\n            }\r\n        }\r\n        else {\r\n            assert(this.path.getFront() === childName, \"Can't get a merge for a child not on the path of the operation\");\r\n            return new Merge(this.source, this.path.popFront(), this.children);\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    Merge.prototype.toString = function () {\r\n        return ('Operation(' +\r\n            this.path +\r\n            ': ' +\r\n            this.source.toString() +\r\n            ' merge: ' +\r\n            this.children.toString() +\r\n            ')');\r\n    };\r\n    return Merge;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * A cache node only stores complete children. Additionally it holds a flag whether the node can be considered fully\r\n * initialized in the sense that we know at one point in time this represented a valid state of the world, e.g.\r\n * initialized with data from the server, or a complete overwrite by the client. The filtered flag also tracks\r\n * whether a node potentially had children removed due to a filter.\r\n */\r\nvar CacheNode = /** @class */ (function () {\r\n    /**\r\n     * @param {!Node} node_\r\n     * @param {boolean} fullyInitialized_\r\n     * @param {boolean} filtered_\r\n     */\r\n    function CacheNode(node_, fullyInitialized_, filtered_) {\r\n        this.node_ = node_;\r\n        this.fullyInitialized_ = fullyInitialized_;\r\n        this.filtered_ = filtered_;\r\n    }\r\n    /**\r\n     * Returns whether this node was fully initialized with either server data or a complete overwrite by the client\r\n     * @return {boolean}\r\n     */\r\n    CacheNode.prototype.isFullyInitialized = function () {\r\n        return this.fullyInitialized_;\r\n    };\r\n    /**\r\n     * Returns whether this node is potentially missing children due to a filter applied to the node\r\n     * @return {boolean}\r\n     */\r\n    CacheNode.prototype.isFiltered = function () {\r\n        return this.filtered_;\r\n    };\r\n    /**\r\n     * @param {!Path} path\r\n     * @return {boolean}\r\n     */\r\n    CacheNode.prototype.isCompleteForPath = function (path) {\r\n        if (path.isEmpty()) {\r\n            return this.isFullyInitialized() && !this.filtered_;\r\n        }\r\n        var childKey = path.getFront();\r\n        return this.isCompleteForChild(childKey);\r\n    };\r\n    /**\r\n     * @param {!string} key\r\n     * @return {boolean}\r\n     */\r\n    CacheNode.prototype.isCompleteForChild = function (key) {\r\n        return ((this.isFullyInitialized() && !this.filtered_) || this.node_.hasChild(key));\r\n    };\r\n    /**\r\n     * @return {!Node}\r\n     */\r\n    CacheNode.prototype.getNode = function () {\r\n        return this.node_;\r\n    };\r\n    return CacheNode;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Stores the data we have cached for a view.\r\n *\r\n * serverSnap is the cached server data, eventSnap is the cached event data (server data plus any local writes).\r\n *\r\n * @constructor\r\n */\r\nvar ViewCache = /** @class */ (function () {\r\n    /**\r\n     *\r\n     * @param {!CacheNode} eventCache_\r\n     * @param {!CacheNode} serverCache_\r\n     */\r\n    function ViewCache(eventCache_, serverCache_) {\r\n        this.eventCache_ = eventCache_;\r\n        this.serverCache_ = serverCache_;\r\n    }\r\n    /**\r\n     * @param {!Node} eventSnap\r\n     * @param {boolean} complete\r\n     * @param {boolean} filtered\r\n     * @return {!ViewCache}\r\n     */\r\n    ViewCache.prototype.updateEventSnap = function (eventSnap, complete, filtered) {\r\n        return new ViewCache(new CacheNode(eventSnap, complete, filtered), this.serverCache_);\r\n    };\r\n    /**\r\n     * @param {!Node} serverSnap\r\n     * @param {boolean} complete\r\n     * @param {boolean} filtered\r\n     * @return {!ViewCache}\r\n     */\r\n    ViewCache.prototype.updateServerSnap = function (serverSnap, complete, filtered) {\r\n        return new ViewCache(this.eventCache_, new CacheNode(serverSnap, complete, filtered));\r\n    };\r\n    /**\r\n     * @return {!CacheNode}\r\n     */\r\n    ViewCache.prototype.getEventCache = function () {\r\n        return this.eventCache_;\r\n    };\r\n    /**\r\n     * @return {?Node}\r\n     */\r\n    ViewCache.prototype.getCompleteEventSnap = function () {\r\n        return this.eventCache_.isFullyInitialized()\r\n            ? this.eventCache_.getNode()\r\n            : null;\r\n    };\r\n    /**\r\n     * @return {!CacheNode}\r\n     */\r\n    ViewCache.prototype.getServerCache = function () {\r\n        return this.serverCache_;\r\n    };\r\n    /**\r\n     * @return {?Node}\r\n     */\r\n    ViewCache.prototype.getCompleteServerSnap = function () {\r\n        return this.serverCache_.isFullyInitialized()\r\n            ? this.serverCache_.getNode()\r\n            : null;\r\n    };\r\n    /**\r\n     * @const\r\n     * @type {ViewCache}\r\n     */\r\n    ViewCache.Empty = new ViewCache(new CacheNode(ChildrenNode.EMPTY_NODE, \r\n    /*fullyInitialized=*/ false, \r\n    /*filtered=*/ false), new CacheNode(ChildrenNode.EMPTY_NODE, \r\n    /*fullyInitialized=*/ false, \r\n    /*filtered=*/ false));\r\n    return ViewCache;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @constructor\r\n * @struct\r\n * @param {!string} type The event type\r\n * @param {!Node} snapshotNode The data\r\n * @param {string=} childName The name for this child, if it's a child event\r\n * @param {Node=} oldSnap Used for intermediate processing of child changed events\r\n * @param {string=} prevName The name for the previous child, if applicable\r\n */\r\nvar Change = /** @class */ (function () {\r\n    function Change(type, snapshotNode, childName, oldSnap, prevName) {\r\n        this.type = type;\r\n        this.snapshotNode = snapshotNode;\r\n        this.childName = childName;\r\n        this.oldSnap = oldSnap;\r\n        this.prevName = prevName;\r\n    }\r\n    /**\r\n     * @param {!Node} snapshot\r\n     * @return {!Change}\r\n     */\r\n    Change.valueChange = function (snapshot) {\r\n        return new Change(Change.VALUE, snapshot);\r\n    };\r\n    /**\r\n     * @param {string} childKey\r\n     * @param {!Node} snapshot\r\n     * @return {!Change}\r\n     */\r\n    Change.childAddedChange = function (childKey, snapshot) {\r\n        return new Change(Change.CHILD_ADDED, snapshot, childKey);\r\n    };\r\n    /**\r\n     * @param {string} childKey\r\n     * @param {!Node} snapshot\r\n     * @return {!Change}\r\n     */\r\n    Change.childRemovedChange = function (childKey, snapshot) {\r\n        return new Change(Change.CHILD_REMOVED, snapshot, childKey);\r\n    };\r\n    /**\r\n     * @param {string} childKey\r\n     * @param {!Node} newSnapshot\r\n     * @param {!Node} oldSnapshot\r\n     * @return {!Change}\r\n     */\r\n    Change.childChangedChange = function (childKey, newSnapshot, oldSnapshot) {\r\n        return new Change(Change.CHILD_CHANGED, newSnapshot, childKey, oldSnapshot);\r\n    };\r\n    /**\r\n     * @param {string} childKey\r\n     * @param {!Node} snapshot\r\n     * @return {!Change}\r\n     */\r\n    Change.childMovedChange = function (childKey, snapshot) {\r\n        return new Change(Change.CHILD_MOVED, snapshot, childKey);\r\n    };\r\n    //event types\r\n    /** Event type for a child added */\r\n    Change.CHILD_ADDED = 'child_added';\r\n    /** Event type for a child removed */\r\n    Change.CHILD_REMOVED = 'child_removed';\r\n    /** Event type for a child changed */\r\n    Change.CHILD_CHANGED = 'child_changed';\r\n    /** Event type for a child moved */\r\n    Change.CHILD_MOVED = 'child_moved';\r\n    /** Event type for a value change */\r\n    Change.VALUE = 'value';\r\n    return Change;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Doesn't really filter nodes but applies an index to the node and keeps track of any changes\r\n *\r\n * @constructor\r\n * @implements {NodeFilter}\r\n * @param {!Index} index\r\n */\r\nvar IndexedFilter = /** @class */ (function () {\r\n    function IndexedFilter(index_) {\r\n        this.index_ = index_;\r\n    }\r\n    IndexedFilter.prototype.updateChild = function (snap, key, newChild, affectedPath, source, optChangeAccumulator) {\r\n        assert(snap.isIndexed(this.index_), 'A node must be indexed if only a child is updated');\r\n        var oldChild = snap.getImmediateChild(key);\r\n        // Check if anything actually changed.\r\n        if (oldChild.getChild(affectedPath).equals(newChild.getChild(affectedPath))) {\r\n            // There's an edge case where a child can enter or leave the view because affectedPath was set to null.\r\n            // In this case, affectedPath will appear null in both the old and new snapshots.  So we need\r\n            // to avoid treating these cases as \"nothing changed.\"\r\n            if (oldChild.isEmpty() == newChild.isEmpty()) {\r\n                // Nothing changed.\r\n                // This assert should be valid, but it's expensive (can dominate perf testing) so don't actually do it.\r\n                //assert(oldChild.equals(newChild), 'Old and new snapshots should be equal.');\r\n                return snap;\r\n            }\r\n        }\r\n        if (optChangeAccumulator != null) {\r\n            if (newChild.isEmpty()) {\r\n                if (snap.hasChild(key)) {\r\n                    optChangeAccumulator.trackChildChange(Change.childRemovedChange(key, oldChild));\r\n                }\r\n                else {\r\n                    assert(snap.isLeafNode(), 'A child remove without an old child only makes sense on a leaf node');\r\n                }\r\n            }\r\n            else if (oldChild.isEmpty()) {\r\n                optChangeAccumulator.trackChildChange(Change.childAddedChange(key, newChild));\r\n            }\r\n            else {\r\n                optChangeAccumulator.trackChildChange(Change.childChangedChange(key, newChild, oldChild));\r\n            }\r\n        }\r\n        if (snap.isLeafNode() && newChild.isEmpty()) {\r\n            return snap;\r\n        }\r\n        else {\r\n            // Make sure the node is indexed\r\n            return snap.updateImmediateChild(key, newChild).withIndex(this.index_);\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    IndexedFilter.prototype.updateFullNode = function (oldSnap, newSnap, optChangeAccumulator) {\r\n        if (optChangeAccumulator != null) {\r\n            if (!oldSnap.isLeafNode()) {\r\n                oldSnap.forEachChild(PRIORITY_INDEX, function (key, childNode) {\r\n                    if (!newSnap.hasChild(key)) {\r\n                        optChangeAccumulator.trackChildChange(Change.childRemovedChange(key, childNode));\r\n                    }\r\n                });\r\n            }\r\n            if (!newSnap.isLeafNode()) {\r\n                newSnap.forEachChild(PRIORITY_INDEX, function (key, childNode) {\r\n                    if (oldSnap.hasChild(key)) {\r\n                        var oldChild = oldSnap.getImmediateChild(key);\r\n                        if (!oldChild.equals(childNode)) {\r\n                            optChangeAccumulator.trackChildChange(Change.childChangedChange(key, childNode, oldChild));\r\n                        }\r\n                    }\r\n                    else {\r\n                        optChangeAccumulator.trackChildChange(Change.childAddedChange(key, childNode));\r\n                    }\r\n                });\r\n            }\r\n        }\r\n        return newSnap.withIndex(this.index_);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    IndexedFilter.prototype.updatePriority = function (oldSnap, newPriority) {\r\n        if (oldSnap.isEmpty()) {\r\n            return ChildrenNode.EMPTY_NODE;\r\n        }\r\n        else {\r\n            return oldSnap.updatePriority(newPriority);\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    IndexedFilter.prototype.filtersNodes = function () {\r\n        return false;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    IndexedFilter.prototype.getIndexedFilter = function () {\r\n        return this;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    IndexedFilter.prototype.getIndex = function () {\r\n        return this.index_;\r\n    };\r\n    return IndexedFilter;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @constructor\r\n */\r\nvar ChildChangeAccumulator = /** @class */ (function () {\r\n    function ChildChangeAccumulator() {\r\n        this.changeMap_ = {};\r\n    }\r\n    /**\r\n     * @param {!Change} change\r\n     */\r\n    ChildChangeAccumulator.prototype.trackChildChange = function (change) {\r\n        var type = change.type;\r\n        var childKey /** @type {!string} */ = change.childName;\r\n        assert(type == Change.CHILD_ADDED ||\r\n            type == Change.CHILD_CHANGED ||\r\n            type == Change.CHILD_REMOVED, 'Only child changes supported for tracking');\r\n        assert(childKey !== '.priority', 'Only non-priority child changes can be tracked.');\r\n        var oldChange = safeGet(this.changeMap_, childKey);\r\n        if (oldChange) {\r\n            var oldType = oldChange.type;\r\n            if (type == Change.CHILD_ADDED && oldType == Change.CHILD_REMOVED) {\r\n                this.changeMap_[childKey] = Change.childChangedChange(childKey, change.snapshotNode, oldChange.snapshotNode);\r\n            }\r\n            else if (type == Change.CHILD_REMOVED &&\r\n                oldType == Change.CHILD_ADDED) {\r\n                delete this.changeMap_[childKey];\r\n            }\r\n            else if (type == Change.CHILD_REMOVED &&\r\n                oldType == Change.CHILD_CHANGED) {\r\n                this.changeMap_[childKey] = Change.childRemovedChange(childKey, oldChange.oldSnap);\r\n            }\r\n            else if (type == Change.CHILD_CHANGED &&\r\n                oldType == Change.CHILD_ADDED) {\r\n                this.changeMap_[childKey] = Change.childAddedChange(childKey, change.snapshotNode);\r\n            }\r\n            else if (type == Change.CHILD_CHANGED &&\r\n                oldType == Change.CHILD_CHANGED) {\r\n                this.changeMap_[childKey] = Change.childChangedChange(childKey, change.snapshotNode, oldChange.oldSnap);\r\n            }\r\n            else {\r\n                throw assertionError('Illegal combination of changes: ' +\r\n                    change +\r\n                    ' occurred after ' +\r\n                    oldChange);\r\n            }\r\n        }\r\n        else {\r\n            this.changeMap_[childKey] = change;\r\n        }\r\n    };\r\n    /**\r\n     * @return {!Array.<!Change>}\r\n     */\r\n    ChildChangeAccumulator.prototype.getChanges = function () {\r\n        return getValues(this.changeMap_);\r\n    };\r\n    return ChildChangeAccumulator;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * An implementation of CompleteChildSource that never returns any additional children\r\n *\r\n * @private\r\n * @constructor\r\n * @implements CompleteChildSource\r\n */\r\nvar NoCompleteChildSource_ = /** @class */ (function () {\r\n    function NoCompleteChildSource_() {\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    NoCompleteChildSource_.prototype.getCompleteChild = function (childKey) {\r\n        return null;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    NoCompleteChildSource_.prototype.getChildAfterChild = function (index, child, reverse) {\r\n        return null;\r\n    };\r\n    return NoCompleteChildSource_;\r\n}());\r\n/**\r\n * Singleton instance.\r\n * @const\r\n * @type {!CompleteChildSource}\r\n */\r\nvar NO_COMPLETE_CHILD_SOURCE = new NoCompleteChildSource_();\r\n/**\r\n * An implementation of CompleteChildSource that uses a WriteTree in addition to any other server data or\r\n * old event caches available to calculate complete children.\r\n *\r\n *\r\n * @implements CompleteChildSource\r\n */\r\nvar WriteTreeCompleteChildSource = /** @class */ (function () {\r\n    /**\r\n     * @param {!WriteTreeRef} writes_\r\n     * @param {!ViewCache} viewCache_\r\n     * @param {?Node} optCompleteServerCache_\r\n     */\r\n    function WriteTreeCompleteChildSource(writes_, viewCache_, optCompleteServerCache_) {\r\n        if (optCompleteServerCache_ === void 0) { optCompleteServerCache_ = null; }\r\n        this.writes_ = writes_;\r\n        this.viewCache_ = viewCache_;\r\n        this.optCompleteServerCache_ = optCompleteServerCache_;\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    WriteTreeCompleteChildSource.prototype.getCompleteChild = function (childKey) {\r\n        var node = this.viewCache_.getEventCache();\r\n        if (node.isCompleteForChild(childKey)) {\r\n            return node.getNode().getImmediateChild(childKey);\r\n        }\r\n        else {\r\n            var serverNode = this.optCompleteServerCache_ != null\r\n                ? new CacheNode(this.optCompleteServerCache_, true, false)\r\n                : this.viewCache_.getServerCache();\r\n            return this.writes_.calcCompleteChild(childKey, serverNode);\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    WriteTreeCompleteChildSource.prototype.getChildAfterChild = function (index, child, reverse) {\r\n        var completeServerData = this.optCompleteServerCache_ != null\r\n            ? this.optCompleteServerCache_\r\n            : this.viewCache_.getCompleteServerSnap();\r\n        var nodes = this.writes_.calcIndexedSlice(completeServerData, child, 1, reverse, index);\r\n        if (nodes.length === 0) {\r\n            return null;\r\n        }\r\n        else {\r\n            return nodes[0];\r\n        }\r\n    };\r\n    return WriteTreeCompleteChildSource;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @constructor\r\n * @struct\r\n */\r\nvar ProcessorResult = /** @class */ (function () {\r\n    /**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {!Array.<!Change>} changes\r\n     */\r\n    function ProcessorResult(viewCache, changes) {\r\n        this.viewCache = viewCache;\r\n        this.changes = changes;\r\n    }\r\n    return ProcessorResult;\r\n}());\r\n/**\r\n * @constructor\r\n */\r\nvar ViewProcessor = /** @class */ (function () {\r\n    /**\r\n     * @param {!NodeFilter} filter_\r\n     */\r\n    function ViewProcessor(filter_) {\r\n        this.filter_ = filter_;\r\n    }\r\n    /**\r\n     * @param {!ViewCache} viewCache\r\n     */\r\n    ViewProcessor.prototype.assertIndexed = function (viewCache) {\r\n        assert(viewCache\r\n            .getEventCache()\r\n            .getNode()\r\n            .isIndexed(this.filter_.getIndex()), 'Event snap not indexed');\r\n        assert(viewCache\r\n            .getServerCache()\r\n            .getNode()\r\n            .isIndexed(this.filter_.getIndex()), 'Server snap not indexed');\r\n    };\r\n    /**\r\n     * @param {!ViewCache} oldViewCache\r\n     * @param {!Operation} operation\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} completeCache\r\n     * @return {!ProcessorResult}\r\n     */\r\n    ViewProcessor.prototype.applyOperation = function (oldViewCache, operation, writesCache, completeCache) {\r\n        var accumulator = new ChildChangeAccumulator();\r\n        var newViewCache, filterServerNode;\r\n        if (operation.type === OperationType.OVERWRITE) {\r\n            var overwrite = operation;\r\n            if (overwrite.source.fromUser) {\r\n                newViewCache = this.applyUserOverwrite_(oldViewCache, overwrite.path, overwrite.snap, writesCache, completeCache, accumulator);\r\n            }\r\n            else {\r\n                assert(overwrite.source.fromServer, 'Unknown source.');\r\n                // We filter the node if it's a tagged update or the node has been previously filtered  and the\r\n                // update is not at the root in which case it is ok (and necessary) to mark the node unfiltered\r\n                // again\r\n                filterServerNode =\r\n                    overwrite.source.tagged ||\r\n                        (oldViewCache.getServerCache().isFiltered() &&\r\n                            !overwrite.path.isEmpty());\r\n                newViewCache = this.applyServerOverwrite_(oldViewCache, overwrite.path, overwrite.snap, writesCache, completeCache, filterServerNode, accumulator);\r\n            }\r\n        }\r\n        else if (operation.type === OperationType.MERGE) {\r\n            var merge = operation;\r\n            if (merge.source.fromUser) {\r\n                newViewCache = this.applyUserMerge_(oldViewCache, merge.path, merge.children, writesCache, completeCache, accumulator);\r\n            }\r\n            else {\r\n                assert(merge.source.fromServer, 'Unknown source.');\r\n                // We filter the node if it's a tagged update or the node has been previously filtered\r\n                filterServerNode =\r\n                    merge.source.tagged || oldViewCache.getServerCache().isFiltered();\r\n                newViewCache = this.applyServerMerge_(oldViewCache, merge.path, merge.children, writesCache, completeCache, filterServerNode, accumulator);\r\n            }\r\n        }\r\n        else if (operation.type === OperationType.ACK_USER_WRITE) {\r\n            var ackUserWrite = operation;\r\n            if (!ackUserWrite.revert) {\r\n                newViewCache = this.ackUserWrite_(oldViewCache, ackUserWrite.path, ackUserWrite.affectedTree, writesCache, completeCache, accumulator);\r\n            }\r\n            else {\r\n                newViewCache = this.revertUserWrite_(oldViewCache, ackUserWrite.path, writesCache, completeCache, accumulator);\r\n            }\r\n        }\r\n        else if (operation.type === OperationType.LISTEN_COMPLETE) {\r\n            newViewCache = this.listenComplete_(oldViewCache, operation.path, writesCache, accumulator);\r\n        }\r\n        else {\r\n            throw assertionError('Unknown operation type: ' + operation.type);\r\n        }\r\n        var changes = accumulator.getChanges();\r\n        ViewProcessor.maybeAddValueEvent_(oldViewCache, newViewCache, changes);\r\n        return new ProcessorResult(newViewCache, changes);\r\n    };\r\n    /**\r\n     * @param {!ViewCache} oldViewCache\r\n     * @param {!ViewCache} newViewCache\r\n     * @param {!Array.<!Change>} accumulator\r\n     * @private\r\n     */\r\n    ViewProcessor.maybeAddValueEvent_ = function (oldViewCache, newViewCache, accumulator) {\r\n        var eventSnap = newViewCache.getEventCache();\r\n        if (eventSnap.isFullyInitialized()) {\r\n            var isLeafOrEmpty = eventSnap.getNode().isLeafNode() || eventSnap.getNode().isEmpty();\r\n            var oldCompleteSnap = oldViewCache.getCompleteEventSnap();\r\n            if (accumulator.length > 0 ||\r\n                !oldViewCache.getEventCache().isFullyInitialized() ||\r\n                (isLeafOrEmpty &&\r\n                    !eventSnap\r\n                        .getNode()\r\n                        .equals(/** @type {!Node} */ (oldCompleteSnap))) ||\r\n                !eventSnap\r\n                    .getNode()\r\n                    .getPriority()\r\n                    .equals(oldCompleteSnap.getPriority())) {\r\n                accumulator.push(Change.valueChange(\r\n                /** @type {!Node} */ newViewCache.getCompleteEventSnap()));\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {!Path} changePath\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {!CompleteChildSource} source\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\r\n    ViewProcessor.prototype.generateEventCacheAfterServerEvent_ = function (viewCache, changePath, writesCache, source, accumulator) {\r\n        var oldEventSnap = viewCache.getEventCache();\r\n        if (writesCache.shadowingWrite(changePath) != null) {\r\n            // we have a shadowing write, ignore changes\r\n            return viewCache;\r\n        }\r\n        else {\r\n            var newEventCache = void 0, serverNode = void 0;\r\n            if (changePath.isEmpty()) {\r\n                // TODO: figure out how this plays with \"sliding ack windows\"\r\n                assert(viewCache.getServerCache().isFullyInitialized(), 'If change path is empty, we must have complete server data');\r\n                if (viewCache.getServerCache().isFiltered()) {\r\n                    // We need to special case this, because we need to only apply writes to complete children, or\r\n                    // we might end up raising events for incomplete children. If the server data is filtered deep\r\n                    // writes cannot be guaranteed to be complete\r\n                    var serverCache = viewCache.getCompleteServerSnap();\r\n                    var completeChildren = serverCache instanceof ChildrenNode\r\n                        ? serverCache\r\n                        : ChildrenNode.EMPTY_NODE;\r\n                    var completeEventChildren = writesCache.calcCompleteEventChildren(completeChildren);\r\n                    newEventCache = this.filter_.updateFullNode(viewCache.getEventCache().getNode(), completeEventChildren, accumulator);\r\n                }\r\n                else {\r\n                    var completeNode = writesCache.calcCompleteEventCache(viewCache.getCompleteServerSnap());\r\n                    newEventCache = this.filter_.updateFullNode(viewCache.getEventCache().getNode(), completeNode, accumulator);\r\n                }\r\n            }\r\n            else {\r\n                var childKey = changePath.getFront();\r\n                if (childKey == '.priority') {\r\n                    assert(changePath.getLength() == 1, \"Can't have a priority with additional path components\");\r\n                    var oldEventNode = oldEventSnap.getNode();\r\n                    serverNode = viewCache.getServerCache().getNode();\r\n                    // we might have overwrites for this priority\r\n                    var updatedPriority = writesCache.calcEventCacheAfterServerOverwrite(changePath, oldEventNode, serverNode);\r\n                    if (updatedPriority != null) {\r\n                        newEventCache = this.filter_.updatePriority(oldEventNode, updatedPriority);\r\n                    }\r\n                    else {\r\n                        // priority didn't change, keep old node\r\n                        newEventCache = oldEventSnap.getNode();\r\n                    }\r\n                }\r\n                else {\r\n                    var childChangePath = changePath.popFront();\r\n                    // update child\r\n                    var newEventChild = void 0;\r\n                    if (oldEventSnap.isCompleteForChild(childKey)) {\r\n                        serverNode = viewCache.getServerCache().getNode();\r\n                        var eventChildUpdate = writesCache.calcEventCacheAfterServerOverwrite(changePath, oldEventSnap.getNode(), serverNode);\r\n                        if (eventChildUpdate != null) {\r\n                            newEventChild = oldEventSnap\r\n                                .getNode()\r\n                                .getImmediateChild(childKey)\r\n                                .updateChild(childChangePath, eventChildUpdate);\r\n                        }\r\n                        else {\r\n                            // Nothing changed, just keep the old child\r\n                            newEventChild = oldEventSnap\r\n                                .getNode()\r\n                                .getImmediateChild(childKey);\r\n                        }\r\n                    }\r\n                    else {\r\n                        newEventChild = writesCache.calcCompleteChild(childKey, viewCache.getServerCache());\r\n                    }\r\n                    if (newEventChild != null) {\r\n                        newEventCache = this.filter_.updateChild(oldEventSnap.getNode(), childKey, newEventChild, childChangePath, source, accumulator);\r\n                    }\r\n                    else {\r\n                        // no complete child available or no change\r\n                        newEventCache = oldEventSnap.getNode();\r\n                    }\r\n                }\r\n            }\r\n            return viewCache.updateEventSnap(newEventCache, oldEventSnap.isFullyInitialized() || changePath.isEmpty(), this.filter_.filtersNodes());\r\n        }\r\n    };\r\n    /**\r\n     * @param {!ViewCache} oldViewCache\r\n     * @param {!Path} changePath\r\n     * @param {!Node} changedSnap\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} completeCache\r\n     * @param {boolean} filterServerNode\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\r\n    ViewProcessor.prototype.applyServerOverwrite_ = function (oldViewCache, changePath, changedSnap, writesCache, completeCache, filterServerNode, accumulator) {\r\n        var oldServerSnap = oldViewCache.getServerCache();\r\n        var newServerCache;\r\n        var serverFilter = filterServerNode\r\n            ? this.filter_\r\n            : this.filter_.getIndexedFilter();\r\n        if (changePath.isEmpty()) {\r\n            newServerCache = serverFilter.updateFullNode(oldServerSnap.getNode(), changedSnap, null);\r\n        }\r\n        else if (serverFilter.filtersNodes() && !oldServerSnap.isFiltered()) {\r\n            // we want to filter the server node, but we didn't filter the server node yet, so simulate a full update\r\n            var newServerNode = oldServerSnap\r\n                .getNode()\r\n                .updateChild(changePath, changedSnap);\r\n            newServerCache = serverFilter.updateFullNode(oldServerSnap.getNode(), newServerNode, null);\r\n        }\r\n        else {\r\n            var childKey = changePath.getFront();\r\n            if (!oldServerSnap.isCompleteForPath(changePath) &&\r\n                changePath.getLength() > 1) {\r\n                // We don't update incomplete nodes with updates intended for other listeners\r\n                return oldViewCache;\r\n            }\r\n            var childChangePath = changePath.popFront();\r\n            var childNode = oldServerSnap.getNode().getImmediateChild(childKey);\r\n            var newChildNode = childNode.updateChild(childChangePath, changedSnap);\r\n            if (childKey == '.priority') {\r\n                newServerCache = serverFilter.updatePriority(oldServerSnap.getNode(), newChildNode);\r\n            }\r\n            else {\r\n                newServerCache = serverFilter.updateChild(oldServerSnap.getNode(), childKey, newChildNode, childChangePath, NO_COMPLETE_CHILD_SOURCE, null);\r\n            }\r\n        }\r\n        var newViewCache = oldViewCache.updateServerSnap(newServerCache, oldServerSnap.isFullyInitialized() || changePath.isEmpty(), serverFilter.filtersNodes());\r\n        var source = new WriteTreeCompleteChildSource(writesCache, newViewCache, completeCache);\r\n        return this.generateEventCacheAfterServerEvent_(newViewCache, changePath, writesCache, source, accumulator);\r\n    };\r\n    /**\r\n     * @param {!ViewCache} oldViewCache\r\n     * @param {!Path} changePath\r\n     * @param {!Node} changedSnap\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} completeCache\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\r\n    ViewProcessor.prototype.applyUserOverwrite_ = function (oldViewCache, changePath, changedSnap, writesCache, completeCache, accumulator) {\r\n        var oldEventSnap = oldViewCache.getEventCache();\r\n        var newViewCache, newEventCache;\r\n        var source = new WriteTreeCompleteChildSource(writesCache, oldViewCache, completeCache);\r\n        if (changePath.isEmpty()) {\r\n            newEventCache = this.filter_.updateFullNode(oldViewCache.getEventCache().getNode(), changedSnap, accumulator);\r\n            newViewCache = oldViewCache.updateEventSnap(newEventCache, true, this.filter_.filtersNodes());\r\n        }\r\n        else {\r\n            var childKey = changePath.getFront();\r\n            if (childKey === '.priority') {\r\n                newEventCache = this.filter_.updatePriority(oldViewCache.getEventCache().getNode(), changedSnap);\r\n                newViewCache = oldViewCache.updateEventSnap(newEventCache, oldEventSnap.isFullyInitialized(), oldEventSnap.isFiltered());\r\n            }\r\n            else {\r\n                var childChangePath = changePath.popFront();\r\n                var oldChild = oldEventSnap.getNode().getImmediateChild(childKey);\r\n                var newChild = void 0;\r\n                if (childChangePath.isEmpty()) {\r\n                    // Child overwrite, we can replace the child\r\n                    newChild = changedSnap;\r\n                }\r\n                else {\r\n                    var childNode = source.getCompleteChild(childKey);\r\n                    if (childNode != null) {\r\n                        if (childChangePath.getBack() === '.priority' &&\r\n                            childNode.getChild(childChangePath.parent()).isEmpty()) {\r\n                            // This is a priority update on an empty node. If this node exists on the server, the\r\n                            // server will send down the priority in the update, so ignore for now\r\n                            newChild = childNode;\r\n                        }\r\n                        else {\r\n                            newChild = childNode.updateChild(childChangePath, changedSnap);\r\n                        }\r\n                    }\r\n                    else {\r\n                        // There is no complete child node available\r\n                        newChild = ChildrenNode.EMPTY_NODE;\r\n                    }\r\n                }\r\n                if (!oldChild.equals(newChild)) {\r\n                    var newEventSnap = this.filter_.updateChild(oldEventSnap.getNode(), childKey, newChild, childChangePath, source, accumulator);\r\n                    newViewCache = oldViewCache.updateEventSnap(newEventSnap, oldEventSnap.isFullyInitialized(), this.filter_.filtersNodes());\r\n                }\r\n                else {\r\n                    newViewCache = oldViewCache;\r\n                }\r\n            }\r\n        }\r\n        return newViewCache;\r\n    };\r\n    /**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {string} childKey\r\n     * @return {boolean}\r\n     * @private\r\n     */\r\n    ViewProcessor.cacheHasChild_ = function (viewCache, childKey) {\r\n        return viewCache.getEventCache().isCompleteForChild(childKey);\r\n    };\r\n    /**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {!Path} path\r\n     * @param {ImmutableTree.<!Node>} changedChildren\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} serverCache\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\r\n    ViewProcessor.prototype.applyUserMerge_ = function (viewCache, path, changedChildren, writesCache, serverCache, accumulator) {\r\n        var _this = this;\r\n        // HACK: In the case of a limit query, there may be some changes that bump things out of the\r\n        // window leaving room for new items.  It's important we process these changes first, so we\r\n        // iterate the changes twice, first processing any that affect items currently in view.\r\n        // TODO: I consider an item \"in view\" if cacheHasChild is true, which checks both the server\r\n        // and event snap.  I'm not sure if this will result in edge cases when a child is in one but\r\n        // not the other.\r\n        var curViewCache = viewCache;\r\n        changedChildren.foreach(function (relativePath, childNode) {\r\n            var writePath = path.child(relativePath);\r\n            if (ViewProcessor.cacheHasChild_(viewCache, writePath.getFront())) {\r\n                curViewCache = _this.applyUserOverwrite_(curViewCache, writePath, childNode, writesCache, serverCache, accumulator);\r\n            }\r\n        });\r\n        changedChildren.foreach(function (relativePath, childNode) {\r\n            var writePath = path.child(relativePath);\r\n            if (!ViewProcessor.cacheHasChild_(viewCache, writePath.getFront())) {\r\n                curViewCache = _this.applyUserOverwrite_(curViewCache, writePath, childNode, writesCache, serverCache, accumulator);\r\n            }\r\n        });\r\n        return curViewCache;\r\n    };\r\n    /**\r\n     * @param {!Node} node\r\n     * @param {ImmutableTree.<!Node>} merge\r\n     * @return {!Node}\r\n     * @private\r\n     */\r\n    ViewProcessor.prototype.applyMerge_ = function (node, merge) {\r\n        merge.foreach(function (relativePath, childNode) {\r\n            node = node.updateChild(relativePath, childNode);\r\n        });\r\n        return node;\r\n    };\r\n    /**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {!Path} path\r\n     * @param {!ImmutableTree.<!Node>} changedChildren\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} serverCache\r\n     * @param {boolean} filterServerNode\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\r\n    ViewProcessor.prototype.applyServerMerge_ = function (viewCache, path, changedChildren, writesCache, serverCache, filterServerNode, accumulator) {\r\n        var _this = this;\r\n        // If we don't have a cache yet, this merge was intended for a previously listen in the same location. Ignore it and\r\n        // wait for the complete data update coming soon.\r\n        if (viewCache\r\n            .getServerCache()\r\n            .getNode()\r\n            .isEmpty() &&\r\n            !viewCache.getServerCache().isFullyInitialized()) {\r\n            return viewCache;\r\n        }\r\n        // HACK: In the case of a limit query, there may be some changes that bump things out of the\r\n        // window leaving room for new items.  It's important we process these changes first, so we\r\n        // iterate the changes twice, first processing any that affect items currently in view.\r\n        // TODO: I consider an item \"in view\" if cacheHasChild is true, which checks both the server\r\n        // and event snap.  I'm not sure if this will result in edge cases when a child is in one but\r\n        // not the other.\r\n        var curViewCache = viewCache;\r\n        var viewMergeTree;\r\n        if (path.isEmpty()) {\r\n            viewMergeTree = changedChildren;\r\n        }\r\n        else {\r\n            viewMergeTree = ImmutableTree.Empty.setTree(path, changedChildren);\r\n        }\r\n        var serverNode = viewCache.getServerCache().getNode();\r\n        viewMergeTree.children.inorderTraversal(function (childKey, childTree) {\r\n            if (serverNode.hasChild(childKey)) {\r\n                var serverChild = viewCache\r\n                    .getServerCache()\r\n                    .getNode()\r\n                    .getImmediateChild(childKey);\r\n                var newChild = _this.applyMerge_(serverChild, childTree);\r\n                curViewCache = _this.applyServerOverwrite_(curViewCache, new Path(childKey), newChild, writesCache, serverCache, filterServerNode, accumulator);\r\n            }\r\n        });\r\n        viewMergeTree.children.inorderTraversal(function (childKey, childMergeTree) {\r\n            var isUnknownDeepMerge = !viewCache.getServerCache().isCompleteForChild(childKey) &&\r\n                childMergeTree.value == null;\r\n            if (!serverNode.hasChild(childKey) && !isUnknownDeepMerge) {\r\n                var serverChild = viewCache\r\n                    .getServerCache()\r\n                    .getNode()\r\n                    .getImmediateChild(childKey);\r\n                var newChild = _this.applyMerge_(serverChild, childMergeTree);\r\n                curViewCache = _this.applyServerOverwrite_(curViewCache, new Path(childKey), newChild, writesCache, serverCache, filterServerNode, accumulator);\r\n            }\r\n        });\r\n        return curViewCache;\r\n    };\r\n    /**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {!Path} ackPath\r\n     * @param {!ImmutableTree<!boolean>} affectedTree\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} completeCache\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\r\n    ViewProcessor.prototype.ackUserWrite_ = function (viewCache, ackPath, affectedTree, writesCache, completeCache, accumulator) {\r\n        if (writesCache.shadowingWrite(ackPath) != null) {\r\n            return viewCache;\r\n        }\r\n        // Only filter server node if it is currently filtered\r\n        var filterServerNode = viewCache.getServerCache().isFiltered();\r\n        // Essentially we'll just get our existing server cache for the affected paths and re-apply it as a server update\r\n        // now that it won't be shadowed.\r\n        var serverCache = viewCache.getServerCache();\r\n        if (affectedTree.value != null) {\r\n            // This is an overwrite.\r\n            if ((ackPath.isEmpty() && serverCache.isFullyInitialized()) ||\r\n                serverCache.isCompleteForPath(ackPath)) {\r\n                return this.applyServerOverwrite_(viewCache, ackPath, serverCache.getNode().getChild(ackPath), writesCache, completeCache, filterServerNode, accumulator);\r\n            }\r\n            else if (ackPath.isEmpty()) {\r\n                // This is a goofy edge case where we are acking data at this location but don't have full data.  We\r\n                // should just re-apply whatever we have in our cache as a merge.\r\n                var changedChildren_1 = ImmutableTree.Empty;\r\n                serverCache.getNode().forEachChild(KEY_INDEX, function (name, node) {\r\n                    changedChildren_1 = changedChildren_1.set(new Path(name), node);\r\n                });\r\n                return this.applyServerMerge_(viewCache, ackPath, changedChildren_1, writesCache, completeCache, filterServerNode, accumulator);\r\n            }\r\n            else {\r\n                return viewCache;\r\n            }\r\n        }\r\n        else {\r\n            // This is a merge.\r\n            var changedChildren_2 = ImmutableTree.Empty;\r\n            affectedTree.foreach(function (mergePath, value) {\r\n                var serverCachePath = ackPath.child(mergePath);\r\n                if (serverCache.isCompleteForPath(serverCachePath)) {\r\n                    changedChildren_2 = changedChildren_2.set(mergePath, serverCache.getNode().getChild(serverCachePath));\r\n                }\r\n            });\r\n            return this.applyServerMerge_(viewCache, ackPath, changedChildren_2, writesCache, completeCache, filterServerNode, accumulator);\r\n        }\r\n    };\r\n    /**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {!Path} path\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\r\n    ViewProcessor.prototype.listenComplete_ = function (viewCache, path, writesCache, accumulator) {\r\n        var oldServerNode = viewCache.getServerCache();\r\n        var newViewCache = viewCache.updateServerSnap(oldServerNode.getNode(), oldServerNode.isFullyInitialized() || path.isEmpty(), oldServerNode.isFiltered());\r\n        return this.generateEventCacheAfterServerEvent_(newViewCache, path, writesCache, NO_COMPLETE_CHILD_SOURCE, accumulator);\r\n    };\r\n    /**\r\n     * @param {!ViewCache} viewCache\r\n     * @param {!Path} path\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} completeServerCache\r\n     * @param {!ChildChangeAccumulator} accumulator\r\n     * @return {!ViewCache}\r\n     * @private\r\n     */\r\n    ViewProcessor.prototype.revertUserWrite_ = function (viewCache, path, writesCache, completeServerCache, accumulator) {\r\n        var complete;\r\n        if (writesCache.shadowingWrite(path) != null) {\r\n            return viewCache;\r\n        }\r\n        else {\r\n            var source = new WriteTreeCompleteChildSource(writesCache, viewCache, completeServerCache);\r\n            var oldEventCache = viewCache.getEventCache().getNode();\r\n            var newEventCache = void 0;\r\n            if (path.isEmpty() || path.getFront() === '.priority') {\r\n                var newNode = void 0;\r\n                if (viewCache.getServerCache().isFullyInitialized()) {\r\n                    newNode = writesCache.calcCompleteEventCache(viewCache.getCompleteServerSnap());\r\n                }\r\n                else {\r\n                    var serverChildren = viewCache.getServerCache().getNode();\r\n                    assert(serverChildren instanceof ChildrenNode, 'serverChildren would be complete if leaf node');\r\n                    newNode = writesCache.calcCompleteEventChildren(serverChildren);\r\n                }\r\n                newNode = newNode;\r\n                newEventCache = this.filter_.updateFullNode(oldEventCache, newNode, accumulator);\r\n            }\r\n            else {\r\n                var childKey = path.getFront();\r\n                var newChild = writesCache.calcCompleteChild(childKey, viewCache.getServerCache());\r\n                if (newChild == null &&\r\n                    viewCache.getServerCache().isCompleteForChild(childKey)) {\r\n                    newChild = oldEventCache.getImmediateChild(childKey);\r\n                }\r\n                if (newChild != null) {\r\n                    newEventCache = this.filter_.updateChild(oldEventCache, childKey, newChild, path.popFront(), source, accumulator);\r\n                }\r\n                else if (viewCache\r\n                    .getEventCache()\r\n                    .getNode()\r\n                    .hasChild(childKey)) {\r\n                    // No complete child available, delete the existing one, if any\r\n                    newEventCache = this.filter_.updateChild(oldEventCache, childKey, ChildrenNode.EMPTY_NODE, path.popFront(), source, accumulator);\r\n                }\r\n                else {\r\n                    newEventCache = oldEventCache;\r\n                }\r\n                if (newEventCache.isEmpty() &&\r\n                    viewCache.getServerCache().isFullyInitialized()) {\r\n                    // We might have reverted all child writes. Maybe the old event was a leaf node\r\n                    complete = writesCache.calcCompleteEventCache(viewCache.getCompleteServerSnap());\r\n                    if (complete.isLeafNode()) {\r\n                        newEventCache = this.filter_.updateFullNode(newEventCache, complete, accumulator);\r\n                    }\r\n                }\r\n            }\r\n            complete =\r\n                viewCache.getServerCache().isFullyInitialized() ||\r\n                    writesCache.shadowingWrite(Path.Empty) != null;\r\n            return viewCache.updateEventSnap(newEventCache, complete, this.filter_.filtersNodes());\r\n        }\r\n    };\r\n    return ViewProcessor;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * An EventGenerator is used to convert \"raw\" changes (Change) as computed by the\r\n * CacheDiffer into actual events (Event) that can be raised.  See generateEventsForChanges()\r\n * for details.\r\n *\r\n * @constructor\r\n */\r\nvar EventGenerator = /** @class */ (function () {\r\n    /**\r\n     *\r\n     * @param {!Query} query_\r\n     */\r\n    function EventGenerator(query_) {\r\n        this.query_ = query_;\r\n        /**\r\n         * @private\r\n         * @type {!Index}\r\n         */\r\n        this.index_ = this.query_.getQueryParams().getIndex();\r\n    }\r\n    /**\r\n     * Given a set of raw changes (no moved events and prevName not specified yet), and a set of\r\n     * EventRegistrations that should be notified of these changes, generate the actual events to be raised.\r\n     *\r\n     * Notes:\r\n     *  - child_moved events will be synthesized at this time for any child_changed events that affect\r\n     *    our index.\r\n     *  - prevName will be calculated based on the index ordering.\r\n     *\r\n     * @param {!Array.<!Change>} changes\r\n     * @param {!Node} eventCache\r\n     * @param {!Array.<!EventRegistration>} eventRegistrations\r\n     * @return {!Array.<!Event>}\r\n     */\r\n    EventGenerator.prototype.generateEventsForChanges = function (changes, eventCache, eventRegistrations) {\r\n        var _this = this;\r\n        var events = [];\r\n        var moves = [];\r\n        changes.forEach(function (change) {\r\n            if (change.type === Change.CHILD_CHANGED &&\r\n                _this.index_.indexedValueChanged(change.oldSnap, change.snapshotNode)) {\r\n                moves.push(Change.childMovedChange(change.childName, change.snapshotNode));\r\n            }\r\n        });\r\n        this.generateEventsForType_(events, Change.CHILD_REMOVED, changes, eventRegistrations, eventCache);\r\n        this.generateEventsForType_(events, Change.CHILD_ADDED, changes, eventRegistrations, eventCache);\r\n        this.generateEventsForType_(events, Change.CHILD_MOVED, moves, eventRegistrations, eventCache);\r\n        this.generateEventsForType_(events, Change.CHILD_CHANGED, changes, eventRegistrations, eventCache);\r\n        this.generateEventsForType_(events, Change.VALUE, changes, eventRegistrations, eventCache);\r\n        return events;\r\n    };\r\n    /**\r\n     * Given changes of a single change type, generate the corresponding events.\r\n     *\r\n     * @param {!Array.<!Event>} events\r\n     * @param {!string} eventType\r\n     * @param {!Array.<!Change>} changes\r\n     * @param {!Array.<!EventRegistration>} registrations\r\n     * @param {!Node} eventCache\r\n     * @private\r\n     */\r\n    EventGenerator.prototype.generateEventsForType_ = function (events, eventType, changes, registrations, eventCache) {\r\n        var _this = this;\r\n        var filteredChanges = changes.filter(function (change) { return change.type === eventType; });\r\n        filteredChanges.sort(this.compareChanges_.bind(this));\r\n        filteredChanges.forEach(function (change) {\r\n            var materializedChange = _this.materializeSingleChange_(change, eventCache);\r\n            registrations.forEach(function (registration) {\r\n                if (registration.respondsTo(change.type)) {\r\n                    events.push(registration.createEvent(materializedChange, _this.query_));\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * @param {!Change} change\r\n     * @param {!Node} eventCache\r\n     * @return {!Change}\r\n     * @private\r\n     */\r\n    EventGenerator.prototype.materializeSingleChange_ = function (change, eventCache) {\r\n        if (change.type === 'value' || change.type === 'child_removed') {\r\n            return change;\r\n        }\r\n        else {\r\n            change.prevName = eventCache.getPredecessorChildName(\r\n            /** @type {!string} */\r\n            change.childName, change.snapshotNode, this.index_);\r\n            return change;\r\n        }\r\n    };\r\n    /**\r\n     * @param {!Change} a\r\n     * @param {!Change} b\r\n     * @return {number}\r\n     * @private\r\n     */\r\n    EventGenerator.prototype.compareChanges_ = function (a, b) {\r\n        if (a.childName == null || b.childName == null) {\r\n            throw assertionError('Should only compare child_ events.');\r\n        }\r\n        var aWrapped = new NamedNode(a.childName, a.snapshotNode);\r\n        var bWrapped = new NamedNode(b.childName, b.snapshotNode);\r\n        return this.index_.compare(aWrapped, bWrapped);\r\n    };\r\n    return EventGenerator;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * A view represents a specific location and query that has 1 or more event registrations.\r\n *\r\n * It does several things:\r\n *  - Maintains the list of event registrations for this location/query.\r\n *  - Maintains a cache of the data visible for this location/query.\r\n *  - Applies new operations (via applyOperation), updates the cache, and based on the event\r\n *    registrations returns the set of events to be raised.\r\n * @constructor\r\n */\r\nvar View = /** @class */ (function () {\r\n    /**\r\n     *\r\n     * @param {!Query} query_\r\n     * @param {!ViewCache} initialViewCache\r\n     */\r\n    function View(query_, initialViewCache) {\r\n        this.query_ = query_;\r\n        this.eventRegistrations_ = [];\r\n        var params = this.query_.getQueryParams();\r\n        var indexFilter = new IndexedFilter(params.getIndex());\r\n        var filter = params.getNodeFilter();\r\n        /**\r\n         * @type {ViewProcessor}\r\n         * @private\r\n         */\r\n        this.processor_ = new ViewProcessor(filter);\r\n        var initialServerCache = initialViewCache.getServerCache();\r\n        var initialEventCache = initialViewCache.getEventCache();\r\n        // Don't filter server node with other filter than index, wait for tagged listen\r\n        var serverSnap = indexFilter.updateFullNode(ChildrenNode.EMPTY_NODE, initialServerCache.getNode(), null);\r\n        var eventSnap = filter.updateFullNode(ChildrenNode.EMPTY_NODE, initialEventCache.getNode(), null);\r\n        var newServerCache = new CacheNode(serverSnap, initialServerCache.isFullyInitialized(), indexFilter.filtersNodes());\r\n        var newEventCache = new CacheNode(eventSnap, initialEventCache.isFullyInitialized(), filter.filtersNodes());\r\n        /**\r\n         * @type {!ViewCache}\r\n         * @private\r\n         */\r\n        this.viewCache_ = new ViewCache(newEventCache, newServerCache);\r\n        /**\r\n         * @type {!EventGenerator}\r\n         * @private\r\n         */\r\n        this.eventGenerator_ = new EventGenerator(this.query_);\r\n    }\r\n    /**\r\n     * @return {!Query}\r\n     */\r\n    View.prototype.getQuery = function () {\r\n        return this.query_;\r\n    };\r\n    /**\r\n     * @return {?Node}\r\n     */\r\n    View.prototype.getServerCache = function () {\r\n        return this.viewCache_.getServerCache().getNode();\r\n    };\r\n    /**\r\n     * @param {!Path} path\r\n     * @return {?Node}\r\n     */\r\n    View.prototype.getCompleteServerCache = function (path) {\r\n        var cache = this.viewCache_.getCompleteServerSnap();\r\n        if (cache) {\r\n            // If this isn't a \"loadsAllData\" view, then cache isn't actually a complete cache and\r\n            // we need to see if it contains the child we're interested in.\r\n            if (this.query_.getQueryParams().loadsAllData() ||\r\n                (!path.isEmpty() && !cache.getImmediateChild(path.getFront()).isEmpty())) {\r\n                return cache.getChild(path);\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    /**\r\n     * @return {boolean}\r\n     */\r\n    View.prototype.isEmpty = function () {\r\n        return this.eventRegistrations_.length === 0;\r\n    };\r\n    /**\r\n     * @param {!EventRegistration} eventRegistration\r\n     */\r\n    View.prototype.addEventRegistration = function (eventRegistration) {\r\n        this.eventRegistrations_.push(eventRegistration);\r\n    };\r\n    /**\r\n     * @param {?EventRegistration} eventRegistration If null, remove all callbacks.\r\n     * @param {Error=} cancelError If a cancelError is provided, appropriate cancel events will be returned.\r\n     * @return {!Array.<!Event>} Cancel events, if cancelError was provided.\r\n     */\r\n    View.prototype.removeEventRegistration = function (eventRegistration, cancelError) {\r\n        var cancelEvents = [];\r\n        if (cancelError) {\r\n            assert(eventRegistration == null, 'A cancel should cancel all event registrations.');\r\n            var path_1 = this.query_.path;\r\n            this.eventRegistrations_.forEach(function (registration) {\r\n                cancelError /** @type {!Error} */ = cancelError;\r\n                var maybeEvent = registration.createCancelEvent(cancelError, path_1);\r\n                if (maybeEvent) {\r\n                    cancelEvents.push(maybeEvent);\r\n                }\r\n            });\r\n        }\r\n        if (eventRegistration) {\r\n            var remaining = [];\r\n            for (var i = 0; i < this.eventRegistrations_.length; ++i) {\r\n                var existing = this.eventRegistrations_[i];\r\n                if (!existing.matches(eventRegistration)) {\r\n                    remaining.push(existing);\r\n                }\r\n                else if (eventRegistration.hasAnyCallback()) {\r\n                    // We're removing just this one\r\n                    remaining = remaining.concat(this.eventRegistrations_.slice(i + 1));\r\n                    break;\r\n                }\r\n            }\r\n            this.eventRegistrations_ = remaining;\r\n        }\r\n        else {\r\n            this.eventRegistrations_ = [];\r\n        }\r\n        return cancelEvents;\r\n    };\r\n    /**\r\n     * Applies the given Operation, updates our cache, and returns the appropriate events.\r\n     *\r\n     * @param {!Operation} operation\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} completeServerCache\r\n     * @return {!Array.<!Event>}\r\n     */\r\n    View.prototype.applyOperation = function (operation, writesCache, completeServerCache) {\r\n        if (operation.type === OperationType.MERGE &&\r\n            operation.source.queryId !== null) {\r\n            assert(this.viewCache_.getCompleteServerSnap(), 'We should always have a full cache before handling merges');\r\n            assert(this.viewCache_.getCompleteEventSnap(), 'Missing event cache, even though we have a server cache');\r\n        }\r\n        var oldViewCache = this.viewCache_;\r\n        var result = this.processor_.applyOperation(oldViewCache, operation, writesCache, completeServerCache);\r\n        this.processor_.assertIndexed(result.viewCache);\r\n        assert(result.viewCache.getServerCache().isFullyInitialized() ||\r\n            !oldViewCache.getServerCache().isFullyInitialized(), 'Once a server snap is complete, it should never go back');\r\n        this.viewCache_ = result.viewCache;\r\n        return this.generateEventsForChanges_(result.changes, result.viewCache.getEventCache().getNode(), null);\r\n    };\r\n    /**\r\n     * @param {!EventRegistration} registration\r\n     * @return {!Array.<!Event>}\r\n     */\r\n    View.prototype.getInitialEvents = function (registration) {\r\n        var eventSnap = this.viewCache_.getEventCache();\r\n        var initialChanges = [];\r\n        if (!eventSnap.getNode().isLeafNode()) {\r\n            var eventNode = eventSnap.getNode();\r\n            eventNode.forEachChild(PRIORITY_INDEX, function (key, childNode) {\r\n                initialChanges.push(Change.childAddedChange(key, childNode));\r\n            });\r\n        }\r\n        if (eventSnap.isFullyInitialized()) {\r\n            initialChanges.push(Change.valueChange(eventSnap.getNode()));\r\n        }\r\n        return this.generateEventsForChanges_(initialChanges, eventSnap.getNode(), registration);\r\n    };\r\n    /**\r\n     * @private\r\n     * @param {!Array.<!Change>} changes\r\n     * @param {!Node} eventCache\r\n     * @param {EventRegistration=} eventRegistration\r\n     * @return {!Array.<!Event>}\r\n     */\r\n    View.prototype.generateEventsForChanges_ = function (changes, eventCache, eventRegistration) {\r\n        var registrations = eventRegistration\r\n            ? [eventRegistration]\r\n            : this.eventRegistrations_;\r\n        return this.eventGenerator_.generateEventsForChanges(changes, eventCache, registrations);\r\n    };\r\n    return View;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar __referenceConstructor$1;\r\n/**\r\n * SyncPoint represents a single location in a SyncTree with 1 or more event registrations, meaning we need to\r\n * maintain 1 or more Views at this location to cache server data and raise appropriate events for server changes\r\n * and user writes (set, transaction, update).\r\n *\r\n * It's responsible for:\r\n *  - Maintaining the set of 1 or more views necessary at this location (a SyncPoint with 0 views should be removed).\r\n *  - Proxying user / server operations to the views as appropriate (i.e. applyServerOverwrite,\r\n *    applyUserOverwrite, etc.)\r\n */\r\nvar SyncPoint = /** @class */ (function () {\r\n    function SyncPoint() {\r\n        /**\r\n         * The Views being tracked at this location in the tree, stored as a map where the key is a\r\n         * queryId and the value is the View for that query.\r\n         *\r\n         * NOTE: This list will be quite small (usually 1, but perhaps 2 or 3; any more is an odd use case).\r\n         *\r\n         * @type {!Object.<!string, !View>}\r\n         * @private\r\n         */\r\n        this.views_ = {};\r\n    }\r\n    Object.defineProperty(SyncPoint, \"__referenceConstructor\", {\r\n        get: function () {\r\n            assert(__referenceConstructor$1, 'Reference.ts has not been loaded');\r\n            return __referenceConstructor$1;\r\n        },\r\n        set: function (val) {\r\n            assert(!__referenceConstructor$1, '__referenceConstructor has already been defined');\r\n            __referenceConstructor$1 = val;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * @return {boolean}\r\n     */\r\n    SyncPoint.prototype.isEmpty = function () {\r\n        return isEmpty(this.views_);\r\n    };\r\n    /**\r\n     *\r\n     * @param {!Operation} operation\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} optCompleteServerCache\r\n     * @return {!Array.<!Event>}\r\n     */\r\n    SyncPoint.prototype.applyOperation = function (operation, writesCache, optCompleteServerCache) {\r\n        var queryId = operation.source.queryId;\r\n        if (queryId !== null) {\r\n            var view = safeGet(this.views_, queryId);\r\n            assert(view != null, 'SyncTree gave us an op for an invalid query.');\r\n            return view.applyOperation(operation, writesCache, optCompleteServerCache);\r\n        }\r\n        else {\r\n            var events_1 = [];\r\n            forEach(this.views_, function (key, view) {\r\n                events_1 = events_1.concat(view.applyOperation(operation, writesCache, optCompleteServerCache));\r\n            });\r\n            return events_1;\r\n        }\r\n    };\r\n    /**\r\n     * Add an event callback for the specified query.\r\n     *\r\n     * @param {!Query} query\r\n     * @param {!EventRegistration} eventRegistration\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @param {?Node} serverCache Complete server cache, if we have it.\r\n     * @param {boolean} serverCacheComplete\r\n     * @return {!Array.<!Event>} Events to raise.\r\n     */\r\n    SyncPoint.prototype.addEventRegistration = function (query, eventRegistration, writesCache, serverCache, serverCacheComplete) {\r\n        var queryId = query.queryIdentifier();\r\n        var view = safeGet(this.views_, queryId);\r\n        if (!view) {\r\n            // TODO: make writesCache take flag for complete server node\r\n            var eventCache = writesCache.calcCompleteEventCache(serverCacheComplete ? serverCache : null);\r\n            var eventCacheComplete = false;\r\n            if (eventCache) {\r\n                eventCacheComplete = true;\r\n            }\r\n            else if (serverCache instanceof ChildrenNode) {\r\n                eventCache = writesCache.calcCompleteEventChildren(serverCache);\r\n                eventCacheComplete = false;\r\n            }\r\n            else {\r\n                eventCache = ChildrenNode.EMPTY_NODE;\r\n                eventCacheComplete = false;\r\n            }\r\n            var viewCache = new ViewCache(new CacheNode(\r\n            /** @type {!Node} */ (eventCache), eventCacheComplete, false), new CacheNode(\r\n            /** @type {!Node} */ (serverCache), serverCacheComplete, false));\r\n            view = new View(query, viewCache);\r\n            this.views_[queryId] = view;\r\n        }\r\n        // This is guaranteed to exist now, we just created anything that was missing\r\n        view.addEventRegistration(eventRegistration);\r\n        return view.getInitialEvents(eventRegistration);\r\n    };\r\n    /**\r\n     * Remove event callback(s).  Return cancelEvents if a cancelError is specified.\r\n     *\r\n     * If query is the default query, we'll check all views for the specified eventRegistration.\r\n     * If eventRegistration is null, we'll remove all callbacks for the specified view(s).\r\n     *\r\n     * @param {!Query} query\r\n     * @param {?EventRegistration} eventRegistration If null, remove all callbacks.\r\n     * @param {Error=} cancelError If a cancelError is provided, appropriate cancel events will be returned.\r\n     * @return {{removed:!Array.<!Query>, events:!Array.<!Event>}} removed queries and any cancel events\r\n     */\r\n    SyncPoint.prototype.removeEventRegistration = function (query, eventRegistration, cancelError) {\r\n        var queryId = query.queryIdentifier();\r\n        var removed = [];\r\n        var cancelEvents = [];\r\n        var hadCompleteView = this.hasCompleteView();\r\n        if (queryId === 'default') {\r\n            // When you do ref.off(...), we search all views for the registration to remove.\r\n            var self_1 = this;\r\n            forEach(this.views_, function (viewQueryId, view) {\r\n                cancelEvents = cancelEvents.concat(view.removeEventRegistration(eventRegistration, cancelError));\r\n                if (view.isEmpty()) {\r\n                    delete self_1.views_[viewQueryId];\r\n                    // We'll deal with complete views later.\r\n                    if (!view\r\n                        .getQuery()\r\n                        .getQueryParams()\r\n                        .loadsAllData()) {\r\n                        removed.push(view.getQuery());\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            // remove the callback from the specific view.\r\n            var view = safeGet(this.views_, queryId);\r\n            if (view) {\r\n                cancelEvents = cancelEvents.concat(view.removeEventRegistration(eventRegistration, cancelError));\r\n                if (view.isEmpty()) {\r\n                    delete this.views_[queryId];\r\n                    // We'll deal with complete views later.\r\n                    if (!view\r\n                        .getQuery()\r\n                        .getQueryParams()\r\n                        .loadsAllData()) {\r\n                        removed.push(view.getQuery());\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (hadCompleteView && !this.hasCompleteView()) {\r\n            // We removed our last complete view.\r\n            removed.push(new SyncPoint.__referenceConstructor(query.repo, query.path));\r\n        }\r\n        return { removed: removed, events: cancelEvents };\r\n    };\r\n    /**\r\n     * @return {!Array.<!View>}\r\n     */\r\n    SyncPoint.prototype.getQueryViews = function () {\r\n        var _this = this;\r\n        var values = Object.keys(this.views_).map(function (key) { return _this.views_[key]; });\r\n        return values.filter(function (view) {\r\n            return !view\r\n                .getQuery()\r\n                .getQueryParams()\r\n                .loadsAllData();\r\n        });\r\n    };\r\n    /**\r\n     *\r\n     * @param {!Path} path The path to the desired complete snapshot\r\n     * @return {?Node} A complete cache, if it exists\r\n     */\r\n    SyncPoint.prototype.getCompleteServerCache = function (path) {\r\n        var serverCache = null;\r\n        forEach(this.views_, function (key, view) {\r\n            serverCache = serverCache || view.getCompleteServerCache(path);\r\n        });\r\n        return serverCache;\r\n    };\r\n    /**\r\n     * @param {!Query} query\r\n     * @return {?View}\r\n     */\r\n    SyncPoint.prototype.viewForQuery = function (query) {\r\n        var params = query.getQueryParams();\r\n        if (params.loadsAllData()) {\r\n            return this.getCompleteView();\r\n        }\r\n        else {\r\n            var queryId = query.queryIdentifier();\r\n            return safeGet(this.views_, queryId);\r\n        }\r\n    };\r\n    /**\r\n     * @param {!Query} query\r\n     * @return {boolean}\r\n     */\r\n    SyncPoint.prototype.viewExistsForQuery = function (query) {\r\n        return this.viewForQuery(query) != null;\r\n    };\r\n    /**\r\n     * @return {boolean}\r\n     */\r\n    SyncPoint.prototype.hasCompleteView = function () {\r\n        return this.getCompleteView() != null;\r\n    };\r\n    /**\r\n     * @return {?View}\r\n     */\r\n    SyncPoint.prototype.getCompleteView = function () {\r\n        var completeView = findValue(this.views_, function (view) {\r\n            return view\r\n                .getQuery()\r\n                .getQueryParams()\r\n                .loadsAllData();\r\n        });\r\n        return completeView || null;\r\n    };\r\n    return SyncPoint;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * This class holds a collection of writes that can be applied to nodes in unison. It abstracts away the logic with\r\n * dealing with priority writes and multiple nested writes. At any given path there is only allowed to be one write\r\n * modifying that path. Any write to an existing path or shadowing an existing path will modify that existing write\r\n * to reflect the write added.\r\n *\r\n * @constructor\r\n * @param {!ImmutableTree.<!Node>} writeTree\r\n */\r\nvar CompoundWrite = /** @class */ (function () {\r\n    function CompoundWrite(writeTree_) {\r\n        this.writeTree_ = writeTree_;\r\n    }\r\n    /**\r\n     * @param {!Path} path\r\n     * @param {!Node} node\r\n     * @return {!CompoundWrite}\r\n     */\r\n    CompoundWrite.prototype.addWrite = function (path, node) {\r\n        if (path.isEmpty()) {\r\n            return new CompoundWrite(new ImmutableTree(node));\r\n        }\r\n        else {\r\n            var rootmost = this.writeTree_.findRootMostValueAndPath(path);\r\n            if (rootmost != null) {\r\n                var rootMostPath = rootmost.path;\r\n                var value = rootmost.value;\r\n                var relativePath = Path.relativePath(rootMostPath, path);\r\n                value = value.updateChild(relativePath, node);\r\n                return new CompoundWrite(this.writeTree_.set(rootMostPath, value));\r\n            }\r\n            else {\r\n                var subtree = new ImmutableTree(node);\r\n                var newWriteTree = this.writeTree_.setTree(path, subtree);\r\n                return new CompoundWrite(newWriteTree);\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * @param {!Path} path\r\n     * @param {!Object.<string, !Node>} updates\r\n     * @return {!CompoundWrite}\r\n     */\r\n    CompoundWrite.prototype.addWrites = function (path, updates) {\r\n        var newWrite = this;\r\n        forEach(updates, function (childKey, node) {\r\n            newWrite = newWrite.addWrite(path.child(childKey), node);\r\n        });\r\n        return newWrite;\r\n    };\r\n    /**\r\n     * Will remove a write at the given path and deeper paths. This will <em>not</em> modify a write at a higher\r\n     * location, which must be removed by calling this method with that path.\r\n     *\r\n     * @param {!Path} path The path at which a write and all deeper writes should be removed\r\n     * @return {!CompoundWrite} The new CompoundWrite with the removed path\r\n     */\r\n    CompoundWrite.prototype.removeWrite = function (path) {\r\n        if (path.isEmpty()) {\r\n            return CompoundWrite.Empty;\r\n        }\r\n        else {\r\n            var newWriteTree = this.writeTree_.setTree(path, ImmutableTree.Empty);\r\n            return new CompoundWrite(newWriteTree);\r\n        }\r\n    };\r\n    /**\r\n     * Returns whether this CompoundWrite will fully overwrite a node at a given location and can therefore be\r\n     * considered \"complete\".\r\n     *\r\n     * @param {!Path} path The path to check for\r\n     * @return {boolean} Whether there is a complete write at that path\r\n     */\r\n    CompoundWrite.prototype.hasCompleteWrite = function (path) {\r\n        return this.getCompleteNode(path) != null;\r\n    };\r\n    /**\r\n     * Returns a node for a path if and only if the node is a \"complete\" overwrite at that path. This will not aggregate\r\n     * writes from deeper paths, but will return child nodes from a more shallow path.\r\n     *\r\n     * @param {!Path} path The path to get a complete write\r\n     * @return {?Node} The node if complete at that path, or null otherwise.\r\n     */\r\n    CompoundWrite.prototype.getCompleteNode = function (path) {\r\n        var rootmost = this.writeTree_.findRootMostValueAndPath(path);\r\n        if (rootmost != null) {\r\n            return this.writeTree_\r\n                .get(rootmost.path)\r\n                .getChild(Path.relativePath(rootmost.path, path));\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    };\r\n    /**\r\n     * Returns all children that are guaranteed to be a complete overwrite.\r\n     *\r\n     * @return {!Array.<NamedNode>} A list of all complete children.\r\n     */\r\n    CompoundWrite.prototype.getCompleteChildren = function () {\r\n        var children = [];\r\n        var node = this.writeTree_.value;\r\n        if (node != null) {\r\n            // If it's a leaf node, it has no children; so nothing to do.\r\n            if (!node.isLeafNode()) {\r\n                node.forEachChild(PRIORITY_INDEX, function (childName, childNode) {\r\n                    children.push(new NamedNode(childName, childNode));\r\n                });\r\n            }\r\n        }\r\n        else {\r\n            this.writeTree_.children.inorderTraversal(function (childName, childTree) {\r\n                if (childTree.value != null) {\r\n                    children.push(new NamedNode(childName, childTree.value));\r\n                }\r\n            });\r\n        }\r\n        return children;\r\n    };\r\n    /**\r\n     * @param {!Path} path\r\n     * @return {!CompoundWrite}\r\n     */\r\n    CompoundWrite.prototype.childCompoundWrite = function (path) {\r\n        if (path.isEmpty()) {\r\n            return this;\r\n        }\r\n        else {\r\n            var shadowingNode = this.getCompleteNode(path);\r\n            if (shadowingNode != null) {\r\n                return new CompoundWrite(new ImmutableTree(shadowingNode));\r\n            }\r\n            else {\r\n                return new CompoundWrite(this.writeTree_.subtree(path));\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Returns true if this CompoundWrite is empty and therefore does not modify any nodes.\r\n     * @return {boolean} Whether this CompoundWrite is empty\r\n     */\r\n    CompoundWrite.prototype.isEmpty = function () {\r\n        return this.writeTree_.isEmpty();\r\n    };\r\n    /**\r\n     * Applies this CompoundWrite to a node. The node is returned with all writes from this CompoundWrite applied to the\r\n     * node\r\n     * @param {!Node} node The node to apply this CompoundWrite to\r\n     * @return {!Node} The node with all writes applied\r\n     */\r\n    CompoundWrite.prototype.apply = function (node) {\r\n        return CompoundWrite.applySubtreeWrite_(Path.Empty, this.writeTree_, node);\r\n    };\r\n    /**\r\n     * @type {!CompoundWrite}\r\n     */\r\n    CompoundWrite.Empty = new CompoundWrite(new ImmutableTree(null));\r\n    /**\r\n     * @param {!Path} relativePath\r\n     * @param {!ImmutableTree.<!Node>} writeTree\r\n     * @param {!Node} node\r\n     * @return {!Node}\r\n     * @private\r\n     */\r\n    CompoundWrite.applySubtreeWrite_ = function (relativePath, writeTree, node) {\r\n        if (writeTree.value != null) {\r\n            // Since there a write is always a leaf, we're done here\r\n            return node.updateChild(relativePath, writeTree.value);\r\n        }\r\n        else {\r\n            var priorityWrite_1 = null;\r\n            writeTree.children.inorderTraversal(function (childKey, childTree) {\r\n                if (childKey === '.priority') {\r\n                    // Apply priorities at the end so we don't update priorities for either empty nodes or forget\r\n                    // to apply priorities to empty nodes that are later filled\r\n                    assert(childTree.value !== null, 'Priority writes must always be leaf nodes');\r\n                    priorityWrite_1 = childTree.value;\r\n                }\r\n                else {\r\n                    node = CompoundWrite.applySubtreeWrite_(relativePath.child(childKey), childTree, node);\r\n                }\r\n            });\r\n            // If there was a priority write, we only apply it if the node is not empty\r\n            if (!node.getChild(relativePath).isEmpty() && priorityWrite_1 !== null) {\r\n                node = node.updateChild(relativePath.child('.priority'), priorityWrite_1);\r\n            }\r\n            return node;\r\n        }\r\n    };\r\n    return CompoundWrite;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * WriteTree tracks all pending user-initiated writes and has methods to calculate the result of merging them\r\n * with underlying server data (to create \"event cache\" data).  Pending writes are added with addOverwrite()\r\n * and addMerge(), and removed with removeWrite().\r\n *\r\n * @constructor\r\n */\r\nvar WriteTree = /** @class */ (function () {\r\n    function WriteTree() {\r\n        /**\r\n         * A tree tracking the result of applying all visible writes.  This does not include transactions with\r\n         * applyLocally=false or writes that are completely shadowed by other writes.\r\n         *\r\n         * @type {!CompoundWrite}\r\n         * @private\r\n         */\r\n        this.visibleWrites_ = CompoundWrite.Empty;\r\n        /**\r\n         * A list of all pending writes, regardless of visibility and shadowed-ness.  Used to calculate arbitrary\r\n         * sets of the changed data, such as hidden writes (from transactions) or changes with certain writes excluded (also\r\n         * used by transactions).\r\n         *\r\n         * @type {!Array.<!WriteRecord>}\r\n         * @private\r\n         */\r\n        this.allWrites_ = [];\r\n        this.lastWriteId_ = -1;\r\n    }\r\n    /**\r\n     * Create a new WriteTreeRef for the given path. For use with a new sync point at the given path.\r\n     *\r\n     * @param {!Path} path\r\n     * @return {!WriteTreeRef}\r\n     */\r\n    WriteTree.prototype.childWrites = function (path) {\r\n        return new WriteTreeRef(path, this);\r\n    };\r\n    /**\r\n     * Record a new overwrite from user code.\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!Node} snap\r\n     * @param {!number} writeId\r\n     * @param {boolean=} visible This is set to false by some transactions. It should be excluded from event caches\r\n     */\r\n    WriteTree.prototype.addOverwrite = function (path, snap, writeId, visible) {\r\n        assert(writeId > this.lastWriteId_, 'Stacking an older write on top of newer ones');\r\n        if (visible === undefined) {\r\n            visible = true;\r\n        }\r\n        this.allWrites_.push({\r\n            path: path,\r\n            snap: snap,\r\n            writeId: writeId,\r\n            visible: visible\r\n        });\r\n        if (visible) {\r\n            this.visibleWrites_ = this.visibleWrites_.addWrite(path, snap);\r\n        }\r\n        this.lastWriteId_ = writeId;\r\n    };\r\n    /**\r\n     * Record a new merge from user code.\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!Object.<string, !Node>} changedChildren\r\n     * @param {!number} writeId\r\n     */\r\n    WriteTree.prototype.addMerge = function (path, changedChildren, writeId) {\r\n        assert(writeId > this.lastWriteId_, 'Stacking an older merge on top of newer ones');\r\n        this.allWrites_.push({\r\n            path: path,\r\n            children: changedChildren,\r\n            writeId: writeId,\r\n            visible: true\r\n        });\r\n        this.visibleWrites_ = this.visibleWrites_.addWrites(path, changedChildren);\r\n        this.lastWriteId_ = writeId;\r\n    };\r\n    /**\r\n     * @param {!number} writeId\r\n     * @return {?WriteRecord}\r\n     */\r\n    WriteTree.prototype.getWrite = function (writeId) {\r\n        for (var i = 0; i < this.allWrites_.length; i++) {\r\n            var record = this.allWrites_[i];\r\n            if (record.writeId === writeId) {\r\n                return record;\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    /**\r\n     * Remove a write (either an overwrite or merge) that has been successfully acknowledge by the server. Recalculates\r\n     * the tree if necessary.  We return true if it may have been visible, meaning views need to reevaluate.\r\n     *\r\n     * @param {!number} writeId\r\n     * @return {boolean} true if the write may have been visible (meaning we'll need to reevaluate / raise\r\n     * events as a result).\r\n     */\r\n    WriteTree.prototype.removeWrite = function (writeId) {\r\n        // Note: disabling this check. It could be a transaction that preempted another transaction, and thus was applied\r\n        // out of order.\r\n        //const validClear = revert || this.allWrites_.length === 0 || writeId <= this.allWrites_[0].writeId;\r\n        //assert(validClear, \"Either we don't have this write, or it's the first one in the queue\");\r\n        var _this = this;\r\n        var idx = this.allWrites_.findIndex(function (s) {\r\n            return s.writeId === writeId;\r\n        });\r\n        assert(idx >= 0, 'removeWrite called with nonexistent writeId.');\r\n        var writeToRemove = this.allWrites_[idx];\r\n        this.allWrites_.splice(idx, 1);\r\n        var removedWriteWasVisible = writeToRemove.visible;\r\n        var removedWriteOverlapsWithOtherWrites = false;\r\n        var i = this.allWrites_.length - 1;\r\n        while (removedWriteWasVisible && i >= 0) {\r\n            var currentWrite = this.allWrites_[i];\r\n            if (currentWrite.visible) {\r\n                if (i >= idx &&\r\n                    this.recordContainsPath_(currentWrite, writeToRemove.path)) {\r\n                    // The removed write was completely shadowed by a subsequent write.\r\n                    removedWriteWasVisible = false;\r\n                }\r\n                else if (writeToRemove.path.contains(currentWrite.path)) {\r\n                    // Either we're covering some writes or they're covering part of us (depending on which came first).\r\n                    removedWriteOverlapsWithOtherWrites = true;\r\n                }\r\n            }\r\n            i--;\r\n        }\r\n        if (!removedWriteWasVisible) {\r\n            return false;\r\n        }\r\n        else if (removedWriteOverlapsWithOtherWrites) {\r\n            // There's some shadowing going on. Just rebuild the visible writes from scratch.\r\n            this.resetTree_();\r\n            return true;\r\n        }\r\n        else {\r\n            // There's no shadowing.  We can safely just remove the write(s) from visibleWrites.\r\n            if (writeToRemove.snap) {\r\n                this.visibleWrites_ = this.visibleWrites_.removeWrite(writeToRemove.path);\r\n            }\r\n            else {\r\n                var children = writeToRemove.children;\r\n                forEach(children, function (childName) {\r\n                    _this.visibleWrites_ = _this.visibleWrites_.removeWrite(writeToRemove.path.child(childName));\r\n                });\r\n            }\r\n            return true;\r\n        }\r\n    };\r\n    /**\r\n     * Return a complete snapshot for the given path if there's visible write data at that path, else null.\r\n     * No server data is considered.\r\n     *\r\n     * @param {!Path} path\r\n     * @return {?Node}\r\n     */\r\n    WriteTree.prototype.getCompleteWriteData = function (path) {\r\n        return this.visibleWrites_.getCompleteNode(path);\r\n    };\r\n    /**\r\n     * Given optional, underlying server data, and an optional set of constraints (exclude some sets, include hidden\r\n     * writes), attempt to calculate a complete snapshot for the given path\r\n     *\r\n     * @param {!Path} treePath\r\n     * @param {?Node} completeServerCache\r\n     * @param {Array.<number>=} writeIdsToExclude An optional set to be excluded\r\n     * @param {boolean=} includeHiddenWrites Defaults to false, whether or not to layer on writes with visible set to false\r\n     * @return {?Node}\r\n     */\r\n    WriteTree.prototype.calcCompleteEventCache = function (treePath, completeServerCache, writeIdsToExclude, includeHiddenWrites) {\r\n        if (!writeIdsToExclude && !includeHiddenWrites) {\r\n            var shadowingNode = this.visibleWrites_.getCompleteNode(treePath);\r\n            if (shadowingNode != null) {\r\n                return shadowingNode;\r\n            }\r\n            else {\r\n                var subMerge = this.visibleWrites_.childCompoundWrite(treePath);\r\n                if (subMerge.isEmpty()) {\r\n                    return completeServerCache;\r\n                }\r\n                else if (completeServerCache == null &&\r\n                    !subMerge.hasCompleteWrite(Path.Empty)) {\r\n                    // We wouldn't have a complete snapshot, since there's no underlying data and no complete shadow\r\n                    return null;\r\n                }\r\n                else {\r\n                    var layeredCache = completeServerCache || ChildrenNode.EMPTY_NODE;\r\n                    return subMerge.apply(layeredCache);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            var merge = this.visibleWrites_.childCompoundWrite(treePath);\r\n            if (!includeHiddenWrites && merge.isEmpty()) {\r\n                return completeServerCache;\r\n            }\r\n            else {\r\n                // If the server cache is null, and we don't have a complete cache, we need to return null\r\n                if (!includeHiddenWrites &&\r\n                    completeServerCache == null &&\r\n                    !merge.hasCompleteWrite(Path.Empty)) {\r\n                    return null;\r\n                }\r\n                else {\r\n                    var filter = function (write) {\r\n                        return ((write.visible || includeHiddenWrites) &&\r\n                            (!writeIdsToExclude ||\r\n                                !~writeIdsToExclude.indexOf(write.writeId)) &&\r\n                            (write.path.contains(treePath) || treePath.contains(write.path)));\r\n                    };\r\n                    var mergeAtPath = WriteTree.layerTree_(this.allWrites_, filter, treePath);\r\n                    var layeredCache = completeServerCache || ChildrenNode.EMPTY_NODE;\r\n                    return mergeAtPath.apply(layeredCache);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * With optional, underlying server data, attempt to return a children node of children that we have complete data for.\r\n     * Used when creating new views, to pre-fill their complete event children snapshot.\r\n     *\r\n     * @param {!Path} treePath\r\n     * @param {?ChildrenNode} completeServerChildren\r\n     * @return {!ChildrenNode}\r\n     */\r\n    WriteTree.prototype.calcCompleteEventChildren = function (treePath, completeServerChildren) {\r\n        var completeChildren = ChildrenNode.EMPTY_NODE;\r\n        var topLevelSet = this.visibleWrites_.getCompleteNode(treePath);\r\n        if (topLevelSet) {\r\n            if (!topLevelSet.isLeafNode()) {\r\n                // we're shadowing everything. Return the children.\r\n                topLevelSet.forEachChild(PRIORITY_INDEX, function (childName, childSnap) {\r\n                    completeChildren = completeChildren.updateImmediateChild(childName, childSnap);\r\n                });\r\n            }\r\n            return completeChildren;\r\n        }\r\n        else if (completeServerChildren) {\r\n            // Layer any children we have on top of this\r\n            // We know we don't have a top-level set, so just enumerate existing children\r\n            var merge_1 = this.visibleWrites_.childCompoundWrite(treePath);\r\n            completeServerChildren.forEachChild(PRIORITY_INDEX, function (childName, childNode) {\r\n                var node = merge_1\r\n                    .childCompoundWrite(new Path(childName))\r\n                    .apply(childNode);\r\n                completeChildren = completeChildren.updateImmediateChild(childName, node);\r\n            });\r\n            // Add any complete children we have from the set\r\n            merge_1.getCompleteChildren().forEach(function (namedNode) {\r\n                completeChildren = completeChildren.updateImmediateChild(namedNode.name, namedNode.node);\r\n            });\r\n            return completeChildren;\r\n        }\r\n        else {\r\n            // We don't have anything to layer on top of. Layer on any children we have\r\n            // Note that we can return an empty snap if we have a defined delete\r\n            var merge = this.visibleWrites_.childCompoundWrite(treePath);\r\n            merge.getCompleteChildren().forEach(function (namedNode) {\r\n                completeChildren = completeChildren.updateImmediateChild(namedNode.name, namedNode.node);\r\n            });\r\n            return completeChildren;\r\n        }\r\n    };\r\n    /**\r\n     * Given that the underlying server data has updated, determine what, if anything, needs to be\r\n     * applied to the event cache.\r\n     *\r\n     * Possibilities:\r\n     *\r\n     * 1. No writes are shadowing. Events should be raised, the snap to be applied comes from the server data\r\n     *\r\n     * 2. Some write is completely shadowing. No events to be raised\r\n     *\r\n     * 3. Is partially shadowed. Events\r\n     *\r\n     * Either existingEventSnap or existingServerSnap must exist\r\n     *\r\n     * @param {!Path} treePath\r\n     * @param {!Path} childPath\r\n     * @param {?Node} existingEventSnap\r\n     * @param {?Node} existingServerSnap\r\n     * @return {?Node}\r\n     */\r\n    WriteTree.prototype.calcEventCacheAfterServerOverwrite = function (treePath, childPath, existingEventSnap, existingServerSnap) {\r\n        assert(existingEventSnap || existingServerSnap, 'Either existingEventSnap or existingServerSnap must exist');\r\n        var path = treePath.child(childPath);\r\n        if (this.visibleWrites_.hasCompleteWrite(path)) {\r\n            // At this point we can probably guarantee that we're in case 2, meaning no events\r\n            // May need to check visibility while doing the findRootMostValueAndPath call\r\n            return null;\r\n        }\r\n        else {\r\n            // No complete shadowing. We're either partially shadowing or not shadowing at all.\r\n            var childMerge = this.visibleWrites_.childCompoundWrite(path);\r\n            if (childMerge.isEmpty()) {\r\n                // We're not shadowing at all. Case 1\r\n                return existingServerSnap.getChild(childPath);\r\n            }\r\n            else {\r\n                // This could be more efficient if the serverNode + updates doesn't change the eventSnap\r\n                // However this is tricky to find out, since user updates don't necessary change the server\r\n                // snap, e.g. priority updates on empty nodes, or deep deletes. Another special case is if the server\r\n                // adds nodes, but doesn't change any existing writes. It is therefore not enough to\r\n                // only check if the updates change the serverNode.\r\n                // Maybe check if the merge tree contains these special cases and only do a full overwrite in that case?\r\n                return childMerge.apply(existingServerSnap.getChild(childPath));\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Returns a complete child for a given server snap after applying all user writes or null if there is no\r\n     * complete child for this ChildKey.\r\n     *\r\n     * @param {!Path} treePath\r\n     * @param {!string} childKey\r\n     * @param {!CacheNode} existingServerSnap\r\n     * @return {?Node}\r\n     */\r\n    WriteTree.prototype.calcCompleteChild = function (treePath, childKey, existingServerSnap) {\r\n        var path = treePath.child(childKey);\r\n        var shadowingNode = this.visibleWrites_.getCompleteNode(path);\r\n        if (shadowingNode != null) {\r\n            return shadowingNode;\r\n        }\r\n        else {\r\n            if (existingServerSnap.isCompleteForChild(childKey)) {\r\n                var childMerge = this.visibleWrites_.childCompoundWrite(path);\r\n                return childMerge.apply(existingServerSnap.getNode().getImmediateChild(childKey));\r\n            }\r\n            else {\r\n                return null;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Returns a node if there is a complete overwrite for this path. More specifically, if there is a write at\r\n     * a higher path, this will return the child of that write relative to the write and this path.\r\n     * Returns null if there is no write at this path.\r\n     *\r\n     * @param {!Path} path\r\n     * @return {?Node}\r\n     */\r\n    WriteTree.prototype.shadowingWrite = function (path) {\r\n        return this.visibleWrites_.getCompleteNode(path);\r\n    };\r\n    /**\r\n     * This method is used when processing child remove events on a query. If we can, we pull in children that were outside\r\n     * the window, but may now be in the window.\r\n     *\r\n     * @param {!Path} treePath\r\n     * @param {?Node} completeServerData\r\n     * @param {!NamedNode} startPost\r\n     * @param {!number} count\r\n     * @param {boolean} reverse\r\n     * @param {!Index} index\r\n     * @return {!Array.<!NamedNode>}\r\n     */\r\n    WriteTree.prototype.calcIndexedSlice = function (treePath, completeServerData, startPost, count, reverse, index) {\r\n        var toIterate;\r\n        var merge = this.visibleWrites_.childCompoundWrite(treePath);\r\n        var shadowingNode = merge.getCompleteNode(Path.Empty);\r\n        if (shadowingNode != null) {\r\n            toIterate = shadowingNode;\r\n        }\r\n        else if (completeServerData != null) {\r\n            toIterate = merge.apply(completeServerData);\r\n        }\r\n        else {\r\n            // no children to iterate on\r\n            return [];\r\n        }\r\n        toIterate = toIterate.withIndex(index);\r\n        if (!toIterate.isEmpty() && !toIterate.isLeafNode()) {\r\n            var nodes = [];\r\n            var cmp = index.getCompare();\r\n            var iter = reverse\r\n                ? toIterate.getReverseIteratorFrom(startPost, index)\r\n                : toIterate.getIteratorFrom(startPost, index);\r\n            var next = iter.getNext();\r\n            while (next && nodes.length < count) {\r\n                if (cmp(next, startPost) !== 0) {\r\n                    nodes.push(next);\r\n                }\r\n                next = iter.getNext();\r\n            }\r\n            return nodes;\r\n        }\r\n        else {\r\n            return [];\r\n        }\r\n    };\r\n    /**\r\n     * @param {!WriteRecord} writeRecord\r\n     * @param {!Path} path\r\n     * @return {boolean}\r\n     * @private\r\n     */\r\n    WriteTree.prototype.recordContainsPath_ = function (writeRecord, path) {\r\n        if (writeRecord.snap) {\r\n            return writeRecord.path.contains(path);\r\n        }\r\n        else {\r\n            // findKey can return undefined, so use !! to coerce to boolean\r\n            return !!findKey(writeRecord.children, function (childSnap, childName) {\r\n                return writeRecord.path.child(childName).contains(path);\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * Re-layer the writes and merges into a tree so we can efficiently calculate event snapshots\r\n     * @private\r\n     */\r\n    WriteTree.prototype.resetTree_ = function () {\r\n        this.visibleWrites_ = WriteTree.layerTree_(this.allWrites_, WriteTree.DefaultFilter_, Path.Empty);\r\n        if (this.allWrites_.length > 0) {\r\n            this.lastWriteId_ = this.allWrites_[this.allWrites_.length - 1].writeId;\r\n        }\r\n        else {\r\n            this.lastWriteId_ = -1;\r\n        }\r\n    };\r\n    /**\r\n     * The default filter used when constructing the tree. Keep everything that's visible.\r\n     *\r\n     * @param {!WriteRecord} write\r\n     * @return {boolean}\r\n     * @private\r\n     */\r\n    WriteTree.DefaultFilter_ = function (write) {\r\n        return write.visible;\r\n    };\r\n    /**\r\n     * Static method. Given an array of WriteRecords, a filter for which ones to include, and a path, construct the tree of\r\n     * event data at that path.\r\n     *\r\n     * @param {!Array.<!WriteRecord>} writes\r\n     * @param {!function(!WriteRecord):boolean} filter\r\n     * @param {!Path} treeRoot\r\n     * @return {!CompoundWrite}\r\n     * @private\r\n     */\r\n    WriteTree.layerTree_ = function (writes, filter, treeRoot) {\r\n        var compoundWrite = CompoundWrite.Empty;\r\n        for (var i = 0; i < writes.length; ++i) {\r\n            var write = writes[i];\r\n            // Theory, a later set will either:\r\n            // a) abort a relevant transaction, so no need to worry about excluding it from calculating that transaction\r\n            // b) not be relevant to a transaction (separate branch), so again will not affect the data for that transaction\r\n            if (filter(write)) {\r\n                var writePath = write.path;\r\n                var relativePath = void 0;\r\n                if (write.snap) {\r\n                    if (treeRoot.contains(writePath)) {\r\n                        relativePath = Path.relativePath(treeRoot, writePath);\r\n                        compoundWrite = compoundWrite.addWrite(relativePath, write.snap);\r\n                    }\r\n                    else if (writePath.contains(treeRoot)) {\r\n                        relativePath = Path.relativePath(writePath, treeRoot);\r\n                        compoundWrite = compoundWrite.addWrite(Path.Empty, write.snap.getChild(relativePath));\r\n                    }\r\n                    else {\r\n                        // There is no overlap between root path and write path, ignore write\r\n                    }\r\n                }\r\n                else if (write.children) {\r\n                    if (treeRoot.contains(writePath)) {\r\n                        relativePath = Path.relativePath(treeRoot, writePath);\r\n                        compoundWrite = compoundWrite.addWrites(relativePath, write.children);\r\n                    }\r\n                    else if (writePath.contains(treeRoot)) {\r\n                        relativePath = Path.relativePath(writePath, treeRoot);\r\n                        if (relativePath.isEmpty()) {\r\n                            compoundWrite = compoundWrite.addWrites(Path.Empty, write.children);\r\n                        }\r\n                        else {\r\n                            var child = safeGet(write.children, relativePath.getFront());\r\n                            if (child) {\r\n                                // There exists a child in this node that matches the root path\r\n                                var deepNode = child.getChild(relativePath.popFront());\r\n                                compoundWrite = compoundWrite.addWrite(Path.Empty, deepNode);\r\n                            }\r\n                        }\r\n                    }\r\n                    else {\r\n                        // There is no overlap between root path and write path, ignore write\r\n                    }\r\n                }\r\n                else {\r\n                    throw assertionError('WriteRecord should have .snap or .children');\r\n                }\r\n            }\r\n        }\r\n        return compoundWrite;\r\n    };\r\n    return WriteTree;\r\n}());\r\n/**\r\n * A WriteTreeRef wraps a WriteTree and a path, for convenient access to a particular subtree.  All of the methods\r\n * just proxy to the underlying WriteTree.\r\n *\r\n * @constructor\r\n */\r\nvar WriteTreeRef = /** @class */ (function () {\r\n    /**\r\n     * @param {!Path} path\r\n     * @param {!WriteTree} writeTree\r\n     */\r\n    function WriteTreeRef(path, writeTree) {\r\n        this.treePath_ = path;\r\n        this.writeTree_ = writeTree;\r\n    }\r\n    /**\r\n     * If possible, returns a complete event cache, using the underlying server data if possible. In addition, can be used\r\n     * to get a cache that includes hidden writes, and excludes arbitrary writes. Note that customizing the returned node\r\n     * can lead to a more expensive calculation.\r\n     *\r\n     * @param {?Node} completeServerCache\r\n     * @param {Array.<number>=} writeIdsToExclude Optional writes to exclude.\r\n     * @param {boolean=} includeHiddenWrites Defaults to false, whether or not to layer on writes with visible set to false\r\n     * @return {?Node}\r\n     */\r\n    WriteTreeRef.prototype.calcCompleteEventCache = function (completeServerCache, writeIdsToExclude, includeHiddenWrites) {\r\n        return this.writeTree_.calcCompleteEventCache(this.treePath_, completeServerCache, writeIdsToExclude, includeHiddenWrites);\r\n    };\r\n    /**\r\n     * If possible, returns a children node containing all of the complete children we have data for. The returned data is a\r\n     * mix of the given server data and write data.\r\n     *\r\n     * @param {?ChildrenNode} completeServerChildren\r\n     * @return {!ChildrenNode}\r\n     */\r\n    WriteTreeRef.prototype.calcCompleteEventChildren = function (completeServerChildren) {\r\n        return this.writeTree_.calcCompleteEventChildren(this.treePath_, completeServerChildren);\r\n    };\r\n    /**\r\n     * Given that either the underlying server data has updated or the outstanding writes have updated, determine what,\r\n     * if anything, needs to be applied to the event cache.\r\n     *\r\n     * Possibilities:\r\n     *\r\n     * 1. No writes are shadowing. Events should be raised, the snap to be applied comes from the server data\r\n     *\r\n     * 2. Some write is completely shadowing. No events to be raised\r\n     *\r\n     * 3. Is partially shadowed. Events should be raised\r\n     *\r\n     * Either existingEventSnap or existingServerSnap must exist, this is validated via an assert\r\n     *\r\n     * @param {!Path} path\r\n     * @param {?Node} existingEventSnap\r\n     * @param {?Node} existingServerSnap\r\n     * @return {?Node}\r\n     */\r\n    WriteTreeRef.prototype.calcEventCacheAfterServerOverwrite = function (path, existingEventSnap, existingServerSnap) {\r\n        return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_, path, existingEventSnap, existingServerSnap);\r\n    };\r\n    /**\r\n     * Returns a node if there is a complete overwrite for this path. More specifically, if there is a write at\r\n     * a higher path, this will return the child of that write relative to the write and this path.\r\n     * Returns null if there is no write at this path.\r\n     *\r\n     * @param {!Path} path\r\n     * @return {?Node}\r\n     */\r\n    WriteTreeRef.prototype.shadowingWrite = function (path) {\r\n        return this.writeTree_.shadowingWrite(this.treePath_.child(path));\r\n    };\r\n    /**\r\n     * This method is used when processing child remove events on a query. If we can, we pull in children that were outside\r\n     * the window, but may now be in the window\r\n     *\r\n     * @param {?Node} completeServerData\r\n     * @param {!NamedNode} startPost\r\n     * @param {!number} count\r\n     * @param {boolean} reverse\r\n     * @param {!Index} index\r\n     * @return {!Array.<!NamedNode>}\r\n     */\r\n    WriteTreeRef.prototype.calcIndexedSlice = function (completeServerData, startPost, count, reverse, index) {\r\n        return this.writeTree_.calcIndexedSlice(this.treePath_, completeServerData, startPost, count, reverse, index);\r\n    };\r\n    /**\r\n     * Returns a complete child for a given server snap after applying all user writes or null if there is no\r\n     * complete child for this ChildKey.\r\n     *\r\n     * @param {!string} childKey\r\n     * @param {!CacheNode} existingServerCache\r\n     * @return {?Node}\r\n     */\r\n    WriteTreeRef.prototype.calcCompleteChild = function (childKey, existingServerCache) {\r\n        return this.writeTree_.calcCompleteChild(this.treePath_, childKey, existingServerCache);\r\n    };\r\n    /**\r\n     * Return a WriteTreeRef for a child.\r\n     *\r\n     * @param {string} childName\r\n     * @return {!WriteTreeRef}\r\n     */\r\n    WriteTreeRef.prototype.child = function (childName) {\r\n        return new WriteTreeRef(this.treePath_.child(childName), this.writeTree_);\r\n    };\r\n    return WriteTreeRef;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * SyncTree is the central class for managing event callback registration, data caching, views\r\n * (query processing), and event generation.  There are typically two SyncTree instances for\r\n * each Repo, one for the normal Firebase data, and one for the .info data.\r\n *\r\n * It has a number of responsibilities, including:\r\n *  - Tracking all user event callbacks (registered via addEventRegistration() and removeEventRegistration()).\r\n *  - Applying and caching data changes for user set(), transaction(), and update() calls\r\n *    (applyUserOverwrite(), applyUserMerge()).\r\n *  - Applying and caching data changes for server data changes (applyServerOverwrite(),\r\n *    applyServerMerge()).\r\n *  - Generating user-facing events for server and user changes (all of the apply* methods\r\n *    return the set of events that need to be raised as a result).\r\n *  - Maintaining the appropriate set of server listens to ensure we are always subscribed\r\n *    to the correct set of paths and queries to satisfy the current set of user event\r\n *    callbacks (listens are started/stopped using the provided listenProvider).\r\n *\r\n * NOTE: Although SyncTree tracks event callbacks and calculates events to raise, the actual\r\n * events are returned to the caller rather than raised synchronously.\r\n *\r\n * @constructor\r\n */\r\nvar SyncTree = /** @class */ (function () {\r\n    /**\r\n     * @param {!ListenProvider} listenProvider_ Used by SyncTree to start / stop listening\r\n     *   to server data.\r\n     */\r\n    function SyncTree(listenProvider_) {\r\n        this.listenProvider_ = listenProvider_;\r\n        /**\r\n         * Tree of SyncPoints.  There's a SyncPoint at any location that has 1 or more views.\r\n         * @type {!ImmutableTree.<!SyncPoint>}\r\n         * @private\r\n         */\r\n        this.syncPointTree_ = ImmutableTree.Empty;\r\n        /**\r\n         * A tree of all pending user writes (user-initiated set()'s, transaction()'s, update()'s, etc.).\r\n         * @type {!WriteTree}\r\n         * @private\r\n         */\r\n        this.pendingWriteTree_ = new WriteTree();\r\n        this.tagToQueryMap_ = {};\r\n        this.queryToTagMap_ = {};\r\n    }\r\n    /**\r\n     * Apply the data changes for a user-generated set() or transaction() call.\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!Node} newData\r\n     * @param {number} writeId\r\n     * @param {boolean=} visible\r\n     * @return {!Array.<!Event>} Events to raise.\r\n     */\r\n    SyncTree.prototype.applyUserOverwrite = function (path, newData, writeId, visible) {\r\n        // Record pending write.\r\n        this.pendingWriteTree_.addOverwrite(path, newData, writeId, visible);\r\n        if (!visible) {\r\n            return [];\r\n        }\r\n        else {\r\n            return this.applyOperationToSyncPoints_(new Overwrite(OperationSource.User, path, newData));\r\n        }\r\n    };\r\n    /**\r\n     * Apply the data from a user-generated update() call\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!Object.<string, !Node>} changedChildren\r\n     * @param {!number} writeId\r\n     * @return {!Array.<!Event>} Events to raise.\r\n     */\r\n    SyncTree.prototype.applyUserMerge = function (path, changedChildren, writeId) {\r\n        // Record pending merge.\r\n        this.pendingWriteTree_.addMerge(path, changedChildren, writeId);\r\n        var changeTree = ImmutableTree.fromObject(changedChildren);\r\n        return this.applyOperationToSyncPoints_(new Merge(OperationSource.User, path, changeTree));\r\n    };\r\n    /**\r\n     * Acknowledge a pending user write that was previously registered with applyUserOverwrite() or applyUserMerge().\r\n     *\r\n     * @param {!number} writeId\r\n     * @param {boolean=} revert True if the given write failed and needs to be reverted\r\n     * @return {!Array.<!Event>} Events to raise.\r\n     */\r\n    SyncTree.prototype.ackUserWrite = function (writeId, revert) {\r\n        if (revert === void 0) { revert = false; }\r\n        var write = this.pendingWriteTree_.getWrite(writeId);\r\n        var needToReevaluate = this.pendingWriteTree_.removeWrite(writeId);\r\n        if (!needToReevaluate) {\r\n            return [];\r\n        }\r\n        else {\r\n            var affectedTree_1 = ImmutableTree.Empty;\r\n            if (write.snap != null) {\r\n                // overwrite\r\n                affectedTree_1 = affectedTree_1.set(Path.Empty, true);\r\n            }\r\n            else {\r\n                forEach(write.children, function (pathString, node) {\r\n                    affectedTree_1 = affectedTree_1.set(new Path(pathString), node);\r\n                });\r\n            }\r\n            return this.applyOperationToSyncPoints_(new AckUserWrite(write.path, affectedTree_1, revert));\r\n        }\r\n    };\r\n    /**\r\n     * Apply new server data for the specified path..\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!Node} newData\r\n     * @return {!Array.<!Event>} Events to raise.\r\n     */\r\n    SyncTree.prototype.applyServerOverwrite = function (path, newData) {\r\n        return this.applyOperationToSyncPoints_(new Overwrite(OperationSource.Server, path, newData));\r\n    };\r\n    /**\r\n     * Apply new server data to be merged in at the specified path.\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!Object.<string, !Node>} changedChildren\r\n     * @return {!Array.<!Event>} Events to raise.\r\n     */\r\n    SyncTree.prototype.applyServerMerge = function (path, changedChildren) {\r\n        var changeTree = ImmutableTree.fromObject(changedChildren);\r\n        return this.applyOperationToSyncPoints_(new Merge(OperationSource.Server, path, changeTree));\r\n    };\r\n    /**\r\n     * Apply a listen complete for a query\r\n     *\r\n     * @param {!Path} path\r\n     * @return {!Array.<!Event>} Events to raise.\r\n     */\r\n    SyncTree.prototype.applyListenComplete = function (path) {\r\n        return this.applyOperationToSyncPoints_(new ListenComplete(OperationSource.Server, path));\r\n    };\r\n    /**\r\n     * Apply new server data for the specified tagged query.\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!Node} snap\r\n     * @param {!number} tag\r\n     * @return {!Array.<!Event>} Events to raise.\r\n     */\r\n    SyncTree.prototype.applyTaggedQueryOverwrite = function (path, snap, tag) {\r\n        var queryKey = this.queryKeyForTag_(tag);\r\n        if (queryKey != null) {\r\n            var r = SyncTree.parseQueryKey_(queryKey);\r\n            var queryPath = r.path, queryId = r.queryId;\r\n            var relativePath = Path.relativePath(queryPath, path);\r\n            var op = new Overwrite(OperationSource.forServerTaggedQuery(queryId), relativePath, snap);\r\n            return this.applyTaggedOperation_(queryPath, op);\r\n        }\r\n        else {\r\n            // Query must have been removed already\r\n            return [];\r\n        }\r\n    };\r\n    /**\r\n     * Apply server data to be merged in for the specified tagged query.\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!Object.<string, !Node>} changedChildren\r\n     * @param {!number} tag\r\n     * @return {!Array.<!Event>} Events to raise.\r\n     */\r\n    SyncTree.prototype.applyTaggedQueryMerge = function (path, changedChildren, tag) {\r\n        var queryKey = this.queryKeyForTag_(tag);\r\n        if (queryKey) {\r\n            var r = SyncTree.parseQueryKey_(queryKey);\r\n            var queryPath = r.path, queryId = r.queryId;\r\n            var relativePath = Path.relativePath(queryPath, path);\r\n            var changeTree = ImmutableTree.fromObject(changedChildren);\r\n            var op = new Merge(OperationSource.forServerTaggedQuery(queryId), relativePath, changeTree);\r\n            return this.applyTaggedOperation_(queryPath, op);\r\n        }\r\n        else {\r\n            // We've already removed the query. No big deal, ignore the update\r\n            return [];\r\n        }\r\n    };\r\n    /**\r\n     * Apply a listen complete for a tagged query\r\n     *\r\n     * @param {!Path} path\r\n     * @param {!number} tag\r\n     * @return {!Array.<!Event>} Events to raise.\r\n     */\r\n    SyncTree.prototype.applyTaggedListenComplete = function (path, tag) {\r\n        var queryKey = this.queryKeyForTag_(tag);\r\n        if (queryKey) {\r\n            var r = SyncTree.parseQueryKey_(queryKey);\r\n            var queryPath = r.path, queryId = r.queryId;\r\n            var relativePath = Path.relativePath(queryPath, path);\r\n            var op = new ListenComplete(OperationSource.forServerTaggedQuery(queryId), relativePath);\r\n            return this.applyTaggedOperation_(queryPath, op);\r\n        }\r\n        else {\r\n            // We've already removed the query. No big deal, ignore the update\r\n            return [];\r\n        }\r\n    };\r\n    /**\r\n     * Add an event callback for the specified query.\r\n     *\r\n     * @param {!Query} query\r\n     * @param {!EventRegistration} eventRegistration\r\n     * @return {!Array.<!Event>} Events to raise.\r\n     */\r\n    SyncTree.prototype.addEventRegistration = function (query, eventRegistration) {\r\n        var path = query.path;\r\n        var serverCache = null;\r\n        var foundAncestorDefaultView = false;\r\n        // Any covering writes will necessarily be at the root, so really all we need to find is the server cache.\r\n        // Consider optimizing this once there's a better understanding of what actual behavior will be.\r\n        this.syncPointTree_.foreachOnPath(path, function (pathToSyncPoint, sp) {\r\n            var relativePath = Path.relativePath(pathToSyncPoint, path);\r\n            serverCache = serverCache || sp.getCompleteServerCache(relativePath);\r\n            foundAncestorDefaultView =\r\n                foundAncestorDefaultView || sp.hasCompleteView();\r\n        });\r\n        var syncPoint = this.syncPointTree_.get(path);\r\n        if (!syncPoint) {\r\n            syncPoint = new SyncPoint();\r\n            this.syncPointTree_ = this.syncPointTree_.set(path, syncPoint);\r\n        }\r\n        else {\r\n            foundAncestorDefaultView =\r\n                foundAncestorDefaultView || syncPoint.hasCompleteView();\r\n            serverCache = serverCache || syncPoint.getCompleteServerCache(Path.Empty);\r\n        }\r\n        var serverCacheComplete;\r\n        if (serverCache != null) {\r\n            serverCacheComplete = true;\r\n        }\r\n        else {\r\n            serverCacheComplete = false;\r\n            serverCache = ChildrenNode.EMPTY_NODE;\r\n            var subtree = this.syncPointTree_.subtree(path);\r\n            subtree.foreachChild(function (childName, childSyncPoint) {\r\n                var completeCache = childSyncPoint.getCompleteServerCache(Path.Empty);\r\n                if (completeCache) {\r\n                    serverCache = serverCache.updateImmediateChild(childName, completeCache);\r\n                }\r\n            });\r\n        }\r\n        var viewAlreadyExists = syncPoint.viewExistsForQuery(query);\r\n        if (!viewAlreadyExists && !query.getQueryParams().loadsAllData()) {\r\n            // We need to track a tag for this query\r\n            var queryKey = SyncTree.makeQueryKey_(query);\r\n            assert(!(queryKey in this.queryToTagMap_), 'View does not exist, but we have a tag');\r\n            var tag = SyncTree.getNextQueryTag_();\r\n            this.queryToTagMap_[queryKey] = tag;\r\n            // Coerce to string to avoid sparse arrays.\r\n            this.tagToQueryMap_['_' + tag] = queryKey;\r\n        }\r\n        var writesCache = this.pendingWriteTree_.childWrites(path);\r\n        var events = syncPoint.addEventRegistration(query, eventRegistration, writesCache, serverCache, serverCacheComplete);\r\n        if (!viewAlreadyExists && !foundAncestorDefaultView) {\r\n            var view /** @type !View */ = syncPoint.viewForQuery(query);\r\n            events = events.concat(this.setupListener_(query, view));\r\n        }\r\n        return events;\r\n    };\r\n    /**\r\n     * Remove event callback(s).\r\n     *\r\n     * If query is the default query, we'll check all queries for the specified eventRegistration.\r\n     * If eventRegistration is null, we'll remove all callbacks for the specified query/queries.\r\n     *\r\n     * @param {!Query} query\r\n     * @param {?EventRegistration} eventRegistration If null, all callbacks are removed.\r\n     * @param {Error=} cancelError If a cancelError is provided, appropriate cancel events will be returned.\r\n     * @return {!Array.<!Event>} Cancel events, if cancelError was provided.\r\n     */\r\n    SyncTree.prototype.removeEventRegistration = function (query, eventRegistration, cancelError) {\r\n        var _this = this;\r\n        // Find the syncPoint first. Then deal with whether or not it has matching listeners\r\n        var path = query.path;\r\n        var maybeSyncPoint = this.syncPointTree_.get(path);\r\n        var cancelEvents = [];\r\n        // A removal on a default query affects all queries at that location. A removal on an indexed query, even one without\r\n        // other query constraints, does *not* affect all queries at that location. So this check must be for 'default', and\r\n        // not loadsAllData().\r\n        if (maybeSyncPoint &&\r\n            (query.queryIdentifier() === 'default' ||\r\n                maybeSyncPoint.viewExistsForQuery(query))) {\r\n            /**\r\n             * @type {{removed: !Array.<!Query>, events: !Array.<!Event>}}\r\n             */\r\n            var removedAndEvents = maybeSyncPoint.removeEventRegistration(query, eventRegistration, cancelError);\r\n            if (maybeSyncPoint.isEmpty()) {\r\n                this.syncPointTree_ = this.syncPointTree_.remove(path);\r\n            }\r\n            var removed = removedAndEvents.removed;\r\n            cancelEvents = removedAndEvents.events;\r\n            // We may have just removed one of many listeners and can short-circuit this whole process\r\n            // We may also not have removed a default listener, in which case all of the descendant listeners should already be\r\n            // properly set up.\r\n            //\r\n            // Since indexed queries can shadow if they don't have other query constraints, check for loadsAllData(), instead of\r\n            // queryId === 'default'\r\n            var removingDefault = -1 !==\r\n                removed.findIndex(function (query) {\r\n                    return query.getQueryParams().loadsAllData();\r\n                });\r\n            var covered = this.syncPointTree_.findOnPath(path, function (relativePath, parentSyncPoint) {\r\n                return parentSyncPoint.hasCompleteView();\r\n            });\r\n            if (removingDefault && !covered) {\r\n                var subtree = this.syncPointTree_.subtree(path);\r\n                // There are potentially child listeners. Determine what if any listens we need to send before executing the\r\n                // removal\r\n                if (!subtree.isEmpty()) {\r\n                    // We need to fold over our subtree and collect the listeners to send\r\n                    var newViews = this.collectDistinctViewsForSubTree_(subtree);\r\n                    // Ok, we've collected all the listens we need. Set them up.\r\n                    for (var i = 0; i < newViews.length; ++i) {\r\n                        var view = newViews[i], newQuery = view.getQuery();\r\n                        var listener = this.createListenerForView_(view);\r\n                        this.listenProvider_.startListening(SyncTree.queryForListening_(newQuery), this.tagForQuery_(newQuery), listener.hashFn, listener.onComplete);\r\n                    }\r\n                }\r\n                else {\r\n                    // There's nothing below us, so nothing we need to start listening on\r\n                }\r\n            }\r\n            // If we removed anything and we're not covered by a higher up listen, we need to stop listening on this query\r\n            // The above block has us covered in terms of making sure we're set up on listens lower in the tree.\r\n            // Also, note that if we have a cancelError, it's already been removed at the provider level.\r\n            if (!covered && removed.length > 0 && !cancelError) {\r\n                // If we removed a default, then we weren't listening on any of the other queries here. Just cancel the one\r\n                // default. Otherwise, we need to iterate through and cancel each individual query\r\n                if (removingDefault) {\r\n                    // We don't tag default listeners\r\n                    var defaultTag = null;\r\n                    this.listenProvider_.stopListening(SyncTree.queryForListening_(query), defaultTag);\r\n                }\r\n                else {\r\n                    removed.forEach(function (queryToRemove) {\r\n                        var tagToRemove = _this.queryToTagMap_[SyncTree.makeQueryKey_(queryToRemove)];\r\n                        _this.listenProvider_.stopListening(SyncTree.queryForListening_(queryToRemove), tagToRemove);\r\n                    });\r\n                }\r\n            }\r\n            // Now, clear all of the tags we're tracking for the removed listens\r\n            this.removeTags_(removed);\r\n        }\r\n        else {\r\n            // No-op, this listener must've been already removed\r\n        }\r\n        return cancelEvents;\r\n    };\r\n    /**\r\n     * Returns a complete cache, if we have one, of the data at a particular path. The location must have a listener above\r\n     * it, but as this is only used by transaction code, that should always be the case anyways.\r\n     *\r\n     * Note: this method will *include* hidden writes from transaction with applyLocally set to false.\r\n     * @param {!Path} path The path to the data we want\r\n     * @param {Array.<number>=} writeIdsToExclude A specific set to be excluded\r\n     * @return {?Node}\r\n     */\r\n    SyncTree.prototype.calcCompleteEventCache = function (path, writeIdsToExclude) {\r\n        var includeHiddenSets = true;\r\n        var writeTree = this.pendingWriteTree_;\r\n        var serverCache = this.syncPointTree_.findOnPath(path, function (pathSoFar, syncPoint) {\r\n            var relativePath = Path.relativePath(pathSoFar, path);\r\n            var serverCache = syncPoint.getCompleteServerCache(relativePath);\r\n            if (serverCache) {\r\n                return serverCache;\r\n            }\r\n        });\r\n        return writeTree.calcCompleteEventCache(path, serverCache, writeIdsToExclude, includeHiddenSets);\r\n    };\r\n    /**\r\n     * This collapses multiple unfiltered views into a single view, since we only need a single\r\n     * listener for them.\r\n     *\r\n     * @param {!ImmutableTree.<!SyncPoint>} subtree\r\n     * @return {!Array.<!View>}\r\n     * @private\r\n     */\r\n    SyncTree.prototype.collectDistinctViewsForSubTree_ = function (subtree) {\r\n        return subtree.fold(function (relativePath, maybeChildSyncPoint, childMap) {\r\n            if (maybeChildSyncPoint && maybeChildSyncPoint.hasCompleteView()) {\r\n                var completeView = maybeChildSyncPoint.getCompleteView();\r\n                return [completeView];\r\n            }\r\n            else {\r\n                // No complete view here, flatten any deeper listens into an array\r\n                var views_1 = [];\r\n                if (maybeChildSyncPoint) {\r\n                    views_1 = maybeChildSyncPoint.getQueryViews();\r\n                }\r\n                forEach(childMap, function (key, childViews) {\r\n                    views_1 = views_1.concat(childViews);\r\n                });\r\n                return views_1;\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * @param {!Array.<!Query>} queries\r\n     * @private\r\n     */\r\n    SyncTree.prototype.removeTags_ = function (queries) {\r\n        for (var j = 0; j < queries.length; ++j) {\r\n            var removedQuery = queries[j];\r\n            if (!removedQuery.getQueryParams().loadsAllData()) {\r\n                // We should have a tag for this\r\n                var removedQueryKey = SyncTree.makeQueryKey_(removedQuery);\r\n                var removedQueryTag = this.queryToTagMap_[removedQueryKey];\r\n                delete this.queryToTagMap_[removedQueryKey];\r\n                delete this.tagToQueryMap_['_' + removedQueryTag];\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Normalizes a query to a query we send the server for listening\r\n     * @param {!Query} query\r\n     * @return {!Query} The normalized query\r\n     * @private\r\n     */\r\n    SyncTree.queryForListening_ = function (query) {\r\n        if (query.getQueryParams().loadsAllData() &&\r\n            !query.getQueryParams().isDefault()) {\r\n            // We treat queries that load all data as default queries\r\n            // Cast is necessary because ref() technically returns Firebase which is actually fb.api.Firebase which inherits\r\n            // from Query\r\n            return /** @type {!Query} */ query.getRef();\r\n        }\r\n        else {\r\n            return query;\r\n        }\r\n    };\r\n    /**\r\n     * For a given new listen, manage the de-duplication of outstanding subscriptions.\r\n     *\r\n     * @param {!Query} query\r\n     * @param {!View} view\r\n     * @return {!Array.<!Event>} This method can return events to support synchronous data sources\r\n     * @private\r\n     */\r\n    SyncTree.prototype.setupListener_ = function (query, view) {\r\n        var path = query.path;\r\n        var tag = this.tagForQuery_(query);\r\n        var listener = this.createListenerForView_(view);\r\n        var events = this.listenProvider_.startListening(SyncTree.queryForListening_(query), tag, listener.hashFn, listener.onComplete);\r\n        var subtree = this.syncPointTree_.subtree(path);\r\n        // The root of this subtree has our query. We're here because we definitely need to send a listen for that, but we\r\n        // may need to shadow other listens as well.\r\n        if (tag) {\r\n            assert(!subtree.value.hasCompleteView(), \"If we're adding a query, it shouldn't be shadowed\");\r\n        }\r\n        else {\r\n            // Shadow everything at or below this location, this is a default listener.\r\n            var queriesToStop = subtree.fold(function (relativePath, maybeChildSyncPoint, childMap) {\r\n                if (!relativePath.isEmpty() &&\r\n                    maybeChildSyncPoint &&\r\n                    maybeChildSyncPoint.hasCompleteView()) {\r\n                    return [maybeChildSyncPoint.getCompleteView().getQuery()];\r\n                }\r\n                else {\r\n                    // No default listener here, flatten any deeper queries into an array\r\n                    var queries_1 = [];\r\n                    if (maybeChildSyncPoint) {\r\n                        queries_1 = queries_1.concat(maybeChildSyncPoint.getQueryViews().map(function (view) { return view.getQuery(); }));\r\n                    }\r\n                    forEach(childMap, function (key, childQueries) {\r\n                        queries_1 = queries_1.concat(childQueries);\r\n                    });\r\n                    return queries_1;\r\n                }\r\n            });\r\n            for (var i = 0; i < queriesToStop.length; ++i) {\r\n                var queryToStop = queriesToStop[i];\r\n                this.listenProvider_.stopListening(SyncTree.queryForListening_(queryToStop), this.tagForQuery_(queryToStop));\r\n            }\r\n        }\r\n        return events;\r\n    };\r\n    /**\r\n     *\r\n     * @param {!View} view\r\n     * @return {{hashFn: function(), onComplete: function(!string, *)}}\r\n     * @private\r\n     */\r\n    SyncTree.prototype.createListenerForView_ = function (view) {\r\n        var _this = this;\r\n        var query = view.getQuery();\r\n        var tag = this.tagForQuery_(query);\r\n        return {\r\n            hashFn: function () {\r\n                var cache = view.getServerCache() || ChildrenNode.EMPTY_NODE;\r\n                return cache.hash();\r\n            },\r\n            onComplete: function (status) {\r\n                if (status === 'ok') {\r\n                    if (tag) {\r\n                        return _this.applyTaggedListenComplete(query.path, tag);\r\n                    }\r\n                    else {\r\n                        return _this.applyListenComplete(query.path);\r\n                    }\r\n                }\r\n                else {\r\n                    // If a listen failed, kill all of the listeners here, not just the one that triggered the error.\r\n                    // Note that this may need to be scoped to just this listener if we change permissions on filtered children\r\n                    var error$$1 = errorForServerCode(status, query);\r\n                    return _this.removeEventRegistration(query, \r\n                    /*eventRegistration*/ null, error$$1);\r\n                }\r\n            }\r\n        };\r\n    };\r\n    /**\r\n     * Given a query, computes a \"queryKey\" suitable for use in our queryToTagMap_.\r\n     * @private\r\n     * @param {!Query} query\r\n     * @return {string}\r\n     */\r\n    SyncTree.makeQueryKey_ = function (query) {\r\n        return query.path.toString() + '$' + query.queryIdentifier();\r\n    };\r\n    /**\r\n     * Given a queryKey (created by makeQueryKey), parse it back into a path and queryId.\r\n     * @private\r\n     * @param {!string} queryKey\r\n     * @return {{queryId: !string, path: !Path}}\r\n     */\r\n    SyncTree.parseQueryKey_ = function (queryKey) {\r\n        var splitIndex = queryKey.indexOf('$');\r\n        assert(splitIndex !== -1 && splitIndex < queryKey.length - 1, 'Bad queryKey.');\r\n        return {\r\n            queryId: queryKey.substr(splitIndex + 1),\r\n            path: new Path(queryKey.substr(0, splitIndex))\r\n        };\r\n    };\r\n    /**\r\n     * Return the query associated with the given tag, if we have one\r\n     * @param {!number} tag\r\n     * @return {?string}\r\n     * @private\r\n     */\r\n    SyncTree.prototype.queryKeyForTag_ = function (tag) {\r\n        return this.tagToQueryMap_['_' + tag];\r\n    };\r\n    /**\r\n     * Return the tag associated with the given query.\r\n     * @param {!Query} query\r\n     * @return {?number}\r\n     * @private\r\n     */\r\n    SyncTree.prototype.tagForQuery_ = function (query) {\r\n        var queryKey = SyncTree.makeQueryKey_(query);\r\n        return safeGet(this.queryToTagMap_, queryKey);\r\n    };\r\n    /**\r\n     * Static accessor for query tags.\r\n     * @return {number}\r\n     * @private\r\n     */\r\n    SyncTree.getNextQueryTag_ = function () {\r\n        return SyncTree.nextQueryTag_++;\r\n    };\r\n    /**\r\n     * A helper method to apply tagged operations\r\n     *\r\n     * @param {!Path} queryPath\r\n     * @param {!Operation} operation\r\n     * @return {!Array.<!Event>}\r\n     * @private\r\n     */\r\n    SyncTree.prototype.applyTaggedOperation_ = function (queryPath, operation) {\r\n        var syncPoint = this.syncPointTree_.get(queryPath);\r\n        assert(syncPoint, \"Missing sync point for query tag that we're tracking\");\r\n        var writesCache = this.pendingWriteTree_.childWrites(queryPath);\r\n        return syncPoint.applyOperation(operation, writesCache, \r\n        /*serverCache=*/ null);\r\n    };\r\n    /**\r\n     * A helper method that visits all descendant and ancestor SyncPoints, applying the operation.\r\n     *\r\n     * NOTES:\r\n     * - Descendant SyncPoints will be visited first (since we raise events depth-first).\r\n  \n     * - We call applyOperation() on each SyncPoint passing three things:\r\n     *   1. A version of the Operation that has been made relative to the SyncPoint location.\r\n     *   2. A WriteTreeRef of any writes we have cached at the SyncPoint location.\r\n     *   3. A snapshot Node with cached server data, if we have it.\r\n  \n     * - We concatenate all of the events returned by each SyncPoint and return the result.\r\n     *\r\n     * @param {!Operation} operation\r\n     * @return {!Array.<!Event>}\r\n     * @private\r\n     */\r\n    SyncTree.prototype.applyOperationToSyncPoints_ = function (operation) {\r\n        return this.applyOperationHelper_(operation, this.syncPointTree_, \r\n        /*serverCache=*/ null, this.pendingWriteTree_.childWrites(Path.Empty));\r\n    };\r\n    /**\r\n     * Recursive helper for applyOperationToSyncPoints_\r\n     *\r\n     * @private\r\n     * @param {!Operation} operation\r\n     * @param {ImmutableTree.<!SyncPoint>} syncPointTree\r\n     * @param {?Node} serverCache\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @return {!Array.<!Event>}\r\n     */\r\n    SyncTree.prototype.applyOperationHelper_ = function (operation, syncPointTree, serverCache, writesCache) {\r\n        if (operation.path.isEmpty()) {\r\n            return this.applyOperationDescendantsHelper_(operation, syncPointTree, serverCache, writesCache);\r\n        }\r\n        else {\r\n            var syncPoint = syncPointTree.get(Path.Empty);\r\n            // If we don't have cached server data, see if we can get it from this SyncPoint.\r\n            if (serverCache == null && syncPoint != null) {\r\n                serverCache = syncPoint.getCompleteServerCache(Path.Empty);\r\n            }\r\n            var events = [];\r\n            var childName = operation.path.getFront();\r\n            var childOperation = operation.operationForChild(childName);\r\n            var childTree = syncPointTree.children.get(childName);\r\n            if (childTree && childOperation) {\r\n                var childServerCache = serverCache\r\n                    ? serverCache.getImmediateChild(childName)\r\n                    : null;\r\n                var childWritesCache = writesCache.child(childName);\r\n                events = events.concat(this.applyOperationHelper_(childOperation, childTree, childServerCache, childWritesCache));\r\n            }\r\n            if (syncPoint) {\r\n                events = events.concat(syncPoint.applyOperation(operation, writesCache, serverCache));\r\n            }\r\n            return events;\r\n        }\r\n    };\r\n    /**\r\n     * Recursive helper for applyOperationToSyncPoints_\r\n     *\r\n     * @private\r\n     * @param {!Operation} operation\r\n     * @param {ImmutableTree.<!SyncPoint>} syncPointTree\r\n     * @param {?Node} serverCache\r\n     * @param {!WriteTreeRef} writesCache\r\n     * @return {!Array.<!Event>}\r\n     */\r\n    SyncTree.prototype.applyOperationDescendantsHelper_ = function (operation, syncPointTree, serverCache, writesCache) {\r\n        var _this = this;\r\n        var syncPoint = syncPointTree.get(Path.Empty);\r\n        // If we don't have cached server data, see if we can get it from this SyncPoint.\r\n        if (serverCache == null && syncPoint != null) {\r\n            serverCache = syncPoint.getCompleteServerCache(Path.Empty);\r\n        }\r\n        var events = [];\r\n        syncPointTree.children.inorderTraversal(function (childName, childTree) {\r\n            var childServerCache = serverCache\r\n                ? serverCache.getImmediateChild(childName)\r\n                : null;\r\n            var childWritesCache = writesCache.child(childName);\r\n            var childOperation = operation.operationForChild(childName);\r\n            if (childOperation) {\r\n                events = events.concat(_this.applyOperationDescendantsHelper_(childOperation, childTree, childServerCache, childWritesCache));\r\n            }\r\n        });\r\n        if (syncPoint) {\r\n            events = events.concat(syncPoint.applyOperation(operation, writesCache, serverCache));\r\n        }\r\n        return events;\r\n    };\r\n    /**\r\n     * Static tracker for next query tag.\r\n     * @type {number}\r\n     * @private\r\n     */\r\n    SyncTree.nextQueryTag_ = 1;\r\n    return SyncTree;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Mutable object which basically just stores a reference to the \"latest\" immutable snapshot.\r\n *\r\n * @constructor\r\n */\r\nvar SnapshotHolder = /** @class */ (function () {\r\n    function SnapshotHolder() {\r\n        this.rootNode_ = ChildrenNode.EMPTY_NODE;\r\n    }\r\n    SnapshotHolder.prototype.getNode = function (path) {\r\n        return this.rootNode_.getChild(path);\r\n    };\r\n    SnapshotHolder.prototype.updateSnapshot = function (path, newSnapshotNode) {\r\n        this.rootNode_ = this.rootNode_.updateChild(path, newSnapshotNode);\r\n    };\r\n    return SnapshotHolder;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Abstraction around FirebaseApp's token fetching capabilities.\r\n */\r\nvar AuthTokenProvider = /** @class */ (function () {\r\n    /**\r\n     * @param {!FirebaseApp} app_\r\n     */\r\n    function AuthTokenProvider(app_) {\r\n        this.app_ = app_;\r\n    }\r\n    /**\r\n     * @param {boolean} forceRefresh\r\n     * @return {!Promise<FirebaseAuthTokenData>}\r\n     */\r\n    AuthTokenProvider.prototype.getToken = function (forceRefresh) {\r\n        return this.app_['INTERNAL']['getToken'](forceRefresh).then(null, \r\n        // .catch\r\n        function (error$$1) {\r\n            // TODO: Need to figure out all the cases this is raised and whether\r\n            // this makes sense.\r\n            if (error$$1 && error$$1.code === 'auth/token-not-initialized') {\r\n                log('Got auth/token-not-initialized error.  Treating as null token.');\r\n                return null;\r\n            }\r\n            else {\r\n                return Promise.reject(error$$1);\r\n            }\r\n        });\r\n    };\r\n    AuthTokenProvider.prototype.addTokenChangeListener = function (listener) {\r\n        // TODO: We might want to wrap the listener and call it with no args to\r\n        // avoid a leaky abstraction, but that makes removing the listener harder.\r\n        this.app_['INTERNAL']['addAuthTokenListener'](listener);\r\n    };\r\n    AuthTokenProvider.prototype.removeTokenChangeListener = function (listener) {\r\n        this.app_['INTERNAL']['removeAuthTokenListener'](listener);\r\n    };\r\n    AuthTokenProvider.prototype.notifyForInvalidToken = function () {\r\n        var errorMessage = 'Provided authentication credentials for the app named \"' +\r\n            this.app_.name +\r\n            '\" are invalid. This usually indicates your app was not ' +\r\n            'initialized correctly. ';\r\n        if ('credential' in this.app_.options) {\r\n            errorMessage +=\r\n                'Make sure the \"credential\" property provided to initializeApp() ' +\r\n                    'is authorized to access the specified \"databaseURL\" and is from the correct ' +\r\n                    'project.';\r\n        }\r\n        else if ('serviceAccount' in this.app_.options) {\r\n            errorMessage +=\r\n                'Make sure the \"serviceAccount\" property provided to initializeApp() ' +\r\n                    'is authorized to access the specified \"databaseURL\" and is from the correct ' +\r\n                    'project.';\r\n        }\r\n        else {\r\n            errorMessage +=\r\n                'Make sure the \"apiKey\" and \"databaseURL\" properties provided to ' +\r\n                    'initializeApp() match the values provided for your app at ' +\r\n                    'https://console.firebase.google.com/.';\r\n        }\r\n        warn(errorMessage);\r\n    };\r\n    return AuthTokenProvider;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Tracks a collection of stats.\r\n *\r\n * @constructor\r\n */\r\nvar StatsCollection = /** @class */ (function () {\r\n    function StatsCollection() {\r\n        this.counters_ = {};\r\n    }\r\n    StatsCollection.prototype.incrementCounter = function (name, amount) {\r\n        if (amount === void 0) { amount = 1; }\r\n        if (!contains(this.counters_, name))\r\n            this.counters_[name] = 0;\r\n        this.counters_[name] += amount;\r\n    };\r\n    StatsCollection.prototype.get = function () {\r\n        return deepCopy(this.counters_);\r\n    };\r\n    return StatsCollection;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar StatsManager = /** @class */ (function () {\r\n    function StatsManager() {\r\n    }\r\n    StatsManager.getCollection = function (repoInfo) {\r\n        var hashString = repoInfo.toString();\r\n        if (!this.collections_[hashString]) {\r\n            this.collections_[hashString] = new StatsCollection();\r\n        }\r\n        return this.collections_[hashString];\r\n    };\r\n    StatsManager.getOrCreateReporter = function (repoInfo, creatorFunction) {\r\n        var hashString = repoInfo.toString();\r\n        if (!this.reporters_[hashString]) {\r\n            this.reporters_[hashString] = creatorFunction();\r\n        }\r\n        return this.reporters_[hashString];\r\n    };\r\n    StatsManager.collections_ = {};\r\n    StatsManager.reporters_ = {};\r\n    return StatsManager;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns the delta from the previous call to get stats.\r\n *\r\n * @param collection_ The collection to \"listen\" to.\r\n * @constructor\r\n */\r\nvar StatsListener = /** @class */ (function () {\r\n    function StatsListener(collection_) {\r\n        this.collection_ = collection_;\r\n        this.last_ = null;\r\n    }\r\n    StatsListener.prototype.get = function () {\r\n        var newStats = this.collection_.get();\r\n        var delta = clone(newStats);\r\n        if (this.last_) {\r\n            forEach(this.last_, function (stat, value) {\r\n                delta[stat] = delta[stat] - value;\r\n            });\r\n        }\r\n        this.last_ = newStats;\r\n        return delta;\r\n    };\r\n    return StatsListener;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Assuming some apps may have a short amount of time on page, and a bulk of firebase operations probably\r\n// happen on page load, we try to report our first set of stats pretty quickly, but we wait at least 10\r\n// seconds to try to ensure the Firebase connection is established / settled.\r\nvar FIRST_STATS_MIN_TIME = 10 * 1000;\r\nvar FIRST_STATS_MAX_TIME = 30 * 1000;\r\n// We'll continue to report stats on average every 5 minutes.\r\nvar REPORT_STATS_INTERVAL = 5 * 60 * 1000;\r\n/**\r\n * @constructor\r\n */\r\nvar StatsReporter = /** @class */ (function () {\r\n    /**\r\n     * @param collection\r\n     * @param server_\r\n     */\r\n    function StatsReporter(collection, server_) {\r\n        this.server_ = server_;\r\n        this.statsToReport_ = {};\r\n        this.statsListener_ = new StatsListener(collection);\r\n        var timeout = FIRST_STATS_MIN_TIME +\r\n            (FIRST_STATS_MAX_TIME - FIRST_STATS_MIN_TIME) * Math.random();\r\n        setTimeoutNonBlocking(this.reportStats_.bind(this), Math.floor(timeout));\r\n    }\r\n    StatsReporter.prototype.includeStat = function (stat) {\r\n        this.statsToReport_[stat] = true;\r\n    };\r\n    StatsReporter.prototype.reportStats_ = function () {\r\n        var _this = this;\r\n        var stats = this.statsListener_.get();\r\n        var reportedStats = {};\r\n        var haveStatsToReport = false;\r\n        forEach(stats, function (stat, value) {\r\n            if (value > 0 && contains(_this.statsToReport_, stat)) {\r\n                reportedStats[stat] = value;\r\n                haveStatsToReport = true;\r\n            }\r\n        });\r\n        if (haveStatsToReport) {\r\n            this.server_.reportStats(reportedStats);\r\n        }\r\n        // queue our next run.\r\n        setTimeoutNonBlocking(this.reportStats_.bind(this), Math.floor(Math.random() * 2 * REPORT_STATS_INTERVAL));\r\n    };\r\n    return StatsReporter;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * The event queue serves a few purposes:\r\n * 1. It ensures we maintain event order in the face of event callbacks doing operations that result in more\r\n *    events being queued.\r\n * 2. raiseQueuedEvents() handles being called reentrantly nicely.  That is, if in the course of raising events,\r\n *    raiseQueuedEvents() is called again, the \"inner\" call will pick up raising events where the \"outer\" call\r\n *    left off, ensuring that the events are still raised synchronously and in order.\r\n * 3. You can use raiseEventsAtPath and raiseEventsForChangedPath to ensure only relevant previously-queued\r\n *    events are raised synchronously.\r\n *\r\n * NOTE: This can all go away if/when we move to async events.\r\n *\r\n * @constructor\r\n */\r\nvar EventQueue = /** @class */ (function () {\r\n    function EventQueue() {\r\n        /**\r\n         * @private\r\n         * @type {!Array.<EventList>}\r\n         */\r\n        this.eventLists_ = [];\r\n        /**\r\n         * Tracks recursion depth of raiseQueuedEvents_, for debugging purposes.\r\n         * @private\r\n         * @type {!number}\r\n         */\r\n        this.recursionDepth_ = 0;\r\n    }\r\n    /**\r\n     * @param {!Array.<Event>} eventDataList The new events to queue.\r\n     */\r\n    EventQueue.prototype.queueEvents = function (eventDataList) {\r\n        // We group events by path, storing them in a single EventList, to make it easier to skip over them quickly.\r\n        var currList = null;\r\n        for (var i = 0; i < eventDataList.length; i++) {\r\n            var eventData = eventDataList[i];\r\n            var eventPath = eventData.getPath();\r\n            if (currList !== null && !eventPath.equals(currList.getPath())) {\r\n                this.eventLists_.push(currList);\r\n                currList = null;\r\n            }\r\n            if (currList === null) {\r\n                currList = new EventList(eventPath);\r\n            }\r\n            currList.add(eventData);\r\n        }\r\n        if (currList) {\r\n            this.eventLists_.push(currList);\r\n        }\r\n    };\r\n    /**\r\n     * Queues the specified events and synchronously raises all events (including previously queued ones)\r\n     * for the specified path.\r\n     *\r\n     * It is assumed that the new events are all for the specified path.\r\n     *\r\n     * @param {!Path} path The path to raise events for.\r\n     * @param {!Array.<Event>} eventDataList The new events to raise.\r\n     */\r\n    EventQueue.prototype.raiseEventsAtPath = function (path, eventDataList) {\r\n        this.queueEvents(eventDataList);\r\n        this.raiseQueuedEventsMatchingPredicate_(function (eventPath) {\r\n            return eventPath.equals(path);\r\n        });\r\n    };\r\n    /**\r\n     * Queues the specified events and synchronously raises all events (including previously queued ones) for\r\n     * locations related to the specified change path (i.e. all ancestors and descendants).\r\n     *\r\n     * It is assumed that the new events are all related (ancestor or descendant) to the specified path.\r\n     *\r\n     * @param {!Path} changedPath The path to raise events for.\r\n     * @param {!Array.<!Event>} eventDataList The events to raise\r\n     */\r\n    EventQueue.prototype.raiseEventsForChangedPath = function (changedPath, eventDataList) {\r\n        this.queueEvents(eventDataList);\r\n        this.raiseQueuedEventsMatchingPredicate_(function (eventPath) {\r\n            return eventPath.contains(changedPath) || changedPath.contains(eventPath);\r\n        });\r\n    };\r\n    /**\r\n     * @param {!function(!Path):boolean} predicate\r\n     * @private\r\n     */\r\n    EventQueue.prototype.raiseQueuedEventsMatchingPredicate_ = function (predicate) {\r\n        this.recursionDepth_++;\r\n        var sentAll = true;\r\n        for (var i = 0; i < this.eventLists_.length; i++) {\r\n            var eventList = this.eventLists_[i];\r\n            if (eventList) {\r\n                var eventPath = eventList.getPath();\r\n                if (predicate(eventPath)) {\r\n                    this.eventLists_[i].raise();\r\n                    this.eventLists_[i] = null;\r\n                }\r\n                else {\r\n                    sentAll = false;\r\n                }\r\n            }\r\n        }\r\n        if (sentAll) {\r\n            this.eventLists_ = [];\r\n        }\r\n        this.recursionDepth_--;\r\n    };\r\n    return EventQueue;\r\n}());\r\n/**\r\n * @param {!Path} path\r\n * @constructor\r\n */\r\nvar EventList = /** @class */ (function () {\r\n    function EventList(path_) {\r\n        this.path_ = path_;\r\n        /**\r\n         * @type {!Array.<Event>}\r\n         * @private\r\n         */\r\n        this.events_ = [];\r\n    }\r\n    /**\r\n     * @param {!Event} eventData\r\n     */\r\n    EventList.prototype.add = function (eventData) {\r\n        this.events_.push(eventData);\r\n    };\r\n    /**\r\n     * Iterates through the list and raises each event\r\n     */\r\n    EventList.prototype.raise = function () {\r\n        for (var i = 0; i < this.events_.length; i++) {\r\n            var eventData = this.events_[i];\r\n            if (eventData !== null) {\r\n                this.events_[i] = null;\r\n                var eventFn = eventData.getEventRunner();\r\n                if (logger) {\r\n                    log('event: ' + eventData.toString());\r\n                }\r\n                exceptionGuard(eventFn);\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * @return {!Path}\r\n     */\r\n    EventList.prototype.getPath = function () {\r\n        return this.path_;\r\n    };\r\n    return EventList;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Base class to be used if you want to emit events. Call the constructor with\r\n * the set of allowed event names.\r\n */\r\nvar EventEmitter = /** @class */ (function () {\r\n    /**\r\n     * @param {!Array.<string>} allowedEvents_\r\n     */\r\n    function EventEmitter(allowedEvents_) {\r\n        this.allowedEvents_ = allowedEvents_;\r\n        this.listeners_ = {};\r\n        assert(Array.isArray(allowedEvents_) && allowedEvents_.length > 0, 'Requires a non-empty array');\r\n    }\r\n    /**\r\n     * To be called by derived classes to trigger events.\r\n     * @param {!string} eventType\r\n     * @param {...*} var_args\r\n     */\r\n    EventEmitter.prototype.trigger = function (eventType) {\r\n        var var_args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            var_args[_i - 1] = arguments[_i];\r\n        }\r\n        if (Array.isArray(this.listeners_[eventType])) {\r\n            // Clone the list, since callbacks could add/remove listeners.\r\n            var listeners = this.listeners_[eventType].slice();\r\n            for (var i = 0; i < listeners.length; i++) {\r\n                listeners[i].callback.apply(listeners[i].context, var_args);\r\n            }\r\n        }\r\n    };\r\n    EventEmitter.prototype.on = function (eventType, callback, context) {\r\n        this.validateEventType_(eventType);\r\n        this.listeners_[eventType] = this.listeners_[eventType] || [];\r\n        this.listeners_[eventType].push({ callback: callback, context: context });\r\n        var eventData = this.getInitialEvent(eventType);\r\n        if (eventData) {\r\n            callback.apply(context, eventData);\r\n        }\r\n    };\r\n    EventEmitter.prototype.off = function (eventType, callback, context) {\r\n        this.validateEventType_(eventType);\r\n        var listeners = this.listeners_[eventType] || [];\r\n        for (var i = 0; i < listeners.length; i++) {\r\n            if (listeners[i].callback === callback &&\r\n                (!context || context === listeners[i].context)) {\r\n                listeners.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    };\r\n    EventEmitter.prototype.validateEventType_ = function (eventType) {\r\n        assert(this.allowedEvents_.find(function (et) {\r\n            return et === eventType;\r\n        }), 'Unknown event: ' + eventType);\r\n    };\r\n    return EventEmitter;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @extends {EventEmitter}\r\n */\r\nvar VisibilityMonitor = /** @class */ (function (_super) {\r\n    __extends(VisibilityMonitor, _super);\r\n    function VisibilityMonitor() {\r\n        var _this = _super.call(this, ['visible']) || this;\r\n        var hidden;\r\n        var visibilityChange;\r\n        if (typeof document !== 'undefined' &&\r\n            typeof document.addEventListener !== 'undefined') {\r\n            if (typeof document['hidden'] !== 'undefined') {\r\n                // Opera 12.10 and Firefox 18 and later support\r\n                visibilityChange = 'visibilitychange';\r\n                hidden = 'hidden';\r\n            }\r\n            else if (typeof document['mozHidden'] !== 'undefined') {\r\n                visibilityChange = 'mozvisibilitychange';\r\n                hidden = 'mozHidden';\r\n            }\r\n            else if (typeof document['msHidden'] !== 'undefined') {\r\n                visibilityChange = 'msvisibilitychange';\r\n                hidden = 'msHidden';\r\n            }\r\n            else if (typeof document['webkitHidden'] !== 'undefined') {\r\n                visibilityChange = 'webkitvisibilitychange';\r\n                hidden = 'webkitHidden';\r\n            }\r\n        }\r\n        // Initially, we always assume we are visible. This ensures that in browsers\r\n        // without page visibility support or in cases where we are never visible\r\n        // (e.g. chrome extension), we act as if we are visible, i.e. don't delay\r\n        // reconnects\r\n        _this.visible_ = true;\r\n        if (visibilityChange) {\r\n            document.addEventListener(visibilityChange, function () {\r\n                var visible = !document[hidden];\r\n                if (visible !== _this.visible_) {\r\n                    _this.visible_ = visible;\r\n                    _this.trigger('visible', visible);\r\n                }\r\n            }, false);\r\n        }\r\n        return _this;\r\n    }\r\n    VisibilityMonitor.getInstance = function () {\r\n        return new VisibilityMonitor();\r\n    };\r\n    /**\r\n     * @param {!string} eventType\r\n     * @return {Array.<boolean>}\r\n     */\r\n    VisibilityMonitor.prototype.getInitialEvent = function (eventType) {\r\n        assert(eventType === 'visible', 'Unknown event type: ' + eventType);\r\n        return [this.visible_];\r\n    };\r\n    return VisibilityMonitor;\r\n}(EventEmitter));\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Monitors online state (as reported by window.online/offline events).\r\n *\r\n * The expectation is that this could have many false positives (thinks we are online\r\n * when we're not), but no false negatives.  So we can safely use it to determine when\r\n * we definitely cannot reach the internet.\r\n *\r\n * @extends {EventEmitter}\r\n */\r\nvar OnlineMonitor = /** @class */ (function (_super) {\r\n    __extends(OnlineMonitor, _super);\r\n    function OnlineMonitor() {\r\n        var _this = _super.call(this, ['online']) || this;\r\n        _this.online_ = true;\r\n        // We've had repeated complaints that Cordova apps can get stuck \"offline\", e.g.\r\n        // https://forum.ionicframework.com/t/firebase-connection-is-lost-and-never-come-back/43810\r\n        // It would seem that the 'online' event does not always fire consistently. So we disable it\r\n        // for Cordova.\r\n        if (typeof window !== 'undefined' &&\r\n            typeof window.addEventListener !== 'undefined' &&\r\n            !isMobileCordova()) {\r\n            window.addEventListener('online', function () {\r\n                if (!_this.online_) {\r\n                    _this.online_ = true;\r\n                    _this.trigger('online', true);\r\n                }\r\n            }, false);\r\n            window.addEventListener('offline', function () {\r\n                if (_this.online_) {\r\n                    _this.online_ = false;\r\n                    _this.trigger('online', false);\r\n                }\r\n            }, false);\r\n        }\r\n        return _this;\r\n    }\r\n    OnlineMonitor.getInstance = function () {\r\n        return new OnlineMonitor();\r\n    };\r\n    /**\r\n     * @param {!string} eventType\r\n     * @return {Array.<boolean>}\r\n     */\r\n    OnlineMonitor.prototype.getInitialEvent = function (eventType) {\r\n        assert(eventType === 'online', 'Unknown event type: ' + eventType);\r\n        return [this.online_];\r\n    };\r\n    /**\r\n     * @return {boolean}\r\n     */\r\n    OnlineMonitor.prototype.currentlyOnline = function () {\r\n        return this.online_;\r\n    };\r\n    return OnlineMonitor;\r\n}(EventEmitter));\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * This class ensures the packets from the server arrive in order\r\n * This class takes data from the server and ensures it gets passed into the callbacks in order.\r\n * @constructor\r\n */\r\nvar PacketReceiver = /** @class */ (function () {\r\n    /**\r\n     * @param onMessage_\r\n     */\r\n    function PacketReceiver(onMessage_) {\r\n        this.onMessage_ = onMessage_;\r\n        this.pendingResponses = [];\r\n        this.currentResponseNum = 0;\r\n        this.closeAfterResponse = -1;\r\n        this.onClose = null;\r\n    }\r\n    PacketReceiver.prototype.closeAfter = function (responseNum, callback) {\r\n        this.closeAfterResponse = responseNum;\r\n        this.onClose = callback;\r\n        if (this.closeAfterResponse < this.currentResponseNum) {\r\n            this.onClose();\r\n            this.onClose = null;\r\n        }\r\n    };\r\n    /**\r\n     * Each message from the server comes with a response number, and an array of data. The responseNumber\r\n     * allows us to ensure that we process them in the right order, since we can't be guaranteed that all\r\n     * browsers will respond in the same order as the requests we sent\r\n     * @param {number} requestNum\r\n     * @param {Array} data\r\n     */\r\n    PacketReceiver.prototype.handleResponse = function (requestNum, data) {\r\n        var _this = this;\r\n        this.pendingResponses[requestNum] = data;\r\n        var _loop_1 = function () {\r\n            var toProcess = this_1.pendingResponses[this_1.currentResponseNum];\r\n            delete this_1.pendingResponses[this_1.currentResponseNum];\r\n            var _loop_2 = function (i) {\r\n                if (toProcess[i]) {\r\n                    exceptionGuard(function () {\r\n                        _this.onMessage_(toProcess[i]);\r\n                    });\r\n                }\r\n            };\r\n            for (var i = 0; i < toProcess.length; ++i) {\r\n                _loop_2(i);\r\n            }\r\n            if (this_1.currentResponseNum === this_1.closeAfterResponse) {\r\n                if (this_1.onClose) {\r\n                    this_1.onClose();\r\n                    this_1.onClose = null;\r\n                }\r\n                return \"break\";\r\n            }\r\n            this_1.currentResponseNum++;\r\n        };\r\n        var this_1 = this;\r\n        while (this.pendingResponses[this.currentResponseNum]) {\r\n            var state_1 = _loop_1();\r\n            if (state_1 === \"break\")\r\n                break;\r\n        }\r\n    };\r\n    return PacketReceiver;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// URL query parameters associated with longpolling\r\nvar FIREBASE_LONGPOLL_START_PARAM = 'start';\r\nvar FIREBASE_LONGPOLL_CLOSE_COMMAND = 'close';\r\nvar FIREBASE_LONGPOLL_COMMAND_CB_NAME = 'pLPCommand';\r\nvar FIREBASE_LONGPOLL_DATA_CB_NAME = 'pRTLPCB';\r\nvar FIREBASE_LONGPOLL_ID_PARAM = 'id';\r\nvar FIREBASE_LONGPOLL_PW_PARAM = 'pw';\r\nvar FIREBASE_LONGPOLL_SERIAL_PARAM = 'ser';\r\nvar FIREBASE_LONGPOLL_CALLBACK_ID_PARAM = 'cb';\r\nvar FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM = 'seg';\r\nvar FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET = 'ts';\r\nvar FIREBASE_LONGPOLL_DATA_PARAM = 'd';\r\nvar FIREBASE_LONGPOLL_DISCONN_FRAME_PARAM = 'disconn';\r\nvar FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM = 'dframe';\r\n//Data size constants.\r\n//TODO: Perf: the maximum length actually differs from browser to browser.\r\n// We should check what browser we're on and set accordingly.\r\nvar MAX_URL_DATA_SIZE = 1870;\r\nvar SEG_HEADER_SIZE = 30; //ie: &seg=8299234&ts=982389123&d=\r\nvar MAX_PAYLOAD_SIZE = MAX_URL_DATA_SIZE - SEG_HEADER_SIZE;\r\n/**\r\n * Keepalive period\r\n * send a fresh request at minimum every 25 seconds. Opera has a maximum request\r\n * length of 30 seconds that we can't exceed.\r\n * @const\r\n * @type {number}\r\n */\r\nvar KEEPALIVE_REQUEST_INTERVAL = 25000;\r\n/**\r\n * How long to wait before aborting a long-polling connection attempt.\r\n * @const\r\n * @type {number}\r\n */\r\nvar LP_CONNECT_TIMEOUT = 30000;\r\n/**\r\n * This class manages a single long-polling connection.\r\n *\r\n * @constructor\r\n * @implements {Transport}\r\n */\r\nvar BrowserPollConnection = /** @class */ (function () {\r\n    /**\r\n     * @param {string} connId An identifier for this connection, used for logging\r\n     * @param {RepoInfo} repoInfo The info for the endpoint to send data to.\r\n     * @param {string=} transportSessionId Optional transportSessionid if we are reconnecting for an existing\r\n     *                                         transport session\r\n     * @param {string=}  lastSessionId Optional lastSessionId if the PersistentConnection has already created a\r\n     *                                     connection previously\r\n     */\r\n    function BrowserPollConnection(connId, repoInfo, transportSessionId, lastSessionId) {\r\n        this.connId = connId;\r\n        this.repoInfo = repoInfo;\r\n        this.transportSessionId = transportSessionId;\r\n        this.lastSessionId = lastSessionId;\r\n        this.bytesSent = 0;\r\n        this.bytesReceived = 0;\r\n        this.everConnected_ = false;\r\n        this.log_ = logWrapper(connId);\r\n        this.stats_ = StatsManager.getCollection(repoInfo);\r\n        this.urlFn = function (params) {\r\n            return repoInfo.connectionURL(LONG_POLLING, params);\r\n        };\r\n    }\r\n    /**\r\n     *\r\n     * @param {function(Object)} onMessage Callback when messages arrive\r\n     * @param {function()} onDisconnect Callback with connection lost.\r\n     */\r\n    BrowserPollConnection.prototype.open = function (onMessage, onDisconnect) {\r\n        var _this = this;\r\n        this.curSegmentNum = 0;\r\n        this.onDisconnect_ = onDisconnect;\r\n        this.myPacketOrderer = new PacketReceiver(onMessage);\r\n        this.isClosed_ = false;\r\n        this.connectTimeoutTimer_ = setTimeout(function () {\r\n            _this.log_('Timed out trying to connect.');\r\n            // Make sure we clear the host cache\r\n            _this.onClosed_();\r\n            _this.connectTimeoutTimer_ = null;\r\n        }, Math.floor(LP_CONNECT_TIMEOUT));\r\n        // Ensure we delay the creation of the iframe until the DOM is loaded.\r\n        executeWhenDOMReady(function () {\r\n            if (_this.isClosed_)\r\n                return;\r\n            //Set up a callback that gets triggered once a connection is set up.\r\n            _this.scriptTagHolder = new FirebaseIFrameScriptHolder(function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                var command = args[0], arg1 = args[1], arg2 = args[2];\r\n                _this.incrementIncomingBytes_(args);\r\n                if (!_this.scriptTagHolder)\r\n                    return; // we closed the connection.\r\n                if (_this.connectTimeoutTimer_) {\r\n                    clearTimeout(_this.connectTimeoutTimer_);\r\n                    _this.connectTimeoutTimer_ = null;\r\n                }\r\n                _this.everConnected_ = true;\r\n                if (command == FIREBASE_LONGPOLL_START_PARAM) {\r\n                    _this.id = arg1;\r\n                    _this.password = arg2;\r\n                }\r\n                else if (command === FIREBASE_LONGPOLL_CLOSE_COMMAND) {\r\n                    // Don't clear the host cache. We got a response from the server, so we know it's reachable\r\n                    if (arg1) {\r\n                        // We aren't expecting any more data (other than what the server's already in the process of sending us\r\n                        // through our already open polls), so don't send any more.\r\n                        _this.scriptTagHolder.sendNewPolls = false;\r\n                        // arg1 in this case is the last response number sent by the server. We should try to receive\r\n                        // all of the responses up to this one before closing\r\n                        _this.myPacketOrderer.closeAfter(arg1, function () {\r\n                            _this.onClosed_();\r\n                        });\r\n                    }\r\n                    else {\r\n                        _this.onClosed_();\r\n                    }\r\n                }\r\n                else {\r\n                    throw new Error('Unrecognized command received: ' + command);\r\n                }\r\n            }, function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                var pN = args[0], data = args[1];\r\n                _this.incrementIncomingBytes_(args);\r\n                _this.myPacketOrderer.handleResponse(pN, data);\r\n            }, function () {\r\n                _this.onClosed_();\r\n            }, _this.urlFn);\r\n            //Send the initial request to connect. The serial number is simply to keep the browser from pulling previous results\r\n            //from cache.\r\n            var urlParams = {};\r\n            urlParams[FIREBASE_LONGPOLL_START_PARAM] = 't';\r\n            urlParams[FIREBASE_LONGPOLL_SERIAL_PARAM] = Math.floor(Math.random() * 100000000);\r\n            if (_this.scriptTagHolder.uniqueCallbackIdentifier)\r\n                urlParams[FIREBASE_LONGPOLL_CALLBACK_ID_PARAM] = _this.scriptTagHolder.uniqueCallbackIdentifier;\r\n            urlParams[VERSION_PARAM] = PROTOCOL_VERSION;\r\n            if (_this.transportSessionId) {\r\n                urlParams[TRANSPORT_SESSION_PARAM] = _this.transportSessionId;\r\n            }\r\n            if (_this.lastSessionId) {\r\n                urlParams[LAST_SESSION_PARAM] = _this.lastSessionId;\r\n            }\r\n            if (!isNodeSdk() &&\r\n                typeof location !== 'undefined' &&\r\n                location.href &&\r\n                location.href.indexOf(FORGE_DOMAIN) !== -1) {\r\n                urlParams[REFERER_PARAM] = FORGE_REF;\r\n            }\r\n            var connectURL = _this.urlFn(urlParams);\r\n            _this.log_('Connecting via long-poll to ' + connectURL);\r\n            _this.scriptTagHolder.addTag(connectURL, function () {\r\n                /* do nothing */\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Call this when a handshake has completed successfully and we want to consider the connection established\r\n     */\r\n    BrowserPollConnection.prototype.start = function () {\r\n        this.scriptTagHolder.startLongPoll(this.id, this.password);\r\n        this.addDisconnectPingFrame(this.id, this.password);\r\n    };\r\n    /**\r\n     * Forces long polling to be considered as a potential transport\r\n     */\r\n    BrowserPollConnection.forceAllow = function () {\r\n        BrowserPollConnection.forceAllow_ = true;\r\n    };\r\n    /**\r\n     * Forces longpolling to not be considered as a potential transport\r\n     */\r\n    BrowserPollConnection.forceDisallow = function () {\r\n        BrowserPollConnection.forceDisallow_ = true;\r\n    };\r\n    // Static method, use string literal so it can be accessed in a generic way\r\n    BrowserPollConnection.isAvailable = function () {\r\n        // NOTE: In React-Native there's normally no 'document', but if you debug a React-Native app in\r\n        // the Chrome debugger, 'document' is defined, but document.createElement is null (2015/06/08).\r\n        return (BrowserPollConnection.forceAllow_ ||\r\n            (!BrowserPollConnection.forceDisallow_ &&\r\n                typeof document !== 'undefined' &&\r\n                document.createElement != null &&\r\n                !isChromeExtensionContentScript() &&\r\n                !isWindowsStoreApp() &&\r\n                !isNodeSdk()));\r\n    };\r\n    /**\r\n     * No-op for polling\r\n     */\r\n    BrowserPollConnection.prototype.markConnectionHealthy = function () { };\r\n    /**\r\n     * Stops polling and cleans up the iframe\r\n     * @private\r\n     */\r\n    BrowserPollConnection.prototype.shutdown_ = function () {\r\n        this.isClosed_ = true;\r\n        if (this.scriptTagHolder) {\r\n            this.scriptTagHolder.close();\r\n            this.scriptTagHolder = null;\r\n        }\r\n        //remove the disconnect frame, which will trigger an XHR call to the server to tell it we're leaving.\r\n        if (this.myDisconnFrame) {\r\n            document.body.removeChild(this.myDisconnFrame);\r\n            this.myDisconnFrame = null;\r\n        }\r\n        if (this.connectTimeoutTimer_) {\r\n            clearTimeout(this.connectTimeoutTimer_);\r\n            this.connectTimeoutTimer_ = null;\r\n        }\r\n    };\r\n    /**\r\n     * Triggered when this transport is closed\r\n     * @private\r\n     */\r\n    BrowserPollConnection.prototype.onClosed_ = function () {\r\n        if (!this.isClosed_) {\r\n            this.log_('Longpoll is closing itself');\r\n            this.shutdown_();\r\n            if (this.onDisconnect_) {\r\n                this.onDisconnect_(this.everConnected_);\r\n                this.onDisconnect_ = null;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * External-facing close handler. RealTime has requested we shut down. Kill our connection and tell the server\r\n     * that we've left.\r\n     */\r\n    BrowserPollConnection.prototype.close = function () {\r\n        if (!this.isClosed_) {\r\n            this.log_('Longpoll is being closed.');\r\n            this.shutdown_();\r\n        }\r\n    };\r\n    /**\r\n     * Send the JSON object down to the server. It will need to be stringified, base64 encoded, and then\r\n     * broken into chunks (since URLs have a small maximum length).\r\n     * @param {!Object} data The JSON data to transmit.\r\n     */\r\n    BrowserPollConnection.prototype.send = function (data) {\r\n        var dataStr = stringify(data);\r\n        this.bytesSent += dataStr.length;\r\n        this.stats_.incrementCounter('bytes_sent', dataStr.length);\r\n        //first, lets get the base64-encoded data\r\n        var base64data = base64Encode(dataStr);\r\n        //We can only fit a certain amount in each URL, so we need to split this request\r\n        //up into multiple pieces if it doesn't fit in one request.\r\n        var dataSegs = splitStringBySize(base64data, MAX_PAYLOAD_SIZE);\r\n        //Enqueue each segment for transmission. We assign each chunk a sequential ID and a total number\r\n        //of segments so that we can reassemble the packet on the server.\r\n        for (var i = 0; i < dataSegs.length; i++) {\r\n            this.scriptTagHolder.enqueueSegment(this.curSegmentNum, dataSegs.length, dataSegs[i]);\r\n            this.curSegmentNum++;\r\n        }\r\n    };\r\n    /**\r\n     * This is how we notify the server that we're leaving.\r\n     * We aren't able to send requests with DHTML on a window close event, but we can\r\n     * trigger XHR requests in some browsers (everything but Opera basically).\r\n     * @param {!string} id\r\n     * @param {!string} pw\r\n     */\r\n    BrowserPollConnection.prototype.addDisconnectPingFrame = function (id, pw) {\r\n        if (isNodeSdk())\r\n            return;\r\n        this.myDisconnFrame = document.createElement('iframe');\r\n        var urlParams = {};\r\n        urlParams[FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM] = 't';\r\n        urlParams[FIREBASE_LONGPOLL_ID_PARAM] = id;\r\n        urlParams[FIREBASE_LONGPOLL_PW_PARAM] = pw;\r\n        this.myDisconnFrame.src = this.urlFn(urlParams);\r\n        this.myDisconnFrame.style.display = 'none';\r\n        document.body.appendChild(this.myDisconnFrame);\r\n    };\r\n    /**\r\n     * Used to track the bytes received by this client\r\n     * @param {*} args\r\n     * @private\r\n     */\r\n    BrowserPollConnection.prototype.incrementIncomingBytes_ = function (args) {\r\n        // TODO: This is an annoying perf hit just to track the number of incoming bytes.  Maybe it should be opt-in.\r\n        var bytesReceived = stringify(args).length;\r\n        this.bytesReceived += bytesReceived;\r\n        this.stats_.incrementCounter('bytes_received', bytesReceived);\r\n    };\r\n    return BrowserPollConnection;\r\n}());\r\n/*********************************************************************************************\r\n * A wrapper around an iframe that is used as a long-polling script holder.\r\n * @constructor\r\n *********************************************************************************************/\r\nvar FirebaseIFrameScriptHolder = /** @class */ (function () {\r\n    /**\r\n     * @param commandCB - The callback to be called when control commands are recevied from the server.\r\n     * @param onMessageCB - The callback to be triggered when responses arrive from the server.\r\n     * @param onDisconnect - The callback to be triggered when this tag holder is closed\r\n     * @param urlFn - A function that provides the URL of the endpoint to send data to.\r\n     */\r\n    function FirebaseIFrameScriptHolder(commandCB, onMessageCB, onDisconnect, urlFn) {\r\n        this.onDisconnect = onDisconnect;\r\n        this.urlFn = urlFn;\r\n        //We maintain a count of all of the outstanding requests, because if we have too many active at once it can cause\r\n        //problems in some browsers.\r\n        /**\r\n         * @type {CountedSet.<number, number>}\r\n         */\r\n        this.outstandingRequests = new CountedSet();\r\n        //A queue of the pending segments waiting for transmission to the server.\r\n        this.pendingSegs = [];\r\n        //A serial number. We use this for two things:\r\n        // 1) A way to ensure the browser doesn't cache responses to polls\r\n        // 2) A way to make the server aware when long-polls arrive in a different order than we started them. The\r\n        //    server needs to release both polls in this case or it will cause problems in Opera since Opera can only execute\r\n        //    JSONP code in the order it was added to the iframe.\r\n        this.currentSerial = Math.floor(Math.random() * 100000000);\r\n        // This gets set to false when we're \"closing down\" the connection (e.g. we're switching transports but there's still\r\n        // incoming data from the server that we're waiting for).\r\n        this.sendNewPolls = true;\r\n        if (!isNodeSdk()) {\r\n            //Each script holder registers a couple of uniquely named callbacks with the window. These are called from the\r\n            //iframes where we put the long-polling script tags. We have two callbacks:\r\n            //   1) Command Callback - Triggered for control issues, like starting a connection.\r\n            //   2) Message Callback - Triggered when new data arrives.\r\n            this.uniqueCallbackIdentifier = LUIDGenerator();\r\n            window[FIREBASE_LONGPOLL_COMMAND_CB_NAME + this.uniqueCallbackIdentifier] = commandCB;\r\n            window[FIREBASE_LONGPOLL_DATA_CB_NAME + this.uniqueCallbackIdentifier] = onMessageCB;\r\n            //Create an iframe for us to add script tags to.\r\n            this.myIFrame = FirebaseIFrameScriptHolder.createIFrame_();\r\n            // Set the iframe's contents.\r\n            var script = '';\r\n            // if we set a javascript url, it's IE and we need to set the document domain. The javascript url is sufficient\r\n            // for ie9, but ie8 needs to do it again in the document itself.\r\n            if (this.myIFrame.src &&\r\n                this.myIFrame.src.substr(0, 'javascript:'.length) === 'javascript:') {\r\n                var currentDomain = document.domain;\r\n                script = '<script>document.domain=\"' + currentDomain + '\";</script>';\r\n            }\r\n            var iframeContents = '<html><body>' + script + '</body></html>';\r\n            try {\r\n                this.myIFrame.doc.open();\r\n                this.myIFrame.doc.write(iframeContents);\r\n                this.myIFrame.doc.close();\r\n            }\r\n            catch (e) {\r\n                log('frame writing exception');\r\n                if (e.stack) {\r\n                    log(e.stack);\r\n                }\r\n                log(e);\r\n            }\r\n        }\r\n        else {\r\n            this.commandCB = commandCB;\r\n            this.onMessageCB = onMessageCB;\r\n        }\r\n    }\r\n    /**\r\n     * Each browser has its own funny way to handle iframes. Here we mush them all together into one object that I can\r\n     * actually use.\r\n     * @private\r\n     * @return {Element}\r\n     */\r\n    FirebaseIFrameScriptHolder.createIFrame_ = function () {\r\n        var iframe = document.createElement('iframe');\r\n        iframe.style.display = 'none';\r\n        // This is necessary in order to initialize the document inside the iframe\r\n        if (document.body) {\r\n            document.body.appendChild(iframe);\r\n            try {\r\n                // If document.domain has been modified in IE, this will throw an error, and we need to set the\r\n                // domain of the iframe's document manually. We can do this via a javascript: url as the src attribute\r\n                // Also note that we must do this *after* the iframe has been appended to the page. Otherwise it doesn't work.\r\n                var a = iframe.contentWindow.document;\r\n                if (!a) {\r\n                    // Apologies for the log-spam, I need to do something to keep closure from optimizing out the assignment above.\r\n                    log('No IE domain setting required');\r\n                }\r\n            }\r\n            catch (e) {\r\n                var domain = document.domain;\r\n                iframe.src =\r\n                    \"javascript:void((function(){document.open();document.domain='\" +\r\n                        domain +\r\n                        \"';document.close();})())\";\r\n            }\r\n        }\r\n        else {\r\n            // LongPollConnection attempts to delay initialization until the document is ready, so hopefully this\r\n            // never gets hit.\r\n            throw 'Document body has not initialized. Wait to initialize Firebase until after the document is ready.';\r\n        }\r\n        // Get the document of the iframe in a browser-specific way.\r\n        if (iframe.contentDocument) {\r\n            iframe.doc = iframe.contentDocument; // Firefox, Opera, Safari\r\n        }\r\n        else if (iframe.contentWindow) {\r\n            iframe.doc = iframe.contentWindow.document; // Internet Explorer\r\n        }\r\n        else if (iframe.document) {\r\n            iframe.doc = iframe.document; //others?\r\n        }\r\n        return iframe;\r\n    };\r\n    /**\r\n     * Cancel all outstanding queries and remove the frame.\r\n     */\r\n    FirebaseIFrameScriptHolder.prototype.close = function () {\r\n        var _this = this;\r\n        //Mark this iframe as dead, so no new requests are sent.\r\n        this.alive = false;\r\n        if (this.myIFrame) {\r\n            //We have to actually remove all of the html inside this iframe before removing it from the\r\n            //window, or IE will continue loading and executing the script tags we've already added, which\r\n            //can lead to some errors being thrown. Setting innerHTML seems to be the easiest way to do this.\r\n            this.myIFrame.doc.body.innerHTML = '';\r\n            setTimeout(function () {\r\n                if (_this.myIFrame !== null) {\r\n                    document.body.removeChild(_this.myIFrame);\r\n                    _this.myIFrame = null;\r\n                }\r\n            }, Math.floor(0));\r\n        }\r\n        if (isNodeSdk() && this.myID) {\r\n            var urlParams = {};\r\n            urlParams[FIREBASE_LONGPOLL_DISCONN_FRAME_PARAM] = 't';\r\n            urlParams[FIREBASE_LONGPOLL_ID_PARAM] = this.myID;\r\n            urlParams[FIREBASE_LONGPOLL_PW_PARAM] = this.myPW;\r\n            var theURL = this.urlFn(urlParams);\r\n            FirebaseIFrameScriptHolder.nodeRestRequest(theURL);\r\n        }\r\n        // Protect from being called recursively.\r\n        var onDisconnect = this.onDisconnect;\r\n        if (onDisconnect) {\r\n            this.onDisconnect = null;\r\n            onDisconnect();\r\n        }\r\n    };\r\n    /**\r\n     * Actually start the long-polling session by adding the first script tag(s) to the iframe.\r\n     * @param {!string} id - The ID of this connection\r\n     * @param {!string} pw - The password for this connection\r\n     */\r\n    FirebaseIFrameScriptHolder.prototype.startLongPoll = function (id, pw) {\r\n        this.myID = id;\r\n        this.myPW = pw;\r\n        this.alive = true;\r\n        //send the initial request. If there are requests queued, make sure that we transmit as many as we are currently able to.\r\n        while (this.newRequest_()) { }\r\n    };\r\n    /**\r\n     * This is called any time someone might want a script tag to be added. It adds a script tag when there aren't\r\n     * too many outstanding requests and we are still alive.\r\n     *\r\n     * If there are outstanding packet segments to send, it sends one. If there aren't, it sends a long-poll anyways if\r\n     * needed.\r\n     */\r\n    FirebaseIFrameScriptHolder.prototype.newRequest_ = function () {\r\n        // We keep one outstanding request open all the time to receive data, but if we need to send data\r\n        // (pendingSegs.length > 0) then we create a new request to send the data.  The server will automatically\r\n        // close the old request.\r\n        if (this.alive &&\r\n            this.sendNewPolls &&\r\n            this.outstandingRequests.count() < (this.pendingSegs.length > 0 ? 2 : 1)) {\r\n            //construct our url\r\n            this.currentSerial++;\r\n            var urlParams = {};\r\n            urlParams[FIREBASE_LONGPOLL_ID_PARAM] = this.myID;\r\n            urlParams[FIREBASE_LONGPOLL_PW_PARAM] = this.myPW;\r\n            urlParams[FIREBASE_LONGPOLL_SERIAL_PARAM] = this.currentSerial;\r\n            var theURL = this.urlFn(urlParams);\r\n            //Now add as much data as we can.\r\n            var curDataString = '';\r\n            var i = 0;\r\n            while (this.pendingSegs.length > 0) {\r\n                //first, lets see if the next segment will fit.\r\n                var nextSeg = this.pendingSegs[0];\r\n                if (nextSeg.d.length + SEG_HEADER_SIZE + curDataString.length <=\r\n                    MAX_URL_DATA_SIZE) {\r\n                    //great, the segment will fit. Lets append it.\r\n                    var theSeg = this.pendingSegs.shift();\r\n                    curDataString =\r\n                        curDataString +\r\n                            '&' +\r\n                            FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM +\r\n                            i +\r\n                            '=' +\r\n                            theSeg.seg +\r\n                            '&' +\r\n                            FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET +\r\n                            i +\r\n                            '=' +\r\n                            theSeg.ts +\r\n                            '&' +\r\n                            FIREBASE_LONGPOLL_DATA_PARAM +\r\n                            i +\r\n                            '=' +\r\n                            theSeg.d;\r\n                    i++;\r\n                }\r\n                else {\r\n                    break;\r\n                }\r\n            }\r\n            theURL = theURL + curDataString;\r\n            this.addLongPollTag_(theURL, this.currentSerial);\r\n            return true;\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    };\r\n    /**\r\n     * Queue a packet for transmission to the server.\r\n     * @param segnum - A sequential id for this packet segment used for reassembly\r\n     * @param totalsegs - The total number of segments in this packet\r\n     * @param data - The data for this segment.\r\n     */\r\n    FirebaseIFrameScriptHolder.prototype.enqueueSegment = function (segnum, totalsegs, data) {\r\n        //add this to the queue of segments to send.\r\n        this.pendingSegs.push({ seg: segnum, ts: totalsegs, d: data });\r\n        //send the data immediately if there isn't already data being transmitted, unless\r\n        //startLongPoll hasn't been called yet.\r\n        if (this.alive) {\r\n            this.newRequest_();\r\n        }\r\n    };\r\n    /**\r\n     * Add a script tag for a regular long-poll request.\r\n     * @param {!string} url - The URL of the script tag.\r\n     * @param {!number} serial - The serial number of the request.\r\n     * @private\r\n     */\r\n    FirebaseIFrameScriptHolder.prototype.addLongPollTag_ = function (url, serial) {\r\n        var _this = this;\r\n        //remember that we sent this request.\r\n        this.outstandingRequests.add(serial, 1);\r\n        var doNewRequest = function () {\r\n            _this.outstandingRequests.remove(serial);\r\n            _this.newRequest_();\r\n        };\r\n        // If this request doesn't return on its own accord (by the server sending us some data), we'll\r\n        // create a new one after the KEEPALIVE interval to make sure we always keep a fresh request open.\r\n        var keepaliveTimeout = setTimeout(doNewRequest, Math.floor(KEEPALIVE_REQUEST_INTERVAL));\r\n        var readyStateCB = function () {\r\n            // Request completed.  Cancel the keepalive.\r\n            clearTimeout(keepaliveTimeout);\r\n            // Trigger a new request so we can continue receiving data.\r\n            doNewRequest();\r\n        };\r\n        this.addTag(url, readyStateCB);\r\n    };\r\n    /**\r\n     * Add an arbitrary script tag to the iframe.\r\n     * @param {!string} url - The URL for the script tag source.\r\n     * @param {!function()} loadCB - A callback to be triggered once the script has loaded.\r\n     */\r\n    FirebaseIFrameScriptHolder.prototype.addTag = function (url, loadCB) {\r\n        var _this = this;\r\n        if (isNodeSdk()) {\r\n            this.doNodeLongPoll(url, loadCB);\r\n        }\r\n        else {\r\n            setTimeout(function () {\r\n                try {\r\n                    // if we're already closed, don't add this poll\r\n                    if (!_this.sendNewPolls)\r\n                        return;\r\n                    var newScript_1 = _this.myIFrame.doc.createElement('script');\r\n                    newScript_1.type = 'text/javascript';\r\n                    newScript_1.async = true;\r\n                    newScript_1.src = url;\r\n                    newScript_1.onload = newScript_1.onreadystatechange = function () {\r\n                        var rstate = newScript_1.readyState;\r\n                        if (!rstate || rstate === 'loaded' || rstate === 'complete') {\r\n                            newScript_1.onload = newScript_1.onreadystatechange = null;\r\n                            if (newScript_1.parentNode) {\r\n                                newScript_1.parentNode.removeChild(newScript_1);\r\n                            }\r\n                            loadCB();\r\n                        }\r\n                    };\r\n                    newScript_1.onerror = function () {\r\n                        log('Long-poll script failed to load: ' + url);\r\n                        _this.sendNewPolls = false;\r\n                        _this.close();\r\n                    };\r\n                    _this.myIFrame.doc.body.appendChild(newScript_1);\r\n                }\r\n                catch (e) {\r\n                    // TODO: we should make this error visible somehow\r\n                }\r\n            }, Math.floor(1));\r\n        }\r\n    };\r\n    return FirebaseIFrameScriptHolder;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar WEBSOCKET_MAX_FRAME_SIZE = 16384;\r\nvar WEBSOCKET_KEEPALIVE_INTERVAL = 45000;\r\nvar WebSocketImpl = null;\r\nif (typeof MozWebSocket !== 'undefined') {\r\n    WebSocketImpl = MozWebSocket;\r\n}\r\nelse if (typeof WebSocket !== 'undefined') {\r\n    WebSocketImpl = WebSocket;\r\n}\r\n/**\r\n * Create a new websocket connection with the given callbacks.\r\n * @constructor\r\n * @implements {Transport}\r\n */\r\nvar WebSocketConnection = /** @class */ (function () {\r\n    /**\r\n     * @param {string} connId identifier for this transport\r\n     * @param {RepoInfo} repoInfo The info for the websocket endpoint.\r\n     * @param {string=} transportSessionId Optional transportSessionId if this is connecting to an existing transport\r\n     *                                         session\r\n     * @param {string=} lastSessionId Optional lastSessionId if there was a previous connection\r\n     */\r\n    function WebSocketConnection(connId, repoInfo, transportSessionId, lastSessionId) {\r\n        this.connId = connId;\r\n        this.keepaliveTimer = null;\r\n        this.frames = null;\r\n        this.totalFrames = 0;\r\n        this.bytesSent = 0;\r\n        this.bytesReceived = 0;\r\n        this.log_ = logWrapper(this.connId);\r\n        this.stats_ = StatsManager.getCollection(repoInfo);\r\n        this.connURL = WebSocketConnection.connectionURL_(repoInfo, transportSessionId, lastSessionId);\r\n    }\r\n    /**\r\n     * @param {RepoInfo} repoInfo The info for the websocket endpoint.\r\n     * @param {string=} transportSessionId Optional transportSessionId if this is connecting to an existing transport\r\n     *                                         session\r\n     * @param {string=} lastSessionId Optional lastSessionId if there was a previous connection\r\n     * @return {string} connection url\r\n     * @private\r\n     */\r\n    WebSocketConnection.connectionURL_ = function (repoInfo, transportSessionId, lastSessionId) {\r\n        var urlParams = {};\r\n        urlParams[VERSION_PARAM] = PROTOCOL_VERSION;\r\n        if (!isNodeSdk() &&\r\n            typeof location !== 'undefined' &&\r\n            location.href &&\r\n            location.href.indexOf(FORGE_DOMAIN) !== -1) {\r\n            urlParams[REFERER_PARAM] = FORGE_REF;\r\n        }\r\n        if (transportSessionId) {\r\n            urlParams[TRANSPORT_SESSION_PARAM] = transportSessionId;\r\n        }\r\n        if (lastSessionId) {\r\n            urlParams[LAST_SESSION_PARAM] = lastSessionId;\r\n        }\r\n        return repoInfo.connectionURL(WEBSOCKET, urlParams);\r\n    };\r\n    /**\r\n     *\r\n     * @param onMessage Callback when messages arrive\r\n     * @param onDisconnect Callback with connection lost.\r\n     */\r\n    WebSocketConnection.prototype.open = function (onMessage, onDisconnect) {\r\n        var _this = this;\r\n        this.onDisconnect = onDisconnect;\r\n        this.onMessage = onMessage;\r\n        this.log_('Websocket connecting to ' + this.connURL);\r\n        this.everConnected_ = false;\r\n        // Assume failure until proven otherwise.\r\n        PersistentStorage.set('previous_websocket_failure', true);\r\n        try {\r\n            if (isNodeSdk()) {\r\n                var device = CONSTANTS.NODE_ADMIN ? 'AdminNode' : 'Node';\r\n                // UA Format: Firebase/<wire_protocol>/<sdk_version>/<platform>/<device>\r\n                var options = {\r\n                    headers: {\r\n                        'User-Agent': \"Firebase/\" + PROTOCOL_VERSION + \"/\" + firebase.SDK_VERSION + \"/\" + process.platform + \"/\" + device\r\n                    }\r\n                };\r\n                // Plumb appropriate http_proxy environment variable into faye-websocket if it exists.\r\n                var env = process['env'];\r\n                var proxy = this.connURL.indexOf('wss://') == 0\r\n                    ? env['HTTPS_PROXY'] || env['https_proxy']\r\n                    : env['HTTP_PROXY'] || env['http_proxy'];\r\n                if (proxy) {\r\n                    options['proxy'] = { origin: proxy };\r\n                }\r\n                this.mySock = new WebSocketImpl(this.connURL, [], options);\r\n            }\r\n            else {\r\n                this.mySock = new WebSocketImpl(this.connURL);\r\n            }\r\n        }\r\n        catch (e) {\r\n            this.log_('Error instantiating WebSocket.');\r\n            var error$$1 = e.message || e.data;\r\n            if (error$$1) {\r\n                this.log_(error$$1);\r\n            }\r\n            this.onClosed_();\r\n            return;\r\n        }\r\n        this.mySock.onopen = function () {\r\n            _this.log_('Websocket connected.');\r\n            _this.everConnected_ = true;\r\n        };\r\n        this.mySock.onclose = function () {\r\n            _this.log_('Websocket connection was disconnected.');\r\n            _this.mySock = null;\r\n            _this.onClosed_();\r\n        };\r\n        this.mySock.onmessage = function (m) {\r\n            _this.handleIncomingFrame(m);\r\n        };\r\n        this.mySock.onerror = function (e) {\r\n            _this.log_('WebSocket error.  Closing connection.');\r\n            var error$$1 = e.message || e.data;\r\n            if (error$$1) {\r\n                _this.log_(error$$1);\r\n            }\r\n            _this.onClosed_();\r\n        };\r\n    };\r\n    /**\r\n     * No-op for websockets, we don't need to do anything once the connection is confirmed as open\r\n     */\r\n    WebSocketConnection.prototype.start = function () { };\r\n    WebSocketConnection.forceDisallow = function () {\r\n        WebSocketConnection.forceDisallow_ = true;\r\n    };\r\n    WebSocketConnection.isAvailable = function () {\r\n        var isOldAndroid = false;\r\n        if (typeof navigator !== 'undefined' && navigator.userAgent) {\r\n            var oldAndroidRegex = /Android ([0-9]{0,}\\.[0-9]{0,})/;\r\n            var oldAndroidMatch = navigator.userAgent.match(oldAndroidRegex);\r\n            if (oldAndroidMatch && oldAndroidMatch.length > 1) {\r\n                if (parseFloat(oldAndroidMatch[1]) < 4.4) {\r\n                    isOldAndroid = true;\r\n                }\r\n            }\r\n        }\r\n        return (!isOldAndroid &&\r\n            WebSocketImpl !== null &&\r\n            !WebSocketConnection.forceDisallow_);\r\n    };\r\n    /**\r\n     * Returns true if we previously failed to connect with this transport.\r\n     * @return {boolean}\r\n     */\r\n    WebSocketConnection.previouslyFailed = function () {\r\n        // If our persistent storage is actually only in-memory storage,\r\n        // we default to assuming that it previously failed to be safe.\r\n        return (PersistentStorage.isInMemoryStorage ||\r\n            PersistentStorage.get('previous_websocket_failure') === true);\r\n    };\r\n    WebSocketConnection.prototype.markConnectionHealthy = function () {\r\n        PersistentStorage.remove('previous_websocket_failure');\r\n    };\r\n    WebSocketConnection.prototype.appendFrame_ = function (data) {\r\n        this.frames.push(data);\r\n        if (this.frames.length == this.totalFrames) {\r\n            var fullMess = this.frames.join('');\r\n            this.frames = null;\r\n            var jsonMess = jsonEval(fullMess);\r\n            //handle the message\r\n            this.onMessage(jsonMess);\r\n        }\r\n    };\r\n    /**\r\n     * @param {number} frameCount The number of frames we are expecting from the server\r\n     * @private\r\n     */\r\n    WebSocketConnection.prototype.handleNewFrameCount_ = function (frameCount) {\r\n        this.totalFrames = frameCount;\r\n        this.frames = [];\r\n    };\r\n    /**\r\n     * Attempts to parse a frame count out of some text. If it can't, assumes a value of 1\r\n     * @param {!String} data\r\n     * @return {?String} Any remaining data to be process, or null if there is none\r\n     * @private\r\n     */\r\n    WebSocketConnection.prototype.extractFrameCount_ = function (data) {\r\n        assert(this.frames === null, 'We already have a frame buffer');\r\n        // TODO: The server is only supposed to send up to 9999 frames (i.e. length <= 4), but that isn't being enforced\r\n        // currently.  So allowing larger frame counts (length <= 6).  See https://app.asana.com/0/search/8688598998380/8237608042508\r\n        if (data.length <= 6) {\r\n            var frameCount = Number(data);\r\n            if (!isNaN(frameCount)) {\r\n                this.handleNewFrameCount_(frameCount);\r\n                return null;\r\n            }\r\n        }\r\n        this.handleNewFrameCount_(1);\r\n        return data;\r\n    };\r\n    /**\r\n     * Process a websocket frame that has arrived from the server.\r\n     * @param mess The frame data\r\n     */\r\n    WebSocketConnection.prototype.handleIncomingFrame = function (mess) {\r\n        if (this.mySock === null)\r\n            return; // Chrome apparently delivers incoming packets even after we .close() the connection sometimes.\r\n        var data = mess['data'];\r\n        this.bytesReceived += data.length;\r\n        this.stats_.incrementCounter('bytes_received', data.length);\r\n        this.resetKeepAlive();\r\n        if (this.frames !== null) {\r\n            // we're buffering\r\n            this.appendFrame_(data);\r\n        }\r\n        else {\r\n            // try to parse out a frame count, otherwise, assume 1 and process it\r\n            var remainingData = this.extractFrameCount_(data);\r\n            if (remainingData !== null) {\r\n                this.appendFrame_(remainingData);\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Send a message to the server\r\n     * @param {Object} data The JSON object to transmit\r\n     */\r\n    WebSocketConnection.prototype.send = function (data) {\r\n        this.resetKeepAlive();\r\n        var dataStr = stringify(data);\r\n        this.bytesSent += dataStr.length;\r\n        this.stats_.incrementCounter('bytes_sent', dataStr.length);\r\n        //We can only fit a certain amount in each websocket frame, so we need to split this request\r\n        //up into multiple pieces if it doesn't fit in one request.\r\n        var dataSegs = splitStringBySize(dataStr, WEBSOCKET_MAX_FRAME_SIZE);\r\n        //Send the length header\r\n        if (dataSegs.length > 1) {\r\n            this.sendString_(String(dataSegs.length));\r\n        }\r\n        //Send the actual data in segments.\r\n        for (var i = 0; i < dataSegs.length; i++) {\r\n            this.sendString_(dataSegs[i]);\r\n        }\r\n    };\r\n    WebSocketConnection.prototype.shutdown_ = function () {\r\n        this.isClosed_ = true;\r\n        if (this.keepaliveTimer) {\r\n            clearInterval(this.keepaliveTimer);\r\n            this.keepaliveTimer = null;\r\n        }\r\n        if (this.mySock) {\r\n            this.mySock.close();\r\n            this.mySock = null;\r\n        }\r\n    };\r\n    WebSocketConnection.prototype.onClosed_ = function () {\r\n        if (!this.isClosed_) {\r\n            this.log_('WebSocket is closing itself');\r\n            this.shutdown_();\r\n            // since this is an internal close, trigger the close listener\r\n            if (this.onDisconnect) {\r\n                this.onDisconnect(this.everConnected_);\r\n                this.onDisconnect = null;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * External-facing close handler.\r\n     * Close the websocket and kill the connection.\r\n     */\r\n    WebSocketConnection.prototype.close = function () {\r\n        if (!this.isClosed_) {\r\n            this.log_('WebSocket is being closed');\r\n            this.shutdown_();\r\n        }\r\n    };\r\n    /**\r\n     * Kill the current keepalive timer and start a new one, to ensure that it always fires N seconds after\r\n     * the last activity.\r\n     */\r\n    WebSocketConnection.prototype.resetKeepAlive = function () {\r\n        var _this = this;\r\n        clearInterval(this.keepaliveTimer);\r\n        this.keepaliveTimer = setInterval(function () {\r\n            //If there has been no websocket activity for a while, send a no-op\r\n            if (_this.mySock) {\r\n                _this.sendString_('0');\r\n            }\r\n            _this.resetKeepAlive();\r\n        }, Math.floor(WEBSOCKET_KEEPALIVE_INTERVAL));\r\n    };\r\n    /**\r\n     * Send a string over the websocket.\r\n     *\r\n     * @param {string} str String to send.\r\n     * @private\r\n     */\r\n    WebSocketConnection.prototype.sendString_ = function (str) {\r\n        // Firefox seems to sometimes throw exceptions (NS_ERROR_UNEXPECTED) from websocket .send()\r\n        // calls for some unknown reason.  We treat these as an error and disconnect.\r\n        // See https://app.asana.com/0/58926111402292/68021340250410\r\n        try {\r\n            this.mySock.send(str);\r\n        }\r\n        catch (e) {\r\n            this.log_('Exception thrown from WebSocket.send():', e.message || e.data, 'Closing connection.');\r\n            setTimeout(this.onClosed_.bind(this), 0);\r\n        }\r\n    };\r\n    /**\r\n     * Number of response before we consider the connection \"healthy.\"\r\n     * @type {number}\r\n     */\r\n    WebSocketConnection.responsesRequiredToBeHealthy = 2;\r\n    /**\r\n     * Time to wait for the connection te become healthy before giving up.\r\n     * @type {number}\r\n     */\r\n    WebSocketConnection.healthyTimeout = 30000;\r\n    return WebSocketConnection;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Currently simplistic, this class manages what transport a Connection should use at various stages of its\r\n * lifecycle.\r\n *\r\n * It starts with longpolling in a browser, and httppolling on node. It then upgrades to websockets if\r\n * they are available.\r\n * @constructor\r\n */\r\nvar TransportManager = /** @class */ (function () {\r\n    /**\r\n     * @param {!RepoInfo} repoInfo Metadata around the namespace we're connecting to\r\n     */\r\n    function TransportManager(repoInfo) {\r\n        this.initTransports_(repoInfo);\r\n    }\r\n    Object.defineProperty(TransportManager, \"ALL_TRANSPORTS\", {\r\n        /**\r\n         * @const\r\n         * @type {!Array.<function(new:Transport, string, RepoInfo, string=)>}\r\n         */\r\n        get: function () {\r\n            return [BrowserPollConnection, WebSocketConnection];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * @param {!RepoInfo} repoInfo\r\n     * @private\r\n     */\r\n    TransportManager.prototype.initTransports_ = function (repoInfo) {\r\n        var isWebSocketsAvailable = WebSocketConnection && WebSocketConnection['isAvailable']();\r\n        var isSkipPollConnection = isWebSocketsAvailable && !WebSocketConnection.previouslyFailed();\r\n        if (repoInfo.webSocketOnly) {\r\n            if (!isWebSocketsAvailable)\r\n                warn(\"wss:// URL used, but browser isn't known to support websockets.  Trying anyway.\");\r\n            isSkipPollConnection = true;\r\n        }\r\n        if (isSkipPollConnection) {\r\n            this.transports_ = [WebSocketConnection];\r\n        }\r\n        else {\r\n            var transports_1 = (this.transports_ = []);\r\n            each(TransportManager.ALL_TRANSPORTS, function (i, transport) {\r\n                if (transport && transport['isAvailable']()) {\r\n                    transports_1.push(transport);\r\n                }\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * @return {function(new:Transport, !string, !RepoInfo, string=, string=)} The constructor for the\r\n     * initial transport to use\r\n     */\r\n    TransportManager.prototype.initialTransport = function () {\r\n        if (this.transports_.length > 0) {\r\n            return this.transports_[0];\r\n        }\r\n        else {\r\n            throw new Error('No transports available');\r\n        }\r\n    };\r\n    /**\r\n     * @return {?function(new:Transport, function(),function(), string=)} The constructor for the next\r\n     * transport, or null\r\n     */\r\n    TransportManager.prototype.upgradeTransport = function () {\r\n        if (this.transports_.length > 1) {\r\n            return this.transports_[1];\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    };\r\n    return TransportManager;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Abort upgrade attempt if it takes longer than 60s.\r\nvar UPGRADE_TIMEOUT = 60000;\r\n// For some transports (WebSockets), we need to \"validate\" the transport by exchanging a few requests and responses.\r\n// If we haven't sent enough requests within 5s, we'll start sending noop ping requests.\r\nvar DELAY_BEFORE_SENDING_EXTRA_REQUESTS = 5000;\r\n// If the initial data sent triggers a lot of bandwidth (i.e. it's a large put or a listen for a large amount of data)\r\n// then we may not be able to exchange our ping/pong requests within the healthy timeout.  So if we reach the timeout\r\n// but we've sent/received enough bytes, we don't cancel the connection.\r\nvar BYTES_SENT_HEALTHY_OVERRIDE = 10 * 1024;\r\nvar BYTES_RECEIVED_HEALTHY_OVERRIDE = 100 * 1024;\r\nvar MESSAGE_TYPE = 't';\r\nvar MESSAGE_DATA = 'd';\r\nvar CONTROL_SHUTDOWN = 's';\r\nvar CONTROL_RESET = 'r';\r\nvar CONTROL_ERROR = 'e';\r\nvar CONTROL_PONG = 'o';\r\nvar SWITCH_ACK = 'a';\r\nvar END_TRANSMISSION = 'n';\r\nvar PING = 'p';\r\nvar SERVER_HELLO = 'h';\r\n/**\r\n * Creates a new real-time connection to the server using whichever method works\r\n * best in the current browser.\r\n *\r\n * @constructor\r\n */\r\nvar Connection = /** @class */ (function () {\r\n    /**\r\n     * @param {!string} id - an id for this connection\r\n     * @param {!RepoInfo} repoInfo_ - the info for the endpoint to connect to\r\n     * @param {function(Object)} onMessage_ - the callback to be triggered when a server-push message arrives\r\n     * @param {function(number, string)} onReady_ - the callback to be triggered when this connection is ready to send messages.\r\n     * @param {function()} onDisconnect_ - the callback to be triggered when a connection was lost\r\n     * @param {function(string)} onKill_ - the callback to be triggered when this connection has permanently shut down.\r\n     * @param {string=} lastSessionId - last session id in persistent connection. is used to clean up old session in real-time server\r\n     */\r\n    function Connection(id, repoInfo_, onMessage_, onReady_, onDisconnect_, onKill_, lastSessionId) {\r\n        this.id = id;\r\n        this.repoInfo_ = repoInfo_;\r\n        this.onMessage_ = onMessage_;\r\n        this.onReady_ = onReady_;\r\n        this.onDisconnect_ = onDisconnect_;\r\n        this.onKill_ = onKill_;\r\n        this.lastSessionId = lastSessionId;\r\n        this.connectionCount = 0;\r\n        this.pendingDataMessages = [];\r\n        this.state_ = 0 /* CONNECTING */;\r\n        this.log_ = logWrapper('c:' + this.id + ':');\r\n        this.transportManager_ = new TransportManager(repoInfo_);\r\n        this.log_('Connection created');\r\n        this.start_();\r\n    }\r\n    /**\r\n     * Starts a connection attempt\r\n     * @private\r\n     */\r\n    Connection.prototype.start_ = function () {\r\n        var _this = this;\r\n        var conn = this.transportManager_.initialTransport();\r\n        this.conn_ = new conn(this.nextTransportId_(), this.repoInfo_, undefined, this.lastSessionId);\r\n        // For certain transports (WebSockets), we need to send and receive several messages back and forth before we\r\n        // can consider the transport healthy.\r\n        this.primaryResponsesRequired_ = conn['responsesRequiredToBeHealthy'] || 0;\r\n        var onMessageReceived = this.connReceiver_(this.conn_);\r\n        var onConnectionLost = this.disconnReceiver_(this.conn_);\r\n        this.tx_ = this.conn_;\r\n        this.rx_ = this.conn_;\r\n        this.secondaryConn_ = null;\r\n        this.isHealthy_ = false;\r\n        /*\r\n         * Firefox doesn't like when code from one iframe tries to create another iframe by way of the parent frame.\r\n         * This can occur in the case of a redirect, i.e. we guessed wrong on what server to connect to and received a reset.\r\n         * Somehow, setTimeout seems to make this ok. That doesn't make sense from a security perspective, since you should\r\n         * still have the context of your originating frame.\r\n         */\r\n        setTimeout(function () {\r\n            // this.conn_ gets set to null in some of the tests. Check to make sure it still exists before using it\r\n            _this.conn_ && _this.conn_.open(onMessageReceived, onConnectionLost);\r\n        }, Math.floor(0));\r\n        var healthyTimeout_ms = conn['healthyTimeout'] || 0;\r\n        if (healthyTimeout_ms > 0) {\r\n            this.healthyTimeout_ = setTimeoutNonBlocking(function () {\r\n                _this.healthyTimeout_ = null;\r\n                if (!_this.isHealthy_) {\r\n                    if (_this.conn_ &&\r\n                        _this.conn_.bytesReceived > BYTES_RECEIVED_HEALTHY_OVERRIDE) {\r\n                        _this.log_('Connection exceeded healthy timeout but has received ' +\r\n                            _this.conn_.bytesReceived +\r\n                            ' bytes.  Marking connection healthy.');\r\n                        _this.isHealthy_ = true;\r\n                        _this.conn_.markConnectionHealthy();\r\n                    }\r\n                    else if (_this.conn_ &&\r\n                        _this.conn_.bytesSent > BYTES_SENT_HEALTHY_OVERRIDE) {\r\n                        _this.log_('Connection exceeded healthy timeout but has sent ' +\r\n                            _this.conn_.bytesSent +\r\n                            ' bytes.  Leaving connection alive.');\r\n                        // NOTE: We don't want to mark it healthy, since we have no guarantee that the bytes have made it to\r\n                        // the server.\r\n                    }\r\n                    else {\r\n                        _this.log_('Closing unhealthy connection after timeout.');\r\n                        _this.close();\r\n                    }\r\n                }\r\n            }, Math.floor(healthyTimeout_ms));\r\n        }\r\n    };\r\n    /**\r\n     * @return {!string}\r\n     * @private\r\n     */\r\n    Connection.prototype.nextTransportId_ = function () {\r\n        return 'c:' + this.id + ':' + this.connectionCount++;\r\n    };\r\n    Connection.prototype.disconnReceiver_ = function (conn) {\r\n        var _this = this;\r\n        return function (everConnected) {\r\n            if (conn === _this.conn_) {\r\n                _this.onConnectionLost_(everConnected);\r\n            }\r\n            else if (conn === _this.secondaryConn_) {\r\n                _this.log_('Secondary connection lost.');\r\n                _this.onSecondaryConnectionLost_();\r\n            }\r\n            else {\r\n                _this.log_('closing an old connection');\r\n            }\r\n        };\r\n    };\r\n    Connection.prototype.connReceiver_ = function (conn) {\r\n        var _this = this;\r\n        return function (message) {\r\n            if (_this.state_ != 2 /* DISCONNECTED */) {\r\n                if (conn === _this.rx_) {\r\n                    _this.onPrimaryMessageReceived_(message);\r\n                }\r\n                else if (conn === _this.secondaryConn_) {\r\n                    _this.onSecondaryMessageReceived_(message);\r\n                }\r\n                else {\r\n                    _this.log_('message on old connection');\r\n                }\r\n            }\r\n        };\r\n    };\r\n    /**\r\n     *\r\n     * @param {Object} dataMsg An arbitrary data message to be sent to the server\r\n     */\r\n    Connection.prototype.sendRequest = function (dataMsg) {\r\n        // wrap in a data message envelope and send it on\r\n        var msg = { t: 'd', d: dataMsg };\r\n        this.sendData_(msg);\r\n    };\r\n    Connection.prototype.tryCleanupConnection = function () {\r\n        if (this.tx_ === this.secondaryConn_ && this.rx_ === this.secondaryConn_) {\r\n            this.log_('cleaning up and promoting a connection: ' + this.secondaryConn_.connId);\r\n            this.conn_ = this.secondaryConn_;\r\n            this.secondaryConn_ = null;\r\n            // the server will shutdown the old connection\r\n        }\r\n    };\r\n    Connection.prototype.onSecondaryControl_ = function (controlData) {\r\n        if (MESSAGE_TYPE in controlData) {\r\n            var cmd = controlData[MESSAGE_TYPE];\r\n            if (cmd === SWITCH_ACK) {\r\n                this.upgradeIfSecondaryHealthy_();\r\n            }\r\n            else if (cmd === CONTROL_RESET) {\r\n                // Most likely the session wasn't valid. Abandon the switch attempt\r\n                this.log_('Got a reset on secondary, closing it');\r\n                this.secondaryConn_.close();\r\n                // If we were already using this connection for something, than we need to fully close\r\n                if (this.tx_ === this.secondaryConn_ ||\r\n                    this.rx_ === this.secondaryConn_) {\r\n                    this.close();\r\n                }\r\n            }\r\n            else if (cmd === CONTROL_PONG) {\r\n                this.log_('got pong on secondary.');\r\n                this.secondaryResponsesRequired_--;\r\n                this.upgradeIfSecondaryHealthy_();\r\n            }\r\n        }\r\n    };\r\n    Connection.prototype.onSecondaryMessageReceived_ = function (parsedData) {\r\n        var layer = requireKey('t', parsedData);\r\n        var data = requireKey('d', parsedData);\r\n        if (layer == 'c') {\r\n            this.onSecondaryControl_(data);\r\n        }\r\n        else if (layer == 'd') {\r\n            // got a data message, but we're still second connection. Need to buffer it up\r\n            this.pendingDataMessages.push(data);\r\n        }\r\n        else {\r\n            throw new Error('Unknown protocol layer: ' + layer);\r\n        }\r\n    };\r\n    Connection.prototype.upgradeIfSecondaryHealthy_ = function () {\r\n        if (this.secondaryResponsesRequired_ <= 0) {\r\n            this.log_('Secondary connection is healthy.');\r\n            this.isHealthy_ = true;\r\n            this.secondaryConn_.markConnectionHealthy();\r\n            this.proceedWithUpgrade_();\r\n        }\r\n        else {\r\n            // Send a ping to make sure the connection is healthy.\r\n            this.log_('sending ping on secondary.');\r\n            this.secondaryConn_.send({ t: 'c', d: { t: PING, d: {} } });\r\n        }\r\n    };\r\n    Connection.prototype.proceedWithUpgrade_ = function () {\r\n        // tell this connection to consider itself open\r\n        this.secondaryConn_.start();\r\n        // send ack\r\n        this.log_('sending client ack on secondary');\r\n        this.secondaryConn_.send({ t: 'c', d: { t: SWITCH_ACK, d: {} } });\r\n        // send end packet on primary transport, switch to sending on this one\r\n        // can receive on this one, buffer responses until end received on primary transport\r\n        this.log_('Ending transmission on primary');\r\n        this.conn_.send({ t: 'c', d: { t: END_TRANSMISSION, d: {} } });\r\n        this.tx_ = this.secondaryConn_;\r\n        this.tryCleanupConnection();\r\n    };\r\n    Connection.prototype.onPrimaryMessageReceived_ = function (parsedData) {\r\n        // Must refer to parsedData properties in quotes, so closure doesn't touch them.\r\n        var layer = requireKey('t', parsedData);\r\n        var data = requireKey('d', parsedData);\r\n        if (layer == 'c') {\r\n            this.onControl_(data);\r\n        }\r\n        else if (layer == 'd') {\r\n            this.onDataMessage_(data);\r\n        }\r\n    };\r\n    Connection.prototype.onDataMessage_ = function (message) {\r\n        this.onPrimaryResponse_();\r\n        // We don't do anything with data messages, just kick them up a level\r\n        this.onMessage_(message);\r\n    };\r\n    Connection.prototype.onPrimaryResponse_ = function () {\r\n        if (!this.isHealthy_) {\r\n            this.primaryResponsesRequired_--;\r\n            if (this.primaryResponsesRequired_ <= 0) {\r\n                this.log_('Primary connection is healthy.');\r\n                this.isHealthy_ = true;\r\n                this.conn_.markConnectionHealthy();\r\n            }\r\n        }\r\n    };\r\n    Connection.prototype.onControl_ = function (controlData) {\r\n        var cmd = requireKey(MESSAGE_TYPE, controlData);\r\n        if (MESSAGE_DATA in controlData) {\r\n            var payload = controlData[MESSAGE_DATA];\r\n            if (cmd === SERVER_HELLO) {\r\n                this.onHandshake_(payload);\r\n            }\r\n            else if (cmd === END_TRANSMISSION) {\r\n                this.log_('recvd end transmission on primary');\r\n                this.rx_ = this.secondaryConn_;\r\n                for (var i = 0; i < this.pendingDataMessages.length; ++i) {\r\n                    this.onDataMessage_(this.pendingDataMessages[i]);\r\n                }\r\n                this.pendingDataMessages = [];\r\n                this.tryCleanupConnection();\r\n            }\r\n            else if (cmd === CONTROL_SHUTDOWN) {\r\n                // This was previously the 'onKill' callback passed to the lower-level connection\r\n                // payload in this case is the reason for the shutdown. Generally a human-readable error\r\n                this.onConnectionShutdown_(payload);\r\n            }\r\n            else if (cmd === CONTROL_RESET) {\r\n                // payload in this case is the host we should contact\r\n                this.onReset_(payload);\r\n            }\r\n            else if (cmd === CONTROL_ERROR) {\r\n                error('Server Error: ' + payload);\r\n            }\r\n            else if (cmd === CONTROL_PONG) {\r\n                this.log_('got pong on primary.');\r\n                this.onPrimaryResponse_();\r\n                this.sendPingOnPrimaryIfNecessary_();\r\n            }\r\n            else {\r\n                error('Unknown control packet command: ' + cmd);\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     *\r\n     * @param {Object} handshake The handshake data returned from the server\r\n     * @private\r\n     */\r\n    Connection.prototype.onHandshake_ = function (handshake) {\r\n        var timestamp = handshake.ts;\r\n        var version = handshake.v;\r\n        var host = handshake.h;\r\n        this.sessionId = handshake.s;\r\n        this.repoInfo_.updateHost(host);\r\n        // if we've already closed the connection, then don't bother trying to progress further\r\n        if (this.state_ == 0 /* CONNECTING */) {\r\n            this.conn_.start();\r\n            this.onConnectionEstablished_(this.conn_, timestamp);\r\n            if (PROTOCOL_VERSION !== version) {\r\n                warn('Protocol version mismatch detected');\r\n            }\r\n            // TODO: do we want to upgrade? when? maybe a delay?\r\n            this.tryStartUpgrade_();\r\n        }\r\n    };\r\n    Connection.prototype.tryStartUpgrade_ = function () {\r\n        var conn = this.transportManager_.upgradeTransport();\r\n        if (conn) {\r\n            this.startUpgrade_(conn);\r\n        }\r\n    };\r\n    Connection.prototype.startUpgrade_ = function (conn) {\r\n        var _this = this;\r\n        this.secondaryConn_ = new conn(this.nextTransportId_(), this.repoInfo_, this.sessionId);\r\n        // For certain transports (WebSockets), we need to send and receive several messages back and forth before we\r\n        // can consider the transport healthy.\r\n        this.secondaryResponsesRequired_ =\r\n            conn['responsesRequiredToBeHealthy'] || 0;\r\n        var onMessage = this.connReceiver_(this.secondaryConn_);\r\n        var onDisconnect = this.disconnReceiver_(this.secondaryConn_);\r\n        this.secondaryConn_.open(onMessage, onDisconnect);\r\n        // If we haven't successfully upgraded after UPGRADE_TIMEOUT, give up and kill the secondary.\r\n        setTimeoutNonBlocking(function () {\r\n            if (_this.secondaryConn_) {\r\n                _this.log_('Timed out trying to upgrade.');\r\n                _this.secondaryConn_.close();\r\n            }\r\n        }, Math.floor(UPGRADE_TIMEOUT));\r\n    };\r\n    Connection.prototype.onReset_ = function (host) {\r\n        this.log_('Reset packet received.  New host: ' + host);\r\n        this.repoInfo_.updateHost(host);\r\n        // TODO: if we're already \"connected\", we need to trigger a disconnect at the next layer up.\r\n        // We don't currently support resets after the connection has already been established\r\n        if (this.state_ === 1 /* CONNECTED */) {\r\n            this.close();\r\n        }\r\n        else {\r\n            // Close whatever connections we have open and start again.\r\n            this.closeConnections_();\r\n            this.start_();\r\n        }\r\n    };\r\n    Connection.prototype.onConnectionEstablished_ = function (conn, timestamp) {\r\n        var _this = this;\r\n        this.log_('Realtime connection established.');\r\n        this.conn_ = conn;\r\n        this.state_ = 1 /* CONNECTED */;\r\n        if (this.onReady_) {\r\n            this.onReady_(timestamp, this.sessionId);\r\n            this.onReady_ = null;\r\n        }\r\n        // If after 5 seconds we haven't sent enough requests to the server to get the connection healthy,\r\n        // send some pings.\r\n        if (this.primaryResponsesRequired_ === 0) {\r\n            this.log_('Primary connection is healthy.');\r\n            this.isHealthy_ = true;\r\n        }\r\n        else {\r\n            setTimeoutNonBlocking(function () {\r\n                _this.sendPingOnPrimaryIfNecessary_();\r\n            }, Math.floor(DELAY_BEFORE_SENDING_EXTRA_REQUESTS));\r\n        }\r\n    };\r\n    Connection.prototype.sendPingOnPrimaryIfNecessary_ = function () {\r\n        // If the connection isn't considered healthy yet, we'll send a noop ping packet request.\r\n        if (!this.isHealthy_ && this.state_ === 1 /* CONNECTED */) {\r\n            this.log_('sending ping on primary.');\r\n            this.sendData_({ t: 'c', d: { t: PING, d: {} } });\r\n        }\r\n    };\r\n    Connection.prototype.onSecondaryConnectionLost_ = function () {\r\n        var conn = this.secondaryConn_;\r\n        this.secondaryConn_ = null;\r\n        if (this.tx_ === conn || this.rx_ === conn) {\r\n            // we are relying on this connection already in some capacity. Therefore, a failure is real\r\n            this.close();\r\n        }\r\n    };\r\n    /**\r\n     *\r\n     * @param {boolean} everConnected Whether or not the connection ever reached a server. Used to determine if\r\n     * we should flush the host cache\r\n     * @private\r\n     */\r\n    Connection.prototype.onConnectionLost_ = function (everConnected) {\r\n        this.conn_ = null;\r\n        // NOTE: IF you're seeing a Firefox error for this line, I think it might be because it's getting\r\n        // called on window close and RealtimeState.CONNECTING is no longer defined.  Just a guess.\r\n        if (!everConnected && this.state_ === 0 /* CONNECTING */) {\r\n            this.log_('Realtime connection failed.');\r\n            // Since we failed to connect at all, clear any cached entry for this namespace in case the machine went away\r\n            if (this.repoInfo_.isCacheableHost()) {\r\n                PersistentStorage.remove('host:' + this.repoInfo_.host);\r\n                // reset the internal host to what we would show the user, i.e. <ns>.firebaseio.com\r\n                this.repoInfo_.internalHost = this.repoInfo_.host;\r\n            }\r\n        }\r\n        else if (this.state_ === 1 /* CONNECTED */) {\r\n            this.log_('Realtime connection lost.');\r\n        }\r\n        this.close();\r\n    };\r\n    /**\r\n     *\r\n     * @param {string} reason\r\n     * @private\r\n     */\r\n    Connection.prototype.onConnectionShutdown_ = function (reason) {\r\n        this.log_('Connection shutdown command received. Shutting down...');\r\n        if (this.onKill_) {\r\n            this.onKill_(reason);\r\n            this.onKill_ = null;\r\n        }\r\n        // We intentionally don't want to fire onDisconnect (kill is a different case),\r\n        // so clear the callback.\r\n        this.onDisconnect_ = null;\r\n        this.close();\r\n    };\r\n    Connection.prototype.sendData_ = function (data) {\r\n        if (this.state_ !== 1 /* CONNECTED */) {\r\n            throw 'Connection is not connected';\r\n        }\r\n        else {\r\n            this.tx_.send(data);\r\n        }\r\n    };\r\n    /**\r\n     * Cleans up this connection, calling the appropriate callbacks\r\n     */\r\n    Connection.prototype.close = function () {\r\n        if (this.state_ !== 2 /* DISCONNECTED */) {\r\n            this.log_('Closing realtime connection.');\r\n            this.state_ = 2 /* DISCONNECTED */;\r\n            this.closeConnections_();\r\n            if (this.onDisconnect_) {\r\n                this.onDisconnect_();\r\n                this.onDisconnect_ = null;\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     *\r\n     * @private\r\n     */\r\n    Connection.prototype.closeConnections_ = function () {\r\n        this.log_('Shutting down all connections');\r\n        if (this.conn_) {\r\n            this.conn_.close();\r\n            this.conn_ = null;\r\n        }\r\n        if (this.secondaryConn_) {\r\n            this.secondaryConn_.close();\r\n            this.secondaryConn_ = null;\r\n        }\r\n        if (this.healthyTimeout_) {\r\n            clearTimeout(this.healthyTimeout_);\r\n            this.healthyTimeout_ = null;\r\n        }\r\n    };\r\n    return Connection;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Interface defining the set of actions that can be performed against the Firebase server\r\n * (basically corresponds to our wire protocol).\r\n *\r\n * @interface\r\n */\r\nvar ServerActions = /** @class */ (function () {\r\n    function ServerActions() {\r\n    }\r\n    /**\r\n     * @param {string} pathString\r\n     * @param {*} data\r\n     * @param {function(string, string)=} onComplete\r\n     * @param {string=} hash\r\n     */\r\n    ServerActions.prototype.put = function (pathString, data, onComplete, hash) { };\r\n    /**\r\n     * @param {string} pathString\r\n     * @param {*} data\r\n     * @param {function(string, ?string)} onComplete\r\n     * @param {string=} hash\r\n     */\r\n    ServerActions.prototype.merge = function (pathString, data, onComplete, hash) { };\r\n    /**\r\n     * Refreshes the auth token for the current connection.\r\n     * @param {string} token The authentication token\r\n     */\r\n    ServerActions.prototype.refreshAuthToken = function (token) { };\r\n    /**\r\n     * @param {string} pathString\r\n     * @param {*} data\r\n     * @param {function(string, string)=} onComplete\r\n     */\r\n    ServerActions.prototype.onDisconnectPut = function (pathString, data, onComplete) { };\r\n    /**\r\n     * @param {string} pathString\r\n     * @param {*} data\r\n     * @param {function(string, string)=} onComplete\r\n     */\r\n    ServerActions.prototype.onDisconnectMerge = function (pathString, data, onComplete) { };\r\n    /**\r\n     * @param {string} pathString\r\n     * @param {function(string, string)=} onComplete\r\n     */\r\n    ServerActions.prototype.onDisconnectCancel = function (pathString, onComplete) { };\r\n    /**\r\n     * @param {Object.<string, *>} stats\r\n     */\r\n    ServerActions.prototype.reportStats = function (stats) { };\r\n    return ServerActions;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar RECONNECT_MIN_DELAY = 1000;\r\nvar RECONNECT_MAX_DELAY_DEFAULT = 60 * 5 * 1000; // 5 minutes in milliseconds (Case: 1858)\r\nvar RECONNECT_MAX_DELAY_FOR_ADMINS = 30 * 1000; // 30 seconds for admin clients (likely to be a backend server)\r\nvar RECONNECT_DELAY_MULTIPLIER = 1.3;\r\nvar RECONNECT_DELAY_RESET_TIMEOUT = 30000; // Reset delay back to MIN_DELAY after being connected for 30sec.\r\nvar SERVER_KILL_INTERRUPT_REASON = 'server_kill';\r\n// If auth fails repeatedly, we'll assume something is wrong and log a warning / back off.\r\nvar INVALID_AUTH_TOKEN_THRESHOLD = 3;\r\n/**\r\n * Firebase connection.  Abstracts wire protocol and handles reconnecting.\r\n *\r\n * NOTE: All JSON objects sent to the realtime connection must have property names enclosed\r\n * in quotes to make sure the closure compiler does not minify them.\r\n */\r\nvar PersistentConnection = /** @class */ (function (_super) {\r\n    __extends(PersistentConnection, _super);\r\n    /**\r\n     * @implements {ServerActions}\r\n     * @param {!RepoInfo} repoInfo_ Data about the namespace we are connecting to\r\n     * @param {function(string, *, boolean, ?number)} onDataUpdate_ A callback for new data from the server\r\n     * @param onConnectStatus_\r\n     * @param onServerInfoUpdate_\r\n     * @param authTokenProvider_\r\n     * @param authOverride_\r\n     */\r\n    function PersistentConnection(repoInfo_, onDataUpdate_, onConnectStatus_, onServerInfoUpdate_, authTokenProvider_, authOverride_) {\r\n        var _this = _super.call(this) || this;\r\n        _this.repoInfo_ = repoInfo_;\r\n        _this.onDataUpdate_ = onDataUpdate_;\r\n        _this.onConnectStatus_ = onConnectStatus_;\r\n        _this.onServerInfoUpdate_ = onServerInfoUpdate_;\r\n        _this.authTokenProvider_ = authTokenProvider_;\r\n        _this.authOverride_ = authOverride_;\r\n        // Used for diagnostic logging.\r\n        _this.id = PersistentConnection.nextPersistentConnectionId_++;\r\n        _this.log_ = logWrapper('p:' + _this.id + ':');\r\n        /** @private {Object} */\r\n        _this.interruptReasons_ = {};\r\n        _this.listens_ = {};\r\n        _this.outstandingPuts_ = [];\r\n        _this.outstandingPutCount_ = 0;\r\n        _this.onDisconnectRequestQueue_ = [];\r\n        _this.connected_ = false;\r\n        _this.reconnectDelay_ = RECONNECT_MIN_DELAY;\r\n        _this.maxReconnectDelay_ = RECONNECT_MAX_DELAY_DEFAULT;\r\n        _this.securityDebugCallback_ = null;\r\n        _this.lastSessionId = null;\r\n        /** @private {number|null} */\r\n        _this.establishConnectionTimer_ = null;\r\n        /** @private {boolean} */\r\n        _this.visible_ = false;\r\n        // Before we get connected, we keep a queue of pending messages to send.\r\n        _this.requestCBHash_ = {};\r\n        _this.requestNumber_ = 0;\r\n        /** @private {?{\r\n         *   sendRequest(Object),\r\n         *   close()\r\n         * }} */\r\n        _this.realtime_ = null;\r\n        /** @private {string|null} */\r\n        _this.authToken_ = null;\r\n        _this.forceTokenRefresh_ = false;\r\n        _this.invalidAuthTokenCount_ = 0;\r\n        _this.firstConnection_ = true;\r\n        _this.lastConnectionAttemptTime_ = null;\r\n        _this.lastConnectionEstablishedTime_ = null;\r\n        if (authOverride_ && !isNodeSdk()) {\r\n            throw new Error('Auth override specified in options, but not supported on non Node.js platforms');\r\n        }\r\n        _this.scheduleConnect_(0);\r\n        VisibilityMonitor.getInstance().on('visible', _this.onVisible_, _this);\r\n        if (repoInfo_.host.indexOf('fblocal') === -1) {\r\n            OnlineMonitor.getInstance().on('online', _this.onOnline_, _this);\r\n        }\r\n        return _this;\r\n    }\r\n    /**\r\n     * @param {!string} action\r\n     * @param {*} body\r\n     * @param {function(*)=} onResponse\r\n     * @protected\r\n     */\r\n    PersistentConnection.prototype.sendRequest = function (action, body, onResponse) {\r\n        var curReqNum = ++this.requestNumber_;\r\n        var msg = { r: curReqNum, a: action, b: body };\r\n        this.log_(stringify(msg));\r\n        assert(this.connected_, \"sendRequest call when we're not connected not allowed.\");\r\n        this.realtime_.sendRequest(msg);\r\n        if (onResponse) {\r\n            this.requestCBHash_[curReqNum] = onResponse;\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PersistentConnection.prototype.listen = function (query, currentHashFn, tag, onComplete) {\r\n        var queryId = query.queryIdentifier();\r\n        var pathString = query.path.toString();\r\n        this.log_('Listen called for ' + pathString + ' ' + queryId);\r\n        this.listens_[pathString] = this.listens_[pathString] || {};\r\n        assert(query.getQueryParams().isDefault() ||\r\n            !query.getQueryParams().loadsAllData(), 'listen() called for non-default but complete query');\r\n        assert(!this.listens_[pathString][queryId], 'listen() called twice for same path/queryId.');\r\n        var listenSpec = {\r\n            onComplete: onComplete,\r\n            hashFn: currentHashFn,\r\n            query: query,\r\n            tag: tag\r\n        };\r\n        this.listens_[pathString][queryId] = listenSpec;\r\n        if (this.connected_) {\r\n            this.sendListen_(listenSpec);\r\n        }\r\n    };\r\n    /**\r\n     * @param {!{onComplete(),\r\n     *           hashFn():!string,\r\n     *           query: !Query,\r\n     *           tag: ?number}} listenSpec\r\n     * @private\r\n     */\r\n    PersistentConnection.prototype.sendListen_ = function (listenSpec) {\r\n        var _this = this;\r\n        var query = listenSpec.query;\r\n        var pathString = query.path.toString();\r\n        var queryId = query.queryIdentifier();\r\n        this.log_('Listen on ' + pathString + ' for ' + queryId);\r\n        var req = { /*path*/ p: pathString };\r\n        var action = 'q';\r\n        // Only bother to send query if it's non-default.\r\n        if (listenSpec.tag) {\r\n            req['q'] = query.queryObject();\r\n            req['t'] = listenSpec.tag;\r\n        }\r\n        req[ /*hash*/'h'] = listenSpec.hashFn();\r\n        this.sendRequest(action, req, function (message) {\r\n            var payload = message[ /*data*/'d'];\r\n            var status = message[ /*status*/'s'];\r\n            // print warnings in any case...\r\n            PersistentConnection.warnOnListenWarnings_(payload, query);\r\n            var currentListenSpec = _this.listens_[pathString] && _this.listens_[pathString][queryId];\r\n            // only trigger actions if the listen hasn't been removed and readded\r\n            if (currentListenSpec === listenSpec) {\r\n                _this.log_('listen response', message);\r\n                if (status !== 'ok') {\r\n                    _this.removeListen_(pathString, queryId);\r\n                }\r\n                if (listenSpec.onComplete) {\r\n                    listenSpec.onComplete(status, payload);\r\n                }\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * @param {*} payload\r\n     * @param {!Query} query\r\n     * @private\r\n     */\r\n    PersistentConnection.warnOnListenWarnings_ = function (payload, query) {\r\n        if (payload && typeof payload === 'object' && contains(payload, 'w')) {\r\n            var warnings = safeGet(payload, 'w');\r\n            if (Array.isArray(warnings) && ~warnings.indexOf('no_index')) {\r\n                var indexSpec = '\".indexOn\": \"' +\r\n                    query\r\n                        .getQueryParams()\r\n                        .getIndex()\r\n                        .toString() +\r\n                    '\"';\r\n                var indexPath = query.path.toString();\r\n                warn(\"Using an unspecified index. Your data will be downloaded and \" +\r\n                    (\"filtered on the client. Consider adding \" + indexSpec + \" at \") +\r\n                    (indexPath + \" to your security rules for better performance.\"));\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PersistentConnection.prototype.refreshAuthToken = function (token) {\r\n        this.authToken_ = token;\r\n        this.log_('Auth token refreshed');\r\n        if (this.authToken_) {\r\n            this.tryAuth();\r\n        }\r\n        else {\r\n            //If we're connected we want to let the server know to unauthenticate us. If we're not connected, simply delete\r\n            //the credential so we dont become authenticated next time we connect.\r\n            if (this.connected_) {\r\n                this.sendRequest('unauth', {}, function () { });\r\n            }\r\n        }\r\n        this.reduceReconnectDelayIfAdminCredential_(token);\r\n    };\r\n    /**\r\n     * @param {!string} credential\r\n     * @private\r\n     */\r\n    PersistentConnection.prototype.reduceReconnectDelayIfAdminCredential_ = function (credential) {\r\n        // NOTE: This isn't intended to be bulletproof (a malicious developer can always just modify the client).\r\n        // Additionally, we don't bother resetting the max delay back to the default if auth fails / expires.\r\n        var isFirebaseSecret = credential && credential.length === 40;\r\n        if (isFirebaseSecret || isAdmin(credential)) {\r\n            this.log_('Admin auth credential detected.  Reducing max reconnect time.');\r\n            this.maxReconnectDelay_ = RECONNECT_MAX_DELAY_FOR_ADMINS;\r\n        }\r\n    };\r\n    /**\r\n     * Attempts to authenticate with the given credentials. If the authentication attempt fails, it's triggered like\r\n     * a auth revoked (the connection is closed).\r\n     */\r\n    PersistentConnection.prototype.tryAuth = function () {\r\n        var _this = this;\r\n        if (this.connected_ && this.authToken_) {\r\n            var token_1 = this.authToken_;\r\n            var authMethod = isValidFormat(token_1) ? 'auth' : 'gauth';\r\n            var requestData = { cred: token_1 };\r\n            if (this.authOverride_ === null) {\r\n                requestData['noauth'] = true;\r\n            }\r\n            else if (typeof this.authOverride_ === 'object') {\r\n                requestData['authvar'] = this.authOverride_;\r\n            }\r\n            this.sendRequest(authMethod, requestData, function (res) {\r\n                var status = res[ /*status*/'s'];\r\n                var data = res[ /*data*/'d'] || 'error';\r\n                if (_this.authToken_ === token_1) {\r\n                    if (status === 'ok') {\r\n                        _this.invalidAuthTokenCount_ = 0;\r\n                    }\r\n                    else {\r\n                        // Triggers reconnect and force refresh for auth token\r\n                        _this.onAuthRevoked_(status, data);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PersistentConnection.prototype.unlisten = function (query, tag) {\r\n        var pathString = query.path.toString();\r\n        var queryId = query.queryIdentifier();\r\n        this.log_('Unlisten called for ' + pathString + ' ' + queryId);\r\n        assert(query.getQueryParams().isDefault() ||\r\n            !query.getQueryParams().loadsAllData(), 'unlisten() called for non-default but complete query');\r\n        var listen = this.removeListen_(pathString, queryId);\r\n        if (listen && this.connected_) {\r\n            this.sendUnlisten_(pathString, queryId, query.queryObject(), tag);\r\n        }\r\n    };\r\n    PersistentConnection.prototype.sendUnlisten_ = function (pathString, queryId, queryObj, tag) {\r\n        this.log_('Unlisten on ' + pathString + ' for ' + queryId);\r\n        var req = { /*path*/ p: pathString };\r\n        var action = 'n';\r\n        // Only bother sending queryId if it's non-default.\r\n        if (tag) {\r\n            req['q'] = queryObj;\r\n            req['t'] = tag;\r\n        }\r\n        this.sendRequest(action, req);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PersistentConnection.prototype.onDisconnectPut = function (pathString, data, onComplete) {\r\n        if (this.connected_) {\r\n            this.sendOnDisconnect_('o', pathString, data, onComplete);\r\n        }\r\n        else {\r\n            this.onDisconnectRequestQueue_.push({\r\n                pathString: pathString,\r\n                action: 'o',\r\n                data: data,\r\n                onComplete: onComplete\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PersistentConnection.prototype.onDisconnectMerge = function (pathString, data, onComplete) {\r\n        if (this.connected_) {\r\n            this.sendOnDisconnect_('om', pathString, data, onComplete);\r\n        }\r\n        else {\r\n            this.onDisconnectRequestQueue_.push({\r\n                pathString: pathString,\r\n                action: 'om',\r\n                data: data,\r\n                onComplete: onComplete\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PersistentConnection.prototype.onDisconnectCancel = function (pathString, onComplete) {\r\n        if (this.connected_) {\r\n            this.sendOnDisconnect_('oc', pathString, null, onComplete);\r\n        }\r\n        else {\r\n            this.onDisconnectRequestQueue_.push({\r\n                pathString: pathString,\r\n                action: 'oc',\r\n                data: null,\r\n                onComplete: onComplete\r\n            });\r\n        }\r\n    };\r\n    PersistentConnection.prototype.sendOnDisconnect_ = function (action, pathString, data, onComplete) {\r\n        var request = { /*path*/ p: pathString, /*data*/ d: data };\r\n        this.log_('onDisconnect ' + action, request);\r\n        this.sendRequest(action, request, function (response) {\r\n            if (onComplete) {\r\n                setTimeout(function () {\r\n                    onComplete(response[ /*status*/'s'], response[ /* data */'d']);\r\n                }, Math.floor(0));\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PersistentConnection.prototype.put = function (pathString, data, onComplete, hash) {\r\n        this.putInternal('p', pathString, data, onComplete, hash);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PersistentConnection.prototype.merge = function (pathString, data, onComplete, hash) {\r\n        this.putInternal('m', pathString, data, onComplete, hash);\r\n    };\r\n    PersistentConnection.prototype.putInternal = function (action, pathString, data, onComplete, hash) {\r\n        var request = {\r\n            /*path*/ p: pathString,\r\n            /*data*/ d: data\r\n        };\r\n        if (hash !== undefined)\r\n            request[ /*hash*/'h'] = hash;\r\n        // TODO: Only keep track of the most recent put for a given path?\r\n        this.outstandingPuts_.push({\r\n            action: action,\r\n            request: request,\r\n            onComplete: onComplete\r\n        });\r\n        this.outstandingPutCount_++;\r\n        var index = this.outstandingPuts_.length - 1;\r\n        if (this.connected_) {\r\n            this.sendPut_(index);\r\n        }\r\n        else {\r\n            this.log_('Buffering put: ' + pathString);\r\n        }\r\n    };\r\n    PersistentConnection.prototype.sendPut_ = function (index) {\r\n        var _this = this;\r\n        var action = this.outstandingPuts_[index].action;\r\n        var request = this.outstandingPuts_[index].request;\r\n        var onComplete = this.outstandingPuts_[index].onComplete;\r\n        this.outstandingPuts_[index].queued = this.connected_;\r\n        this.sendRequest(action, request, function (message) {\r\n            _this.log_(action + ' response', message);\r\n            delete _this.outstandingPuts_[index];\r\n            _this.outstandingPutCount_--;\r\n            // Clean up array occasionally.\r\n            if (_this.outstandingPutCount_ === 0) {\r\n                _this.outstandingPuts_ = [];\r\n            }\r\n            if (onComplete)\r\n                onComplete(message[ /*status*/'s'], message[ /* data */'d']);\r\n        });\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    PersistentConnection.prototype.reportStats = function (stats) {\r\n        var _this = this;\r\n        // If we're not connected, we just drop the stats.\r\n        if (this.connected_) {\r\n            var request = { /*counters*/ c: stats };\r\n            this.log_('reportStats', request);\r\n            this.sendRequest(/*stats*/ 's', request, function (result) {\r\n                var status = result[ /*status*/'s'];\r\n                if (status !== 'ok') {\r\n                    var errorReason = result[ /* data */'d'];\r\n                    _this.log_('reportStats', 'Error sending stats: ' + errorReason);\r\n                }\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * @param {*} message\r\n     * @private\r\n     */\r\n    PersistentConnection.prototype.onDataMessage_ = function (message) {\r\n        if ('r' in message) {\r\n            // this is a response\r\n            this.log_('from server: ' + stringify(message));\r\n            var reqNum = message['r'];\r\n            var onResponse = this.requestCBHash_[reqNum];\r\n            if (onResponse) {\r\n                delete this.requestCBHash_[reqNum];\r\n                onResponse(message[ /*body*/'b']);\r\n            }\r\n        }\r\n        else if ('error' in message) {\r\n            throw 'A server-side error has occurred: ' + message['error'];\r\n        }\r\n        else if ('a' in message) {\r\n            // a and b are action and body, respectively\r\n            this.onDataPush_(message['a'], message['b']);\r\n        }\r\n    };\r\n    PersistentConnection.prototype.onDataPush_ = function (action, body) {\r\n        this.log_('handleServerMessage', action, body);\r\n        if (action === 'd')\r\n            this.onDataUpdate_(body[ /*path*/'p'], body[ /*data*/'d'], \r\n            /*isMerge*/ false, body['t']);\r\n        else if (action === 'm')\r\n            this.onDataUpdate_(body[ /*path*/'p'], body[ /*data*/'d'], \r\n            /*isMerge=*/ true, body['t']);\r\n        else if (action === 'c')\r\n            this.onListenRevoked_(body[ /*path*/'p'], body[ /*query*/'q']);\r\n        else if (action === 'ac')\r\n            this.onAuthRevoked_(body[ /*status code*/'s'], body[ /* explanation */'d']);\r\n        else if (action === 'sd')\r\n            this.onSecurityDebugPacket_(body);\r\n        else\r\n            error('Unrecognized action received from server: ' +\r\n                stringify(action) +\r\n                '\\nAre you using the latest client?');\r\n    };\r\n    PersistentConnection.prototype.onReady_ = function (timestamp, sessionId) {\r\n        this.log_('connection ready');\r\n        this.connected_ = true;\r\n        this.lastConnectionEstablishedTime_ = new Date().getTime();\r\n        this.handleTimestamp_(timestamp);\r\n        this.lastSessionId = sessionId;\r\n        if (this.firstConnection_) {\r\n            this.sendConnectStats_();\r\n        }\r\n        this.restoreState_();\r\n        this.firstConnection_ = false;\r\n        this.onConnectStatus_(true);\r\n    };\r\n    PersistentConnection.prototype.scheduleConnect_ = function (timeout) {\r\n        var _this = this;\r\n        assert(!this.realtime_, \"Scheduling a connect when we're already connected/ing?\");\r\n        if (this.establishConnectionTimer_) {\r\n            clearTimeout(this.establishConnectionTimer_);\r\n        }\r\n        // NOTE: Even when timeout is 0, it's important to do a setTimeout to work around an infuriating \"Security Error\" in\r\n        // Firefox when trying to write to our long-polling iframe in some scenarios (e.g. Forge or our unit tests).\r\n        this.establishConnectionTimer_ = setTimeout(function () {\r\n            _this.establishConnectionTimer_ = null;\r\n            _this.establishConnection_();\r\n        }, Math.floor(timeout));\r\n    };\r\n    /**\r\n     * @param {boolean} visible\r\n     * @private\r\n     */\r\n    PersistentConnection.prototype.onVisible_ = function (visible) {\r\n        // NOTE: Tabbing away and back to a window will defeat our reconnect backoff, but I think that's fine.\r\n        if (visible &&\r\n            !this.visible_ &&\r\n            this.reconnectDelay_ === this.maxReconnectDelay_) {\r\n            this.log_('Window became visible.  Reducing delay.');\r\n            this.reconnectDelay_ = RECONNECT_MIN_DELAY;\r\n            if (!this.realtime_) {\r\n                this.scheduleConnect_(0);\r\n            }\r\n        }\r\n        this.visible_ = visible;\r\n    };\r\n    PersistentConnection.prototype.onOnline_ = function (online) {\r\n        if (online) {\r\n            this.log_('Browser went online.');\r\n            this.reconnectDelay_ = RECONNECT_MIN_DELAY;\r\n            if (!this.realtime_) {\r\n                this.scheduleConnect_(0);\r\n            }\r\n        }\r\n        else {\r\n            this.log_('Browser went offline.  Killing connection.');\r\n            if (this.realtime_) {\r\n                this.realtime_.close();\r\n            }\r\n        }\r\n    };\r\n    PersistentConnection.prototype.onRealtimeDisconnect_ = function () {\r\n        this.log_('data client disconnected');\r\n        this.connected_ = false;\r\n        this.realtime_ = null;\r\n        // Since we don't know if our sent transactions succeeded or not, we need to cancel them.\r\n        this.cancelSentTransactions_();\r\n        // Clear out the pending requests.\r\n        this.requestCBHash_ = {};\r\n        if (this.shouldReconnect_()) {\r\n            if (!this.visible_) {\r\n                this.log_(\"Window isn't visible.  Delaying reconnect.\");\r\n                this.reconnectDelay_ = this.maxReconnectDelay_;\r\n                this.lastConnectionAttemptTime_ = new Date().getTime();\r\n            }\r\n            else if (this.lastConnectionEstablishedTime_) {\r\n                // If we've been connected long enough, reset reconnect delay to minimum.\r\n                var timeSinceLastConnectSucceeded = new Date().getTime() - this.lastConnectionEstablishedTime_;\r\n                if (timeSinceLastConnectSucceeded > RECONNECT_DELAY_RESET_TIMEOUT)\r\n                    this.reconnectDelay_ = RECONNECT_MIN_DELAY;\r\n                this.lastConnectionEstablishedTime_ = null;\r\n            }\r\n            var timeSinceLastConnectAttempt = new Date().getTime() - this.lastConnectionAttemptTime_;\r\n            var reconnectDelay = Math.max(0, this.reconnectDelay_ - timeSinceLastConnectAttempt);\r\n            reconnectDelay = Math.random() * reconnectDelay;\r\n            this.log_('Trying to reconnect in ' + reconnectDelay + 'ms');\r\n            this.scheduleConnect_(reconnectDelay);\r\n            // Adjust reconnect delay for next time.\r\n            this.reconnectDelay_ = Math.min(this.maxReconnectDelay_, this.reconnectDelay_ * RECONNECT_DELAY_MULTIPLIER);\r\n        }\r\n        this.onConnectStatus_(false);\r\n    };\r\n    PersistentConnection.prototype.establishConnection_ = function () {\r\n        if (this.shouldReconnect_()) {\r\n            this.log_('Making a connection attempt');\r\n            this.lastConnectionAttemptTime_ = new Date().getTime();\r\n            this.lastConnectionEstablishedTime_ = null;\r\n            var onDataMessage_1 = this.onDataMessage_.bind(this);\r\n            var onReady_1 = this.onReady_.bind(this);\r\n            var onDisconnect_1 = this.onRealtimeDisconnect_.bind(this);\r\n            var connId_1 = this.id + ':' + PersistentConnection.nextConnectionId_++;\r\n            var self_1 = this;\r\n            var lastSessionId_1 = this.lastSessionId;\r\n            var canceled_1 = false;\r\n            var connection_1 = null;\r\n            var closeFn_1 = function () {\r\n                if (connection_1) {\r\n                    connection_1.close();\r\n                }\r\n                else {\r\n                    canceled_1 = true;\r\n                    onDisconnect_1();\r\n                }\r\n            };\r\n            var sendRequestFn = function (msg) {\r\n                assert(connection_1, \"sendRequest call when we're not connected not allowed.\");\r\n                connection_1.sendRequest(msg);\r\n            };\r\n            this.realtime_ = {\r\n                close: closeFn_1,\r\n                sendRequest: sendRequestFn\r\n            };\r\n            var forceRefresh = this.forceTokenRefresh_;\r\n            this.forceTokenRefresh_ = false;\r\n            // First fetch auth token, and establish connection after fetching the token was successful\r\n            this.authTokenProvider_\r\n                .getToken(forceRefresh)\r\n                .then(function (result) {\r\n                if (!canceled_1) {\r\n                    log('getToken() completed. Creating connection.');\r\n                    self_1.authToken_ = result && result.accessToken;\r\n                    connection_1 = new Connection(connId_1, self_1.repoInfo_, onDataMessage_1, onReady_1, onDisconnect_1, \r\n                    /* onKill= */ function (reason) {\r\n                        warn(reason + ' (' + self_1.repoInfo_.toString() + ')');\r\n                        self_1.interrupt(SERVER_KILL_INTERRUPT_REASON);\r\n                    }, lastSessionId_1);\r\n                }\r\n                else {\r\n                    log('getToken() completed but was canceled');\r\n                }\r\n            })\r\n                .then(null, function (error$$1) {\r\n                self_1.log_('Failed to get token: ' + error$$1);\r\n                if (!canceled_1) {\r\n                    if (CONSTANTS.NODE_ADMIN) {\r\n                        // This may be a critical error for the Admin Node.js SDK, so log a warning.\r\n                        // But getToken() may also just have temporarily failed, so we still want to\r\n                        // continue retrying.\r\n                        warn(error$$1);\r\n                    }\r\n                    closeFn_1();\r\n                }\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * @param {string} reason\r\n     */\r\n    PersistentConnection.prototype.interrupt = function (reason) {\r\n        log('Interrupting connection for reason: ' + reason);\r\n        this.interruptReasons_[reason] = true;\r\n        if (this.realtime_) {\r\n            this.realtime_.close();\r\n        }\r\n        else {\r\n            if (this.establishConnectionTimer_) {\r\n                clearTimeout(this.establishConnectionTimer_);\r\n                this.establishConnectionTimer_ = null;\r\n            }\r\n            if (this.connected_) {\r\n                this.onRealtimeDisconnect_();\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * @param {string} reason\r\n     */\r\n    PersistentConnection.prototype.resume = function (reason) {\r\n        log('Resuming connection for reason: ' + reason);\r\n        delete this.interruptReasons_[reason];\r\n        if (isEmpty(this.interruptReasons_)) {\r\n            this.reconnectDelay_ = RECONNECT_MIN_DELAY;\r\n            if (!this.realtime_) {\r\n                this.scheduleConnect_(0);\r\n            }\r\n        }\r\n    };\r\n    PersistentConnection.prototype.handleTimestamp_ = function (timestamp) {\r\n        var delta = timestamp - new Date().getTime();\r\n        this.onServerInfoUpdate_({ serverTimeOffset: delta });\r\n    };\r\n    PersistentConnection.prototype.cancelSentTransactions_ = function () {\r\n        for (var i = 0; i < this.outstandingPuts_.length; i++) {\r\n            var put = this.outstandingPuts_[i];\r\n            if (put && /*hash*/ 'h' in put.request && put.queued) {\r\n                if (put.onComplete)\r\n                    put.onComplete('disconnect');\r\n                delete this.outstandingPuts_[i];\r\n                this.outstandingPutCount_--;\r\n            }\r\n        }\r\n        // Clean up array occasionally.\r\n        if (this.outstandingPutCount_ === 0)\r\n            this.outstandingPuts_ = [];\r\n    };\r\n    /**\r\n     * @param {!string} pathString\r\n     * @param {Array.<*>=} query\r\n     * @private\r\n     */\r\n    PersistentConnection.prototype.onListenRevoked_ = function (pathString, query) {\r\n        // Remove the listen and manufacture a \"permission_denied\" error for the failed listen.\r\n        var queryId;\r\n        if (!query) {\r\n            queryId = 'default';\r\n        }\r\n        else {\r\n            queryId = query.map(function (q) { return ObjectToUniqueKey(q); }).join('$');\r\n        }\r\n        var listen = this.removeListen_(pathString, queryId);\r\n        if (listen && listen.onComplete)\r\n            listen.onComplete('permission_denied');\r\n    };\r\n    /**\r\n     * @param {!string} pathString\r\n     * @param {!string} queryId\r\n     * @return {{queries:Array.<Query>, onComplete:function(string)}}\r\n     * @private\r\n     */\r\n    PersistentConnection.prototype.removeListen_ = function (pathString, queryId) {\r\n        var normalizedPathString = new Path(pathString).toString(); // normalize path.\r\n        var listen;\r\n        if (this.listens_[normalizedPathString] !== undefined) {\r\n            listen = this.listens_[normalizedPathString][queryId];\r\n            delete this.listens_[normalizedPathString][queryId];\r\n            if (getCount(this.listens_[normalizedPathString]) === 0) {\r\n                delete this.listens_[normalizedPathString];\r\n            }\r\n        }\r\n        else {\r\n            // all listens for this path has already been removed\r\n            listen = undefined;\r\n        }\r\n        return listen;\r\n    };\r\n    PersistentConnection.prototype.onAuthRevoked_ = function (statusCode, explanation) {\r\n        log('Auth token revoked: ' + statusCode + '/' + explanation);\r\n        this.authToken_ = null;\r\n        this.forceTokenRefresh_ = true;\r\n        this.realtime_.close();\r\n        if (statusCode === 'invalid_token' || statusCode === 'permission_denied') {\r\n            // We'll wait a couple times before logging the warning / increasing the\r\n            // retry period since oauth tokens will report as \"invalid\" if they're\r\n            // just expired. Plus there may be transient issues that resolve themselves.\r\n            this.invalidAuthTokenCount_++;\r\n            if (this.invalidAuthTokenCount_ >= INVALID_AUTH_TOKEN_THRESHOLD) {\r\n                // Set a long reconnect delay because recovery is unlikely\r\n                this.reconnectDelay_ = RECONNECT_MAX_DELAY_FOR_ADMINS;\r\n                // Notify the auth token provider that the token is invalid, which will log\r\n                // a warning\r\n                this.authTokenProvider_.notifyForInvalidToken();\r\n            }\r\n        }\r\n    };\r\n    PersistentConnection.prototype.onSecurityDebugPacket_ = function (body) {\r\n        if (this.securityDebugCallback_) {\r\n            this.securityDebugCallback_(body);\r\n        }\r\n        else {\r\n            if ('msg' in body) {\r\n                console.log('FIREBASE: ' + body['msg'].replace('\\n', '\\nFIREBASE: '));\r\n            }\r\n        }\r\n    };\r\n    PersistentConnection.prototype.restoreState_ = function () {\r\n        var _this = this;\r\n        //Re-authenticate ourselves if we have a credential stored.\r\n        this.tryAuth();\r\n        // Puts depend on having received the corresponding data update from the server before they complete, so we must\r\n        // make sure to send listens before puts.\r\n        forEach(this.listens_, function (pathString, queries) {\r\n            forEach(queries, function (key, listenSpec) {\r\n                _this.sendListen_(listenSpec);\r\n            });\r\n        });\r\n        for (var i = 0; i < this.outstandingPuts_.length; i++) {\r\n            if (this.outstandingPuts_[i])\r\n                this.sendPut_(i);\r\n        }\r\n        while (this.onDisconnectRequestQueue_.length) {\r\n            var request = this.onDisconnectRequestQueue_.shift();\r\n            this.sendOnDisconnect_(request.action, request.pathString, request.data, request.onComplete);\r\n        }\r\n    };\r\n    /**\r\n     * Sends client stats for first connection\r\n     * @private\r\n     */\r\n    PersistentConnection.prototype.sendConnectStats_ = function () {\r\n        var stats = {};\r\n        var clientName = 'js';\r\n        if (CONSTANTS.NODE_ADMIN) {\r\n            clientName = 'admin_node';\r\n        }\r\n        else if (CONSTANTS.NODE_CLIENT) {\r\n            clientName = 'node';\r\n        }\r\n        stats['sdk.' + clientName + '.' + firebase.SDK_VERSION.replace(/\\./g, '-')] = 1;\r\n        if (isMobileCordova()) {\r\n            stats['framework.cordova'] = 1;\r\n        }\r\n        else if (isReactNative()) {\r\n            stats['framework.reactnative'] = 1;\r\n        }\r\n        this.reportStats(stats);\r\n    };\r\n    /**\r\n     * @return {boolean}\r\n     * @private\r\n     */\r\n    PersistentConnection.prototype.shouldReconnect_ = function () {\r\n        var online = OnlineMonitor.getInstance().currentlyOnline();\r\n        return isEmpty(this.interruptReasons_) && online;\r\n    };\r\n    /**\r\n     * @private\r\n     */\r\n    PersistentConnection.nextPersistentConnectionId_ = 0;\r\n    /**\r\n     * Counter for number of connections created. Mainly used for tagging in the logs\r\n     * @type {number}\r\n     * @private\r\n     */\r\n    PersistentConnection.nextConnectionId_ = 0;\r\n    return PersistentConnection;\r\n}(ServerActions));\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * An implementation of ServerActions that communicates with the server via REST requests.\r\n * This is mostly useful for compatibility with crawlers, where we don't want to spin up a full\r\n * persistent connection (using WebSockets or long-polling)\r\n */\r\nvar ReadonlyRestClient = /** @class */ (function (_super) {\r\n    __extends(ReadonlyRestClient, _super);\r\n    /**\r\n     * @param {!RepoInfo} repoInfo_ Data about the namespace we are connecting to\r\n     * @param {function(string, *, boolean, ?number)} onDataUpdate_ A callback for new data from the server\r\n     * @param {AuthTokenProvider} authTokenProvider_\r\n     * @implements {ServerActions}\r\n     */\r\n    function ReadonlyRestClient(repoInfo_, onDataUpdate_, authTokenProvider_) {\r\n        var _this = _super.call(this) || this;\r\n        _this.repoInfo_ = repoInfo_;\r\n        _this.onDataUpdate_ = onDataUpdate_;\r\n        _this.authTokenProvider_ = authTokenProvider_;\r\n        /** @private {function(...[*])} */\r\n        _this.log_ = logWrapper('p:rest:');\r\n        /**\r\n         * We don't actually need to track listens, except to prevent us calling an onComplete for a listen\r\n         * that's been removed. :-/\r\n         *\r\n         * @private {!Object.<string, !Object>}\r\n         */\r\n        _this.listens_ = {};\r\n        return _this;\r\n    }\r\n    ReadonlyRestClient.prototype.reportStats = function (stats) {\r\n        throw new Error('Method not implemented.');\r\n    };\r\n    /**\r\n     * @param {!Query} query\r\n     * @param {?number=} tag\r\n     * @return {string}\r\n     * @private\r\n     */\r\n    ReadonlyRestClient.getListenId_ = function (query, tag) {\r\n        if (tag !== undefined) {\r\n            return 'tag$' + tag;\r\n        }\r\n        else {\r\n            assert(query.getQueryParams().isDefault(), \"should have a tag if it's not a default query.\");\r\n            return query.path.toString();\r\n        }\r\n    };\r\n    /** @inheritDoc */\r\n    ReadonlyRestClient.prototype.listen = function (query, currentHashFn, tag, onComplete) {\r\n        var _this = this;\r\n        var pathString = query.path.toString();\r\n        this.log_('Listen called for ' + pathString + ' ' + query.queryIdentifier());\r\n        // Mark this listener so we can tell if it's removed.\r\n        var listenId = ReadonlyRestClient.getListenId_(query, tag);\r\n        var thisListen = {};\r\n        this.listens_[listenId] = thisListen;\r\n        var queryStringParameters = query\r\n            .getQueryParams()\r\n            .toRestQueryStringParameters();\r\n        this.restRequest_(pathString + '.json', queryStringParameters, function (error$$1, result) {\r\n            var data = result;\r\n            if (error$$1 === 404) {\r\n                data = null;\r\n                error$$1 = null;\r\n            }\r\n            if (error$$1 === null) {\r\n                _this.onDataUpdate_(pathString, data, /*isMerge=*/ false, tag);\r\n            }\r\n            if (safeGet(_this.listens_, listenId) === thisListen) {\r\n                var status_1;\r\n                if (!error$$1) {\r\n                    status_1 = 'ok';\r\n                }\r\n                else if (error$$1 == 401) {\r\n                    status_1 = 'permission_denied';\r\n                }\r\n                else {\r\n                    status_1 = 'rest_error:' + error$$1;\r\n                }\r\n                onComplete(status_1, null);\r\n            }\r\n        });\r\n    };\r\n    /** @inheritDoc */\r\n    ReadonlyRestClient.prototype.unlisten = function (query, tag) {\r\n        var listenId = ReadonlyRestClient.getListenId_(query, tag);\r\n        delete this.listens_[listenId];\r\n    };\r\n    /** @inheritDoc */\r\n    ReadonlyRestClient.prototype.refreshAuthToken = function (token) {\r\n        // no-op since we just always call getToken.\r\n    };\r\n    /**\r\n     * Performs a REST request to the given path, with the provided query string parameters,\r\n     * and any auth credentials we have.\r\n     *\r\n     * @param {!string} pathString\r\n     * @param {!Object.<string, *>} queryStringParameters\r\n     * @param {?function(?number, *=)} callback\r\n     * @private\r\n     */\r\n    ReadonlyRestClient.prototype.restRequest_ = function (pathString, queryStringParameters, callback) {\r\n        var _this = this;\r\n        if (queryStringParameters === void 0) { queryStringParameters = {}; }\r\n        queryStringParameters['format'] = 'export';\r\n        this.authTokenProvider_\r\n            .getToken(/*forceRefresh=*/ false)\r\n            .then(function (authTokenData) {\r\n            var authToken = authTokenData && authTokenData.accessToken;\r\n            if (authToken) {\r\n                queryStringParameters['auth'] = authToken;\r\n            }\r\n            var url = (_this.repoInfo_.secure ? 'https://' : 'http://') +\r\n                _this.repoInfo_.host +\r\n                pathString +\r\n                '?' +\r\n                'ns=' +\r\n                _this.repoInfo_.namespace +\r\n                querystring(queryStringParameters);\r\n            _this.log_('Sending REST request for ' + url);\r\n            var xhr = new XMLHttpRequest();\r\n            xhr.onreadystatechange = function () {\r\n                if (callback && xhr.readyState === 4) {\r\n                    _this.log_('REST Response for ' + url + ' received. status:', xhr.status, 'response:', xhr.responseText);\r\n                    var res = null;\r\n                    if (xhr.status >= 200 && xhr.status < 300) {\r\n                        try {\r\n                            res = jsonEval(xhr.responseText);\r\n                        }\r\n                        catch (e) {\r\n                            warn('Failed to parse JSON response for ' +\r\n                                url +\r\n                                ': ' +\r\n                                xhr.responseText);\r\n                        }\r\n                        callback(null, res);\r\n                    }\r\n                    else {\r\n                        // 401 and 404 are expected.\r\n                        if (xhr.status !== 401 && xhr.status !== 404) {\r\n                            warn('Got unsuccessful REST response for ' +\r\n                                url +\r\n                                ' Status: ' +\r\n                                xhr.status);\r\n                        }\r\n                        callback(xhr.status);\r\n                    }\r\n                    callback = null;\r\n                }\r\n            };\r\n            xhr.open('GET', url, /*asynchronous=*/ true);\r\n            xhr.send();\r\n        });\r\n    };\r\n    return ReadonlyRestClient;\r\n}(ServerActions));\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar INTERRUPT_REASON = 'repo_interrupt';\r\n/**\r\n * A connection to a single data repository.\r\n */\r\nvar Repo = /** @class */ (function () {\r\n    /**\r\n     * @param {!RepoInfo} repoInfo_\r\n     * @param {boolean} forceRestClient\r\n     * @param {!FirebaseApp} app\r\n     */\r\n    function Repo(repoInfo_, forceRestClient, app) {\r\n        var _this = this;\r\n        this.repoInfo_ = repoInfo_;\r\n        this.app = app;\r\n        this.dataUpdateCount = 0;\r\n        this.statsListener_ = null;\r\n        this.eventQueue_ = new EventQueue();\r\n        this.nextWriteId_ = 1;\r\n        this.interceptServerDataCallback_ = null;\r\n        // A list of data pieces and paths to be set when this client disconnects.\r\n        this.onDisconnect_ = new SparseSnapshotTree();\r\n        /**\r\n         * TODO: This should be @private but it's used by test_access.js and internal.js\r\n         * @type {?PersistentConnection}\r\n         */\r\n        this.persistentConnection_ = null;\r\n        /** @type {!AuthTokenProvider} */\r\n        var authTokenProvider = new AuthTokenProvider(app);\r\n        this.stats_ = StatsManager.getCollection(repoInfo_);\r\n        if (forceRestClient || beingCrawled()) {\r\n            this.server_ = new ReadonlyRestClient(this.repoInfo_, this.onDataUpdate_.bind(this), authTokenProvider);\r\n            // Minor hack: Fire onConnect immediately, since there's no actual connection.\r\n            setTimeout(this.onConnectStatus_.bind(this, true), 0);\r\n        }\r\n        else {\r\n            var authOverride = app.options['databaseAuthVariableOverride'];\r\n            // Validate authOverride\r\n            if (typeof authOverride !== 'undefined' && authOverride !== null) {\r\n                if (typeof authOverride !== 'object') {\r\n                    throw new Error('Only objects are supported for option databaseAuthVariableOverride');\r\n                }\r\n                try {\r\n                    stringify(authOverride);\r\n                }\r\n                catch (e) {\r\n                    throw new Error('Invalid authOverride provided: ' + e);\r\n                }\r\n            }\r\n            this.persistentConnection_ = new PersistentConnection(this.repoInfo_, this.onDataUpdate_.bind(this), this.onConnectStatus_.bind(this), this.onServerInfoUpdate_.bind(this), authTokenProvider, authOverride);\r\n            this.server_ = this.persistentConnection_;\r\n        }\r\n        authTokenProvider.addTokenChangeListener(function (token) {\r\n            _this.server_.refreshAuthToken(token);\r\n        });\r\n        // In the case of multiple Repos for the same repoInfo (i.e. there are multiple Firebase.Contexts being used),\r\n        // we only want to create one StatsReporter.  As such, we'll report stats over the first Repo created.\r\n        this.statsReporter_ = StatsManager.getOrCreateReporter(repoInfo_, function () { return new StatsReporter(_this.stats_, _this.server_); });\r\n        this.transactions_init_();\r\n        // Used for .info.\r\n        this.infoData_ = new SnapshotHolder();\r\n        this.infoSyncTree_ = new SyncTree({\r\n            startListening: function (query, tag, currentHashFn, onComplete) {\r\n                var infoEvents = [];\r\n                var node = _this.infoData_.getNode(query.path);\r\n                // This is possibly a hack, but we have different semantics for .info endpoints. We don't raise null events\r\n                // on initial data...\r\n                if (!node.isEmpty()) {\r\n                    infoEvents = _this.infoSyncTree_.applyServerOverwrite(query.path, node);\r\n                    setTimeout(function () {\r\n                        onComplete('ok');\r\n                    }, 0);\r\n                }\r\n                return infoEvents;\r\n            },\r\n            stopListening: function () { }\r\n        });\r\n        this.updateInfo_('connected', false);\r\n        this.serverSyncTree_ = new SyncTree({\r\n            startListening: function (query, tag, currentHashFn, onComplete) {\r\n                _this.server_.listen(query, currentHashFn, tag, function (status, data) {\r\n                    var events = onComplete(status, data);\r\n                    _this.eventQueue_.raiseEventsForChangedPath(query.path, events);\r\n                });\r\n                // No synchronous events for network-backed sync trees\r\n                return [];\r\n            },\r\n            stopListening: function (query, tag) {\r\n                _this.server_.unlisten(query, tag);\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * @return {string}  The URL corresponding to the root of this Firebase.\r\n     */\r\n    Repo.prototype.toString = function () {\r\n        return ((this.repoInfo_.secure ? 'https://' : 'http://') + this.repoInfo_.host);\r\n    };\r\n    /**\r\n     * @return {!string} The namespace represented by the repo.\r\n     */\r\n    Repo.prototype.name = function () {\r\n        return this.repoInfo_.namespace;\r\n    };\r\n    /**\r\n     * @return {!number} The time in milliseconds, taking the server offset into account if we have one.\r\n     */\r\n    Repo.prototype.serverTime = function () {\r\n        var offsetNode = this.infoData_.getNode(new Path('.info/serverTimeOffset'));\r\n        var offset = offsetNode.val() || 0;\r\n        return new Date().getTime() + offset;\r\n    };\r\n    /**\r\n     * Generate ServerValues using some variables from the repo object.\r\n     * @return {!Object}\r\n     */\r\n    Repo.prototype.generateServerValues = function () {\r\n        return generateWithValues({\r\n            timestamp: this.serverTime()\r\n        });\r\n    };\r\n    /**\r\n     * Called by realtime when we get new messages from the server.\r\n     *\r\n     * @private\r\n     * @param {string} pathString\r\n     * @param {*} data\r\n     * @param {boolean} isMerge\r\n     * @param {?number} tag\r\n     */\r\n    Repo.prototype.onDataUpdate_ = function (pathString, data, isMerge, tag) {\r\n        // For testing.\r\n        this.dataUpdateCount++;\r\n        var path = new Path(pathString);\r\n        data = this.interceptServerDataCallback_\r\n            ? this.interceptServerDataCallback_(pathString, data)\r\n            : data;\r\n        var events = [];\r\n        if (tag) {\r\n            if (isMerge) {\r\n                var taggedChildren = map(data, function (raw) {\r\n                    return nodeFromJSON$1(raw);\r\n                });\r\n                events = this.serverSyncTree_.applyTaggedQueryMerge(path, taggedChildren, tag);\r\n            }\r\n            else {\r\n                var taggedSnap = nodeFromJSON$1(data);\r\n                events = this.serverSyncTree_.applyTaggedQueryOverwrite(path, taggedSnap, tag);\r\n            }\r\n        }\r\n        else if (isMerge) {\r\n            var changedChildren = map(data, function (raw) {\r\n                return nodeFromJSON$1(raw);\r\n            });\r\n            events = this.serverSyncTree_.applyServerMerge(path, changedChildren);\r\n        }\r\n        else {\r\n            var snap = nodeFromJSON$1(data);\r\n            events = this.serverSyncTree_.applyServerOverwrite(path, snap);\r\n        }\r\n        var affectedPath = path;\r\n        if (events.length > 0) {\r\n            // Since we have a listener outstanding for each transaction, receiving any events\r\n            // is a proxy for some change having occurred.\r\n            affectedPath = this.rerunTransactions_(path);\r\n        }\r\n        this.eventQueue_.raiseEventsForChangedPath(affectedPath, events);\r\n    };\r\n    /**\r\n     * TODO: This should be @private but it's used by test_access.js and internal.js\r\n     * @param {?function(!string, *):*} callback\r\n     * @private\r\n     */\r\n    Repo.prototype.interceptServerData_ = function (callback) {\r\n        this.interceptServerDataCallback_ = callback;\r\n    };\r\n    /**\r\n     * @param {!boolean} connectStatus\r\n     * @private\r\n     */\r\n    Repo.prototype.onConnectStatus_ = function (connectStatus) {\r\n        this.updateInfo_('connected', connectStatus);\r\n        if (connectStatus === false) {\r\n            this.runOnDisconnectEvents_();\r\n        }\r\n    };\r\n    /**\r\n     * @param {!Object} updates\r\n     * @private\r\n     */\r\n    Repo.prototype.onServerInfoUpdate_ = function (updates) {\r\n        var _this = this;\r\n        each(updates, function (value, key) {\r\n            _this.updateInfo_(key, value);\r\n        });\r\n    };\r\n    /**\r\n     *\r\n     * @param {!string} pathString\r\n     * @param {*} value\r\n     * @private\r\n     */\r\n    Repo.prototype.updateInfo_ = function (pathString, value) {\r\n        var path = new Path('/.info/' + pathString);\r\n        var newNode = nodeFromJSON$1(value);\r\n        this.infoData_.updateSnapshot(path, newNode);\r\n        var events = this.infoSyncTree_.applyServerOverwrite(path, newNode);\r\n        this.eventQueue_.raiseEventsForChangedPath(path, events);\r\n    };\r\n    /**\r\n     * @return {!number}\r\n     * @private\r\n     */\r\n    Repo.prototype.getNextWriteId_ = function () {\r\n        return this.nextWriteId_++;\r\n    };\r\n    /**\r\n     * @param {!Path} path\r\n     * @param {*} newVal\r\n     * @param {number|string|null} newPriority\r\n     * @param {?function(?Error, *=)} onComplete\r\n     */\r\n    Repo.prototype.setWithPriority = function (path, newVal, newPriority, onComplete) {\r\n        var _this = this;\r\n        this.log_('set', {\r\n            path: path.toString(),\r\n            value: newVal,\r\n            priority: newPriority\r\n        });\r\n        // TODO: Optimize this behavior to either (a) store flag to skip resolving where possible and / or\r\n        // (b) store unresolved paths on JSON parse\r\n        var serverValues = this.generateServerValues();\r\n        var newNodeUnresolved = nodeFromJSON$1(newVal, newPriority);\r\n        var newNode = resolveDeferredValueSnapshot(newNodeUnresolved, serverValues);\r\n        var writeId = this.getNextWriteId_();\r\n        var events = this.serverSyncTree_.applyUserOverwrite(path, newNode, writeId, true);\r\n        this.eventQueue_.queueEvents(events);\r\n        this.server_.put(path.toString(), newNodeUnresolved.val(/*export=*/ true), function (status, errorReason) {\r\n            var success = status === 'ok';\r\n            if (!success) {\r\n                warn('set at ' + path + ' failed: ' + status);\r\n            }\r\n            var clearEvents = _this.serverSyncTree_.ackUserWrite(writeId, !success);\r\n            _this.eventQueue_.raiseEventsForChangedPath(path, clearEvents);\r\n            _this.callOnCompleteCallback(onComplete, status, errorReason);\r\n        });\r\n        var affectedPath = this.abortTransactions_(path);\r\n        this.rerunTransactions_(affectedPath);\r\n        // We queued the events above, so just flush the queue here\r\n        this.eventQueue_.raiseEventsForChangedPath(affectedPath, []);\r\n    };\r\n    /**\r\n     * @param {!Path} path\r\n     * @param {!Object} childrenToMerge\r\n     * @param {?function(?Error, *=)} onComplete\r\n     */\r\n    Repo.prototype.update = function (path, childrenToMerge, onComplete) {\r\n        var _this = this;\r\n        this.log_('update', { path: path.toString(), value: childrenToMerge });\r\n        // Start with our existing data and merge each child into it.\r\n        var empty = true;\r\n        var serverValues = this.generateServerValues();\r\n        var changedChildren = {};\r\n        forEach(childrenToMerge, function (changedKey, changedValue) {\r\n            empty = false;\r\n            var newNodeUnresolved = nodeFromJSON$1(changedValue);\r\n            changedChildren[changedKey] = resolveDeferredValueSnapshot(newNodeUnresolved, serverValues);\r\n        });\r\n        if (!empty) {\r\n            var writeId_1 = this.getNextWriteId_();\r\n            var events = this.serverSyncTree_.applyUserMerge(path, changedChildren, writeId_1);\r\n            this.eventQueue_.queueEvents(events);\r\n            this.server_.merge(path.toString(), childrenToMerge, function (status, errorReason) {\r\n                var success = status === 'ok';\r\n                if (!success) {\r\n                    warn('update at ' + path + ' failed: ' + status);\r\n                }\r\n                var clearEvents = _this.serverSyncTree_.ackUserWrite(writeId_1, !success);\r\n                var affectedPath = clearEvents.length > 0 ? _this.rerunTransactions_(path) : path;\r\n                _this.eventQueue_.raiseEventsForChangedPath(affectedPath, clearEvents);\r\n                _this.callOnCompleteCallback(onComplete, status, errorReason);\r\n            });\r\n            forEach(childrenToMerge, function (changedPath) {\r\n                var affectedPath = _this.abortTransactions_(path.child(changedPath));\r\n                _this.rerunTransactions_(affectedPath);\r\n            });\r\n            // We queued the events above, so just flush the queue here\r\n            this.eventQueue_.raiseEventsForChangedPath(path, []);\r\n        }\r\n        else {\r\n            log(\"update() called with empty data.  Don't do anything.\");\r\n            this.callOnCompleteCallback(onComplete, 'ok');\r\n        }\r\n    };\r\n    /**\r\n     * Applies all of the changes stored up in the onDisconnect_ tree.\r\n     * @private\r\n     */\r\n    Repo.prototype.runOnDisconnectEvents_ = function () {\r\n        var _this = this;\r\n        this.log_('onDisconnectEvents');\r\n        var serverValues = this.generateServerValues();\r\n        var resolvedOnDisconnectTree = resolveDeferredValueTree(this.onDisconnect_, serverValues);\r\n        var events = [];\r\n        resolvedOnDisconnectTree.forEachTree(Path.Empty, function (path, snap) {\r\n            events = events.concat(_this.serverSyncTree_.applyServerOverwrite(path, snap));\r\n            var affectedPath = _this.abortTransactions_(path);\r\n            _this.rerunTransactions_(affectedPath);\r\n        });\r\n        this.onDisconnect_ = new SparseSnapshotTree();\r\n        this.eventQueue_.raiseEventsForChangedPath(Path.Empty, events);\r\n    };\r\n    /**\r\n     * @param {!Path} path\r\n     * @param {?function(?Error, *=)} onComplete\r\n     */\r\n    Repo.prototype.onDisconnectCancel = function (path, onComplete) {\r\n        var _this = this;\r\n        this.server_.onDisconnectCancel(path.toString(), function (status, errorReason) {\r\n            if (status === 'ok') {\r\n                _this.onDisconnect_.forget(path);\r\n            }\r\n            _this.callOnCompleteCallback(onComplete, status, errorReason);\r\n        });\r\n    };\r\n    /**\r\n     * @param {!Path} path\r\n     * @param {*} value\r\n     * @param {?function(?Error, *=)} onComplete\r\n     */\r\n    Repo.prototype.onDisconnectSet = function (path, value, onComplete) {\r\n        var _this = this;\r\n        var newNode = nodeFromJSON$1(value);\r\n        this.server_.onDisconnectPut(path.toString(), newNode.val(/*export=*/ true), function (status, errorReason) {\r\n            if (status === 'ok') {\r\n                _this.onDisconnect_.remember(path, newNode);\r\n            }\r\n            _this.callOnCompleteCallback(onComplete, status, errorReason);\r\n        });\r\n    };\r\n    /**\r\n     * @param {!Path} path\r\n     * @param {*} value\r\n     * @param {*} priority\r\n     * @param {?function(?Error, *=)} onComplete\r\n     */\r\n    Repo.prototype.onDisconnectSetWithPriority = function (path, value, priority, onComplete) {\r\n        var _this = this;\r\n        var newNode = nodeFromJSON$1(value, priority);\r\n        this.server_.onDisconnectPut(path.toString(), newNode.val(/*export=*/ true), function (status, errorReason) {\r\n            if (status === 'ok') {\r\n                _this.onDisconnect_.remember(path, newNode);\r\n            }\r\n            _this.callOnCompleteCallback(onComplete, status, errorReason);\r\n        });\r\n    };\r\n    /**\r\n     * @param {!Path} path\r\n     * @param {*} childrenToMerge\r\n     * @param {?function(?Error, *=)} onComplete\r\n     */\r\n    Repo.prototype.onDisconnectUpdate = function (path, childrenToMerge, onComplete) {\r\n        var _this = this;\r\n        if (isEmpty(childrenToMerge)) {\r\n            log(\"onDisconnect().update() called with empty data.  Don't do anything.\");\r\n            this.callOnCompleteCallback(onComplete, 'ok');\r\n            return;\r\n        }\r\n        this.server_.onDisconnectMerge(path.toString(), childrenToMerge, function (status, errorReason) {\r\n            if (status === 'ok') {\r\n                forEach(childrenToMerge, function (childName, childNode) {\r\n                    var newChildNode = nodeFromJSON$1(childNode);\r\n                    _this.onDisconnect_.remember(path.child(childName), newChildNode);\r\n                });\r\n            }\r\n            _this.callOnCompleteCallback(onComplete, status, errorReason);\r\n        });\r\n    };\r\n    /**\r\n     * @param {!Query} query\r\n     * @param {!EventRegistration} eventRegistration\r\n     */\r\n    Repo.prototype.addEventCallbackForQuery = function (query, eventRegistration) {\r\n        var events;\r\n        if (query.path.getFront() === '.info') {\r\n            events = this.infoSyncTree_.addEventRegistration(query, eventRegistration);\r\n        }\r\n        else {\r\n            events = this.serverSyncTree_.addEventRegistration(query, eventRegistration);\r\n        }\r\n        this.eventQueue_.raiseEventsAtPath(query.path, events);\r\n    };\r\n    /**\r\n     * @param {!Query} query\r\n     * @param {?EventRegistration} eventRegistration\r\n     */\r\n    Repo.prototype.removeEventCallbackForQuery = function (query, eventRegistration) {\r\n        // These are guaranteed not to raise events, since we're not passing in a cancelError. However, we can future-proof\r\n        // a little bit by handling the return values anyways.\r\n        var events;\r\n        if (query.path.getFront() === '.info') {\r\n            events = this.infoSyncTree_.removeEventRegistration(query, eventRegistration);\r\n        }\r\n        else {\r\n            events = this.serverSyncTree_.removeEventRegistration(query, eventRegistration);\r\n        }\r\n        this.eventQueue_.raiseEventsAtPath(query.path, events);\r\n    };\r\n    Repo.prototype.interrupt = function () {\r\n        if (this.persistentConnection_) {\r\n            this.persistentConnection_.interrupt(INTERRUPT_REASON);\r\n        }\r\n    };\r\n    Repo.prototype.resume = function () {\r\n        if (this.persistentConnection_) {\r\n            this.persistentConnection_.resume(INTERRUPT_REASON);\r\n        }\r\n    };\r\n    Repo.prototype.stats = function (showDelta) {\r\n        if (showDelta === void 0) { showDelta = false; }\r\n        if (typeof console === 'undefined')\r\n            return;\r\n        var stats;\r\n        if (showDelta) {\r\n            if (!this.statsListener_)\r\n                this.statsListener_ = new StatsListener(this.stats_);\r\n            stats = this.statsListener_.get();\r\n        }\r\n        else {\r\n            stats = this.stats_.get();\r\n        }\r\n        var longestName = Object.keys(stats).reduce(function (previousValue, currentValue) {\r\n            return Math.max(currentValue.length, previousValue);\r\n        }, 0);\r\n        forEach(stats, function (stat, value) {\r\n            // pad stat names to be the same length (plus 2 extra spaces).\r\n            for (var i = stat.length; i < longestName + 2; i++)\r\n                stat += ' ';\r\n            console.log(stat + value);\r\n        });\r\n    };\r\n    Repo.prototype.statsIncrementCounter = function (metric) {\r\n        this.stats_.incrementCounter(metric);\r\n        this.statsReporter_.includeStat(metric);\r\n    };\r\n    /**\r\n     * @param {...*} var_args\r\n     * @private\r\n     */\r\n    Repo.prototype.log_ = function () {\r\n        var var_args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            var_args[_i] = arguments[_i];\r\n        }\r\n        var prefix = '';\r\n        if (this.persistentConnection_) {\r\n            prefix = this.persistentConnection_.id + ':';\r\n        }\r\n        log.apply(void 0, [prefix].concat(var_args));\r\n    };\r\n    /**\r\n     * @param {?function(?Error, *=)} callback\r\n     * @param {!string} status\r\n     * @param {?string=} errorReason\r\n     */\r\n    Repo.prototype.callOnCompleteCallback = function (callback, status, errorReason) {\r\n        if (callback) {\r\n            exceptionGuard(function () {\r\n                if (status == 'ok') {\r\n                    callback(null);\r\n                }\r\n                else {\r\n                    var code = (status || 'error').toUpperCase();\r\n                    var message = code;\r\n                    if (errorReason)\r\n                        message += ': ' + errorReason;\r\n                    var error$$1 = new Error(message);\r\n                    error$$1.code = code;\r\n                    callback(error$$1);\r\n                }\r\n            });\r\n        }\r\n    };\r\n    Object.defineProperty(Repo.prototype, \"database\", {\r\n        get: function () {\r\n            return this.__database || (this.__database = new Database(this));\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return Repo;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Filters nodes by range and uses an IndexFilter to track any changes after filtering the node\r\n *\r\n * @constructor\r\n * @implements {NodeFilter}\r\n */\r\nvar RangedFilter = /** @class */ (function () {\r\n    /**\r\n     * @param {!QueryParams} params\r\n     */\r\n    function RangedFilter(params) {\r\n        this.indexedFilter_ = new IndexedFilter(params.getIndex());\r\n        this.index_ = params.getIndex();\r\n        this.startPost_ = RangedFilter.getStartPost_(params);\r\n        this.endPost_ = RangedFilter.getEndPost_(params);\r\n    }\r\n    /**\r\n     * @return {!NamedNode}\r\n     */\r\n    RangedFilter.prototype.getStartPost = function () {\r\n        return this.startPost_;\r\n    };\r\n    /**\r\n     * @return {!NamedNode}\r\n     */\r\n    RangedFilter.prototype.getEndPost = function () {\r\n        return this.endPost_;\r\n    };\r\n    /**\r\n     * @param {!NamedNode} node\r\n     * @return {boolean}\r\n     */\r\n    RangedFilter.prototype.matches = function (node) {\r\n        return (this.index_.compare(this.getStartPost(), node) <= 0 &&\r\n            this.index_.compare(node, this.getEndPost()) <= 0);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    RangedFilter.prototype.updateChild = function (snap, key, newChild, affectedPath, source, optChangeAccumulator) {\r\n        if (!this.matches(new NamedNode(key, newChild))) {\r\n            newChild = ChildrenNode.EMPTY_NODE;\r\n        }\r\n        return this.indexedFilter_.updateChild(snap, key, newChild, affectedPath, source, optChangeAccumulator);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    RangedFilter.prototype.updateFullNode = function (oldSnap, newSnap, optChangeAccumulator) {\r\n        if (newSnap.isLeafNode()) {\r\n            // Make sure we have a children node with the correct index, not a leaf node;\r\n            newSnap = ChildrenNode.EMPTY_NODE;\r\n        }\r\n        var filtered = newSnap.withIndex(this.index_);\r\n        // Don't support priorities on queries\r\n        filtered = filtered.updatePriority(ChildrenNode.EMPTY_NODE);\r\n        var self = this;\r\n        newSnap.forEachChild(PRIORITY_INDEX, function (key, childNode) {\r\n            if (!self.matches(new NamedNode(key, childNode))) {\r\n                filtered = filtered.updateImmediateChild(key, ChildrenNode.EMPTY_NODE);\r\n            }\r\n        });\r\n        return this.indexedFilter_.updateFullNode(oldSnap, filtered, optChangeAccumulator);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    RangedFilter.prototype.updatePriority = function (oldSnap, newPriority) {\r\n        // Don't support priorities on queries\r\n        return oldSnap;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    RangedFilter.prototype.filtersNodes = function () {\r\n        return true;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    RangedFilter.prototype.getIndexedFilter = function () {\r\n        return this.indexedFilter_;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    RangedFilter.prototype.getIndex = function () {\r\n        return this.index_;\r\n    };\r\n    /**\r\n     * @param {!QueryParams} params\r\n     * @return {!NamedNode}\r\n     * @private\r\n     */\r\n    RangedFilter.getStartPost_ = function (params) {\r\n        if (params.hasStart()) {\r\n            var startName = params.getIndexStartName();\r\n            return params.getIndex().makePost(params.getIndexStartValue(), startName);\r\n        }\r\n        else {\r\n            return params.getIndex().minPost();\r\n        }\r\n    };\r\n    /**\r\n     * @param {!QueryParams} params\r\n     * @return {!NamedNode}\r\n     * @private\r\n     */\r\n    RangedFilter.getEndPost_ = function (params) {\r\n        if (params.hasEnd()) {\r\n            var endName = params.getIndexEndName();\r\n            return params.getIndex().makePost(params.getIndexEndValue(), endName);\r\n        }\r\n        else {\r\n            return params.getIndex().maxPost();\r\n        }\r\n    };\r\n    return RangedFilter;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Applies a limit and a range to a node and uses RangedFilter to do the heavy lifting where possible\r\n *\r\n * @constructor\r\n * @implements {NodeFilter}\r\n */\r\nvar LimitedFilter = /** @class */ (function () {\r\n    /**\r\n     * @param {!QueryParams} params\r\n     */\r\n    function LimitedFilter(params) {\r\n        this.rangedFilter_ = new RangedFilter(params);\r\n        this.index_ = params.getIndex();\r\n        this.limit_ = params.getLimit();\r\n        this.reverse_ = !params.isViewFromLeft();\r\n    }\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LimitedFilter.prototype.updateChild = function (snap, key, newChild, affectedPath, source, optChangeAccumulator) {\r\n        if (!this.rangedFilter_.matches(new NamedNode(key, newChild))) {\r\n            newChild = ChildrenNode.EMPTY_NODE;\r\n        }\r\n        if (snap.getImmediateChild(key).equals(newChild)) {\r\n            // No change\r\n            return snap;\r\n        }\r\n        else if (snap.numChildren() < this.limit_) {\r\n            return this.rangedFilter_\r\n                .getIndexedFilter()\r\n                .updateChild(snap, key, newChild, affectedPath, source, optChangeAccumulator);\r\n        }\r\n        else {\r\n            return this.fullLimitUpdateChild_(snap, key, newChild, source, optChangeAccumulator);\r\n        }\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LimitedFilter.prototype.updateFullNode = function (oldSnap, newSnap, optChangeAccumulator) {\r\n        var filtered;\r\n        if (newSnap.isLeafNode() || newSnap.isEmpty()) {\r\n            // Make sure we have a children node with the correct index, not a leaf node;\r\n            filtered = ChildrenNode.EMPTY_NODE.withIndex(this.index_);\r\n        }\r\n        else {\r\n            if (this.limit_ * 2 < newSnap.numChildren() &&\r\n                newSnap.isIndexed(this.index_)) {\r\n                // Easier to build up a snapshot, since what we're given has more than twice the elements we want\r\n                filtered = ChildrenNode.EMPTY_NODE.withIndex(this.index_);\r\n                // anchor to the startPost, endPost, or last element as appropriate\r\n                var iterator = void 0;\r\n                if (this.reverse_) {\r\n                    iterator = newSnap.getReverseIteratorFrom(this.rangedFilter_.getEndPost(), this.index_);\r\n                }\r\n                else {\r\n                    iterator = newSnap.getIteratorFrom(this.rangedFilter_.getStartPost(), this.index_);\r\n                }\r\n                var count = 0;\r\n                while (iterator.hasNext() && count < this.limit_) {\r\n                    var next = iterator.getNext();\r\n                    var inRange = void 0;\r\n                    if (this.reverse_) {\r\n                        inRange =\r\n                            this.index_.compare(this.rangedFilter_.getStartPost(), next) <= 0;\r\n                    }\r\n                    else {\r\n                        inRange =\r\n                            this.index_.compare(next, this.rangedFilter_.getEndPost()) <= 0;\r\n                    }\r\n                    if (inRange) {\r\n                        filtered = filtered.updateImmediateChild(next.name, next.node);\r\n                        count++;\r\n                    }\r\n                    else {\r\n                        // if we have reached the end post, we cannot keep adding elemments\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                // The snap contains less than twice the limit. Faster to delete from the snap than build up a new one\r\n                filtered = newSnap.withIndex(this.index_);\r\n                // Don't support priorities on queries\r\n                filtered = filtered.updatePriority(ChildrenNode.EMPTY_NODE);\r\n                var startPost = void 0;\r\n                var endPost = void 0;\r\n                var cmp = void 0;\r\n                var iterator = void 0;\r\n                if (this.reverse_) {\r\n                    iterator = filtered.getReverseIterator(this.index_);\r\n                    startPost = this.rangedFilter_.getEndPost();\r\n                    endPost = this.rangedFilter_.getStartPost();\r\n                    var indexCompare_1 = this.index_.getCompare();\r\n                    cmp = function (a, b) { return indexCompare_1(b, a); };\r\n                }\r\n                else {\r\n                    iterator = filtered.getIterator(this.index_);\r\n                    startPost = this.rangedFilter_.getStartPost();\r\n                    endPost = this.rangedFilter_.getEndPost();\r\n                    cmp = this.index_.getCompare();\r\n                }\r\n                var count = 0;\r\n                var foundStartPost = false;\r\n                while (iterator.hasNext()) {\r\n                    var next = iterator.getNext();\r\n                    if (!foundStartPost && cmp(startPost, next) <= 0) {\r\n                        // start adding\r\n                        foundStartPost = true;\r\n                    }\r\n                    var inRange = foundStartPost && count < this.limit_ && cmp(next, endPost) <= 0;\r\n                    if (inRange) {\r\n                        count++;\r\n                    }\r\n                    else {\r\n                        filtered = filtered.updateImmediateChild(next.name, ChildrenNode.EMPTY_NODE);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return this.rangedFilter_\r\n            .getIndexedFilter()\r\n            .updateFullNode(oldSnap, filtered, optChangeAccumulator);\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LimitedFilter.prototype.updatePriority = function (oldSnap, newPriority) {\r\n        // Don't support priorities on queries\r\n        return oldSnap;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LimitedFilter.prototype.filtersNodes = function () {\r\n        return true;\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LimitedFilter.prototype.getIndexedFilter = function () {\r\n        return this.rangedFilter_.getIndexedFilter();\r\n    };\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    LimitedFilter.prototype.getIndex = function () {\r\n        return this.index_;\r\n    };\r\n    /**\r\n     * @param {!Node} snap\r\n     * @param {string} childKey\r\n     * @param {!Node} childSnap\r\n     * @param {!CompleteChildSource} source\r\n     * @param {?ChildChangeAccumulator} changeAccumulator\r\n     * @return {!Node}\r\n     * @private\r\n     */\r\n    LimitedFilter.prototype.fullLimitUpdateChild_ = function (snap, childKey, childSnap, source, changeAccumulator) {\r\n        // TODO: rename all cache stuff etc to general snap terminology\r\n        var cmp;\r\n        if (this.reverse_) {\r\n            var indexCmp_1 = this.index_.getCompare();\r\n            cmp = function (a, b) { return indexCmp_1(b, a); };\r\n        }\r\n        else {\r\n            cmp = this.index_.getCompare();\r\n        }\r\n        var oldEventCache = snap;\r\n        assert(oldEventCache.numChildren() == this.limit_, '');\r\n        var newChildNamedNode = new NamedNode(childKey, childSnap);\r\n        var windowBoundary = this.reverse_\r\n            ? oldEventCache.getFirstChild(this.index_)\r\n            : oldEventCache.getLastChild(this.index_);\r\n        var inRange = this.rangedFilter_.matches(newChildNamedNode);\r\n        if (oldEventCache.hasChild(childKey)) {\r\n            var oldChildSnap = oldEventCache.getImmediateChild(childKey);\r\n            var nextChild = source.getChildAfterChild(this.index_, windowBoundary, this.reverse_);\r\n            while (nextChild != null &&\r\n                (nextChild.name == childKey || oldEventCache.hasChild(nextChild.name))) {\r\n                // There is a weird edge case where a node is updated as part of a merge in the write tree, but hasn't\r\n                // been applied to the limited filter yet. Ignore this next child which will be updated later in\r\n                // the limited filter...\r\n                nextChild = source.getChildAfterChild(this.index_, nextChild, this.reverse_);\r\n            }\r\n            var compareNext = nextChild == null ? 1 : cmp(nextChild, newChildNamedNode);\r\n            var remainsInWindow = inRange && !childSnap.isEmpty() && compareNext >= 0;\r\n            if (remainsInWindow) {\r\n                if (changeAccumulator != null) {\r\n                    changeAccumulator.trackChildChange(Change.childChangedChange(childKey, childSnap, oldChildSnap));\r\n                }\r\n                return oldEventCache.updateImmediateChild(childKey, childSnap);\r\n            }\r\n            else {\r\n                if (changeAccumulator != null) {\r\n                    changeAccumulator.trackChildChange(Change.childRemovedChange(childKey, oldChildSnap));\r\n                }\r\n                var newEventCache = oldEventCache.updateImmediateChild(childKey, ChildrenNode.EMPTY_NODE);\r\n                var nextChildInRange = nextChild != null && this.rangedFilter_.matches(nextChild);\r\n                if (nextChildInRange) {\r\n                    if (changeAccumulator != null) {\r\n                        changeAccumulator.trackChildChange(Change.childAddedChange(nextChild.name, nextChild.node));\r\n                    }\r\n                    return newEventCache.updateImmediateChild(nextChild.name, nextChild.node);\r\n                }\r\n                else {\r\n                    return newEventCache;\r\n                }\r\n            }\r\n        }\r\n        else if (childSnap.isEmpty()) {\r\n            // we're deleting a node, but it was not in the window, so ignore it\r\n            return snap;\r\n        }\r\n        else if (inRange) {\r\n            if (cmp(windowBoundary, newChildNamedNode) >= 0) {\r\n                if (changeAccumulator != null) {\r\n                    changeAccumulator.trackChildChange(Change.childRemovedChange(windowBoundary.name, windowBoundary.node));\r\n                    changeAccumulator.trackChildChange(Change.childAddedChange(childKey, childSnap));\r\n                }\r\n                return oldEventCache\r\n                    .updateImmediateChild(childKey, childSnap)\r\n                    .updateImmediateChild(windowBoundary.name, ChildrenNode.EMPTY_NODE);\r\n            }\r\n            else {\r\n                return snap;\r\n            }\r\n        }\r\n        else {\r\n            return snap;\r\n        }\r\n    };\r\n    return LimitedFilter;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * This class is an immutable-from-the-public-api struct containing a set of query parameters defining a\r\n * range to be returned for a particular location. It is assumed that validation of parameters is done at the\r\n * user-facing API level, so it is not done here.\r\n * @constructor\r\n */\r\nvar QueryParams = /** @class */ (function () {\r\n    function QueryParams() {\r\n        this.limitSet_ = false;\r\n        this.startSet_ = false;\r\n        this.startNameSet_ = false;\r\n        this.endSet_ = false;\r\n        this.endNameSet_ = false;\r\n        this.limit_ = 0;\r\n        this.viewFrom_ = '';\r\n        this.indexStartValue_ = null;\r\n        this.indexStartName_ = '';\r\n        this.indexEndValue_ = null;\r\n        this.indexEndName_ = '';\r\n        this.index_ = PRIORITY_INDEX;\r\n    }\r\n    /**\r\n     * @return {boolean}\r\n     */\r\n    QueryParams.prototype.hasStart = function () {\r\n        return this.startSet_;\r\n    };\r\n    /**\r\n     * @return {boolean} True if it would return from left.\r\n     */\r\n    QueryParams.prototype.isViewFromLeft = function () {\r\n        if (this.viewFrom_ === '') {\r\n            // limit(), rather than limitToFirst or limitToLast was called.\r\n            // This means that only one of startSet_ and endSet_ is true. Use them\r\n            // to calculate which side of the view to anchor to. If neither is set,\r\n            // anchor to the end.\r\n            return this.startSet_;\r\n        }\r\n        else {\r\n            return (this.viewFrom_ === QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT);\r\n        }\r\n    };\r\n    /**\r\n     * Only valid to call if hasStart() returns true\r\n     * @return {*}\r\n     */\r\n    QueryParams.prototype.getIndexStartValue = function () {\r\n        assert(this.startSet_, 'Only valid if start has been set');\r\n        return this.indexStartValue_;\r\n    };\r\n    /**\r\n     * Only valid to call if hasStart() returns true.\r\n     * Returns the starting key name for the range defined by these query parameters\r\n     * @return {!string}\r\n     */\r\n    QueryParams.prototype.getIndexStartName = function () {\r\n        assert(this.startSet_, 'Only valid if start has been set');\r\n        if (this.startNameSet_) {\r\n            return this.indexStartName_;\r\n        }\r\n        else {\r\n            return MIN_NAME;\r\n        }\r\n    };\r\n    /**\r\n     * @return {boolean}\r\n     */\r\n    QueryParams.prototype.hasEnd = function () {\r\n        return this.endSet_;\r\n    };\r\n    /**\r\n     * Only valid to call if hasEnd() returns true.\r\n     * @return {*}\r\n     */\r\n    QueryParams.prototype.getIndexEndValue = function () {\r\n        assert(this.endSet_, 'Only valid if end has been set');\r\n        return this.indexEndValue_;\r\n    };\r\n    /**\r\n     * Only valid to call if hasEnd() returns true.\r\n     * Returns the end key name for the range defined by these query parameters\r\n     * @return {!string}\r\n     */\r\n    QueryParams.prototype.getIndexEndName = function () {\r\n        assert(this.endSet_, 'Only valid if end has been set');\r\n        if (this.endNameSet_) {\r\n            return this.indexEndName_;\r\n        }\r\n        else {\r\n            return MAX_NAME;\r\n        }\r\n    };\r\n    /**\r\n     * @return {boolean}\r\n     */\r\n    QueryParams.prototype.hasLimit = function () {\r\n        return this.limitSet_;\r\n    };\r\n    /**\r\n     * @return {boolean} True if a limit has been set and it has been explicitly anchored\r\n     */\r\n    QueryParams.prototype.hasAnchoredLimit = function () {\r\n        return this.limitSet_ && this.viewFrom_ !== '';\r\n    };\r\n    /**\r\n     * Only valid to call if hasLimit() returns true\r\n     * @return {!number}\r\n     */\r\n    QueryParams.prototype.getLimit = function () {\r\n        assert(this.limitSet_, 'Only valid if limit has been set');\r\n        return this.limit_;\r\n    };\r\n    /**\r\n     * @return {!Index}\r\n     */\r\n    QueryParams.prototype.getIndex = function () {\r\n        return this.index_;\r\n    };\r\n    /**\r\n     * @return {!QueryParams}\r\n     * @private\r\n     */\r\n    QueryParams.prototype.copy_ = function () {\r\n        var copy = new QueryParams();\r\n        copy.limitSet_ = this.limitSet_;\r\n        copy.limit_ = this.limit_;\r\n        copy.startSet_ = this.startSet_;\r\n        copy.indexStartValue_ = this.indexStartValue_;\r\n        copy.startNameSet_ = this.startNameSet_;\r\n        copy.indexStartName_ = this.indexStartName_;\r\n        copy.endSet_ = this.endSet_;\r\n        copy.indexEndValue_ = this.indexEndValue_;\r\n        copy.endNameSet_ = this.endNameSet_;\r\n        copy.indexEndName_ = this.indexEndName_;\r\n        copy.index_ = this.index_;\r\n        copy.viewFrom_ = this.viewFrom_;\r\n        return copy;\r\n    };\r\n    /**\r\n     * @param {!number} newLimit\r\n     * @return {!QueryParams}\r\n     */\r\n    QueryParams.prototype.limit = function (newLimit) {\r\n        var newParams = this.copy_();\r\n        newParams.limitSet_ = true;\r\n        newParams.limit_ = newLimit;\r\n        newParams.viewFrom_ = '';\r\n        return newParams;\r\n    };\r\n    /**\r\n     * @param {!number} newLimit\r\n     * @return {!QueryParams}\r\n     */\r\n    QueryParams.prototype.limitToFirst = function (newLimit) {\r\n        var newParams = this.copy_();\r\n        newParams.limitSet_ = true;\r\n        newParams.limit_ = newLimit;\r\n        newParams.viewFrom_ = QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT;\r\n        return newParams;\r\n    };\r\n    /**\r\n     * @param {!number} newLimit\r\n     * @return {!QueryParams}\r\n     */\r\n    QueryParams.prototype.limitToLast = function (newLimit) {\r\n        var newParams = this.copy_();\r\n        newParams.limitSet_ = true;\r\n        newParams.limit_ = newLimit;\r\n        newParams.viewFrom_ = QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT;\r\n        return newParams;\r\n    };\r\n    /**\r\n     * @param {*} indexValue\r\n     * @param {?string=} key\r\n     * @return {!QueryParams}\r\n     */\r\n    QueryParams.prototype.startAt = function (indexValue, key) {\r\n        var newParams = this.copy_();\r\n        newParams.startSet_ = true;\r\n        if (!(indexValue !== undefined)) {\r\n            indexValue = null;\r\n        }\r\n        newParams.indexStartValue_ = indexValue;\r\n        if (key != null) {\r\n            newParams.startNameSet_ = true;\r\n            newParams.indexStartName_ = key;\r\n        }\r\n        else {\r\n            newParams.startNameSet_ = false;\r\n            newParams.indexStartName_ = '';\r\n        }\r\n        return newParams;\r\n    };\r\n    /**\r\n     * @param {*} indexValue\r\n     * @param {?string=} key\r\n     * @return {!QueryParams}\r\n     */\r\n    QueryParams.prototype.endAt = function (indexValue, key) {\r\n        var newParams = this.copy_();\r\n        newParams.endSet_ = true;\r\n        if (!(indexValue !== undefined)) {\r\n            indexValue = null;\r\n        }\r\n        newParams.indexEndValue_ = indexValue;\r\n        if (key !== undefined) {\r\n            newParams.endNameSet_ = true;\r\n            newParams.indexEndName_ = key;\r\n        }\r\n        else {\r\n            newParams.endNameSet_ = false;\r\n            newParams.indexEndName_ = '';\r\n        }\r\n        return newParams;\r\n    };\r\n    /**\r\n     * @param {!Index} index\r\n     * @return {!QueryParams}\r\n     */\r\n    QueryParams.prototype.orderBy = function (index) {\r\n        var newParams = this.copy_();\r\n        newParams.index_ = index;\r\n        return newParams;\r\n    };\r\n    /**\r\n     * @return {!Object}\r\n     */\r\n    QueryParams.prototype.getQueryObject = function () {\r\n        var WIRE_PROTOCOL_CONSTANTS = QueryParams.WIRE_PROTOCOL_CONSTANTS_;\r\n        var obj = {};\r\n        if (this.startSet_) {\r\n            obj[WIRE_PROTOCOL_CONSTANTS.INDEX_START_VALUE] = this.indexStartValue_;\r\n            if (this.startNameSet_) {\r\n                obj[WIRE_PROTOCOL_CONSTANTS.INDEX_START_NAME] = this.indexStartName_;\r\n            }\r\n        }\r\n        if (this.endSet_) {\r\n            obj[WIRE_PROTOCOL_CONSTANTS.INDEX_END_VALUE] = this.indexEndValue_;\r\n            if (this.endNameSet_) {\r\n                obj[WIRE_PROTOCOL_CONSTANTS.INDEX_END_NAME] = this.indexEndName_;\r\n            }\r\n        }\r\n        if (this.limitSet_) {\r\n            obj[WIRE_PROTOCOL_CONSTANTS.LIMIT] = this.limit_;\r\n            var viewFrom = this.viewFrom_;\r\n            if (viewFrom === '') {\r\n                if (this.isViewFromLeft()) {\r\n                    viewFrom = WIRE_PROTOCOL_CONSTANTS.VIEW_FROM_LEFT;\r\n                }\r\n                else {\r\n                    viewFrom = WIRE_PROTOCOL_CONSTANTS.VIEW_FROM_RIGHT;\r\n                }\r\n            }\r\n            obj[WIRE_PROTOCOL_CONSTANTS.VIEW_FROM] = viewFrom;\r\n        }\r\n        // For now, priority index is the default, so we only specify if it's some other index\r\n        if (this.index_ !== PRIORITY_INDEX) {\r\n            obj[WIRE_PROTOCOL_CONSTANTS.INDEX] = this.index_.toString();\r\n        }\r\n        return obj;\r\n    };\r\n    /**\r\n     * @return {boolean}\r\n     */\r\n    QueryParams.prototype.loadsAllData = function () {\r\n        return !(this.startSet_ || this.endSet_ || this.limitSet_);\r\n    };\r\n    /**\r\n     * @return {boolean}\r\n     */\r\n    QueryParams.prototype.isDefault = function () {\r\n        return this.loadsAllData() && this.index_ == PRIORITY_INDEX;\r\n    };\r\n    /**\r\n     * @return {!NodeFilter}\r\n     */\r\n    QueryParams.prototype.getNodeFilter = function () {\r\n        if (this.loadsAllData()) {\r\n            return new IndexedFilter(this.getIndex());\r\n        }\r\n        else if (this.hasLimit()) {\r\n            return new LimitedFilter(this);\r\n        }\r\n        else {\r\n            return new RangedFilter(this);\r\n        }\r\n    };\r\n    /**\r\n     * Returns a set of REST query string parameters representing this query.\r\n     *\r\n     * @return {!Object.<string,*>} query string parameters\r\n     */\r\n    QueryParams.prototype.toRestQueryStringParameters = function () {\r\n        var REST_CONSTANTS = QueryParams.REST_QUERY_CONSTANTS_;\r\n        var qs = {};\r\n        if (this.isDefault()) {\r\n            return qs;\r\n        }\r\n        var orderBy;\r\n        if (this.index_ === PRIORITY_INDEX) {\r\n            orderBy = REST_CONSTANTS.PRIORITY_INDEX;\r\n        }\r\n        else if (this.index_ === VALUE_INDEX) {\r\n            orderBy = REST_CONSTANTS.VALUE_INDEX;\r\n        }\r\n        else if (this.index_ === KEY_INDEX) {\r\n            orderBy = REST_CONSTANTS.KEY_INDEX;\r\n        }\r\n        else {\r\n            assert(this.index_ instanceof PathIndex, 'Unrecognized index type!');\r\n            orderBy = this.index_.toString();\r\n        }\r\n        qs[REST_CONSTANTS.ORDER_BY] = stringify(orderBy);\r\n        if (this.startSet_) {\r\n            qs[REST_CONSTANTS.START_AT] = stringify(this.indexStartValue_);\r\n            if (this.startNameSet_) {\r\n                qs[REST_CONSTANTS.START_AT] += ',' + stringify(this.indexStartName_);\r\n            }\r\n        }\r\n        if (this.endSet_) {\r\n            qs[REST_CONSTANTS.END_AT] = stringify(this.indexEndValue_);\r\n            if (this.endNameSet_) {\r\n                qs[REST_CONSTANTS.END_AT] += ',' + stringify(this.indexEndName_);\r\n            }\r\n        }\r\n        if (this.limitSet_) {\r\n            if (this.isViewFromLeft()) {\r\n                qs[REST_CONSTANTS.LIMIT_TO_FIRST] = this.limit_;\r\n            }\r\n            else {\r\n                qs[REST_CONSTANTS.LIMIT_TO_LAST] = this.limit_;\r\n            }\r\n        }\r\n        return qs;\r\n    };\r\n    /**\r\n     * Wire Protocol Constants\r\n     * @const\r\n     * @enum {string}\r\n     * @private\r\n     */\r\n    QueryParams.WIRE_PROTOCOL_CONSTANTS_ = {\r\n        INDEX_START_VALUE: 'sp',\r\n        INDEX_START_NAME: 'sn',\r\n        INDEX_END_VALUE: 'ep',\r\n        INDEX_END_NAME: 'en',\r\n        LIMIT: 'l',\r\n        VIEW_FROM: 'vf',\r\n        VIEW_FROM_LEFT: 'l',\r\n        VIEW_FROM_RIGHT: 'r',\r\n        INDEX: 'i'\r\n    };\r\n    /**\r\n     * REST Query Constants\r\n     * @const\r\n     * @enum {string}\r\n     * @private\r\n     */\r\n    QueryParams.REST_QUERY_CONSTANTS_ = {\r\n        ORDER_BY: 'orderBy',\r\n        PRIORITY_INDEX: '$priority',\r\n        VALUE_INDEX: '$value',\r\n        KEY_INDEX: '$key',\r\n        START_AT: 'startAt',\r\n        END_AT: 'endAt',\r\n        LIMIT_TO_FIRST: 'limitToFirst',\r\n        LIMIT_TO_LAST: 'limitToLast'\r\n    };\r\n    /**\r\n     * Default, empty query parameters\r\n     * @type {!QueryParams}\r\n     * @const\r\n     */\r\n    QueryParams.DEFAULT = new QueryParams();\r\n    return QueryParams;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar Reference = /** @class */ (function (_super) {\r\n    __extends(Reference, _super);\r\n    /**\r\n     * Call options:\r\n     *   new Reference(Repo, Path) or\r\n     *   new Reference(url: string, string|RepoManager)\r\n     *\r\n     * Externally - this is the firebase.database.Reference type.\r\n     *\r\n     * @param {!Repo} repo\r\n     * @param {(!Path)} path\r\n     * @extends {Query}\r\n     */\r\n    function Reference(repo, path) {\r\n        var _this = this;\r\n        if (!(repo instanceof Repo)) {\r\n            throw new Error('new Reference() no longer supported - use app.database().');\r\n        }\r\n        // call Query's constructor, passing in the repo and path.\r\n        _this = _super.call(this, repo, path, QueryParams.DEFAULT, false) || this;\r\n        return _this;\r\n    }\r\n    /** @return {?string} */\r\n    Reference.prototype.getKey = function () {\r\n        validateArgCount('Reference.key', 0, 0, arguments.length);\r\n        if (this.path.isEmpty())\r\n            return null;\r\n        else\r\n            return this.path.getBack();\r\n    };\r\n    /**\r\n     * @param {!(string|Path)} pathString\r\n     * @return {!Reference}\r\n     */\r\n    Reference.prototype.child = function (pathString) {\r\n        validateArgCount('Reference.child', 1, 1, arguments.length);\r\n        if (typeof pathString === 'number') {\r\n            pathString = String(pathString);\r\n        }\r\n        else if (!(pathString instanceof Path)) {\r\n            if (this.path.getFront() === null)\r\n                validateRootPathString('Reference.child', 1, pathString, false);\r\n            else\r\n                validatePathString('Reference.child', 1, pathString, false);\r\n        }\r\n        return new Reference(this.repo, this.path.child(pathString));\r\n    };\r\n    /** @return {?Reference} */\r\n    Reference.prototype.getParent = function () {\r\n        validateArgCount('Reference.parent', 0, 0, arguments.length);\r\n        var parentPath = this.path.parent();\r\n        return parentPath === null ? null : new Reference(this.repo, parentPath);\r\n    };\r\n    /** @return {!Reference} */\r\n    Reference.prototype.getRoot = function () {\r\n        validateArgCount('Reference.root', 0, 0, arguments.length);\r\n        var ref = this;\r\n        while (ref.getParent() !== null) {\r\n            ref = ref.getParent();\r\n        }\r\n        return ref;\r\n    };\r\n    /** @return {!Database} */\r\n    Reference.prototype.databaseProp = function () {\r\n        return this.repo.database;\r\n    };\r\n    /**\r\n     * @param {*} newVal\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!Promise}\r\n     */\r\n    Reference.prototype.set = function (newVal, onComplete) {\r\n        validateArgCount('Reference.set', 1, 2, arguments.length);\r\n        validateWritablePath('Reference.set', this.path);\r\n        validateFirebaseDataArg('Reference.set', 1, newVal, this.path, false);\r\n        validateCallback('Reference.set', 2, onComplete, true);\r\n        var deferred = new Deferred();\r\n        this.repo.setWithPriority(this.path, newVal, \r\n        /*priority=*/ null, deferred.wrapCallback(onComplete));\r\n        return deferred.promise;\r\n    };\r\n    /**\r\n     * @param {!Object} objectToMerge\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!Promise}\r\n     */\r\n    Reference.prototype.update = function (objectToMerge, onComplete) {\r\n        validateArgCount('Reference.update', 1, 2, arguments.length);\r\n        validateWritablePath('Reference.update', this.path);\r\n        if (Array.isArray(objectToMerge)) {\r\n            var newObjectToMerge = {};\r\n            for (var i = 0; i < objectToMerge.length; ++i) {\r\n                newObjectToMerge['' + i] = objectToMerge[i];\r\n            }\r\n            objectToMerge = newObjectToMerge;\r\n            warn('Passing an Array to Firebase.update() is deprecated. ' +\r\n                'Use set() if you want to overwrite the existing data, or ' +\r\n                'an Object with integer keys if you really do want to ' +\r\n                'only update some of the children.');\r\n        }\r\n        validateFirebaseMergeDataArg('Reference.update', 1, objectToMerge, this.path, false);\r\n        validateCallback('Reference.update', 2, onComplete, true);\r\n        var deferred = new Deferred();\r\n        this.repo.update(this.path, objectToMerge, deferred.wrapCallback(onComplete));\r\n        return deferred.promise;\r\n    };\r\n    /**\r\n     * @param {*} newVal\r\n     * @param {string|number|null} newPriority\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!Promise}\r\n     */\r\n    Reference.prototype.setWithPriority = function (newVal, newPriority, onComplete) {\r\n        validateArgCount('Reference.setWithPriority', 2, 3, arguments.length);\r\n        validateWritablePath('Reference.setWithPriority', this.path);\r\n        validateFirebaseDataArg('Reference.setWithPriority', 1, newVal, this.path, false);\r\n        validatePriority('Reference.setWithPriority', 2, newPriority, false);\r\n        validateCallback('Reference.setWithPriority', 3, onComplete, true);\r\n        if (this.getKey() === '.length' || this.getKey() === '.keys')\r\n            throw 'Reference.setWithPriority failed: ' +\r\n                this.getKey() +\r\n                ' is a read-only object.';\r\n        var deferred = new Deferred();\r\n        this.repo.setWithPriority(this.path, newVal, newPriority, deferred.wrapCallback(onComplete));\r\n        return deferred.promise;\r\n    };\r\n    /**\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!Promise}\r\n     */\r\n    Reference.prototype.remove = function (onComplete) {\r\n        validateArgCount('Reference.remove', 0, 1, arguments.length);\r\n        validateWritablePath('Reference.remove', this.path);\r\n        validateCallback('Reference.remove', 1, onComplete, true);\r\n        return this.set(null, onComplete);\r\n    };\r\n    /**\r\n     * @param {function(*):*} transactionUpdate\r\n     * @param {(function(?Error, boolean, ?DataSnapshot))=} onComplete\r\n     * @param {boolean=} applyLocally\r\n     * @return {!Promise}\r\n     */\r\n    Reference.prototype.transaction = function (transactionUpdate, onComplete, applyLocally) {\r\n        validateArgCount('Reference.transaction', 1, 3, arguments.length);\r\n        validateWritablePath('Reference.transaction', this.path);\r\n        validateCallback('Reference.transaction', 1, transactionUpdate, false);\r\n        validateCallback('Reference.transaction', 2, onComplete, true);\r\n        // NOTE: applyLocally is an internal-only option for now.  We need to decide if we want to keep it and how\r\n        // to expose it.\r\n        validateBoolean('Reference.transaction', 3, applyLocally, true);\r\n        if (this.getKey() === '.length' || this.getKey() === '.keys')\r\n            throw 'Reference.transaction failed: ' +\r\n                this.getKey() +\r\n                ' is a read-only object.';\r\n        if (applyLocally === undefined)\r\n            applyLocally = true;\r\n        var deferred = new Deferred();\r\n        if (typeof onComplete === 'function') {\r\n            deferred.promise.catch(function () { });\r\n        }\r\n        var promiseComplete = function (error$$1, committed, snapshot) {\r\n            if (error$$1) {\r\n                deferred.reject(error$$1);\r\n            }\r\n            else {\r\n                deferred.resolve(new TransactionResult(committed, snapshot));\r\n            }\r\n            if (typeof onComplete === 'function') {\r\n                onComplete(error$$1, committed, snapshot);\r\n            }\r\n        };\r\n        this.repo.startTransaction(this.path, transactionUpdate, promiseComplete, applyLocally);\r\n        return deferred.promise;\r\n    };\r\n    /**\r\n     * @param {string|number|null} priority\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!Promise}\r\n     */\r\n    Reference.prototype.setPriority = function (priority, onComplete) {\r\n        validateArgCount('Reference.setPriority', 1, 2, arguments.length);\r\n        validateWritablePath('Reference.setPriority', this.path);\r\n        validatePriority('Reference.setPriority', 1, priority, false);\r\n        validateCallback('Reference.setPriority', 2, onComplete, true);\r\n        var deferred = new Deferred();\r\n        this.repo.setWithPriority(this.path.child('.priority'), priority, null, deferred.wrapCallback(onComplete));\r\n        return deferred.promise;\r\n    };\r\n    /**\r\n     * @param {*=} value\r\n     * @param {function(?Error)=} onComplete\r\n     * @return {!Reference}\r\n     */\r\n    Reference.prototype.push = function (value, onComplete) {\r\n        validateArgCount('Reference.push', 0, 2, arguments.length);\r\n        validateWritablePath('Reference.push', this.path);\r\n        validateFirebaseDataArg('Reference.push', 1, value, this.path, true);\r\n        validateCallback('Reference.push', 2, onComplete, true);\r\n        var now = this.repo.serverTime();\r\n        var name = nextPushId(now);\r\n        // push() returns a ThennableReference whose promise is fulfilled with a regular Reference.\r\n        // We use child() to create handles to two different references. The first is turned into a\r\n        // ThennableReference below by adding then() and catch() methods and is used as the\r\n        // return value of push(). The second remains a regular Reference and is used as the fulfilled\r\n        // value of the first ThennableReference.\r\n        var thennablePushRef = this.child(name);\r\n        var pushRef = this.child(name);\r\n        var promise;\r\n        if (value != null) {\r\n            promise = thennablePushRef.set(value, onComplete).then(function () { return pushRef; });\r\n        }\r\n        else {\r\n            promise = Promise.resolve(pushRef);\r\n        }\r\n        thennablePushRef.then = promise.then.bind(promise);\r\n        thennablePushRef.catch = promise.then.bind(promise, undefined);\r\n        if (typeof onComplete === 'function') {\r\n            promise.catch(function () { });\r\n        }\r\n        return thennablePushRef;\r\n    };\r\n    /**\r\n     * @return {!OnDisconnect}\r\n     */\r\n    Reference.prototype.onDisconnect = function () {\r\n        validateWritablePath('Reference.onDisconnect', this.path);\r\n        return new OnDisconnect(this.repo, this.path);\r\n    };\r\n    Object.defineProperty(Reference.prototype, \"database\", {\r\n        get: function () {\r\n            return this.databaseProp();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"key\", {\r\n        get: function () {\r\n            return this.getKey();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"parent\", {\r\n        get: function () {\r\n            return this.getParent();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"root\", {\r\n        get: function () {\r\n            return this.getRoot();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return Reference;\r\n}(Query));\r\n/**\r\n * Define reference constructor in various modules\r\n *\r\n * We are doing this here to avoid several circular\r\n * dependency issues\r\n */\r\nQuery.__referenceConstructor = Reference;\r\nSyncPoint.__referenceConstructor = Reference;\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Node in a Tree.\r\n */\r\nvar TreeNode = /** @class */ (function () {\r\n    function TreeNode() {\r\n        // TODO: Consider making accessors that create children and value lazily or\r\n        // separate Internal / Leaf 'types'.\r\n        this.children = {};\r\n        this.childCount = 0;\r\n        this.value = null;\r\n    }\r\n    return TreeNode;\r\n}());\r\n/**\r\n * A light-weight tree, traversable by path.  Nodes can have both values and children.\r\n * Nodes are not enumerated (by forEachChild) unless they have a value or non-empty\r\n * children.\r\n */\r\nvar Tree = /** @class */ (function () {\r\n    /**\r\n     * @template T\r\n     * @param {string=} name_ Optional name of the node.\r\n     * @param {Tree=} parent_ Optional parent node.\r\n     * @param {TreeNode=} node_ Optional node to wrap.\r\n     */\r\n    function Tree(name_, parent_, node_) {\r\n        if (name_ === void 0) { name_ = ''; }\r\n        if (parent_ === void 0) { parent_ = null; }\r\n        if (node_ === void 0) { node_ = new TreeNode(); }\r\n        this.name_ = name_;\r\n        this.parent_ = parent_;\r\n        this.node_ = node_;\r\n    }\r\n    /**\r\n     * Returns a sub-Tree for the given path.\r\n     *\r\n     * @param {!(string|Path)} pathObj Path to look up.\r\n     * @return {!Tree.<T>} Tree for path.\r\n     */\r\n    Tree.prototype.subTree = function (pathObj) {\r\n        // TODO: Require pathObj to be Path?\r\n        var path = pathObj instanceof Path ? pathObj : new Path(pathObj);\r\n        var child = this, next;\r\n        while ((next = path.getFront()) !== null) {\r\n            var childNode = safeGet(child.node_.children, next) || new TreeNode();\r\n            child = new Tree(next, child, childNode);\r\n            path = path.popFront();\r\n        }\r\n        return child;\r\n    };\r\n    /**\r\n     * Returns the data associated with this tree node.\r\n     *\r\n     * @return {?T} The data or null if no data exists.\r\n     */\r\n    Tree.prototype.getValue = function () {\r\n        return this.node_.value;\r\n    };\r\n    /**\r\n     * Sets data to this tree node.\r\n     *\r\n     * @param {!T} value Value to set.\r\n     */\r\n    Tree.prototype.setValue = function (value) {\r\n        assert(typeof value !== 'undefined', 'Cannot set value to undefined');\r\n        this.node_.value = value;\r\n        this.updateParents_();\r\n    };\r\n    /**\r\n     * Clears the contents of the tree node (its value and all children).\r\n     */\r\n    Tree.prototype.clear = function () {\r\n        this.node_.value = null;\r\n        this.node_.children = {};\r\n        this.node_.childCount = 0;\r\n        this.updateParents_();\r\n    };\r\n    /**\r\n     * @return {boolean} Whether the tree has any children.\r\n     */\r\n    Tree.prototype.hasChildren = function () {\r\n        return this.node_.childCount > 0;\r\n    };\r\n    /**\r\n     * @return {boolean} Whether the tree is empty (no value or children).\r\n     */\r\n    Tree.prototype.isEmpty = function () {\r\n        return this.getValue() === null && !this.hasChildren();\r\n    };\r\n    /**\r\n     * Calls action for each child of this tree node.\r\n     *\r\n     * @param {function(!Tree.<T>)} action Action to be called for each child.\r\n     */\r\n    Tree.prototype.forEachChild = function (action) {\r\n        var _this = this;\r\n        forEach(this.node_.children, function (child, childTree) {\r\n            action(new Tree(child, _this, childTree));\r\n        });\r\n    };\r\n    /**\r\n     * Does a depth-first traversal of this node's descendants, calling action for each one.\r\n     *\r\n     * @param {function(!Tree.<T>)} action Action to be called for each child.\r\n     * @param {boolean=} includeSelf Whether to call action on this node as well. Defaults to\r\n     *   false.\r\n     * @param {boolean=} childrenFirst Whether to call action on children before calling it on\r\n     *   parent.\r\n     */\r\n    Tree.prototype.forEachDescendant = function (action, includeSelf, childrenFirst) {\r\n        if (includeSelf && !childrenFirst)\r\n            action(this);\r\n        this.forEachChild(function (child) {\r\n            child.forEachDescendant(action, /*includeSelf=*/ true, childrenFirst);\r\n        });\r\n        if (includeSelf && childrenFirst)\r\n            action(this);\r\n    };\r\n    /**\r\n     * Calls action on each ancestor node.\r\n     *\r\n     * @param {function(!Tree.<T>)} action Action to be called on each parent; return\r\n     *   true to abort.\r\n     * @param {boolean=} includeSelf Whether to call action on this node as well.\r\n     * @return {boolean} true if the action callback returned true.\r\n     */\r\n    Tree.prototype.forEachAncestor = function (action, includeSelf) {\r\n        var node = includeSelf ? this : this.parent();\r\n        while (node !== null) {\r\n            if (action(node)) {\r\n                return true;\r\n            }\r\n            node = node.parent();\r\n        }\r\n        return false;\r\n    };\r\n    /**\r\n     * Does a depth-first traversal of this node's descendants.  When a descendant with a value\r\n     * is found, action is called on it and traversal does not continue inside the node.\r\n     * Action is *not* called on this node.\r\n     *\r\n     * @param {function(!Tree.<T>)} action Action to be called for each child.\r\n     */\r\n    Tree.prototype.forEachImmediateDescendantWithValue = function (action) {\r\n        this.forEachChild(function (child) {\r\n            if (child.getValue() !== null)\r\n                action(child);\r\n            else\r\n                child.forEachImmediateDescendantWithValue(action);\r\n        });\r\n    };\r\n    /**\r\n     * @return {!Path} The path of this tree node, as a Path.\r\n     */\r\n    Tree.prototype.path = function () {\r\n        return new Path(this.parent_ === null\r\n            ? this.name_\r\n            : this.parent_.path() + '/' + this.name_);\r\n    };\r\n    /**\r\n     * @return {string} The name of the tree node.\r\n     */\r\n    Tree.prototype.name = function () {\r\n        return this.name_;\r\n    };\r\n    /**\r\n     * @return {?Tree} The parent tree node, or null if this is the root of the tree.\r\n     */\r\n    Tree.prototype.parent = function () {\r\n        return this.parent_;\r\n    };\r\n    /**\r\n     * Adds or removes this child from its parent based on whether it's empty or not.\r\n     *\r\n     * @private\r\n     */\r\n    Tree.prototype.updateParents_ = function () {\r\n        if (this.parent_ !== null)\r\n            this.parent_.updateChild_(this.name_, this);\r\n    };\r\n    /**\r\n     * Adds or removes the passed child to this tree node, depending on whether it's empty.\r\n     *\r\n     * @param {string} childName The name of the child to update.\r\n     * @param {!Tree.<T>} child The child to update.\r\n     * @private\r\n     */\r\n    Tree.prototype.updateChild_ = function (childName, child) {\r\n        var childEmpty = child.isEmpty();\r\n        var childExists = contains(this.node_.children, childName);\r\n        if (childEmpty && childExists) {\r\n            delete this.node_.children[childName];\r\n            this.node_.childCount--;\r\n            this.updateParents_();\r\n        }\r\n        else if (!childEmpty && !childExists) {\r\n            this.node_.children[childName] = child.node_;\r\n            this.node_.childCount++;\r\n            this.updateParents_();\r\n        }\r\n    };\r\n    return Tree;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// TODO: This is pretty messy.  Ideally, a lot of this would move into FirebaseData, or a transaction-specific\r\n// component used by FirebaseData, but it has ties to user callbacks (transaction update and onComplete) as well\r\n// as the realtime connection (to send transactions to the server).  So that all needs to be decoupled first.\r\n// For now it's part of Repo, but in its own file.\r\n/**\r\n * @enum {number}\r\n */\r\nvar TransactionStatus;\r\n(function (TransactionStatus) {\r\n    // We've run the transaction and updated transactionResultData_ with the result, but it isn't currently sent to the\r\n    // server. A transaction will go from RUN -> SENT -> RUN if it comes back from the server as rejected due to\r\n    // mismatched hash.\r\n    TransactionStatus[TransactionStatus[\"RUN\"] = 0] = \"RUN\";\r\n    // We've run the transaction and sent it to the server and it's currently outstanding (hasn't come back as accepted\r\n    // or rejected yet).\r\n    TransactionStatus[TransactionStatus[\"SENT\"] = 1] = \"SENT\";\r\n    // Temporary state used to mark completed transactions (whether successful or aborted).  The transaction will be\r\n    // removed when we get a chance to prune completed ones.\r\n    TransactionStatus[TransactionStatus[\"COMPLETED\"] = 2] = \"COMPLETED\";\r\n    // Used when an already-sent transaction needs to be aborted (e.g. due to a conflicting set() call that was made).\r\n    // If it comes back as unsuccessful, we'll abort it.\r\n    TransactionStatus[TransactionStatus[\"SENT_NEEDS_ABORT\"] = 3] = \"SENT_NEEDS_ABORT\";\r\n    // Temporary state used to mark transactions that need to be aborted.\r\n    TransactionStatus[TransactionStatus[\"NEEDS_ABORT\"] = 4] = \"NEEDS_ABORT\";\r\n})(TransactionStatus || (TransactionStatus = {}));\r\n/**\r\n * If a transaction does not succeed after 25 retries, we abort it.  Among other things this ensure that if there's\r\n * ever a bug causing a mismatch between client / server hashes for some data, we won't retry indefinitely.\r\n * @type {number}\r\n * @const\r\n * @private\r\n */\r\nRepo.MAX_TRANSACTION_RETRIES_ = 25;\r\n/**\r\n * Setup the transaction data structures\r\n * @private\r\n */\r\nRepo.prototype.transactions_init_ = function () {\r\n    /**\r\n     * Stores queues of outstanding transactions for Firebase locations.\r\n     *\r\n     * @type {!Tree.<Array.<!Transaction>>}\r\n     * @private\r\n     */\r\n    this.transactionQueueTree_ = new Tree();\r\n};\r\n/**\r\n * Creates a new transaction, adds it to the transactions we're tracking, and sends it to the server if possible.\r\n *\r\n * @param {!Path} path Path at which to do transaction.\r\n * @param {function(*):*} transactionUpdate Update callback.\r\n * @param {?function(?Error, boolean, ?DataSnapshot)} onComplete Completion callback.\r\n * @param {boolean} applyLocally Whether or not to make intermediate results visible\r\n */\r\nRepo.prototype.startTransaction = function (path, transactionUpdate, onComplete, applyLocally) {\r\n    this.log_('transaction on ' + path);\r\n    // Add a watch to make sure we get server updates.\r\n    var valueCallback = function () { };\r\n    var watchRef = new Reference(this, path);\r\n    watchRef.on('value', valueCallback);\r\n    var unwatcher = function () {\r\n        watchRef.off('value', valueCallback);\r\n    };\r\n    // Initialize transaction.\r\n    var transaction = {\r\n        path: path,\r\n        update: transactionUpdate,\r\n        onComplete: onComplete,\r\n        // One of TransactionStatus enums.\r\n        status: null,\r\n        // Used when combining transactions at different locations to figure out which one goes first.\r\n        order: LUIDGenerator(),\r\n        // Whether to raise local events for this transaction.\r\n        applyLocally: applyLocally,\r\n        // Count of how many times we've retried the transaction.\r\n        retryCount: 0,\r\n        // Function to call to clean up our .on() listener.\r\n        unwatcher: unwatcher,\r\n        // Stores why a transaction was aborted.\r\n        abortReason: null,\r\n        currentWriteId: null,\r\n        currentInputSnapshot: null,\r\n        currentOutputSnapshotRaw: null,\r\n        currentOutputSnapshotResolved: null\r\n    };\r\n    // Run transaction initially.\r\n    var currentState = this.getLatestState_(path);\r\n    transaction.currentInputSnapshot = currentState;\r\n    var newVal = transaction.update(currentState.val());\r\n    if (newVal === undefined) {\r\n        // Abort transaction.\r\n        transaction.unwatcher();\r\n        transaction.currentOutputSnapshotRaw = null;\r\n        transaction.currentOutputSnapshotResolved = null;\r\n        if (transaction.onComplete) {\r\n            // We just set the input snapshot, so this cast should be safe\r\n            var snapshot = new DataSnapshot(transaction.currentInputSnapshot, new Reference(this, transaction.path), PRIORITY_INDEX);\r\n            transaction.onComplete(null, false, snapshot);\r\n        }\r\n    }\r\n    else {\r\n        validateFirebaseData('transaction failed: Data returned ', newVal, transaction.path);\r\n        // Mark as run and add to our queue.\r\n        transaction.status = TransactionStatus.RUN;\r\n        var queueNode = this.transactionQueueTree_.subTree(path);\r\n        var nodeQueue = queueNode.getValue() || [];\r\n        nodeQueue.push(transaction);\r\n        queueNode.setValue(nodeQueue);\r\n        // Update visibleData and raise events\r\n        // Note: We intentionally raise events after updating all of our transaction state, since the user could\r\n        // start new transactions from the event callbacks.\r\n        var priorityForNode = void 0;\r\n        if (typeof newVal === 'object' &&\r\n            newVal !== null &&\r\n            contains(newVal, '.priority')) {\r\n            priorityForNode = safeGet(newVal, '.priority');\r\n            assert(isValidPriority(priorityForNode), 'Invalid priority returned by transaction. ' +\r\n                'Priority must be a valid string, finite number, server value, or null.');\r\n        }\r\n        else {\r\n            var currentNode = this.serverSyncTree_.calcCompleteEventCache(path) ||\r\n                ChildrenNode.EMPTY_NODE;\r\n            priorityForNode = currentNode.getPriority().val();\r\n        }\r\n        priorityForNode /** @type {null|number|string} */ = priorityForNode;\r\n        var serverValues = this.generateServerValues();\r\n        var newNodeUnresolved = nodeFromJSON$1(newVal, priorityForNode);\r\n        var newNode = resolveDeferredValueSnapshot(newNodeUnresolved, serverValues);\r\n        transaction.currentOutputSnapshotRaw = newNodeUnresolved;\r\n        transaction.currentOutputSnapshotResolved = newNode;\r\n        transaction.currentWriteId = this.getNextWriteId_();\r\n        var events = this.serverSyncTree_.applyUserOverwrite(path, newNode, transaction.currentWriteId, transaction.applyLocally);\r\n        this.eventQueue_.raiseEventsForChangedPath(path, events);\r\n        this.sendReadyTransactions_();\r\n    }\r\n};\r\n/**\r\n * @param {!Path} path\r\n * @param {Array.<number>=} excludeSets A specific set to exclude\r\n * @return {Node}\r\n * @private\r\n */\r\nRepo.prototype.getLatestState_ = function (path, excludeSets) {\r\n    return (this.serverSyncTree_.calcCompleteEventCache(path, excludeSets) ||\r\n        ChildrenNode.EMPTY_NODE);\r\n};\r\n/**\r\n * Sends any already-run transactions that aren't waiting for outstanding transactions to\r\n * complete.\r\n *\r\n * Externally it's called with no arguments, but it calls itself recursively with a particular\r\n * transactionQueueTree node to recurse through the tree.\r\n *\r\n * @param {Tree.<Array.<Transaction>>=} node  transactionQueueTree node to start at.\r\n * @private\r\n */\r\nRepo.prototype.sendReadyTransactions_ = function (node) {\r\n    var _this = this;\r\n    if (node === void 0) { node = this.transactionQueueTree_; }\r\n    // Before recursing, make sure any completed transactions are removed.\r\n    if (!node) {\r\n        this.pruneCompletedTransactionsBelowNode_(node);\r\n    }\r\n    if (node.getValue() !== null) {\r\n        var queue = this.buildTransactionQueue_(node);\r\n        assert(queue.length > 0, 'Sending zero length transaction queue');\r\n        var allRun = queue.every(function (transaction) { return transaction.status === TransactionStatus.RUN; });\r\n        // If they're all run (and not sent), we can send them.  Else, we must wait.\r\n        if (allRun) {\r\n            this.sendTransactionQueue_(node.path(), queue);\r\n        }\r\n    }\r\n    else if (node.hasChildren()) {\r\n        node.forEachChild(function (childNode) {\r\n            _this.sendReadyTransactions_(childNode);\r\n        });\r\n    }\r\n};\r\n/**\r\n * Given a list of run transactions, send them to the server and then handle the result (success or failure).\r\n *\r\n * @param {!Path} path The location of the queue.\r\n * @param {!Array.<Transaction>} queue Queue of transactions under the specified location.\r\n * @private\r\n */\r\nRepo.prototype.sendTransactionQueue_ = function (path, queue) {\r\n    var _this = this;\r\n    // Mark transactions as sent and increment retry count!\r\n    var setsToIgnore = queue.map(function (txn) {\r\n        return txn.currentWriteId;\r\n    });\r\n    var latestState = this.getLatestState_(path, setsToIgnore);\r\n    var snapToSend = latestState;\r\n    var latestHash = latestState.hash();\r\n    for (var i = 0; i < queue.length; i++) {\r\n        var txn = queue[i];\r\n        assert(txn.status === TransactionStatus.RUN, 'tryToSendTransactionQueue_: items in queue should all be run.');\r\n        txn.status = TransactionStatus.SENT;\r\n        txn.retryCount++;\r\n        var relativePath = Path.relativePath(path, txn.path);\r\n        // If we've gotten to this point, the output snapshot must be defined.\r\n        snapToSend = snapToSend.updateChild(relativePath /**@type {!Node} */, txn.currentOutputSnapshotRaw);\r\n    }\r\n    var dataToSend = snapToSend.val(true);\r\n    var pathToSend = path;\r\n    // Send the put.\r\n    this.server_.put(pathToSend.toString(), dataToSend, function (status) {\r\n        _this.log_('transaction put response', {\r\n            path: pathToSend.toString(),\r\n            status: status\r\n        });\r\n        var events = [];\r\n        if (status === 'ok') {\r\n            // Queue up the callbacks and fire them after cleaning up all of our transaction state, since\r\n            // the callback could trigger more transactions or sets.\r\n            var callbacks = [];\r\n            for (var i = 0; i < queue.length; i++) {\r\n                queue[i].status = TransactionStatus.COMPLETED;\r\n                events = events.concat(_this.serverSyncTree_.ackUserWrite(queue[i].currentWriteId));\r\n                if (queue[i].onComplete) {\r\n                    // We never unset the output snapshot, and given that this transaction is complete, it should be set\r\n                    var node = queue[i].currentOutputSnapshotResolved;\r\n                    var ref = new Reference(_this, queue[i].path);\r\n                    var snapshot = new DataSnapshot(node, ref, PRIORITY_INDEX);\r\n                    callbacks.push(queue[i].onComplete.bind(null, null, true, snapshot));\r\n                }\r\n                queue[i].unwatcher();\r\n            }\r\n            // Now remove the completed transactions.\r\n            _this.pruneCompletedTransactionsBelowNode_(_this.transactionQueueTree_.subTree(path));\r\n            // There may be pending transactions that we can now send.\r\n            _this.sendReadyTransactions_();\r\n            _this.eventQueue_.raiseEventsForChangedPath(path, events);\r\n            // Finally, trigger onComplete callbacks.\r\n            for (var i = 0; i < callbacks.length; i++) {\r\n                exceptionGuard(callbacks[i]);\r\n            }\r\n        }\r\n        else {\r\n            // transactions are no longer sent.  Update their status appropriately.\r\n            if (status === 'datastale') {\r\n                for (var i = 0; i < queue.length; i++) {\r\n                    if (queue[i].status === TransactionStatus.SENT_NEEDS_ABORT)\r\n                        queue[i].status = TransactionStatus.NEEDS_ABORT;\r\n                    else\r\n                        queue[i].status = TransactionStatus.RUN;\r\n                }\r\n            }\r\n            else {\r\n                warn('transaction at ' + pathToSend.toString() + ' failed: ' + status);\r\n                for (var i = 0; i < queue.length; i++) {\r\n                    queue[i].status = TransactionStatus.NEEDS_ABORT;\r\n                    queue[i].abortReason = status;\r\n                }\r\n            }\r\n            _this.rerunTransactions_(path);\r\n        }\r\n    }, latestHash);\r\n};\r\n/**\r\n * Finds all transactions dependent on the data at changedPath and reruns them.\r\n *\r\n * Should be called any time cached data changes.\r\n *\r\n * Return the highest path that was affected by rerunning transactions.  This is the path at which events need to\r\n * be raised for.\r\n *\r\n * @param {!Path} changedPath The path in mergedData that changed.\r\n * @return {!Path} The rootmost path that was affected by rerunning transactions.\r\n * @private\r\n */\r\nRepo.prototype.rerunTransactions_ = function (changedPath) {\r\n    var rootMostTransactionNode = this.getAncestorTransactionNode_(changedPath);\r\n    var path = rootMostTransactionNode.path();\r\n    var queue = this.buildTransactionQueue_(rootMostTransactionNode);\r\n    this.rerunTransactionQueue_(queue, path);\r\n    return path;\r\n};\r\n/**\r\n * Does all the work of rerunning transactions (as well as cleans up aborted transactions and whatnot).\r\n *\r\n * @param {Array.<Transaction>} queue The queue of transactions to run.\r\n * @param {!Path} path The path the queue is for.\r\n * @private\r\n */\r\nRepo.prototype.rerunTransactionQueue_ = function (queue, path) {\r\n    if (queue.length === 0) {\r\n        return; // Nothing to do!\r\n    }\r\n    // Queue up the callbacks and fire them after cleaning up all of our transaction state, since\r\n    // the callback could trigger more transactions or sets.\r\n    var callbacks = [];\r\n    var events = [];\r\n    // Ignore all of the sets we're going to re-run.\r\n    var txnsToRerun = queue.filter(function (q) {\r\n        return q.status === TransactionStatus.RUN;\r\n    });\r\n    var setsToIgnore = txnsToRerun.map(function (q) {\r\n        return q.currentWriteId;\r\n    });\r\n    for (var i = 0; i < queue.length; i++) {\r\n        var transaction = queue[i];\r\n        var relativePath = Path.relativePath(path, transaction.path);\r\n        var abortTransaction = false, abortReason = void 0;\r\n        assert(relativePath !== null, 'rerunTransactionsUnderNode_: relativePath should not be null.');\r\n        if (transaction.status === TransactionStatus.NEEDS_ABORT) {\r\n            abortTransaction = true;\r\n            abortReason = transaction.abortReason;\r\n            events = events.concat(this.serverSyncTree_.ackUserWrite(transaction.currentWriteId, true));\r\n        }\r\n        else if (transaction.status === TransactionStatus.RUN) {\r\n            if (transaction.retryCount >= Repo.MAX_TRANSACTION_RETRIES_) {\r\n                abortTransaction = true;\r\n                abortReason = 'maxretry';\r\n                events = events.concat(this.serverSyncTree_.ackUserWrite(transaction.currentWriteId, true));\r\n            }\r\n            else {\r\n                // This code reruns a transaction\r\n                var currentNode = this.getLatestState_(transaction.path, setsToIgnore);\r\n                transaction.currentInputSnapshot = currentNode;\r\n                var newData = queue[i].update(currentNode.val());\r\n                if (newData !== undefined) {\r\n                    validateFirebaseData('transaction failed: Data returned ', newData, transaction.path);\r\n                    var newDataNode = nodeFromJSON$1(newData);\r\n                    var hasExplicitPriority = typeof newData === 'object' &&\r\n                        newData != null &&\r\n                        contains(newData, '.priority');\r\n                    if (!hasExplicitPriority) {\r\n                        // Keep the old priority if there wasn't a priority explicitly specified.\r\n                        newDataNode = newDataNode.updatePriority(currentNode.getPriority());\r\n                    }\r\n                    var oldWriteId = transaction.currentWriteId;\r\n                    var serverValues = this.generateServerValues();\r\n                    var newNodeResolved = resolveDeferredValueSnapshot(newDataNode, serverValues);\r\n                    transaction.currentOutputSnapshotRaw = newDataNode;\r\n                    transaction.currentOutputSnapshotResolved = newNodeResolved;\r\n                    transaction.currentWriteId = this.getNextWriteId_();\r\n                    // Mutates setsToIgnore in place\r\n                    setsToIgnore.splice(setsToIgnore.indexOf(oldWriteId), 1);\r\n                    events = events.concat(this.serverSyncTree_.applyUserOverwrite(transaction.path, newNodeResolved, transaction.currentWriteId, transaction.applyLocally));\r\n                    events = events.concat(this.serverSyncTree_.ackUserWrite(oldWriteId, true));\r\n                }\r\n                else {\r\n                    abortTransaction = true;\r\n                    abortReason = 'nodata';\r\n                    events = events.concat(this.serverSyncTree_.ackUserWrite(transaction.currentWriteId, true));\r\n                }\r\n            }\r\n        }\r\n        this.eventQueue_.raiseEventsForChangedPath(path, events);\r\n        events = [];\r\n        if (abortTransaction) {\r\n            // Abort.\r\n            queue[i].status = TransactionStatus.COMPLETED;\r\n            // Removing a listener can trigger pruning which can muck with mergedData/visibleData (as it prunes data).\r\n            // So defer the unwatcher until we're done.\r\n            (function (unwatcher) {\r\n                setTimeout(unwatcher, Math.floor(0));\r\n            })(queue[i].unwatcher);\r\n            if (queue[i].onComplete) {\r\n                if (abortReason === 'nodata') {\r\n                    var ref = new Reference(this, queue[i].path);\r\n                    // We set this field immediately, so it's safe to cast to an actual snapshot\r\n                    var lastInput /** @type {!Node} */ = queue[i].currentInputSnapshot;\r\n                    var snapshot = new DataSnapshot(lastInput, ref, PRIORITY_INDEX);\r\n                    callbacks.push(queue[i].onComplete.bind(null, null, false, snapshot));\r\n                }\r\n                else {\r\n                    callbacks.push(queue[i].onComplete.bind(null, new Error(abortReason), false, null));\r\n                }\r\n            }\r\n        }\r\n    }\r\n    // Clean up completed transactions.\r\n    this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);\r\n    // Now fire callbacks, now that we're in a good, known state.\r\n    for (var i = 0; i < callbacks.length; i++) {\r\n        exceptionGuard(callbacks[i]);\r\n    }\r\n    // Try to send the transaction result to the server.\r\n    this.sendReadyTransactions_();\r\n};\r\n/**\r\n * Returns the rootmost ancestor node of the specified path that has a pending transaction on it, or just returns\r\n * the node for the given path if there are no pending transactions on any ancestor.\r\n *\r\n * @param {!Path} path The location to start at.\r\n * @return {!Tree.<Array.<!Transaction>>} The rootmost node with a transaction.\r\n * @private\r\n */\r\nRepo.prototype.getAncestorTransactionNode_ = function (path) {\r\n    var front;\r\n    // Start at the root and walk deeper into the tree towards path until we find a node with pending transactions.\r\n    var transactionNode = this.transactionQueueTree_;\r\n    while ((front = path.getFront()) !== null &&\r\n        transactionNode.getValue() === null) {\r\n        transactionNode = transactionNode.subTree(front);\r\n        path = path.popFront();\r\n    }\r\n    return transactionNode;\r\n};\r\n/**\r\n * Builds the queue of all transactions at or below the specified transactionNode.\r\n *\r\n * @param {!Tree.<Array.<Transaction>>} transactionNode\r\n * @return {Array.<Transaction>} The generated queue.\r\n * @private\r\n */\r\nRepo.prototype.buildTransactionQueue_ = function (transactionNode) {\r\n    // Walk any child transaction queues and aggregate them into a single queue.\r\n    var transactionQueue = [];\r\n    this.aggregateTransactionQueuesForNode_(transactionNode, transactionQueue);\r\n    // Sort them by the order the transactions were created.\r\n    transactionQueue.sort(function (a, b) {\r\n        return a.order - b.order;\r\n    });\r\n    return transactionQueue;\r\n};\r\n/**\r\n * @param {!Tree.<Array.<Transaction>>} node\r\n * @param {Array.<Transaction>} queue\r\n * @private\r\n */\r\nRepo.prototype.aggregateTransactionQueuesForNode_ = function (node, queue) {\r\n    var _this = this;\r\n    var nodeQueue = node.getValue();\r\n    if (nodeQueue !== null) {\r\n        for (var i = 0; i < nodeQueue.length; i++) {\r\n            queue.push(nodeQueue[i]);\r\n        }\r\n    }\r\n    node.forEachChild(function (child) {\r\n        _this.aggregateTransactionQueuesForNode_(child, queue);\r\n    });\r\n};\r\n/**\r\n * Remove COMPLETED transactions at or below this node in the transactionQueueTree_.\r\n *\r\n * @param {!Tree.<Array.<!Transaction>>} node\r\n * @private\r\n */\r\nRepo.prototype.pruneCompletedTransactionsBelowNode_ = function (node) {\r\n    var _this = this;\r\n    var queue = node.getValue();\r\n    if (queue) {\r\n        var to = 0;\r\n        for (var from = 0; from < queue.length; from++) {\r\n            if (queue[from].status !== TransactionStatus.COMPLETED) {\r\n                queue[to] = queue[from];\r\n                to++;\r\n            }\r\n        }\r\n        queue.length = to;\r\n        node.setValue(queue.length > 0 ? queue : null);\r\n    }\r\n    node.forEachChild(function (childNode) {\r\n        _this.pruneCompletedTransactionsBelowNode_(childNode);\r\n    });\r\n};\r\n/**\r\n * Aborts all transactions on ancestors or descendants of the specified path.  Called when doing a set() or update()\r\n * since we consider them incompatible with transactions.\r\n *\r\n * @param {!Path} path Path for which we want to abort related transactions.\r\n * @return {!Path}\r\n * @private\r\n */\r\nRepo.prototype.abortTransactions_ = function (path) {\r\n    var _this = this;\r\n    var affectedPath = this.getAncestorTransactionNode_(path).path();\r\n    var transactionNode = this.transactionQueueTree_.subTree(path);\r\n    transactionNode.forEachAncestor(function (node) {\r\n        _this.abortTransactionsOnNode_(node);\r\n    });\r\n    this.abortTransactionsOnNode_(transactionNode);\r\n    transactionNode.forEachDescendant(function (node) {\r\n        _this.abortTransactionsOnNode_(node);\r\n    });\r\n    return affectedPath;\r\n};\r\n/**\r\n * Abort transactions stored in this transaction queue node.\r\n *\r\n * @param {!Tree.<Array.<Transaction>>} node Node to abort transactions for.\r\n * @private\r\n */\r\nRepo.prototype.abortTransactionsOnNode_ = function (node) {\r\n    var queue = node.getValue();\r\n    if (queue !== null) {\r\n        // Queue up the callbacks and fire them after cleaning up all of our transaction state, since\r\n        // the callback could trigger more transactions or sets.\r\n        var callbacks = [];\r\n        // Go through queue.  Any already-sent transactions must be marked for abort, while the unsent ones\r\n        // can be immediately aborted and removed.\r\n        var events = [];\r\n        var lastSent = -1;\r\n        for (var i = 0; i < queue.length; i++) {\r\n            if (queue[i].status === TransactionStatus.SENT_NEEDS_ABORT) {\r\n                // Already marked.  No action needed.\r\n            }\r\n            else if (queue[i].status === TransactionStatus.SENT) {\r\n                assert(lastSent === i - 1, 'All SENT items should be at beginning of queue.');\r\n                lastSent = i;\r\n                // Mark transaction for abort when it comes back.\r\n                queue[i].status = TransactionStatus.SENT_NEEDS_ABORT;\r\n                queue[i].abortReason = 'set';\r\n            }\r\n            else {\r\n                assert(queue[i].status === TransactionStatus.RUN, 'Unexpected transaction status in abort');\r\n                // We can abort it immediately.\r\n                queue[i].unwatcher();\r\n                events = events.concat(this.serverSyncTree_.ackUserWrite(queue[i].currentWriteId, true));\r\n                if (queue[i].onComplete) {\r\n                    var snapshot = null;\r\n                    callbacks.push(queue[i].onComplete.bind(null, new Error('set'), false, snapshot));\r\n                }\r\n            }\r\n        }\r\n        if (lastSent === -1) {\r\n            // We're not waiting for any sent transactions.  We can clear the queue.\r\n            node.setValue(null);\r\n        }\r\n        else {\r\n            // Remove the transactions we aborted.\r\n            queue.length = lastSent + 1;\r\n        }\r\n        // Now fire the callbacks.\r\n        this.eventQueue_.raiseEventsForChangedPath(node.path(), events);\r\n        for (var i = 0; i < callbacks.length; i++) {\r\n            exceptionGuard(callbacks[i]);\r\n        }\r\n    }\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** @const {string} */\r\nvar DATABASE_URL_OPTION = 'databaseURL';\r\nvar _staticInstance;\r\n/**\r\n * Creates and caches Repo instances.\r\n */\r\nvar RepoManager = /** @class */ (function () {\r\n    function RepoManager() {\r\n        /**\r\n         * @private {!Object.<string, Object<string, !fb.core.Repo>>}\r\n         */\r\n        this.repos_ = {};\r\n        /**\r\n         * If true, new Repos will be created to use ReadonlyRestClient (for testing purposes).\r\n         * @private {boolean}\r\n         */\r\n        this.useRestClient_ = false;\r\n    }\r\n    RepoManager.getInstance = function () {\r\n        if (!_staticInstance) {\r\n            _staticInstance = new RepoManager();\r\n        }\r\n        return _staticInstance;\r\n    };\r\n    // TODO(koss): Remove these functions unless used in tests?\r\n    RepoManager.prototype.interrupt = function () {\r\n        for (var appName in this.repos_) {\r\n            for (var dbUrl in this.repos_[appName]) {\r\n                this.repos_[appName][dbUrl].interrupt();\r\n            }\r\n        }\r\n    };\r\n    RepoManager.prototype.resume = function () {\r\n        for (var appName in this.repos_) {\r\n            for (var dbUrl in this.repos_[appName]) {\r\n                this.repos_[appName][dbUrl].resume();\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * This function should only ever be called to CREATE a new database instance.\r\n     *\r\n     * @param {!FirebaseApp} app\r\n     * @return {!Database}\r\n     */\r\n    RepoManager.prototype.databaseFromApp = function (app, url) {\r\n        var dbUrl = url || app.options[DATABASE_URL_OPTION];\r\n        if (dbUrl === undefined) {\r\n            fatal(\"Can't determine Firebase Database URL.  Be sure to include \" +\r\n                DATABASE_URL_OPTION +\r\n                ' option when calling firebase.initializeApp().');\r\n        }\r\n        var parsedUrl = parseRepoInfo(dbUrl);\r\n        var repoInfo = parsedUrl.repoInfo;\r\n        validateUrl('Invalid Firebase Database URL', 1, parsedUrl);\r\n        if (!parsedUrl.path.isEmpty()) {\r\n            fatal('Database URL must point to the root of a Firebase Database ' +\r\n                '(not including a child path).');\r\n        }\r\n        var repo = this.createRepo(repoInfo, app);\r\n        return repo.database;\r\n    };\r\n    /**\r\n     * Remove the repo and make sure it is disconnected.\r\n     *\r\n     * @param {!Repo} repo\r\n     */\r\n    RepoManager.prototype.deleteRepo = function (repo) {\r\n        var appRepos = safeGet(this.repos_, repo.app.name);\r\n        // This should never happen...\r\n        if (!appRepos || safeGet(appRepos, repo.repoInfo_.toURLString()) !== repo) {\r\n            fatal(\"Database \" + repo.app.name + \"(\" + repo.repoInfo_ + \") has already been deleted.\");\r\n        }\r\n        repo.interrupt();\r\n        delete appRepos[repo.repoInfo_.toURLString()];\r\n    };\r\n    /**\r\n     * Ensures a repo doesn't already exist and then creates one using the\r\n     * provided app.\r\n     *\r\n     * @param {!RepoInfo} repoInfo The metadata about the Repo\r\n     * @param {!FirebaseApp} app\r\n     * @return {!Repo} The Repo object for the specified server / repoName.\r\n     */\r\n    RepoManager.prototype.createRepo = function (repoInfo, app) {\r\n        var appRepos = safeGet(this.repos_, app.name);\r\n        if (!appRepos) {\r\n            appRepos = {};\r\n            this.repos_[app.name] = appRepos;\r\n        }\r\n        var repo = safeGet(appRepos, repoInfo.toURLString());\r\n        if (repo) {\r\n            fatal('Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.');\r\n        }\r\n        repo = new Repo(repoInfo, this.useRestClient_, app);\r\n        appRepos[repoInfo.toURLString()] = repo;\r\n        return repo;\r\n    };\r\n    /**\r\n     * Forces us to use ReadonlyRestClient instead of PersistentConnection for new Repos.\r\n     * @param {boolean} forceRestClient\r\n     */\r\n    RepoManager.prototype.forceRestClient = function (forceRestClient) {\r\n        this.useRestClient_ = forceRestClient;\r\n    };\r\n    return RepoManager;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Class representing a firebase database.\r\n * @implements {FirebaseService}\r\n */\r\nvar Database = /** @class */ (function () {\r\n    /**\r\n     * The constructor should not be called by users of our public API.\r\n     * @param {!Repo} repo_\r\n     */\r\n    function Database(repo_) {\r\n        this.repo_ = repo_;\r\n        if (!(repo_ instanceof Repo)) {\r\n            fatal(\"Don't call new Database() directly - please use firebase.database().\");\r\n        }\r\n        /** @type {Reference} */\r\n        this.root_ = new Reference(repo_, Path.Empty);\r\n        this.INTERNAL = new DatabaseInternals(this);\r\n    }\r\n    Object.defineProperty(Database.prototype, \"app\", {\r\n        get: function () {\r\n            return this.repo_.app;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Database.prototype.ref = function (path) {\r\n        this.checkDeleted_('ref');\r\n        validateArgCount('database.ref', 0, 1, arguments.length);\r\n        if (path instanceof Reference) {\r\n            return this.refFromURL(path.toString());\r\n        }\r\n        return path !== undefined ? this.root_.child(path) : this.root_;\r\n    };\r\n    /**\r\n     * Returns a reference to the root or the path specified in url.\r\n     * We throw a exception if the url is not in the same domain as the\r\n     * current repo.\r\n     * @param {string} url\r\n     * @return {!Reference} Firebase reference.\r\n     */\r\n    Database.prototype.refFromURL = function (url) {\r\n        /** @const {string} */\r\n        var apiName = 'database.refFromURL';\r\n        this.checkDeleted_(apiName);\r\n        validateArgCount(apiName, 1, 1, arguments.length);\r\n        var parsedURL = parseRepoInfo(url);\r\n        validateUrl(apiName, 1, parsedURL);\r\n        var repoInfo = parsedURL.repoInfo;\r\n        if (repoInfo.host !== this.repo_.repoInfo_.host) {\r\n            fatal(apiName +\r\n                ': Host name does not match the current database: ' +\r\n                '(found ' +\r\n                repoInfo.host +\r\n                ' but expected ' +\r\n                this.repo_.repoInfo_.host +\r\n                ')');\r\n        }\r\n        return this.ref(parsedURL.path.toString());\r\n    };\r\n    /**\r\n     * @param {string} apiName\r\n     */\r\n    Database.prototype.checkDeleted_ = function (apiName) {\r\n        if (this.repo_ === null) {\r\n            fatal('Cannot call ' + apiName + ' on a deleted database.');\r\n        }\r\n    };\r\n    // Make individual repo go offline.\r\n    Database.prototype.goOffline = function () {\r\n        validateArgCount('database.goOffline', 0, 0, arguments.length);\r\n        this.checkDeleted_('goOffline');\r\n        this.repo_.interrupt();\r\n    };\r\n    Database.prototype.goOnline = function () {\r\n        validateArgCount('database.goOnline', 0, 0, arguments.length);\r\n        this.checkDeleted_('goOnline');\r\n        this.repo_.resume();\r\n    };\r\n    Database.ServerValue = {\r\n        TIMESTAMP: {\r\n            '.sv': 'timestamp'\r\n        }\r\n    };\r\n    return Database;\r\n}());\r\nvar DatabaseInternals = /** @class */ (function () {\r\n    /** @param {!Database} database */\r\n    function DatabaseInternals(database) {\r\n        this.database = database;\r\n    }\r\n    /** @return {Promise<void>} */\r\n    DatabaseInternals.prototype.delete = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                this.database.checkDeleted_('delete');\r\n                RepoManager.getInstance().deleteRepo(this.database.repo_);\r\n                this.database.repo_ = null;\r\n                this.database.root_ = null;\r\n                this.database.INTERNAL = null;\r\n                this.database = null;\r\n                return [2 /*return*/];\r\n            });\r\n        });\r\n    };\r\n    return DatabaseInternals;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * INTERNAL methods for internal-use only (tests, etc.).\r\n *\r\n * Customers shouldn't use these or else should be aware that they could break at any time.\r\n *\r\n * @const\r\n */\r\nvar forceLongPolling = function () {\r\n    WebSocketConnection.forceDisallow();\r\n    BrowserPollConnection.forceAllow();\r\n};\r\nvar forceWebSockets = function () {\r\n    BrowserPollConnection.forceDisallow();\r\n};\r\n/* Used by App Manager */\r\nvar isWebSocketsAvailable = function () {\r\n    return WebSocketConnection['isAvailable']();\r\n};\r\nvar setSecurityDebugCallback = function (ref, callback) {\r\n    ref.repo.persistentConnection_.securityDebugCallback_ = callback;\r\n};\r\nvar stats = function (ref, showDelta) {\r\n    ref.repo.stats(showDelta);\r\n};\r\nvar statsIncrementCounter = function (ref, metric) {\r\n    ref.repo.statsIncrementCounter(metric);\r\n};\r\nvar dataUpdateCount = function (ref) {\r\n    return ref.repo.dataUpdateCount;\r\n};\r\nvar interceptServerData = function (ref, callback) {\r\n    return ref.repo.interceptServerData_(callback);\r\n};\n\nvar INTERNAL = /*#__PURE__*/Object.freeze({\n  forceLongPolling: forceLongPolling,\n  forceWebSockets: forceWebSockets,\n  isWebSocketsAvailable: isWebSocketsAvailable,\n  setSecurityDebugCallback: setSecurityDebugCallback,\n  stats: stats,\n  statsIncrementCounter: statsIncrementCounter,\n  dataUpdateCount: dataUpdateCount,\n  interceptServerData: interceptServerData\n});\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DataConnection = PersistentConnection;\r\n/**\r\n * @param {!string} pathString\r\n * @param {function(*)} onComplete\r\n */\r\nPersistentConnection.prototype.simpleListen = function (pathString, onComplete) {\r\n    this.sendRequest('q', { p: pathString }, onComplete);\r\n};\r\n/**\r\n * @param {*} data\r\n * @param {function(*)} onEcho\r\n */\r\nPersistentConnection.prototype.echo = function (data, onEcho) {\r\n    this.sendRequest('echo', { d: data }, onEcho);\r\n};\r\n// RealTimeConnection properties that we use in tests.\r\nvar RealTimeConnection = Connection;\r\n/**\r\n * @param {function(): string} newHash\r\n * @return {function()}\r\n */\r\nvar hijackHash = function (newHash) {\r\n    var oldPut = PersistentConnection.prototype.put;\r\n    PersistentConnection.prototype.put = function (pathString, data, opt_onComplete, opt_hash) {\r\n        if (opt_hash !== undefined) {\r\n            opt_hash = newHash();\r\n        }\r\n        oldPut.call(this, pathString, data, opt_onComplete, opt_hash);\r\n    };\r\n    return function () {\r\n        PersistentConnection.prototype.put = oldPut;\r\n    };\r\n};\r\n/**\r\n * @type {function(new:RepoInfo, !string, boolean, !string, boolean): undefined}\r\n */\r\nvar ConnectionTarget = RepoInfo;\r\n/**\r\n * @param {!Query} query\r\n * @return {!string}\r\n */\r\nvar queryIdentifier = function (query) {\r\n    return query.queryIdentifier();\r\n};\r\n/**\r\n * @param {!Query} firebaseRef\r\n * @return {!Object}\r\n */\r\nvar listens = function (firebaseRef) {\r\n    return firebaseRef.repo.persistentConnection_.listens_;\r\n};\r\n/**\r\n * Forces the RepoManager to create Repos that use ReadonlyRestClient instead of PersistentConnection.\r\n *\r\n * @param {boolean} forceRestClient\r\n */\r\nvar forceRestClient = function (forceRestClient) {\r\n    RepoManager.getInstance().forceRestClient(forceRestClient);\r\n};\n\nvar TEST_ACCESS = /*#__PURE__*/Object.freeze({\n  DataConnection: DataConnection,\n  RealTimeConnection: RealTimeConnection,\n  hijackHash: hijackHash,\n  ConnectionTarget: ConnectionTarget,\n  queryIdentifier: queryIdentifier,\n  listens: listens,\n  forceRestClient: forceRestClient\n});\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar ServerValue = Database.ServerValue;\r\nfunction registerDatabase(instance) {\r\n    // Register the Database Service with the 'firebase' namespace.\r\n    var namespace = instance.INTERNAL.registerService('database', function (app, unused, url) { return RepoManager.getInstance().databaseFromApp(app, url); }, \r\n    // firebase.database namespace properties\r\n    {\r\n        Reference: Reference,\r\n        Query: Query,\r\n        Database: Database,\r\n        enableLogging: enableLogging,\r\n        INTERNAL: INTERNAL,\r\n        ServerValue: ServerValue,\r\n        TEST_ACCESS: TEST_ACCESS\r\n    }, null, true);\r\n    if (isNodeSdk()) {\r\n        module.exports = namespace;\r\n    }\r\n}\r\nregisterDatabase(firebase);\n\nexport { registerDatabase, Database, Query, Reference, enableLogging, ServerValue, DataSnapshot, OnDisconnect };\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/@firebase/database/dist/index.esm.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./assets/style.css\n// module id = cbDw\n// module chunks = 0","module.exports = function(originalModule) {\r\n\tif(!originalModule.webpackPolyfill) {\r\n\t\tvar module = Object.create(originalModule);\r\n\t\t// module.parent = undefined by default\r\n\t\tif(!module.children) module.children = [];\r\n\t\tObject.defineProperty(module, \"loaded\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.l;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(module, \"id\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.i;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(module, \"exports\", {\r\n\t\t\tenumerable: true,\r\n\t\t});\r\n\t\tmodule.webpackPolyfill = 1;\r\n\t}\r\n\treturn module;\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// (webpack)/buildin/harmony-module.js","/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * A container for all of the Logger instances\r\n */\r\nvar instances = [];\r\n/**\r\n * The JS SDK supports 5 log levels and also allows a user the ability to\r\n * silence the logs altogether.\r\n *\r\n * The order is a follows:\r\n * DEBUG < VERBOSE < INFO < WARN < ERROR\r\n *\r\n * All of the log types above the current log level will be captured (i.e. if\r\n * you set the log level to `INFO`, errors will still be logged, but `DEBUG` and\r\n * `VERBOSE` logs will not)\r\n */\r\nvar LogLevel;\r\n(function (LogLevel) {\r\n    LogLevel[LogLevel[\"DEBUG\"] = 0] = \"DEBUG\";\r\n    LogLevel[LogLevel[\"VERBOSE\"] = 1] = \"VERBOSE\";\r\n    LogLevel[LogLevel[\"INFO\"] = 2] = \"INFO\";\r\n    LogLevel[LogLevel[\"WARN\"] = 3] = \"WARN\";\r\n    LogLevel[LogLevel[\"ERROR\"] = 4] = \"ERROR\";\r\n    LogLevel[LogLevel[\"SILENT\"] = 5] = \"SILENT\";\r\n})(LogLevel || (LogLevel = {}));\r\n/**\r\n * The default log level\r\n */\r\nvar defaultLogLevel = LogLevel.INFO;\r\n/**\r\n * The default log handler will forward DEBUG, VERBOSE, INFO, WARN, and ERROR\r\n * messages on to their corresponding console counterparts (if the log method\r\n * is supported by the current log level)\r\n */\r\nvar defaultLogHandler = function (instance, logType) {\r\n    var args = [];\r\n    for (var _i = 2; _i < arguments.length; _i++) {\r\n        args[_i - 2] = arguments[_i];\r\n    }\r\n    if (logType < instance.logLevel)\r\n        return;\r\n    var now = new Date().toISOString();\r\n    switch (logType) {\r\n        /**\r\n         * By default, `console.debug` is not displayed in the developer console (in\r\n         * chrome). To avoid forcing users to have to opt-in to these logs twice\r\n         * (i.e. once for firebase, and once in the console), we are sending `DEBUG`\r\n         * logs to the `console.log` function.\r\n         */\r\n        case LogLevel.DEBUG:\r\n            console.log.apply(console, [\"[\" + now + \"]  \" + instance.name + \":\"].concat(args));\r\n            break;\r\n        case LogLevel.VERBOSE:\r\n            console.log.apply(console, [\"[\" + now + \"]  \" + instance.name + \":\"].concat(args));\r\n            break;\r\n        case LogLevel.INFO:\r\n            console.info.apply(console, [\"[\" + now + \"]  \" + instance.name + \":\"].concat(args));\r\n            break;\r\n        case LogLevel.WARN:\r\n            console.warn.apply(console, [\"[\" + now + \"]  \" + instance.name + \":\"].concat(args));\r\n            break;\r\n        case LogLevel.ERROR:\r\n            console.error.apply(console, [\"[\" + now + \"]  \" + instance.name + \":\"].concat(args));\r\n            break;\r\n        default:\r\n            throw new Error(\"Attempted to log a message with an invalid logType (value: \" + logType + \")\");\r\n    }\r\n};\r\nvar Logger = /** @class */ (function () {\r\n    /**\r\n     * Gives you an instance of a Logger to capture messages according to\r\n     * Firebase's logging scheme.\r\n     *\r\n     * @param name The name that the logs will be associated with\r\n     */\r\n    function Logger(name) {\r\n        this.name = name;\r\n        /**\r\n         * The log level of the given Logger instance.\r\n         */\r\n        this._logLevel = defaultLogLevel;\r\n        /**\r\n         * The log handler for the Logger instance.\r\n         */\r\n        this._logHandler = defaultLogHandler;\r\n        /**\r\n         * Capture the current instance for later use\r\n         */\r\n        instances.push(this);\r\n    }\r\n    Object.defineProperty(Logger.prototype, \"logLevel\", {\r\n        get: function () {\r\n            return this._logLevel;\r\n        },\r\n        set: function (val) {\r\n            if (!(val in LogLevel)) {\r\n                throw new TypeError('Invalid value assigned to `logLevel`');\r\n            }\r\n            this._logLevel = val;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Logger.prototype, \"logHandler\", {\r\n        get: function () {\r\n            return this._logHandler;\r\n        },\r\n        set: function (val) {\r\n            if (typeof val !== 'function') {\r\n                throw new TypeError('Value assigned to `logHandler` must be a function');\r\n            }\r\n            this._logHandler = val;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * The functions below are all based on the `console` interface\r\n     */\r\n    Logger.prototype.debug = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._logHandler.apply(this, [this, LogLevel.DEBUG].concat(args));\r\n    };\r\n    Logger.prototype.log = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._logHandler.apply(this, [this, LogLevel.VERBOSE].concat(args));\r\n    };\r\n    Logger.prototype.info = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._logHandler.apply(this, [this, LogLevel.INFO].concat(args));\r\n    };\r\n    Logger.prototype.warn = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._logHandler.apply(this, [this, LogLevel.WARN].concat(args));\r\n    };\r\n    Logger.prototype.error = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        this._logHandler.apply(this, [this, LogLevel.ERROR].concat(args));\r\n    };\r\n    return Logger;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction setLogLevel(level) {\r\n    instances.forEach(function (inst) {\r\n        inst.logLevel = level;\r\n    });\r\n}\n\nexport { setLogLevel, Logger, LogLevel };\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/@firebase/logger/dist/index.esm.js","(function(self) {\n  'use strict';\n\n  if (self.fetch) {\n    return\n  }\n\n  var support = {\n    searchParams: 'URLSearchParams' in self,\n    iterable: 'Symbol' in self && 'iterator' in Symbol,\n    blob: 'FileReader' in self && 'Blob' in self && (function() {\n      try {\n        new Blob()\n        return true\n      } catch(e) {\n        return false\n      }\n    })(),\n    formData: 'FormData' in self,\n    arrayBuffer: 'ArrayBuffer' in self\n  }\n\n  if (support.arrayBuffer) {\n    var viewClasses = [\n      '[object Int8Array]',\n      '[object Uint8Array]',\n      '[object Uint8ClampedArray]',\n      '[object Int16Array]',\n      '[object Uint16Array]',\n      '[object Int32Array]',\n      '[object Uint32Array]',\n      '[object Float32Array]',\n      '[object Float64Array]'\n    ]\n\n    var isDataView = function(obj) {\n      return obj && DataView.prototype.isPrototypeOf(obj)\n    }\n\n    var isArrayBufferView = ArrayBuffer.isView || function(obj) {\n      return obj && viewClasses.indexOf(Object.prototype.toString.call(obj)) > -1\n    }\n  }\n\n  function normalizeName(name) {\n    if (typeof name !== 'string') {\n      name = String(name)\n    }\n    if (/[^a-z0-9\\-#$%&'*+.\\^_`|~]/i.test(name)) {\n      throw new TypeError('Invalid character in header field name')\n    }\n    return name.toLowerCase()\n  }\n\n  function normalizeValue(value) {\n    if (typeof value !== 'string') {\n      value = String(value)\n    }\n    return value\n  }\n\n  // Build a destructive iterator for the value list\n  function iteratorFor(items) {\n    var iterator = {\n      next: function() {\n        var value = items.shift()\n        return {done: value === undefined, value: value}\n      }\n    }\n\n    if (support.iterable) {\n      iterator[Symbol.iterator] = function() {\n        return iterator\n      }\n    }\n\n    return iterator\n  }\n\n  function Headers(headers) {\n    this.map = {}\n\n    if (headers instanceof Headers) {\n      headers.forEach(function(value, name) {\n        this.append(name, value)\n      }, this)\n    } else if (Array.isArray(headers)) {\n      headers.forEach(function(header) {\n        this.append(header[0], header[1])\n      }, this)\n    } else if (headers) {\n      Object.getOwnPropertyNames(headers).forEach(function(name) {\n        this.append(name, headers[name])\n      }, this)\n    }\n  }\n\n  Headers.prototype.append = function(name, value) {\n    name = normalizeName(name)\n    value = normalizeValue(value)\n    var oldValue = this.map[name]\n    this.map[name] = oldValue ? oldValue+','+value : value\n  }\n\n  Headers.prototype['delete'] = function(name) {\n    delete this.map[normalizeName(name)]\n  }\n\n  Headers.prototype.get = function(name) {\n    name = normalizeName(name)\n    return this.has(name) ? this.map[name] : null\n  }\n\n  Headers.prototype.has = function(name) {\n    return this.map.hasOwnProperty(normalizeName(name))\n  }\n\n  Headers.prototype.set = function(name, value) {\n    this.map[normalizeName(name)] = normalizeValue(value)\n  }\n\n  Headers.prototype.forEach = function(callback, thisArg) {\n    for (var name in this.map) {\n      if (this.map.hasOwnProperty(name)) {\n        callback.call(thisArg, this.map[name], name, this)\n      }\n    }\n  }\n\n  Headers.prototype.keys = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push(name) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.values = function() {\n    var items = []\n    this.forEach(function(value) { items.push(value) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.entries = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push([name, value]) })\n    return iteratorFor(items)\n  }\n\n  if (support.iterable) {\n    Headers.prototype[Symbol.iterator] = Headers.prototype.entries\n  }\n\n  function consumed(body) {\n    if (body.bodyUsed) {\n      return Promise.reject(new TypeError('Already read'))\n    }\n    body.bodyUsed = true\n  }\n\n  function fileReaderReady(reader) {\n    return new Promise(function(resolve, reject) {\n      reader.onload = function() {\n        resolve(reader.result)\n      }\n      reader.onerror = function() {\n        reject(reader.error)\n      }\n    })\n  }\n\n  function readBlobAsArrayBuffer(blob) {\n    var reader = new FileReader()\n    var promise = fileReaderReady(reader)\n    reader.readAsArrayBuffer(blob)\n    return promise\n  }\n\n  function readBlobAsText(blob) {\n    var reader = new FileReader()\n    var promise = fileReaderReady(reader)\n    reader.readAsText(blob)\n    return promise\n  }\n\n  function readArrayBufferAsText(buf) {\n    var view = new Uint8Array(buf)\n    var chars = new Array(view.length)\n\n    for (var i = 0; i < view.length; i++) {\n      chars[i] = String.fromCharCode(view[i])\n    }\n    return chars.join('')\n  }\n\n  function bufferClone(buf) {\n    if (buf.slice) {\n      return buf.slice(0)\n    } else {\n      var view = new Uint8Array(buf.byteLength)\n      view.set(new Uint8Array(buf))\n      return view.buffer\n    }\n  }\n\n  function Body() {\n    this.bodyUsed = false\n\n    this._initBody = function(body) {\n      this._bodyInit = body\n      if (!body) {\n        this._bodyText = ''\n      } else if (typeof body === 'string') {\n        this._bodyText = body\n      } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n        this._bodyBlob = body\n      } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n        this._bodyFormData = body\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this._bodyText = body.toString()\n      } else if (support.arrayBuffer && support.blob && isDataView(body)) {\n        this._bodyArrayBuffer = bufferClone(body.buffer)\n        // IE 10-11 can't handle a DataView body.\n        this._bodyInit = new Blob([this._bodyArrayBuffer])\n      } else if (support.arrayBuffer && (ArrayBuffer.prototype.isPrototypeOf(body) || isArrayBufferView(body))) {\n        this._bodyArrayBuffer = bufferClone(body)\n      } else {\n        throw new Error('unsupported BodyInit type')\n      }\n\n      if (!this.headers.get('content-type')) {\n        if (typeof body === 'string') {\n          this.headers.set('content-type', 'text/plain;charset=UTF-8')\n        } else if (this._bodyBlob && this._bodyBlob.type) {\n          this.headers.set('content-type', this._bodyBlob.type)\n        } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n          this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8')\n        }\n      }\n    }\n\n    if (support.blob) {\n      this.blob = function() {\n        var rejected = consumed(this)\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return Promise.resolve(this._bodyBlob)\n        } else if (this._bodyArrayBuffer) {\n          return Promise.resolve(new Blob([this._bodyArrayBuffer]))\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as blob')\n        } else {\n          return Promise.resolve(new Blob([this._bodyText]))\n        }\n      }\n\n      this.arrayBuffer = function() {\n        if (this._bodyArrayBuffer) {\n          return consumed(this) || Promise.resolve(this._bodyArrayBuffer)\n        } else {\n          return this.blob().then(readBlobAsArrayBuffer)\n        }\n      }\n    }\n\n    this.text = function() {\n      var rejected = consumed(this)\n      if (rejected) {\n        return rejected\n      }\n\n      if (this._bodyBlob) {\n        return readBlobAsText(this._bodyBlob)\n      } else if (this._bodyArrayBuffer) {\n        return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))\n      } else if (this._bodyFormData) {\n        throw new Error('could not read FormData body as text')\n      } else {\n        return Promise.resolve(this._bodyText)\n      }\n    }\n\n    if (support.formData) {\n      this.formData = function() {\n        return this.text().then(decode)\n      }\n    }\n\n    this.json = function() {\n      return this.text().then(JSON.parse)\n    }\n\n    return this\n  }\n\n  // HTTP methods whose capitalization should be normalized\n  var methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT']\n\n  function normalizeMethod(method) {\n    var upcased = method.toUpperCase()\n    return (methods.indexOf(upcased) > -1) ? upcased : method\n  }\n\n  function Request(input, options) {\n    options = options || {}\n    var body = options.body\n\n    if (input instanceof Request) {\n      if (input.bodyUsed) {\n        throw new TypeError('Already read')\n      }\n      this.url = input.url\n      this.credentials = input.credentials\n      if (!options.headers) {\n        this.headers = new Headers(input.headers)\n      }\n      this.method = input.method\n      this.mode = input.mode\n      if (!body && input._bodyInit != null) {\n        body = input._bodyInit\n        input.bodyUsed = true\n      }\n    } else {\n      this.url = String(input)\n    }\n\n    this.credentials = options.credentials || this.credentials || 'omit'\n    if (options.headers || !this.headers) {\n      this.headers = new Headers(options.headers)\n    }\n    this.method = normalizeMethod(options.method || this.method || 'GET')\n    this.mode = options.mode || this.mode || null\n    this.referrer = null\n\n    if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n      throw new TypeError('Body not allowed for GET or HEAD requests')\n    }\n    this._initBody(body)\n  }\n\n  Request.prototype.clone = function() {\n    return new Request(this, { body: this._bodyInit })\n  }\n\n  function decode(body) {\n    var form = new FormData()\n    body.trim().split('&').forEach(function(bytes) {\n      if (bytes) {\n        var split = bytes.split('=')\n        var name = split.shift().replace(/\\+/g, ' ')\n        var value = split.join('=').replace(/\\+/g, ' ')\n        form.append(decodeURIComponent(name), decodeURIComponent(value))\n      }\n    })\n    return form\n  }\n\n  function parseHeaders(rawHeaders) {\n    var headers = new Headers()\n    // Replace instances of \\r\\n and \\n followed by at least one space or horizontal tab with a space\n    // https://tools.ietf.org/html/rfc7230#section-3.2\n    var preProcessedHeaders = rawHeaders.replace(/\\r?\\n[\\t ]+/g, ' ')\n    preProcessedHeaders.split(/\\r?\\n/).forEach(function(line) {\n      var parts = line.split(':')\n      var key = parts.shift().trim()\n      if (key) {\n        var value = parts.join(':').trim()\n        headers.append(key, value)\n      }\n    })\n    return headers\n  }\n\n  Body.call(Request.prototype)\n\n  function Response(bodyInit, options) {\n    if (!options) {\n      options = {}\n    }\n\n    this.type = 'default'\n    this.status = options.status === undefined ? 200 : options.status\n    this.ok = this.status >= 200 && this.status < 300\n    this.statusText = 'statusText' in options ? options.statusText : 'OK'\n    this.headers = new Headers(options.headers)\n    this.url = options.url || ''\n    this._initBody(bodyInit)\n  }\n\n  Body.call(Response.prototype)\n\n  Response.prototype.clone = function() {\n    return new Response(this._bodyInit, {\n      status: this.status,\n      statusText: this.statusText,\n      headers: new Headers(this.headers),\n      url: this.url\n    })\n  }\n\n  Response.error = function() {\n    var response = new Response(null, {status: 0, statusText: ''})\n    response.type = 'error'\n    return response\n  }\n\n  var redirectStatuses = [301, 302, 303, 307, 308]\n\n  Response.redirect = function(url, status) {\n    if (redirectStatuses.indexOf(status) === -1) {\n      throw new RangeError('Invalid status code')\n    }\n\n    return new Response(null, {status: status, headers: {location: url}})\n  }\n\n  self.Headers = Headers\n  self.Request = Request\n  self.Response = Response\n\n  self.fetch = function(input, init) {\n    return new Promise(function(resolve, reject) {\n      var request = new Request(input, init)\n      var xhr = new XMLHttpRequest()\n\n      xhr.onload = function() {\n        var options = {\n          status: xhr.status,\n          statusText: xhr.statusText,\n          headers: parseHeaders(xhr.getAllResponseHeaders() || '')\n        }\n        options.url = 'responseURL' in xhr ? xhr.responseURL : options.headers.get('X-Request-URL')\n        var body = 'response' in xhr ? xhr.response : xhr.responseText\n        resolve(new Response(body, options))\n      }\n\n      xhr.onerror = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.ontimeout = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.open(request.method, request.url, true)\n\n      if (request.credentials === 'include') {\n        xhr.withCredentials = true\n      } else if (request.credentials === 'omit') {\n        xhr.withCredentials = false\n      }\n\n      if ('responseType' in xhr && support.blob) {\n        xhr.responseType = 'blob'\n      }\n\n      request.headers.forEach(function(value, name) {\n        xhr.setRequestHeader(name, value)\n      })\n\n      xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit)\n    })\n  }\n  self.fetch.polyfill = true\n})(typeof self !== 'undefined' ? self : this);\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/whatwg-fetch/fetch.js","import { __extends } from 'tslib';\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @fileoverview Firebase constants.  Some of these (@defines) can be overridden at compile-time.\r\n */\r\nvar CONSTANTS = {\r\n    /**\r\n     * @define {boolean} Whether this is the client Node.js SDK.\r\n     */\r\n    NODE_CLIENT: false,\r\n    /**\r\n     * @define {boolean} Whether this is the Admin Node.js SDK.\r\n     */\r\n    NODE_ADMIN: false,\r\n    /**\r\n     * Firebase SDK Version\r\n     */\r\n    SDK_VERSION: '${JSCORE_VERSION}'\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Throws an error if the provided assertion is falsy\r\n * @param {*} assertion The assertion to be tested for falsiness\r\n * @param {!string} message The message to display if the check fails\r\n */\r\nvar assert = function (assertion, message) {\r\n    if (!assertion) {\r\n        throw assertionError(message);\r\n    }\r\n};\r\n/**\r\n * Returns an Error object suitable for throwing.\r\n * @param {string} message\r\n * @return {!Error}\r\n */\r\nvar assertionError = function (message) {\r\n    return new Error('Firebase Database (' +\r\n        CONSTANTS.SDK_VERSION +\r\n        ') INTERNAL ASSERT FAILED: ' +\r\n        message);\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar stringToByteArray = function (str) {\r\n    // TODO(user): Use native implementations if/when available\r\n    var out = [], p = 0;\r\n    for (var i = 0; i < str.length; i++) {\r\n        var c = str.charCodeAt(i);\r\n        if (c < 128) {\r\n            out[p++] = c;\r\n        }\r\n        else if (c < 2048) {\r\n            out[p++] = (c >> 6) | 192;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else if ((c & 0xfc00) == 0xd800 &&\r\n            i + 1 < str.length &&\r\n            (str.charCodeAt(i + 1) & 0xfc00) == 0xdc00) {\r\n            // Surrogate Pair\r\n            c = 0x10000 + ((c & 0x03ff) << 10) + (str.charCodeAt(++i) & 0x03ff);\r\n            out[p++] = (c >> 18) | 240;\r\n            out[p++] = ((c >> 12) & 63) | 128;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else {\r\n            out[p++] = (c >> 12) | 224;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n    }\r\n    return out;\r\n};\r\n/**\r\n * Turns an array of numbers into the string given by the concatenation of the\r\n * characters to which the numbers correspond.\r\n * @param {Array<number>} bytes Array of numbers representing characters.\r\n * @return {string} Stringification of the array.\r\n */\r\nvar byteArrayToString = function (bytes) {\r\n    // TODO(user): Use native implementations if/when available\r\n    var out = [], pos = 0, c = 0;\r\n    while (pos < bytes.length) {\r\n        var c1 = bytes[pos++];\r\n        if (c1 < 128) {\r\n            out[c++] = String.fromCharCode(c1);\r\n        }\r\n        else if (c1 > 191 && c1 < 224) {\r\n            var c2 = bytes[pos++];\r\n            out[c++] = String.fromCharCode(((c1 & 31) << 6) | (c2 & 63));\r\n        }\r\n        else if (c1 > 239 && c1 < 365) {\r\n            // Surrogate Pair\r\n            var c2 = bytes[pos++];\r\n            var c3 = bytes[pos++];\r\n            var c4 = bytes[pos++];\r\n            var u = (((c1 & 7) << 18) | ((c2 & 63) << 12) | ((c3 & 63) << 6) | (c4 & 63)) -\r\n                0x10000;\r\n            out[c++] = String.fromCharCode(0xd800 + (u >> 10));\r\n            out[c++] = String.fromCharCode(0xdc00 + (u & 1023));\r\n        }\r\n        else {\r\n            var c2 = bytes[pos++];\r\n            var c3 = bytes[pos++];\r\n            out[c++] = String.fromCharCode(((c1 & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\r\n        }\r\n    }\r\n    return out.join('');\r\n};\r\n// Static lookup maps, lazily populated by init_()\r\nvar base64 = {\r\n    /**\r\n     * Maps bytes to characters.\r\n     * @type {Object}\r\n     * @private\r\n     */\r\n    byteToCharMap_: null,\r\n    /**\r\n     * Maps characters to bytes.\r\n     * @type {Object}\r\n     * @private\r\n     */\r\n    charToByteMap_: null,\r\n    /**\r\n     * Maps bytes to websafe characters.\r\n     * @type {Object}\r\n     * @private\r\n     */\r\n    byteToCharMapWebSafe_: null,\r\n    /**\r\n     * Maps websafe characters to bytes.\r\n     * @type {Object}\r\n     * @private\r\n     */\r\n    charToByteMapWebSafe_: null,\r\n    /**\r\n     * Our default alphabet, shared between\r\n     * ENCODED_VALS and ENCODED_VALS_WEBSAFE\r\n     * @type {string}\r\n     */\r\n    ENCODED_VALS_BASE: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' + 'abcdefghijklmnopqrstuvwxyz' + '0123456789',\r\n    /**\r\n     * Our default alphabet. Value 64 (=) is special; it means \"nothing.\"\r\n     * @type {string}\r\n     */\r\n    get ENCODED_VALS() {\r\n        return this.ENCODED_VALS_BASE + '+/=';\r\n    },\r\n    /**\r\n     * Our websafe alphabet.\r\n     * @type {string}\r\n     */\r\n    get ENCODED_VALS_WEBSAFE() {\r\n        return this.ENCODED_VALS_BASE + '-_.';\r\n    },\r\n    /**\r\n     * Whether this browser supports the atob and btoa functions. This extension\r\n     * started at Mozilla but is now implemented by many browsers. We use the\r\n     * ASSUME_* variables to avoid pulling in the full useragent detection library\r\n     * but still allowing the standard per-browser compilations.\r\n     *\r\n     * @type {boolean}\r\n     */\r\n    HAS_NATIVE_SUPPORT: typeof atob === 'function',\r\n    /**\r\n     * Base64-encode an array of bytes.\r\n     *\r\n     * @param {Array<number>|Uint8Array} input An array of bytes (numbers with\r\n     *     value in [0, 255]) to encode.\r\n     * @param {boolean=} opt_webSafe Boolean indicating we should use the\r\n     *     alternative alphabet.\r\n     * @return {string} The base64 encoded string.\r\n     */\r\n    encodeByteArray: function (input, opt_webSafe) {\r\n        if (!Array.isArray(input)) {\r\n            throw Error('encodeByteArray takes an array as a parameter');\r\n        }\r\n        this.init_();\r\n        var byteToCharMap = opt_webSafe\r\n            ? this.byteToCharMapWebSafe_\r\n            : this.byteToCharMap_;\r\n        var output = [];\r\n        for (var i = 0; i < input.length; i += 3) {\r\n            var byte1 = input[i];\r\n            var haveByte2 = i + 1 < input.length;\r\n            var byte2 = haveByte2 ? input[i + 1] : 0;\r\n            var haveByte3 = i + 2 < input.length;\r\n            var byte3 = haveByte3 ? input[i + 2] : 0;\r\n            var outByte1 = byte1 >> 2;\r\n            var outByte2 = ((byte1 & 0x03) << 4) | (byte2 >> 4);\r\n            var outByte3 = ((byte2 & 0x0f) << 2) | (byte3 >> 6);\r\n            var outByte4 = byte3 & 0x3f;\r\n            if (!haveByte3) {\r\n                outByte4 = 64;\r\n                if (!haveByte2) {\r\n                    outByte3 = 64;\r\n                }\r\n            }\r\n            output.push(byteToCharMap[outByte1], byteToCharMap[outByte2], byteToCharMap[outByte3], byteToCharMap[outByte4]);\r\n        }\r\n        return output.join('');\r\n    },\r\n    /**\r\n     * Base64-encode a string.\r\n     *\r\n     * @param {string} input A string to encode.\r\n     * @param {boolean=} opt_webSafe If true, we should use the\r\n     *     alternative alphabet.\r\n     * @return {string} The base64 encoded string.\r\n     */\r\n    encodeString: function (input, opt_webSafe) {\r\n        // Shortcut for Mozilla browsers that implement\r\n        // a native base64 encoder in the form of \"btoa/atob\"\r\n        if (this.HAS_NATIVE_SUPPORT && !opt_webSafe) {\r\n            return btoa(input);\r\n        }\r\n        return this.encodeByteArray(stringToByteArray(input), opt_webSafe);\r\n    },\r\n    /**\r\n     * Base64-decode a string.\r\n     *\r\n     * @param {string} input to decode.\r\n     * @param {boolean=} opt_webSafe True if we should use the\r\n     *     alternative alphabet.\r\n     * @return {string} string representing the decoded value.\r\n     */\r\n    decodeString: function (input, opt_webSafe) {\r\n        // Shortcut for Mozilla browsers that implement\r\n        // a native base64 encoder in the form of \"btoa/atob\"\r\n        if (this.HAS_NATIVE_SUPPORT && !opt_webSafe) {\r\n            return atob(input);\r\n        }\r\n        return byteArrayToString(this.decodeStringToByteArray(input, opt_webSafe));\r\n    },\r\n    /**\r\n     * Base64-decode a string.\r\n     *\r\n     * In base-64 decoding, groups of four characters are converted into three\r\n     * bytes.  If the encoder did not apply padding, the input length may not\r\n     * be a multiple of 4.\r\n     *\r\n     * In this case, the last group will have fewer than 4 characters, and\r\n     * padding will be inferred.  If the group has one or two characters, it decodes\r\n     * to one byte.  If the group has three characters, it decodes to two bytes.\r\n     *\r\n     * @param {string} input Input to decode.\r\n     * @param {boolean=} opt_webSafe True if we should use the web-safe alphabet.\r\n     * @return {!Array<number>} bytes representing the decoded value.\r\n     */\r\n    decodeStringToByteArray: function (input, opt_webSafe) {\r\n        this.init_();\r\n        var charToByteMap = opt_webSafe\r\n            ? this.charToByteMapWebSafe_\r\n            : this.charToByteMap_;\r\n        var output = [];\r\n        for (var i = 0; i < input.length;) {\r\n            var byte1 = charToByteMap[input.charAt(i++)];\r\n            var haveByte2 = i < input.length;\r\n            var byte2 = haveByte2 ? charToByteMap[input.charAt(i)] : 0;\r\n            ++i;\r\n            var haveByte3 = i < input.length;\r\n            var byte3 = haveByte3 ? charToByteMap[input.charAt(i)] : 64;\r\n            ++i;\r\n            var haveByte4 = i < input.length;\r\n            var byte4 = haveByte4 ? charToByteMap[input.charAt(i)] : 64;\r\n            ++i;\r\n            if (byte1 == null || byte2 == null || byte3 == null || byte4 == null) {\r\n                throw Error();\r\n            }\r\n            var outByte1 = (byte1 << 2) | (byte2 >> 4);\r\n            output.push(outByte1);\r\n            if (byte3 != 64) {\r\n                var outByte2 = ((byte2 << 4) & 0xf0) | (byte3 >> 2);\r\n                output.push(outByte2);\r\n                if (byte4 != 64) {\r\n                    var outByte3 = ((byte3 << 6) & 0xc0) | byte4;\r\n                    output.push(outByte3);\r\n                }\r\n            }\r\n        }\r\n        return output;\r\n    },\r\n    /**\r\n     * Lazy static initialization function. Called before\r\n     * accessing any of the static map variables.\r\n     * @private\r\n     */\r\n    init_: function () {\r\n        if (!this.byteToCharMap_) {\r\n            this.byteToCharMap_ = {};\r\n            this.charToByteMap_ = {};\r\n            this.byteToCharMapWebSafe_ = {};\r\n            this.charToByteMapWebSafe_ = {};\r\n            // We want quick mappings back and forth, so we precompute two maps.\r\n            for (var i = 0; i < this.ENCODED_VALS.length; i++) {\r\n                this.byteToCharMap_[i] = this.ENCODED_VALS.charAt(i);\r\n                this.charToByteMap_[this.byteToCharMap_[i]] = i;\r\n                this.byteToCharMapWebSafe_[i] = this.ENCODED_VALS_WEBSAFE.charAt(i);\r\n                this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]] = i;\r\n                // Be forgiving when decoding and correctly decode both encodings.\r\n                if (i >= this.ENCODED_VALS_BASE.length) {\r\n                    this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)] = i;\r\n                    this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)] = i;\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n/**\r\n * URL-safe base64 encoding\r\n * @param {!string} str\r\n * @return {!string}\r\n */\r\nvar base64Encode = function (str) {\r\n    var utf8Bytes = stringToByteArray(str);\r\n    return base64.encodeByteArray(utf8Bytes, true);\r\n};\r\n/**\r\n * URL-safe base64 decoding\r\n *\r\n * NOTE: DO NOT use the global atob() function - it does NOT support the\r\n * base64Url variant encoding.\r\n *\r\n * @param {string} str To be decoded\r\n * @return {?string} Decoded result, if possible\r\n */\r\nvar base64Decode = function (str) {\r\n    try {\r\n        return base64.decodeString(str, true);\r\n    }\r\n    catch (e) {\r\n        console.error('base64Decode failed: ', e);\r\n    }\r\n    return null;\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Do a deep-copy of basic JavaScript Objects or Arrays.\r\n */\r\nfunction deepCopy(value) {\r\n    return deepExtend(undefined, value);\r\n}\r\n/**\r\n * Copy properties from source to target (recursively allows extension\r\n * of Objects and Arrays).  Scalar values in the target are over-written.\r\n * If target is undefined, an object of the appropriate type will be created\r\n * (and returned).\r\n *\r\n * We recursively copy all child properties of plain Objects in the source- so\r\n * that namespace- like dictionaries are merged.\r\n *\r\n * Note that the target can be a function, in which case the properties in\r\n * the source Object are copied onto it as static properties of the Function.\r\n */\r\nfunction deepExtend(target, source) {\r\n    if (!(source instanceof Object)) {\r\n        return source;\r\n    }\r\n    switch (source.constructor) {\r\n        case Date:\r\n            // Treat Dates like scalars; if the target date object had any child\r\n            // properties - they will be lost!\r\n            var dateValue = source;\r\n            return new Date(dateValue.getTime());\r\n        case Object:\r\n            if (target === undefined) {\r\n                target = {};\r\n            }\r\n            break;\r\n        case Array:\r\n            // Always copy the array source and overwrite the target.\r\n            target = [];\r\n            break;\r\n        default:\r\n            // Not a plain Object - treat it as a scalar.\r\n            return source;\r\n    }\r\n    for (var prop in source) {\r\n        if (!source.hasOwnProperty(prop)) {\r\n            continue;\r\n        }\r\n        target[prop] = deepExtend(target[prop], source[prop]);\r\n    }\r\n    return target;\r\n}\r\n// TODO: Really needed (for JSCompiler type checking)?\r\nfunction patchProperty(obj, prop, value) {\r\n    obj[prop] = value;\r\n}\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar Deferred = /** @class */ (function () {\r\n    function Deferred() {\r\n        var _this = this;\r\n        this.promise = new Promise(function (resolve, reject) {\r\n            _this.resolve = resolve;\r\n            _this.reject = reject;\r\n        });\r\n    }\r\n    /**\r\n     * Our API internals are not promiseified and cannot because our callback APIs have subtle expectations around\r\n     * invoking promises inline, which Promises are forbidden to do. This method accepts an optional node-style callback\r\n     * and returns a node-style callback which will resolve or reject the Deferred's promise.\r\n     * @param {((?function(?(Error)): (?|undefined))| (?function(?(Error),?=): (?|undefined)))=} callback\r\n     * @return {!function(?(Error), ?=)}\r\n     */\r\n    Deferred.prototype.wrapCallback = function (callback) {\r\n        var _this = this;\r\n        return function (error, value) {\r\n            if (error) {\r\n                _this.reject(error);\r\n            }\r\n            else {\r\n                _this.resolve(value);\r\n            }\r\n            if (typeof callback === 'function') {\r\n                // Attaching noop handler just in case developer wasn't expecting\r\n                // promises\r\n                _this.promise.catch(function () { });\r\n                // Some of our callbacks don't expect a value and our own tests\r\n                // assert that the parameter length is 1\r\n                if (callback.length === 1) {\r\n                    callback(error);\r\n                }\r\n                else {\r\n                    callback(error, value);\r\n                }\r\n            }\r\n        };\r\n    };\r\n    return Deferred;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns navigator.userAgent string or '' if it's not defined.\r\n * @return {string} user agent string\r\n */\r\nvar getUA = function () {\r\n    if (typeof navigator !== 'undefined' &&\r\n        typeof navigator['userAgent'] === 'string') {\r\n        return navigator['userAgent'];\r\n    }\r\n    else {\r\n        return '';\r\n    }\r\n};\r\n/**\r\n * Detect Cordova / PhoneGap / Ionic frameworks on a mobile device.\r\n *\r\n * Deliberately does not rely on checking `file://` URLs (as this fails PhoneGap in the Ripple emulator) nor\r\n * Cordova `onDeviceReady`, which would normally wait for a callback.\r\n *\r\n * @return {boolean} isMobileCordova\r\n */\r\nvar isMobileCordova = function () {\r\n    return (typeof window !== 'undefined' &&\r\n        !!(window['cordova'] || window['phonegap'] || window['PhoneGap']) &&\r\n        /ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA()));\r\n};\r\n/**\r\n * Detect React Native.\r\n *\r\n * @return {boolean} True if ReactNative environment is detected.\r\n */\r\nvar isReactNative = function () {\r\n    return (typeof navigator === 'object' && navigator['product'] === 'ReactNative');\r\n};\r\n/**\r\n * Detect Node.js.\r\n *\r\n * @return {boolean} True if Node.js environment is detected.\r\n */\r\nvar isNodeSdk = function () {\r\n    return CONSTANTS.NODE_CLIENT === true || CONSTANTS.NODE_ADMIN === true;\r\n};\n\nvar ERROR_NAME = 'FirebaseError';\r\nvar captureStackTrace = Error\r\n    .captureStackTrace;\r\n// Export for faking in tests\r\nfunction patchCapture(captureFake) {\r\n    var result = captureStackTrace;\r\n    captureStackTrace = captureFake;\r\n    return result;\r\n}\r\nvar FirebaseError = /** @class */ (function () {\r\n    function FirebaseError(code, message) {\r\n        this.code = code;\r\n        this.message = message;\r\n        // We want the stack value, if implemented by Error\r\n        if (captureStackTrace) {\r\n            // Patches this.stack, omitted calls above ErrorFactory#create\r\n            captureStackTrace(this, ErrorFactory.prototype.create);\r\n        }\r\n        else {\r\n            try {\r\n                // In case of IE11, stack will be set only after error is raised.\r\n                // https://docs.microsoft.com/en-us/scripting/javascript/reference/stack-property-error-javascript\r\n                throw Error.apply(this, arguments);\r\n            }\r\n            catch (err) {\r\n                this.name = ERROR_NAME;\r\n                // Make non-enumerable getter for the property.\r\n                Object.defineProperty(this, 'stack', {\r\n                    get: function () {\r\n                        return err.stack;\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n    return FirebaseError;\r\n}());\r\n// Back-door inheritance\r\nFirebaseError.prototype = Object.create(Error.prototype);\r\nFirebaseError.prototype.constructor = FirebaseError;\r\nFirebaseError.prototype.name = ERROR_NAME;\r\nvar ErrorFactory = /** @class */ (function () {\r\n    function ErrorFactory(service, serviceName, errors) {\r\n        this.service = service;\r\n        this.serviceName = serviceName;\r\n        this.errors = errors;\r\n        // Matches {$name}, by default.\r\n        this.pattern = /\\{\\$([^}]+)}/g;\r\n        // empty\r\n    }\r\n    ErrorFactory.prototype.create = function (code, data) {\r\n        if (data === undefined) {\r\n            data = {};\r\n        }\r\n        var template = this.errors[code];\r\n        var fullCode = this.service + '/' + code;\r\n        var message;\r\n        if (template === undefined) {\r\n            message = 'Error';\r\n        }\r\n        else {\r\n            message = template.replace(this.pattern, function (match, key) {\r\n                var value = data[key];\r\n                return value !== undefined ? value.toString() : '<' + key + '?>';\r\n            });\r\n        }\r\n        // Service: Error message (service/code).\r\n        message = this.serviceName + ': ' + message + ' (' + fullCode + ').';\r\n        var err = new FirebaseError(fullCode, message);\r\n        // Populate the Error object with message parts for programmatic\r\n        // accesses (e.g., e.file).\r\n        for (var prop in data) {\r\n            if (!data.hasOwnProperty(prop) || prop.slice(-1) === '_') {\r\n                continue;\r\n            }\r\n            err[prop] = data[prop];\r\n        }\r\n        return err;\r\n    };\r\n    return ErrorFactory;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Evaluates a JSON string into a javascript object.\r\n *\r\n * @param {string} str A string containing JSON.\r\n * @return {*} The javascript object representing the specified JSON.\r\n */\r\nfunction jsonEval(str) {\r\n    return JSON.parse(str);\r\n}\r\n/**\r\n * Returns JSON representing a javascript object.\r\n * @param {*} data Javascript object to be stringified.\r\n * @return {string} The JSON contents of the object.\r\n */\r\nfunction stringify(data) {\r\n    return JSON.stringify(data);\r\n}\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Decodes a Firebase auth. token into constituent parts.\r\n *\r\n * Notes:\r\n * - May return with invalid / incomplete claims if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n *\r\n * @param {?string} token\r\n * @return {{header: *, claims: *, data: *, signature: string}}\r\n */\r\nvar decode = function (token) {\r\n    var header = {}, claims = {}, data = {}, signature = '';\r\n    try {\r\n        var parts = token.split('.');\r\n        header = jsonEval(base64Decode(parts[0]) || '');\r\n        claims = jsonEval(base64Decode(parts[1]) || '');\r\n        signature = parts[2];\r\n        data = claims['d'] || {};\r\n        delete claims['d'];\r\n    }\r\n    catch (e) { }\r\n    return {\r\n        header: header,\r\n        claims: claims,\r\n        data: data,\r\n        signature: signature\r\n    };\r\n};\r\n/**\r\n * Decodes a Firebase auth. token and checks the validity of its time-based claims. Will return true if the\r\n * token is within the time window authorized by the 'nbf' (not-before) and 'iat' (issued-at) claims.\r\n *\r\n * Notes:\r\n * - May return a false negative if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n *\r\n * @param {?string} token\r\n * @return {boolean}\r\n */\r\nvar isValidTimestamp = function (token) {\r\n    var claims = decode(token).claims, now = Math.floor(new Date().getTime() / 1000), validSince, validUntil;\r\n    if (typeof claims === 'object') {\r\n        if (claims.hasOwnProperty('nbf')) {\r\n            validSince = claims['nbf'];\r\n        }\r\n        else if (claims.hasOwnProperty('iat')) {\r\n            validSince = claims['iat'];\r\n        }\r\n        if (claims.hasOwnProperty('exp')) {\r\n            validUntil = claims['exp'];\r\n        }\r\n        else {\r\n            // token will expire after 24h by default\r\n            validUntil = validSince + 86400;\r\n        }\r\n    }\r\n    return (now && validSince && validUntil && now >= validSince && now <= validUntil);\r\n};\r\n/**\r\n * Decodes a Firebase auth. token and returns its issued at time if valid, null otherwise.\r\n *\r\n * Notes:\r\n * - May return null if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n *\r\n * @param {?string} token\r\n * @return {?number}\r\n */\r\nvar issuedAtTime = function (token) {\r\n    var claims = decode(token).claims;\r\n    if (typeof claims === 'object' && claims.hasOwnProperty('iat')) {\r\n        return claims['iat'];\r\n    }\r\n    return null;\r\n};\r\n/**\r\n * Decodes a Firebase auth. token and checks the validity of its format. Expects a valid issued-at time.\r\n *\r\n * Notes:\r\n * - May return a false negative if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n *\r\n * @param {?string} token\r\n * @return {boolean}\r\n */\r\nvar isValidFormat = function (token) {\r\n    var decoded = decode(token), claims = decoded.claims;\r\n    return !!claims && typeof claims === 'object' && claims.hasOwnProperty('iat');\r\n};\r\n/**\r\n * Attempts to peer into an auth token and determine if it's an admin auth token by looking at the claims portion.\r\n *\r\n * Notes:\r\n * - May return a false negative if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n *\r\n * @param {?string} token\r\n * @return {boolean}\r\n */\r\nvar isAdmin = function (token) {\r\n    var claims = decode(token).claims;\r\n    return typeof claims === 'object' && claims['admin'] === true;\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// See http://www.devthought.com/2012/01/18/an-object-is-not-a-hash/\r\nvar contains = function (obj, key) {\r\n    return Object.prototype.hasOwnProperty.call(obj, key);\r\n};\r\nvar safeGet = function (obj, key) {\r\n    if (Object.prototype.hasOwnProperty.call(obj, key))\r\n        return obj[key];\r\n    // else return undefined.\r\n};\r\n/**\r\n * Enumerates the keys/values in an object, excluding keys defined on the prototype.\r\n *\r\n * @param {?Object.<K,V>} obj Object to enumerate.\r\n * @param {!function(K, V)} fn Function to call for each key and value.\r\n * @template K,V\r\n */\r\nvar forEach = function (obj, fn) {\r\n    for (var key in obj) {\r\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n            fn(key, obj[key]);\r\n        }\r\n    }\r\n};\r\n/**\r\n * Copies all the (own) properties from one object to another.\r\n * @param {!Object} objTo\r\n * @param {!Object} objFrom\r\n * @return {!Object} objTo\r\n */\r\nvar extend = function (objTo, objFrom) {\r\n    forEach(objFrom, function (key, value) {\r\n        objTo[key] = value;\r\n    });\r\n    return objTo;\r\n};\r\n/**\r\n * Returns a clone of the specified object.\r\n * @param {!Object} obj\r\n * @return {!Object} cloned obj.\r\n */\r\nvar clone = function (obj) {\r\n    return extend({}, obj);\r\n};\r\n/**\r\n * Returns true if obj has typeof \"object\" and is not null.  Unlike goog.isObject(), does not return true\r\n * for functions.\r\n *\r\n * @param obj {*} A potential object.\r\n * @returns {boolean} True if it's an object.\r\n */\r\nvar isNonNullObject = function (obj) {\r\n    return typeof obj === 'object' && obj !== null;\r\n};\r\nvar isEmpty = function (obj) {\r\n    for (var key in obj) {\r\n        return false;\r\n    }\r\n    return true;\r\n};\r\nvar getCount = function (obj) {\r\n    var rv = 0;\r\n    for (var key in obj) {\r\n        rv++;\r\n    }\r\n    return rv;\r\n};\r\nvar map = function (obj, f, opt_obj) {\r\n    var res = {};\r\n    for (var key in obj) {\r\n        res[key] = f.call(opt_obj, obj[key], key, obj);\r\n    }\r\n    return res;\r\n};\r\nvar findKey = function (obj, fn, opt_this) {\r\n    for (var key in obj) {\r\n        if (fn.call(opt_this, obj[key], key, obj)) {\r\n            return key;\r\n        }\r\n    }\r\n    return undefined;\r\n};\r\nvar findValue = function (obj, fn, opt_this) {\r\n    var key = findKey(obj, fn, opt_this);\r\n    return key && obj[key];\r\n};\r\nvar getAnyKey = function (obj) {\r\n    for (var key in obj) {\r\n        return key;\r\n    }\r\n};\r\nvar getValues = function (obj) {\r\n    var res = [];\r\n    var i = 0;\r\n    for (var key in obj) {\r\n        res[i++] = obj[key];\r\n    }\r\n    return res;\r\n};\r\n/**\r\n * Tests whether every key/value pair in an object pass the test implemented\r\n * by the provided function\r\n *\r\n * @param {?Object.<K,V>} obj Object to test.\r\n * @param {!function(K, V)} fn Function to call for each key and value.\r\n * @template K,V\r\n */\r\nvar every = function (obj, fn) {\r\n    for (var key in obj) {\r\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n            if (!fn(key, obj[key])) {\r\n                return false;\r\n            }\r\n        }\r\n    }\r\n    return true;\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a querystring-formatted string (e.g. &arg=val&arg2=val2) from a params\r\n * object (e.g. {arg: 'val', arg2: 'val2'})\r\n * Note: You must prepend it with ? when adding it to a URL.\r\n *\r\n * @param {!Object} querystringParams\r\n * @return {string}\r\n */\r\nvar querystring = function (querystringParams) {\r\n    var params = [];\r\n    forEach(querystringParams, function (key, value) {\r\n        if (Array.isArray(value)) {\r\n            value.forEach(function (arrayVal) {\r\n                params.push(encodeURIComponent(key) + '=' + encodeURIComponent(arrayVal));\r\n            });\r\n        }\r\n        else {\r\n            params.push(encodeURIComponent(key) + '=' + encodeURIComponent(value));\r\n        }\r\n    });\r\n    return params.length ? '&' + params.join('&') : '';\r\n};\r\n/**\r\n * Decodes a querystring (e.g. ?arg=val&arg2=val2) into a params object (e.g. {arg: 'val', arg2: 'val2'})\r\n *\r\n * @param {string} querystring\r\n * @return {!Object}\r\n */\r\nvar querystringDecode = function (querystring) {\r\n    var obj = {};\r\n    var tokens = querystring.replace(/^\\?/, '').split('&');\r\n    tokens.forEach(function (token) {\r\n        if (token) {\r\n            var key = token.split('=');\r\n            obj[key[0]] = key[1];\r\n        }\r\n    });\r\n    return obj;\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Copyright 2011 The Closure Library Authors. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//      http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n/**\r\n * @fileoverview Abstract cryptographic hash interface.\r\n *\r\n * See Sha1 and Md5 for sample implementations.\r\n *\r\n */\r\n/**\r\n * Create a cryptographic hash instance.\r\n *\r\n * @constructor\r\n * @struct\r\n */\r\nvar Hash = /** @class */ (function () {\r\n    function Hash() {\r\n        /**\r\n         * The block size for the hasher.\r\n         * @type {number}\r\n         */\r\n        this.blockSize = -1;\r\n    }\r\n    return Hash;\r\n}());\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @fileoverview SHA-1 cryptographic hash.\r\n * Variable names follow the notation in FIPS PUB 180-3:\r\n * http://csrc.nist.gov/publications/fips/fips180-3/fips180-3_final.pdf.\r\n *\r\n * Usage:\r\n *   var sha1 = new sha1();\r\n *   sha1.update(bytes);\r\n *   var hash = sha1.digest();\r\n *\r\n * Performance:\r\n *   Chrome 23:   ~400 Mbit/s\r\n *   Firefox 16:  ~250 Mbit/s\r\n *\r\n */\r\n/**\r\n * SHA-1 cryptographic hash constructor.\r\n *\r\n * The properties declared here are discussed in the above algorithm document.\r\n * @constructor\r\n * @extends {Hash}\r\n * @final\r\n * @struct\r\n */\r\nvar Sha1 = /** @class */ (function (_super) {\r\n    __extends(Sha1, _super);\r\n    function Sha1() {\r\n        var _this = _super.call(this) || this;\r\n        /**\r\n         * Holds the previous values of accumulated variables a-e in the compress_\r\n         * function.\r\n         * @type {!Array<number>}\r\n         * @private\r\n         */\r\n        _this.chain_ = [];\r\n        /**\r\n         * A buffer holding the partially computed hash result.\r\n         * @type {!Array<number>}\r\n         * @private\r\n         */\r\n        _this.buf_ = [];\r\n        /**\r\n         * An array of 80 bytes, each a part of the message to be hashed.  Referred to\r\n         * as the message schedule in the docs.\r\n         * @type {!Array<number>}\r\n         * @private\r\n         */\r\n        _this.W_ = [];\r\n        /**\r\n         * Contains data needed to pad messages less than 64 bytes.\r\n         * @type {!Array<number>}\r\n         * @private\r\n         */\r\n        _this.pad_ = [];\r\n        /**\r\n         * @private {number}\r\n         */\r\n        _this.inbuf_ = 0;\r\n        /**\r\n         * @private {number}\r\n         */\r\n        _this.total_ = 0;\r\n        _this.blockSize = 512 / 8;\r\n        _this.pad_[0] = 128;\r\n        for (var i = 1; i < _this.blockSize; ++i) {\r\n            _this.pad_[i] = 0;\r\n        }\r\n        _this.reset();\r\n        return _this;\r\n    }\r\n    Sha1.prototype.reset = function () {\r\n        this.chain_[0] = 0x67452301;\r\n        this.chain_[1] = 0xefcdab89;\r\n        this.chain_[2] = 0x98badcfe;\r\n        this.chain_[3] = 0x10325476;\r\n        this.chain_[4] = 0xc3d2e1f0;\r\n        this.inbuf_ = 0;\r\n        this.total_ = 0;\r\n    };\r\n    /**\r\n     * Internal compress helper function.\r\n     * @param {!Array<number>|!Uint8Array|string} buf Block to compress.\r\n     * @param {number=} opt_offset Offset of the block in the buffer.\r\n     * @private\r\n     */\r\n    Sha1.prototype.compress_ = function (buf, opt_offset) {\r\n        if (!opt_offset) {\r\n            opt_offset = 0;\r\n        }\r\n        var W = this.W_;\r\n        // get 16 big endian words\r\n        if (typeof buf === 'string') {\r\n            for (var i = 0; i < 16; i++) {\r\n                // TODO(user): [bug 8140122] Recent versions of Safari for Mac OS and iOS\r\n                // have a bug that turns the post-increment ++ operator into pre-increment\r\n                // during JIT compilation.  We have code that depends heavily on SHA-1 for\r\n                // correctness and which is affected by this bug, so I've removed all uses\r\n                // of post-increment ++ in which the result value is used.  We can revert\r\n                // this change once the Safari bug\r\n                // (https://bugs.webkit.org/show_bug.cgi?id=109036) has been fixed and\r\n                // most clients have been updated.\r\n                W[i] =\r\n                    (buf.charCodeAt(opt_offset) << 24) |\r\n                        (buf.charCodeAt(opt_offset + 1) << 16) |\r\n                        (buf.charCodeAt(opt_offset + 2) << 8) |\r\n                        buf.charCodeAt(opt_offset + 3);\r\n                opt_offset += 4;\r\n            }\r\n        }\r\n        else {\r\n            for (var i = 0; i < 16; i++) {\r\n                W[i] =\r\n                    (buf[opt_offset] << 24) |\r\n                        (buf[opt_offset + 1] << 16) |\r\n                        (buf[opt_offset + 2] << 8) |\r\n                        buf[opt_offset + 3];\r\n                opt_offset += 4;\r\n            }\r\n        }\r\n        // expand to 80 words\r\n        for (var i = 16; i < 80; i++) {\r\n            var t = W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16];\r\n            W[i] = ((t << 1) | (t >>> 31)) & 0xffffffff;\r\n        }\r\n        var a = this.chain_[0];\r\n        var b = this.chain_[1];\r\n        var c = this.chain_[2];\r\n        var d = this.chain_[3];\r\n        var e = this.chain_[4];\r\n        var f, k;\r\n        // TODO(user): Try to unroll this loop to speed up the computation.\r\n        for (var i = 0; i < 80; i++) {\r\n            if (i < 40) {\r\n                if (i < 20) {\r\n                    f = d ^ (b & (c ^ d));\r\n                    k = 0x5a827999;\r\n                }\r\n                else {\r\n                    f = b ^ c ^ d;\r\n                    k = 0x6ed9eba1;\r\n                }\r\n            }\r\n            else {\r\n                if (i < 60) {\r\n                    f = (b & c) | (d & (b | c));\r\n                    k = 0x8f1bbcdc;\r\n                }\r\n                else {\r\n                    f = b ^ c ^ d;\r\n                    k = 0xca62c1d6;\r\n                }\r\n            }\r\n            var t = (((a << 5) | (a >>> 27)) + f + e + k + W[i]) & 0xffffffff;\r\n            e = d;\r\n            d = c;\r\n            c = ((b << 30) | (b >>> 2)) & 0xffffffff;\r\n            b = a;\r\n            a = t;\r\n        }\r\n        this.chain_[0] = (this.chain_[0] + a) & 0xffffffff;\r\n        this.chain_[1] = (this.chain_[1] + b) & 0xffffffff;\r\n        this.chain_[2] = (this.chain_[2] + c) & 0xffffffff;\r\n        this.chain_[3] = (this.chain_[3] + d) & 0xffffffff;\r\n        this.chain_[4] = (this.chain_[4] + e) & 0xffffffff;\r\n    };\r\n    Sha1.prototype.update = function (bytes, opt_length) {\r\n        // TODO(johnlenz): tighten the function signature and remove this check\r\n        if (bytes == null) {\r\n            return;\r\n        }\r\n        if (opt_length === undefined) {\r\n            opt_length = bytes.length;\r\n        }\r\n        var lengthMinusBlock = opt_length - this.blockSize;\r\n        var n = 0;\r\n        // Using local instead of member variables gives ~5% speedup on Firefox 16.\r\n        var buf = this.buf_;\r\n        var inbuf = this.inbuf_;\r\n        // The outer while loop should execute at most twice.\r\n        while (n < opt_length) {\r\n            // When we have no data in the block to top up, we can directly process the\r\n            // input buffer (assuming it contains sufficient data). This gives ~25%\r\n            // speedup on Chrome 23 and ~15% speedup on Firefox 16, but requires that\r\n            // the data is provided in large chunks (or in multiples of 64 bytes).\r\n            if (inbuf == 0) {\r\n                while (n <= lengthMinusBlock) {\r\n                    this.compress_(bytes, n);\r\n                    n += this.blockSize;\r\n                }\r\n            }\r\n            if (typeof bytes === 'string') {\r\n                while (n < opt_length) {\r\n                    buf[inbuf] = bytes.charCodeAt(n);\r\n                    ++inbuf;\r\n                    ++n;\r\n                    if (inbuf == this.blockSize) {\r\n                        this.compress_(buf);\r\n                        inbuf = 0;\r\n                        // Jump to the outer loop so we use the full-block optimization.\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                while (n < opt_length) {\r\n                    buf[inbuf] = bytes[n];\r\n                    ++inbuf;\r\n                    ++n;\r\n                    if (inbuf == this.blockSize) {\r\n                        this.compress_(buf);\r\n                        inbuf = 0;\r\n                        // Jump to the outer loop so we use the full-block optimization.\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this.inbuf_ = inbuf;\r\n        this.total_ += opt_length;\r\n    };\r\n    /** @override */\r\n    Sha1.prototype.digest = function () {\r\n        var digest = [];\r\n        var totalBits = this.total_ * 8;\r\n        // Add pad 0x80 0x00*.\r\n        if (this.inbuf_ < 56) {\r\n            this.update(this.pad_, 56 - this.inbuf_);\r\n        }\r\n        else {\r\n            this.update(this.pad_, this.blockSize - (this.inbuf_ - 56));\r\n        }\r\n        // Add # bits.\r\n        for (var i = this.blockSize - 1; i >= 56; i--) {\r\n            this.buf_[i] = totalBits & 255;\r\n            totalBits /= 256; // Don't use bit-shifting here!\r\n        }\r\n        this.compress_(this.buf_);\r\n        var n = 0;\r\n        for (var i = 0; i < 5; i++) {\r\n            for (var j = 24; j >= 0; j -= 8) {\r\n                digest[n] = (this.chain_[i] >> j) & 255;\r\n                ++n;\r\n            }\r\n        }\r\n        return digest;\r\n    };\r\n    return Sha1;\r\n}(Hash));\n\n/**\r\n * Helper to make a Subscribe function (just like Promise helps make a\r\n * Thenable).\r\n *\r\n * @param executor Function which can make calls to a single Observer\r\n *     as a proxy.\r\n * @param onNoObservers Callback when count of Observers goes to zero.\r\n */\r\nfunction createSubscribe(executor, onNoObservers) {\r\n    var proxy = new ObserverProxy(executor, onNoObservers);\r\n    return proxy.subscribe.bind(proxy);\r\n}\r\n/**\r\n * Implement fan-out for any number of Observers attached via a subscribe\r\n * function.\r\n */\r\nvar ObserverProxy = /** @class */ (function () {\r\n    /**\r\n     * @param executor Function which can make calls to a single Observer\r\n     *     as a proxy.\r\n     * @param onNoObservers Callback when count of Observers goes to zero.\r\n     */\r\n    function ObserverProxy(executor, onNoObservers) {\r\n        var _this = this;\r\n        this.observers = [];\r\n        this.unsubscribes = [];\r\n        this.observerCount = 0;\r\n        // Micro-task scheduling by calling task.then().\r\n        this.task = Promise.resolve();\r\n        this.finalized = false;\r\n        this.onNoObservers = onNoObservers;\r\n        // Call the executor asynchronously so subscribers that are called\r\n        // synchronously after the creation of the subscribe function\r\n        // can still receive the very first value generated in the executor.\r\n        this.task\r\n            .then(function () {\r\n            executor(_this);\r\n        })\r\n            .catch(function (e) {\r\n            _this.error(e);\r\n        });\r\n    }\r\n    ObserverProxy.prototype.next = function (value) {\r\n        this.forEachObserver(function (observer) {\r\n            observer.next(value);\r\n        });\r\n    };\r\n    ObserverProxy.prototype.error = function (error) {\r\n        this.forEachObserver(function (observer) {\r\n            observer.error(error);\r\n        });\r\n        this.close(error);\r\n    };\r\n    ObserverProxy.prototype.complete = function () {\r\n        this.forEachObserver(function (observer) {\r\n            observer.complete();\r\n        });\r\n        this.close();\r\n    };\r\n    /**\r\n     * Subscribe function that can be used to add an Observer to the fan-out list.\r\n     *\r\n     * - We require that no event is sent to a subscriber sychronously to their\r\n     *   call to subscribe().\r\n     */\r\n    ObserverProxy.prototype.subscribe = function (nextOrObserver, error, complete) {\r\n        var _this = this;\r\n        var observer;\r\n        if (nextOrObserver === undefined &&\r\n            error === undefined &&\r\n            complete === undefined) {\r\n            throw new Error('Missing Observer.');\r\n        }\r\n        // Assemble an Observer object when passed as callback functions.\r\n        if (implementsAnyMethods(nextOrObserver, ['next', 'error', 'complete'])) {\r\n            observer = nextOrObserver;\r\n        }\r\n        else {\r\n            observer = {\r\n                next: nextOrObserver,\r\n                error: error,\r\n                complete: complete\r\n            };\r\n        }\r\n        if (observer.next === undefined) {\r\n            observer.next = noop;\r\n        }\r\n        if (observer.error === undefined) {\r\n            observer.error = noop;\r\n        }\r\n        if (observer.complete === undefined) {\r\n            observer.complete = noop;\r\n        }\r\n        var unsub = this.unsubscribeOne.bind(this, this.observers.length);\r\n        // Attempt to subscribe to a terminated Observable - we\r\n        // just respond to the Observer with the final error or complete\r\n        // event.\r\n        if (this.finalized) {\r\n            this.task.then(function () {\r\n                try {\r\n                    if (_this.finalError) {\r\n                        observer.error(_this.finalError);\r\n                    }\r\n                    else {\r\n                        observer.complete();\r\n                    }\r\n                }\r\n                catch (e) {\r\n                    // nothing\r\n                }\r\n                return;\r\n            });\r\n        }\r\n        this.observers.push(observer);\r\n        return unsub;\r\n    };\r\n    // Unsubscribe is synchronous - we guarantee that no events are sent to\r\n    // any unsubscribed Observer.\r\n    ObserverProxy.prototype.unsubscribeOne = function (i) {\r\n        if (this.observers === undefined || this.observers[i] === undefined) {\r\n            return;\r\n        }\r\n        delete this.observers[i];\r\n        this.observerCount -= 1;\r\n        if (this.observerCount === 0 && this.onNoObservers !== undefined) {\r\n            this.onNoObservers(this);\r\n        }\r\n    };\r\n    ObserverProxy.prototype.forEachObserver = function (fn) {\r\n        if (this.finalized) {\r\n            // Already closed by previous event....just eat the additional values.\r\n            return;\r\n        }\r\n        // Since sendOne calls asynchronously - there is no chance that\r\n        // this.observers will become undefined.\r\n        for (var i = 0; i < this.observers.length; i++) {\r\n            this.sendOne(i, fn);\r\n        }\r\n    };\r\n    // Call the Observer via one of it's callback function. We are careful to\r\n    // confirm that the observe has not been unsubscribed since this asynchronous\r\n    // function had been queued.\r\n    ObserverProxy.prototype.sendOne = function (i, fn) {\r\n        var _this = this;\r\n        // Execute the callback asynchronously\r\n        this.task.then(function () {\r\n            if (_this.observers !== undefined && _this.observers[i] !== undefined) {\r\n                try {\r\n                    fn(_this.observers[i]);\r\n                }\r\n                catch (e) {\r\n                    // Ignore exceptions raised in Observers or missing methods of an\r\n                    // Observer.\r\n                    // Log error to console. b/31404806\r\n                    if (typeof console !== 'undefined' && console.error) {\r\n                        console.error(e);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    };\r\n    ObserverProxy.prototype.close = function (err) {\r\n        var _this = this;\r\n        if (this.finalized) {\r\n            return;\r\n        }\r\n        this.finalized = true;\r\n        if (err !== undefined) {\r\n            this.finalError = err;\r\n        }\r\n        // Proxy is no longer needed - garbage collect references\r\n        this.task.then(function () {\r\n            _this.observers = undefined;\r\n            _this.onNoObservers = undefined;\r\n        });\r\n    };\r\n    return ObserverProxy;\r\n}());\r\n/** Turn synchronous function into one called asynchronously. */\r\nfunction async(fn, onError) {\r\n    return function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        Promise.resolve(true)\r\n            .then(function () {\r\n            fn.apply(void 0, args);\r\n        })\r\n            .catch(function (error) {\r\n            if (onError) {\r\n                onError(error);\r\n            }\r\n        });\r\n    };\r\n}\r\n/**\r\n * Return true if the object passed in implements any of the named methods.\r\n */\r\nfunction implementsAnyMethods(obj, methods) {\r\n    if (typeof obj !== 'object' || obj === null) {\r\n        return false;\r\n    }\r\n    for (var _i = 0, methods_1 = methods; _i < methods_1.length; _i++) {\r\n        var method = methods_1[_i];\r\n        if (method in obj && typeof obj[method] === 'function') {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\nfunction noop() {\r\n    // do nothing\r\n}\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Check to make sure the appropriate number of arguments are provided for a public function.\r\n * Throws an error if it fails.\r\n *\r\n * @param {!string} fnName The function name\r\n * @param {!number} minCount The minimum number of arguments to allow for the function call\r\n * @param {!number} maxCount The maximum number of argument to allow for the function call\r\n * @param {!number} argCount The actual number of arguments provided.\r\n */\r\nvar validateArgCount = function (fnName, minCount, maxCount, argCount) {\r\n    var argError;\r\n    if (argCount < minCount) {\r\n        argError = 'at least ' + minCount;\r\n    }\r\n    else if (argCount > maxCount) {\r\n        argError = maxCount === 0 ? 'none' : 'no more than ' + maxCount;\r\n    }\r\n    if (argError) {\r\n        var error = fnName +\r\n            ' failed: Was called with ' +\r\n            argCount +\r\n            (argCount === 1 ? ' argument.' : ' arguments.') +\r\n            ' Expects ' +\r\n            argError +\r\n            '.';\r\n        throw new Error(error);\r\n    }\r\n};\r\n/**\r\n * Generates a string to prefix an error message about failed argument validation\r\n *\r\n * @param {!string} fnName The function name\r\n * @param {!number} argumentNumber The index of the argument\r\n * @param {boolean} optional Whether or not the argument is optional\r\n * @return {!string} The prefix to add to the error thrown for validation.\r\n */\r\nfunction errorPrefix(fnName, argumentNumber, optional) {\r\n    var argName = '';\r\n    switch (argumentNumber) {\r\n        case 1:\r\n            argName = optional ? 'first' : 'First';\r\n            break;\r\n        case 2:\r\n            argName = optional ? 'second' : 'Second';\r\n            break;\r\n        case 3:\r\n            argName = optional ? 'third' : 'Third';\r\n            break;\r\n        case 4:\r\n            argName = optional ? 'fourth' : 'Fourth';\r\n            break;\r\n        default:\r\n            throw new Error('errorPrefix called with argumentNumber > 4.  Need to update it?');\r\n    }\r\n    var error = fnName + ' failed: ';\r\n    error += argName + ' argument ';\r\n    return error;\r\n}\r\n/**\r\n * @param {!string} fnName\r\n * @param {!number} argumentNumber\r\n * @param {!string} namespace\r\n * @param {boolean} optional\r\n */\r\nfunction validateNamespace(fnName, argumentNumber, namespace, optional) {\r\n    if (optional && !namespace)\r\n        return;\r\n    if (typeof namespace !== 'string') {\r\n        //TODO: I should do more validation here. We only allow certain chars in namespaces.\r\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) +\r\n            'must be a valid firebase namespace.');\r\n    }\r\n}\r\nfunction validateCallback(fnName, argumentNumber, callback, optional) {\r\n    if (optional && !callback)\r\n        return;\r\n    if (typeof callback !== 'function')\r\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) +\r\n            'must be a valid function.');\r\n}\r\nfunction validateContextObject(fnName, argumentNumber, context, optional) {\r\n    if (optional && !context)\r\n        return;\r\n    if (typeof context !== 'object' || context === null)\r\n        throw new Error(errorPrefix(fnName, argumentNumber, optional) +\r\n            'must be a valid context object.');\r\n}\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Code originally came from goog.crypt.stringToUtf8ByteArray, but for some reason they\r\n// automatically replaced '\\r\\n' with '\\n', and they didn't handle surrogate pairs,\r\n// so it's been modified.\r\n// Note that not all Unicode characters appear as single characters in JavaScript strings.\r\n// fromCharCode returns the UTF-16 encoding of a character - so some Unicode characters\r\n// use 2 characters in Javascript.  All 4-byte UTF-8 characters begin with a first\r\n// character in the range 0xD800 - 0xDBFF (the first character of a so-called surrogate\r\n// pair).\r\n// See http://www.ecma-international.org/ecma-262/5.1/#sec-15.1.3\r\n/**\r\n * @param {string} str\r\n * @return {Array}\r\n */\r\nvar stringToByteArray$1 = function (str) {\r\n    var out = [], p = 0;\r\n    for (var i = 0; i < str.length; i++) {\r\n        var c = str.charCodeAt(i);\r\n        // Is this the lead surrogate in a surrogate pair?\r\n        if (c >= 0xd800 && c <= 0xdbff) {\r\n            var high = c - 0xd800; // the high 10 bits.\r\n            i++;\r\n            assert(i < str.length, 'Surrogate pair missing trail surrogate.');\r\n            var low = str.charCodeAt(i) - 0xdc00; // the low 10 bits.\r\n            c = 0x10000 + (high << 10) + low;\r\n        }\r\n        if (c < 128) {\r\n            out[p++] = c;\r\n        }\r\n        else if (c < 2048) {\r\n            out[p++] = (c >> 6) | 192;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else if (c < 65536) {\r\n            out[p++] = (c >> 12) | 224;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else {\r\n            out[p++] = (c >> 18) | 240;\r\n            out[p++] = ((c >> 12) & 63) | 128;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n    }\r\n    return out;\r\n};\r\n/**\r\n * Calculate length without actually converting; useful for doing cheaper validation.\r\n * @param {string} str\r\n * @return {number}\r\n */\r\nvar stringLength = function (str) {\r\n    var p = 0;\r\n    for (var i = 0; i < str.length; i++) {\r\n        var c = str.charCodeAt(i);\r\n        if (c < 128) {\r\n            p++;\r\n        }\r\n        else if (c < 2048) {\r\n            p += 2;\r\n        }\r\n        else if (c >= 0xd800 && c <= 0xdbff) {\r\n            // Lead surrogate of a surrogate pair.  The pair together will take 4 bytes to represent.\r\n            p += 4;\r\n            i++; // skip trail surrogate.\r\n        }\r\n        else {\r\n            p += 3;\r\n        }\r\n    }\r\n    return p;\r\n};\n\n/**\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nexport { assert, assertionError, base64, base64Decode, base64Encode, CONSTANTS, deepCopy, deepExtend, patchProperty, Deferred, getUA, isMobileCordova, isNodeSdk, isReactNative, ErrorFactory, FirebaseError, patchCapture, jsonEval, stringify, decode, isAdmin, issuedAtTime, isValidFormat, isValidTimestamp, clone, contains, every, extend, findKey, findValue, forEach, getAnyKey, getCount, getValues, isEmpty, isNonNullObject, map, safeGet, querystring, querystringDecode, Sha1, async, createSubscribe, errorPrefix, validateArgCount, validateCallback, validateContextObject, validateNamespace, stringLength, stringToByteArray$1 as stringToByteArray };\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/@firebase/util/dist/index.esm.js"],"sourceRoot":""}